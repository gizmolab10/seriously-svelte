var Om=Object.defineProperty;var Nm=(n,e,t)=>e in n?Om(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var cl=(n,e,t)=>(Nm(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function ue(){}function Vm(n,e){for(const t in e)n[t]=e[t];return n}function A_(n){return n()}function ah(){return Object.create(null)}function sn(n){n.forEach(A_)}function xr(n){return typeof n=="function"}function ce(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let go;function Mm(n,e){return n===e?!0:(go||(go=document.createElement("a")),go.href=e,n===go.href)}function xm(n){return Object.keys(n).length===0}function I_(n,...e){if(n==null){for(const r of e)r(void 0);return ue}const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function se(n){let e;return I_(n,t=>e=t)(),e}function $(n,e,t){n.$$.on_destroy.push(I_(e,t))}function da(n,e,t,r){if(n){const i=C_(n,e,t,r);return n[0](i)}}function C_(n,e,t,r){return n[1]&&r?Vm(t.ctx.slice(),n[1](r(e))):t.ctx}function _a(n,e,t,r){if(n[2]&&r){const i=n[2](r(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const s=[],o=Math.max(e.dirty.length,i.length);for(let a=0;a<o;a+=1)s[a]=e.dirty[a]|i[a];return s}return e.dirty|i}return e.dirty}function pa(n,e,t,r,i,s){if(i){const o=C_(e,t,r,s);n.p(o,i)}}function ga(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function It(n,e,t){return n.set(t),e}function K(n,e){n.appendChild(e)}function B(n,e,t){n.insertBefore(e,t||null)}function F(n){n.parentNode&&n.parentNode.removeChild(n)}function Jr(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function W(n){return document.createElement(n)}function Ke(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function at(n){return document.createTextNode(n)}function J(){return at(" ")}function Te(){return at("")}function ke(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function er(n){return function(e){return e.preventDefault(),n.call(this,e)}}function Lm(n){return function(e){e.target===this&&n.call(this,e)}}function T(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function zm(n){return Array.from(n.childNodes)}function Dt(n,e){e=""+e,n.data!==e&&(n.data=e)}function jo(n,e){n.value=e??""}function C(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,r?"important":"")}function Ti(n,e,t){n.classList.toggle(e,!!t)}function Fm(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function Cn(n,e){return new n(e)}let ws;function _s(n){ws=n}function gu(){if(!ws)throw new Error("Function called outside component initialization");return ws}function Zt(n){gu().$$.on_mount.push(n)}function Bm(n){gu().$$.on_destroy.push(n)}function Fs(){const n=gu();return(e,t,{cancelable:r=!1}={})=>{const i=n.$$.callbacks[e];if(i){const s=Fm(e,t,{cancelable:r});return i.slice().forEach(o=>{o.call(n,s)}),!s.defaultPrevented}return!0}}const ui=[],ut=[];let mi=[];const Nl=[],R_=Promise.resolve();let Vl=!1;function P_(){Vl||(Vl=!0,R_.then(S_))}function Um(){return P_(),R_}function qo(n){mi.push(n)}function vs(n){Nl.push(n)}const hl=new Set;let ii=0;function S_(){if(ii!==0)return;const n=ws;do{try{for(;ii<ui.length;){const e=ui[ii];ii++,_s(e),jm(e.$$)}}catch(e){throw ui.length=0,ii=0,e}for(_s(null),ui.length=0,ii=0;ut.length;)ut.pop()();for(let e=0;e<mi.length;e+=1){const t=mi[e];hl.has(t)||(hl.add(t),t())}mi.length=0}while(ui.length);for(;Nl.length;)Nl.pop()();Vl=!1,hl.clear(),_s(n)}function jm(n){if(n.fragment!==null){n.update(),sn(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(qo)}}function qm(n){const e=[],t=[];mi.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),mi=e}const Do=new Set;let Lr;function de(){Lr={r:0,c:[],p:Lr}}function _e(){Lr.r||sn(Lr.c),Lr=Lr.p}function P(n,e){n&&n.i&&(Do.delete(n),n.i(e))}function V(n,e,t,r){if(n&&n.o){if(Do.has(n))return;Do.add(n),Lr.c.push(()=>{Do.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}function fn(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function wr(n,e,t){const r=n.$$.props[e];r!==void 0&&(n.$$.bound[r]=t,t(n.$$.ctx[r]))}function Q(n){n&&n.c()}function X(n,e,t){const{fragment:r,after_update:i}=n.$$;r&&r.m(e,t),qo(()=>{const s=n.$$.on_mount.map(A_).filter(xr);n.$$.on_destroy?n.$$.on_destroy.push(...s):sn(s),n.$$.on_mount=[]}),i.forEach(qo)}function Y(n,e){const t=n.$$;t.fragment!==null&&(qm(t.after_update),sn(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Hm(n,e){n.$$.dirty[0]===-1&&(ui.push(n),P_(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Pe(n,e,t,r,i,s,o=null,a=[-1]){const l=ws;_s(n);const u=n.$$={fragment:null,ctx:[],props:s,update:ue,not_equal:i,bound:ah(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:ah(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let h=!1;if(u.ctx=t?t(n,e.props||{},(f,d,...p)=>{const g=p.length?p[0]:d;return u.ctx&&i(u.ctx[f],u.ctx[f]=g)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](g),h&&Hm(n,f)),d}):[],u.update(),h=!0,sn(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const f=zm(e.target);u.fragment&&u.fragment.l(f),f.forEach(F)}else u.fragment&&u.fragment.c();e.intro&&P(n.$$.fragment),X(n,e.target,e.anchor),S_()}_s(l)}class Se{constructor(){cl(this,"$$");cl(this,"$$set")}$destroy(){Y(this,1),this.$destroy=ue}$on(e,t){if(!xr(t))return ue;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!xm(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Gm="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Gm);const si=[];function qe(n,e=ue){let t;const r=new Set;function i(a){if(ce(n,a)&&(n=a,t)){const l=!si.length;for(const u of r)u[1](),si.push(u,n);if(l){for(let u=0;u<si.length;u+=2)si[u][0](si[u+1]);si.length=0}}}function s(a){i(a(n))}function o(a,l=ue){const u=[a,l];return r.add(u),r.size===1&&(t=e(i,s)||ue),a(n),()=>{r.delete(u),r.size===0&&t&&(t(),t=null)}}return{set:i,update:s,subscribe:o}}const Br=qe(),Tn=qe(),Ho=qe(),fl=qe(),mn=qe(),_t=qe(),Gr=qe(),At=qe(),Go=qe(),Ml=qe(),Pn=qe(),Oo=qe(),xn=qe(),ma=qe(),vr=qe(),Ei=qe(),Fe=qe(),lt=qe(),dl=qe(),Ur=qe(),tr=qe(),di=qe(),zn=qe(),yn=qe(),ks=qe(),D_=qe(),Ts=qe(),xl=qe(),Ko=qe(),Km=qe(),O_=qe(),jr=qe(),Ll=qe(),ya=qe(),cn=qe();class Wm{constructor(){this.notes={},this.notes={126:["December 29, 2024","rename rings as radial"],125:["December 28, 2024","working import and export buttons in Storage"],124:["December 27, 2024","files can move across dbs"],123:["December 19, 2024","begin work on tutorial"],122:["December 17, 2024","improved details"],121:["December 11, 2024","fix breadcrumb button cosmetics"],120:["December 9, 2024","save and read subtrees"],119:["November 30, 2024","can save to a file (and fetch) entire hierarchy"],118:["November 27, 2024","OFFICIAL ALPHA RELEASE"],117:["November 19, 2024","new details mode segmented"],116:["November 1, 2024","adopt segmented controls"],115:["October 6, 2024","graph, touch, controls on mobile"],114:["October 2, 2024","begin work on mobile)"],113:["September 24, 2024","add new game feature (consequences & quests)"],112:["September 12, 2024","new info details"],111:["September 8, 2024","new resize ring"],110:["August 30, 2024","airtable dbid support"],109:["August 22, 2024","rotate cluster label tangent to arc"],108:["August 18, 2024","paging persists for multiple things and dbs"],107:["August 12, 2024","thumb works (funky)"],106:["August 1, 2024","fixed netlify cluster mode"],105:["July 30, 2024","corrected thumb position and shape of arc and thumb"],104:["July 2, 2024","save and restore paging thumb position"],103:["June 30, 2024","paging thumb button works"],102:["June 18, 2024","visibility logic for advance buttons"],101:["June 13, 2024","limit the number of things within each cluster"],100:["June 6, 2024","significantly reduce stutter during rotation_ring rotation"],99:["June 4, 2024","expand help content and move to help-webseriously.netlify.app"],98:["May 23, 2024","double-click drag to alter ring button radius"],97:["May 20, 2024","cluster rotation perfected, improved memory usage"],96:["May 14, 2024","nearly perfect cluster curly braces, new cluster line angles"],95:["May 10, 2024","add color editing"],94:["May 4, 2024","replace to/from with child/parent and directions with isBidirectional"],93:["May 2, 2024","convert cluster arc into a bracket ( { )"],92:["April 29, 2024","assure things fit in cluster, show cluster arc"],91:["April 23, 2024","fix hover, grab highlight, tools, switching db"],90:["April 10, 2024","display related things clusters"],89:["March 28, 2024","display focus in clusters"],88:["March 26, 2024","resume support for Airtable"],87:["March 22, 2024","begin work on circle layout"],86:["March 10, 2024","vertical parent count dots inside drag dot"],85:["March 6, 2024","move tiny dots in crumbs to surround reveal dots"],84:["March 3, 2024","click title of thing to grab, tiny dots in crumbs"],83:["February 24, 2024","cluster tools: hover and disable logic"],82:["February 16, 2024","add zoom in/out buttons for mobile"],81:["February 15, 2024","new panel layout"],80:["February 13, 2024","dynamic ancestries for child and parent all seemingly working"],79:["February 2, 2024","working on relations"],78:["January 29, 2024","added two new tools to tools cluster"],77:["January 27, 2024","tools cluster is now an overlay hiding title and reveal dot"],76:["January 25, 2024","relocate focus title in graph (default with url query alternative)"],75:["January 23, 2024","switched ancestry ids from things to relationships"],74:["January 20, 2024","fixed most remaining ancestry design bugs"],73:["January 13, 2024","ancestries mostly working"],72:["January 11, 2024","ancestry based design"],71:["January 7, 2024","try to stop using thing ids for grab, focus, etc."],70:["December 24, 2023","center graph"],69:["December 21, 2023","remount graph on relocate and hide/show children"],68:["December 17, 2023","relayout on title edit keystrokes"],67:["December 15, 2023","add div and origin to all components, position: absolute"],66:["November 28, 2023","configuration netlify content security profile"],65:["November 27, 2023","size slider"],64:["November 24, 2023","perfect scrolling"],63:["November 20, 2023","add select notification"],62:["November 13, 2023","cluster dot tweaks"],61:["November 13, 2023","lots of cosmetic cleanups & added query stradial"],60:["November 12, 2023","massive cosmetic tweaks"],59:["November 9, 2023","added ip logging"],58:["November 3, 2023","begin work on reveal cluster"],57:["October 31, 2023","separate bulk collections"],56:["October 27, 2023","fat triangle for all reveal dots"],55:["October 25, 2023","double-click drag dot applies focus"],54:["October 21, 2023","restore details at left"],53:["October 20, 2023","fix add child bugs"],52:["October 13, 2023","new bulks correctly created"],51:["October 12, 2023","new admin view of all data"],50:["October 10, 2023","eliminate details view, show focus title at top"],49:["October 10, 2023","create private firebase bulks as needed"],48:["October 9, 2023","private firebase bulks"],47:["October 9, 2023","two netlify query stradial"],46:["October 8, 2023","perfect editing and browsing"],45:["October 7, 2023","children origins are perfect"],44:["October 5, 2023","scrolling works"],43:["October 3, 2023","fetch Catalist data, HAH!"],41:["October 3, 2023","almost perfectly laid out graph"],40:["September 26, 2023","lines use children height"],39:["September 19, 2023","highlight grabbed root, eliminate line clipping"],38:["September 18, 2023","add fat triangle for focus, click it to go left"],37:["September 16, 2023","position widgets correctly at ends of curves"],36:["September 12, 2023","draw curves, switch public to show them"],35:["September 8, 2023","begin work on bubble.io plugin and svg"],34:["September 3, 2023","crumbs update on db switch"],33:["September 2, 2023","separate hierarchy for each db"],32:["August 31, 2023","manage order changes in snapshots"],31:["August 30, 2023","add child, duplicate and delete"],30:["August 26, 2023","clean construction of relationships"],29:["August 22, 2023","synchronize relocated things"],28:["August 21, 2023","synchronize title edits"],27:["August 20, 2023","firebase relationships"],26:["August 17, 2023","cloud abstraction layer"],25:["August 15, 2023","switch between db IDSignal"],24:["August 15, 2023","bulk for private/public, shared predicates"],23:["August 14, 2023","synchronization works, a goal 8 years long"],22:["August 13, 2023","locally persist db type"],21:["August 13, 2023","select db type"],20:["August 13, 2023","firebase private databases"],17:["August 12, 2023","better help"],12:["August 10, 2023","relocate things"],11:["August 8, 2023","display build number"],10:["August 2, 2023","refactor Panel into Startup"]},this.latest=Object.keys(this.notes).slice(-1)[0]}}const N_=new Wm;Object.defineProperty(String.prototype,"unCamelCase",{value:function(){return this.replace(/([A-Z])/g," $1").toLowerCase()},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"removeWhiteSpace",{value:function(){return this.split(`
`).join(" ").split("	").join("")},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"lastWord",{value:function(){return this.split(" ").slice(-1)[0]},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"fontSize_relativeTo",{value:function(n){return this.includes("em")?n*parseFloat(this.split("em")[0]):this.includes("px")?Number(this.split("em")[0]):Number(this)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"injectEllipsisAt",{value:function(n=6){let e=this;const t=e.length;return t>n*2+1&&(e=e.slice(0,n)+" ... "+e.slice(t-n,t)),e},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"clipWithEllipsisAt",{value:function(n=15){let e=this;return e.length>n&&(e=e.slice(0,n)+" ..."),e},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"hash",{value:function(){var n=0,e,t;if(this.length===0)return n;for(e=0;e<this.length;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(String.prototype,"sizeOf_svgPath",{value:function(){return this.split(" ").slice(-1)[0]},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(String.prototype,"html_encode",{value:function(){let n=this.replace(/\n+/g,"").trim();return encodeURIComponent(n).replace(/%22/g,"'").replace(/%2B/g,"+").replace(/%3A/g,":").replace(/%3F/g,"?").replace(/%23/g,"#").replace(/%2F/g,"/").replace(/%3D/g,"=").replace(/%20/g," ")},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"isAlmost",{value:function(n,e){return Math.abs(this-n)<e},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"force_between",{value:function(n,e){const t=Math.max(n,e),r=Math.min(n,e);return Math.max(r,Math.min(t,this))},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"increment",{value:function(n,e){return this.increment_by(n?1:-1,e)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"increment_by",{value:function(n,e){var t=this.valueOf()+n;return t.normalize_between_zeroAnd(e)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"add_angle_normalized",{value:function(n){return(this+n).angle_normalized()},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"straddles_zero",{value:function(n){return this.angle_normalized()>n.angle_normalized()},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"angle_normalized",{value:function(){return this.normalize_between_zeroAnd(Math.PI*2)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"angle_normalized_aroundZero",{value:function(){return(this+Math.PI).angle_normalized()-Math.PI},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"isBetween",{value:function(n,e,t){const r=Math.min(n,e),i=Math.max(n,e);return t?this>=r&&this<=i:this>r&&this<i},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"roundToEven",{value:function(){return Math.round(this/2)*2},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"degrees_of",{value:function(n){return(this*180/Math.PI).toFixed(n)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"isClocklyBetween",{value:function(n,e,t){const i=this.normalize_between_zeroAnd(t)-t;var s=Math.min(n,e),o=Math.max(n,e);return this.isBetween(s,o,!0)||i.isBetween(s,o,!0)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"isClocklyAlmost",{value:function(n,e,t){return this.isClocklyBetween(n-e,n+e,t)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"expressZero_asHyphen",{value:function(){return this==0?"-":this},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"toFixed",{value:function(n){return new Intl.NumberFormat("en-US",{style:"decimal",maximumFractionDigits:n,minimumFractionDigits:n}).format(this)},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"bump_towards",{value:function(n,e,t){return this<n||this.isAlmost(n,t)?n:this>e||this.isAlmost(e,t)?e:this},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"increment_by_assuring",{value:function(n,e){var t=Math.abs(n),r=this.valueOf();if(r<t&&t!=n)return 0;var i=r+n;return i=Math.min(e-t,i),i},writable:!1,enumerable:!1,configurable:!1});Object.defineProperty(Number.prototype,"normalize_between_zeroAnd",{value:function(n){let e=this;for(;e<0;)e+=n;for(;e>=n;)e-=n;return e},writable:!1,enumerable:!1,configurable:!1});var Yt=(n=>(n.upperRight="ur",n.upperLeft="ul",n.lowerLeft="ll",n.lowerRight="lr",n))(Yt||{}),$n=(n=>(n.right="right",n.left="left",n.down="down",n.up="up",n))($n||{});const wn=class Bn{constructor(e){this.angle=e}static radians_from_degrees(e){return Math.PI/180*e}get angle_orientsDown(){return this.orientation_ofAngle=="down"}get quadrant_basis_angle(){return we.basis_angle_ofQuadrant(this.quadrant_ofAngle)}get angle_slantsForward(){const e=this.quadrant_ofAngle;return["lr","ul"].includes(e)}get angle_pointsRight(){switch(this.quadrant_ofAngle){case"lr":return!0;case"ur":return!0;default:return!1}}get orientation_ofAngle(){let e=this.quadrant_ofAngle;const t=this.angle.normalize_between_zeroAnd(Bn.quarter)<Bn.quarter/2;switch(e){case"ur":return t?"right":"up";case"ul":return t?"up":"left";case"ll":return t?"left":"down";case"lr":return t?"down":"right"}}get quadrant_ofAngle(){const e=this.angle.angle_normalized();let t="lr";return e.isBetween(0,Bn.quarter,!0)&&(t="ur"),e.isBetween(Bn.quarter,Bn.half,!0)&&(t="ul"),e.isBetween(Bn.half,Bn.three_quarters,!0)&&(t="ll"),t}get octant_ofAngle(){const e=this.angle.angle_normalized();let t=Bn.sixteenth;for(let r=0;r<8;r++){if(e<t)return r;t+=Bn.eighth}return 0}get cursor_forAngle(){if(this.angle)switch(this.octant_ofAngle%4){case 0:return"ns-resize";case 1:return"nwse-resize";case 2:return"ew-resize";case 3:return"nesw-resize"}return""}};wn.zero=0;wn.full=Math.PI*2;wn.half=wn.full/2;wn.quarter=wn.full/4;wn.three_quarters=wn.quarter*3;wn.sixteenth=wn.full/16;wn.eighth=wn.full/8;let $e=wn;class G{constructor(e=0,t=0){this.x=e,this.y=t}get asSize(){return new Xe(this.x,this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get toPolar(){return{r:this.magnitude,phi:this.angle}}get isZero(){return this.x==0&&this.y==0}get pixelVerbose(){return`${this.x.toFixed(2)}px ${this.y.toFixed(2)}px`}get verbose(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}get description(){return`${this.x.toFixed(2)} ${this.y.toFixed(2)}`}get negated(){return this.multipliedBy(-1)}get doubled(){return this.multipliedBy(2)}get negatedInHalf(){return this.dividedBy(-2)}get dividedInHalf(){return this.dividedBy(2)}get copy(){return new G(this.x,this.y)}get swap(){return new G(this.y,this.x)}get negateY(){return new G(this.x,-this.y)}get negateX(){return new G(-this.x,this.y)}get abs(){return new G(Math.abs(this.x),Math.abs(this.y))}offsetByX(e){return this.offsetByXY(e,0)}offsetByY(e){return this.offsetByXY(0,e)}offsetEquallyBy(e){return this.offsetByXY(e,e)}offsetByXY(e,t){return new G(this.x+e,this.y+t)}offsetBy(e){return new G(this.x+e.x,this.y+e.y)}vector_to(e){return e.offsetBy(this.negated)}vector_from(e){return e.vector_to(this)}xMultipliedBy(e){return new G(this.x*e,this.y)}yMultipliedBy(e){return new G(this.x,this.y*e)}dividedBy(e){return new G(this.x/e,this.y/e)}multipliedBy(e){return new G(this.x*e,this.y*e)}static fromPolar(e,t){return G.x(e).rotate_by(t)}static fromDOMRect(e){return new G(e.left,e.top)}static square(e){return new G(e,e)}static x(e){return new G(e,0)}static y(e){return new G(0,e)}static get zero(){return new G}get angle(){return Math.atan2(-this.y,this.x)}get quadrant_ofPoint(){const e=this.x,t=this.y;return e>=0&&t>=0?Yt.upperRight:e<0&&t>=0?Yt.upperLeft:e<0&&t<0?Yt.lowerLeft:Yt.lowerRight}get orientation_ofVector(){let e=new $e(this.angle).quadrant_ofAngle;const t=this.angle.normalize_between_zeroAnd($e.quarter)<Math.PI/4;switch(e){case Yt.upperRight:return t?$n.right:$n.up;case Yt.upperLeft:return t?$n.up:$n.left;case Yt.lowerLeft:return t?$n.left:$n.down;case Yt.lowerRight:return t?$n.down:$n.right}}rotate_by(e){const t=Math.cos(e),r=Math.sin(e);return new G(this.x*t-this.y*r,-(this.y*t+this.x*r))}isContainedBy_path(e){const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Failed to get 2D context");t.width=window.innerWidth,t.height=window.innerHeight;const i=new Path2D(e);return r.isPointInPath(i,this.x,this.y)}static origin_inWindowCoordinates_for(e){let t=e,r=G.zero;for(;t;)r=r.offsetByXY(t.offsetLeft,t.offsetTop),t=t.offsetParent;return r}}class Xe{constructor(e=0,t=0){this.height=t,this.width=e}get isZero(){return this.width==0&&this.height==0}get proportion(){return this.width/this.height}get description(){return`${this.width.toFixed(2)} ${this.height.toFixed(2)}`}get verbose(){return`(${this.width.toFixed(2)}, ${this.height.toFixed(2)})`}get pixelVerbose(){return`${this.width.toFixed(2)}px ${this.height.toFixed(2)}px`}get asPoint(){return new G(this.width,this.height)}get copy(){return new Xe(this.width,this.height)}get swap(){return new Xe(this.height,this.width)}get negated(){return this.multipliedBy(-1)}get dividedInHalf(){return this.dividedBy(2)}reducedBy(e){return this.expandedBy(e.negated)}expandedByX(e){return new Xe(this.width+e,this.height)}expandedByY(e){return new Xe(this.width,this.height+e)}expandedByXY(e,t){return new Xe(this.width+e,this.height+t)}expandedEquallyBy(e){return new Xe(this.width+e,this.height+e)}expandedBy(e){return new Xe(this.width+e.x,this.height+e.y)}dividedBy(e){return new Xe(this.width/e,this.height/e)}multipliedBy(e){return new Xe(this.width*e,this.height*e)}unionWith(e){return new Xe(Math.max(this.width,e.width),Math.max(this.height,e.height))}subtracting(e){return new G(this.width-e.width,this.height-e.height)}static fromDOMRect(e){return new Xe(e.width,e.height)}static square(e){return new Xe(e,e)}static get zero(){return new Xe}}class De{constructor(e=G.zero,t=Xe.zero){this.origin=e,this.size=t}get isZero(){return this.origin.isZero&&this.size.isZero}get description(){return`${this.origin.verbose}, ${this.size.verbose}`}get viewBox(){return`${this.origin.description} ${this.size.description}`}get pixelVerbose(){return`${this.origin.pixelVerbose} ${this.size.pixelVerbose}`}get rangeDescription(){return`(${this.origin.x.toFixed(2)} ... ${this.extent.x.toFixed(2)}), (${this.origin.y.toFixed(2)} ... ${this.extent.y.toFixed(2)})`}get center(){return this.origin.offsetBy(this.size.asPoint.dividedInHalf)}get extent(){return this.origin.offsetBy(this.size.asPoint)}get topRight(){return new G(this.extent.x,this.origin.y)}get centerTop(){return new G(this.center.x,this.origin.y)}get bottomLeft(){return new G(this.origin.x,this.extent.y)}get centerLeft(){return new G(this.origin.x,this.center.y)}get centerRight(){return new G(this.extent.x,this.center.y)}get centerBottom(){return new G(this.center.x,this.extent.y)}get copy(){return new De(this.origin.copy,this.size.copy)}get dividedInHalf(){return new De(this.origin,this.size.multipliedBy(-1/2))}get atZero_forX(){return new De(G.y(this.origin.y),this.size)}get atZero_forY(){return new De(G.x(this.origin.x),this.size)}get atZero(){return new De(G.zero,this.size)}static get zero(){return new De(G.zero,Xe.zero)}static createSizeRect(e){return new De(G.zero,e)}offsetByX(e){return new De(this.origin.offsetByX(e),this.size)}offsetByY(e){return new De(this.origin.offsetByY(e),this.size)}offsetBy(e){return new De(this.origin.offsetBy(e),this.size)}originMultipliedBy(e){return new De(this.origin.multipliedBy(e),this.size)}xMultipliedBy(e){return new De(this.origin.xMultipliedBy(e),this.size)}yMultipliedBy(e){return new De(this.origin.yMultipliedBy(e),this.size)}expandedBy(e){const t=this.size.expandedBy(e),r=this.origin.vector_from(e);return new De(r,t)}contains(e){const t=this.origin,r=this.extent;return e.x.isBetween(t.x,r.x,!0)&&e.y.isBetween(t.y,r.y,!0)}corners_forAngle(e){switch(new $e(e).quadrant_ofAngle){case Yt.lowerRight:return[this.bottomLeft,this.topRight];case Yt.upperLeft:return[this.topRight,this.bottomLeft];case Yt.lowerLeft:return[this.extent,this.origin];default:return[this.origin,this.extent]}}static createExtentRect(e,t){return new De(e,t.vector_from(e).asSize)}static createRightCenterRect(e,t){return new De(e.offsetByY(t.height/-2),t)}static createCenterRect(e,t){const r=t.asPoint.dividedInHalf,i=e.offsetBy(r.negated);return new De(i,t)}static rect_forElement_containsPoint(e,t){const r=De.boundingRectFor(e);return(r==null?void 0:r.contains(t))??!1}static rect_forElement_containsEvent(e,t){const r=De.boundingRectFor(e),i=we.pointFor_mouseEvent(t);return(r==null?void 0:r.contains(i))??!1}static createFromDOMRect(e){if(e){const t=new G(e.x,e.y).offsetByXY(window.scrollX,window.scrollY);return new De(t,new Xe(e.width,e.height))}return null}static rect_forComponent_contains(e,t){const r=De.rect_forComponent(e),i=we.pointFor_mouseEvent(t);return r.isZero?!1:r.contains(i)}static boundingRectFor(e){if(e){const t=e.getBoundingClientRect(),r=G.fromDOMRect(t),i=Xe.fromDOMRect(t);return new De(r,i)}return null}static rect_forComponent(e){const t=e.offsetTop,r=e.offsetLeft,i=e.offsetWidth,s=e.offsetHeight;return(t||t==0)&&(r||r==0)&&i&&s?new De(new G(r,t),new Xe(i,s)):De.zero}}var pr=(n=>(n.deleting="deleting",n.adding="adding",n))(pr||{}),kr=(n=>(n.radial="radial",n.tree="tree",n))(kr||{}),Kr=(n=>(n.selection="selection",n.focus="focus",n))(Kr||{}),Vn=(n=>(n.import="import",n.export="export",n))(Vn||{}),yi=(n=>(n.children="children",n.parents="parents",n.related="related",n))(yi||{}),Un=(n=>(n.isFromPersistent="isFrom",n.getPersistentID="getID",n.none="",n))(Un||{}),gn=(n=>(n.flat="flat",n.down="down",n.up="up",n))(gn||{}),Ue=(n=>(n[n.storage=0]="storage",n[n.tools=1]="tools",n[n.recents=2]="recents",n[n.info=3]="info",n))(Ue||{});Ue[0],Ue[1],Ue[2],Ue[3];var jn=(n=>(n.start="start",n.fetch="fetch",n.empty="empty",n.ready="ready",n))(jn||{}),Ft=(n=>(n.generic="",n.roots="^",n.root="!",n.bulk="~",n))(Ft||{}),tn=(n=>(n.miss="miss",n.resize="resize",n.rotate="rotate",n.paging="paging",n))(tn||{}),on=(n=>(n.middle="middle",n.right="right",n.left="left",n.full="full",n))(on||{}),tt=(n=>(n.appreciates="appreciates",n.isRelated="isRelated",n.contains="contains",n.explains="explains",n.requires="requires",n.supports="supports",n))(tt||{}),Ai=(n=>(n.consequence="consequence",n.hyperlink="hyperlink",n.generic="generic",n.money="money",n.phone="phone",n.quest="quest",n.note="note",n.date="date",n.sum="sum",n))(Ai||{}),Le=(n=>(n.details="show details view",n.builds="show build notes",n.smaller="smaller",n.bigger="bigger",n.open="open",n.help="?",n))(Le||{}),fr=(n=>(n.explorer="explorer",n.unknown="unknown",n.firefox="firefox",n.chrome="chrome",n.safari="safari",n.opera="opera",n.orion="orion",n))(fr||{}),dn=(n=>(n.control="control",n.storage="storage",n.reveal="reveal",n.widget="widget",n.crumb="crumb",n.focus="focus",n.drag="drag",n.info="info",n.none="none",n.tool="tool",n))(dn||{}),Es=(n=>(n.directional="directional",n.clusters="clusters",n.necklace="necklace",n.reveal="reveal",n.widget="widget",n.crumbs="crumbs",n.crumb="crumb",n.tools="tools",n.radial="radial",n.panel="panel",n.info="info",n.tree="tree",n.line="line",n.drag="drag",n))(Es||{}),Ee=(n=>(n[n.common=0]="common",n[n.paging=1]="paging",n[n.radial=2]="radial",n[n.backmost=3]="backmost",n[n.lines=4]="lines",n[n.text=5]="text",n[n.dots=6]="dots",n[n.widgets=7]="widgets",n[n.tools=8]="tools",n[n.tool_buttons=9]="tool_buttons",n[n.details=10]="details",n[n.frontmost=11]="frontmost",n))(Ee||{}),te=(n=>(n.delete_confirm="delete_confirm",n.delete_cancel="delete_cancel",n.delete_parent="delete_parent",n.confirmation="confirmation",n.add_parent="add_parent",n.dismiss="dismiss",n.delete="delete",n.create="create",n.next="next",n.more="more",n.none="none",n))(te||{}),ht=(n=>(n.banners="banners",n.details="details",n.rotate="rotate",n.paging="paging",n.widget="widget",n.button="button",n.reveal="reveal",n.graph="graph",n.thumb="thumb",n.tools="tools",n.title="title",n.drag="drag",n.line="line",n.app="app",n))(ht||{});function _i(n,e,t){return Math.min(Math.max(n,t),e)}class Xm extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var os=Xm;function Ym(n){if(typeof n!="string")throw new os(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=ry.test(n)?Zm(n):n;const t=$m.exec(e);if(t){const o=Array.from(t).slice(1);return[...o.slice(0,3).map(a=>parseInt(As(a,2),16)),parseInt(As(o[3]||"f",2),16)/255]}const r=ey.exec(e);if(r){const o=Array.from(r).slice(1);return[...o.slice(0,3).map(a=>parseInt(a,16)),parseInt(o[3]||"ff",16)/255]}const i=ty.exec(e);if(i){const o=Array.from(i).slice(1);return[...o.slice(0,3).map(a=>parseInt(a,10)),parseFloat(o[3]||"1")]}const s=ny.exec(e);if(s){const[o,a,l,u]=Array.from(s).slice(1).map(parseFloat);if(_i(0,100,a)!==a)throw new os(n);if(_i(0,100,l)!==l)throw new os(n);return[...iy(o,a,l),Number.isNaN(u)?1:u]}throw new os(n)}function Qm(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0)%2341}const lh=n=>parseInt(n.replace(/_/g,""),36),Jm="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const t=lh(e.substring(0,3)),r=lh(e.substring(3)).toString(16);let i="";for(let s=0;s<6-r.length;s++)i+="0";return n[t]=`${i}${r}`,n},{});function Zm(n){const e=n.toLowerCase().trim(),t=Jm[Qm(e)];if(!t)throw new os(n);return`#${t}`}const As=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),$m=new RegExp(`^#${As("([a-f0-9])",3)}([a-f0-9])?$`,"i"),ey=new RegExp(`^#${As("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),ty=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${As(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),ny=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,ry=/^[a-z]+$/i,uh=n=>Math.round(n*255),iy=(n,e,t)=>{let r=t/100;if(e===0)return[r,r,r].map(uh);const i=(n%360+360)%360/60,s=(1-Math.abs(2*r-1))*(e/100),o=s*(1-Math.abs(i%2-1));let a=0,l=0,u=0;i>=0&&i<1?(a=s,l=o):i>=1&&i<2?(a=o,l=s):i>=2&&i<3?(l=s,u=o):i>=3&&i<4?(l=o,u=s):i>=4&&i<5?(a=o,u=s):i>=5&&i<6&&(a=s,u=o);const h=r-s/2,f=a+h,d=l+h,p=u+h;return[f,d,p].map(uh)};function sy(n,e,t,r){return`rgba(${_i(0,255,n).toFixed()}, ${_i(0,255,e).toFixed()}, ${_i(0,255,t).toFixed()}, ${parseFloat(_i(0,1,r).toFixed(3))})`}function oy(n,e){const[t,r,i,s]=Ym(n);return sy(t,r,i,s-e)}class ay{constructor(){this.dot_size=13,this.font_size=14,this.width_max=200,this.line_stretch=22,this.height_banner=35,this.halfIncrement=.5,this.width_details=200,this.zoom_in_ratio=1.1,this.default_buttonSize=16,this.height_breadcrumbs=33,this.threshold_longClick=800,this.innermost_ring_radius=75,this.editingTools_diameter=64,this.threshold_doubleClick=700,this.hid_unknown=1e12,this.ring_resizing_thickness=30,this.ring_rotation_thickness=44,this.prevent_selection_style="-webkit-user-select: none; user-select: none; -moz-user-select: none",this.local_help_url="http://localhost:8000/README.html",this.remote_help_url="https://help.webseriously.org",this.title_default="Please, enter a title",this.title_line="------------------------",this.name_bulkAdmin="Jonathan Sand",this.color_highlighted="#9e7daa",this.color_disabled="lightGray",this.thing_color_default="blue",this.baseID_test="handcrafted",this.color_background="white",this.cursor_default="default",this.generic_separator="::",this.color_default="black",this.small_separator=":::",this.big_separator="::::",this.baseID_file="data",this.unknown="unknown",this.newLine=`
`,this.comma=",",this.space=" ",this.empty="",this.build_number=N_.latest,this.row_height=this.dot_size+7,this.zoom_out_ratio=1/this.zoom_in_ratio,this.paging_arc_thickness=this.ring_rotation_thickness/3,this.ring_widget_padding=(this.ring_rotation_thickness-1)/2}}const I=new ay,V_=class M_{ignore(e){}concatenateArrays(e,t){return[...e,...t]}quadrant_ofAngle(e){return new $e(e).quadrant_ofAngle}pointFor_mouseEvent(e){return new G(e.clientX,e.clientY)}location_ofMouseEvent(e){return new G(e.clientX,e.clientY)}opacitize(e,t){return oy(e,1-t)}getWidthOf(e){return this.getWidth_ofString_withSize(e,`${I.font_size}px`)}subtract_arrayFrom(e,t){return t.filter(r=>e.filter(i=>r!=i))}strip_invalid(e){return this.strip_identifiableDuplicates(this.strip_falsies(e))}sort_byOrder(e){return e.sort((t,r)=>t.order-r.order)}uniquely_concatenateArrays(e,t){return this.strip_invalid(this.concatenateArrays(e,t))}apply(e,t){e(!0),t(),e(!1)}copyObject(e){const t=Object.create(Object.getPrototypeOf(e));return Object.assign(t,e),t}getFontOf(e){const t=window.getComputedStyle(e),r=t.fontFamily;return`${t.fontSize} ${r}`}remove(e,t){const r=e.findIndex(i=>i===t);r!==-1&&e.splice(r,1)}sort_byTitleTop(e){return e.sort((t,r)=>{var o,a;const i=(o=t.titleRect)==null?void 0:o.origin.y,s=(a=r.titleRect)==null?void 0:a.origin.y;return!i||!s?0:i-s})}strip_hidDuplicates(e){let t={},r=[];for(const i of e){const s=i.idHashed;(s||s==0)&&!t[s]&&(t[s]=i,r.push(i))}return r}strip_falsies(e){let t=[];for(const r of e)r&&t.push(r);return t}strip_identifiableDuplicates(e){let t={},r=[];for(const i of e){const s=i.idHashed;(s||s==0)&&!t[s]&&(t[s]=i,r.push(i))}return r}strip_thingDuplicates_from(e){var i;let t={},r=[];for(const s of e){const o=(i=s.thing)==null?void 0:i.id.hash();(o||o==0)&&!t[o]&&(t[o]=s,r.push(s))}return r}basis_angle_ofQuadrant(e){switch(e){case Yt.upperRight:return $e.three_quarters;case Yt.lowerLeft:return $e.quarter;case Yt.upperLeft:return $e.half;default:return 0}}convertToObject(e,t){const r={};for(const i of t)e.hasOwnProperty(i)&&(r[i]=e[i]);return r}removeAll(e,t){var r=t,i=t.length;do i=r.length,r=r.replace(e,"");while(i!=r.length);return r}polygonPoints(e,t,r){const i=$e.full/t,s=[];let o=r,a=t;do s.push(G.fromPolar(e,o)),o+=i,a--;while(a>0);return s}get browserType(){const e=navigator.userAgent;switch(!0){case(/msie (\d+)/i.test(e)||/trident\/.*; rv:(\d+)/i.test(e)):return fr.explorer;case/(chrome|crios)\/(\d+)/i.test(e):return fr.chrome;case/firefox\/(\d+)/i.test(e):return fr.firefox;case/opr\/(\d+)/i.test(e):return fr.opera;case/orion\/(\d+)/i.test(e):return fr.orion;case/safari\/(\d+)/i.test(e):return fr.safari;default:return fr.unknown}}ancestries_orders_normalize_persistentMaybe(e,t=!0){this.sort_byOrder(e),e.forEach((r,i)=>{if(r.order!=i){const s=r.relationship;s==null||s.order_setTo_persistentMaybe(i,t)}})}getWidth_ofString_withSize(e,t){const r=document.createElement("div");r.style.fontFamily=se(zn),r.style.left="-9999px",r.style.padding="0px 0px 0px 0px",r.style.position="absolute",r.style.fontSize=t,r.style.whiteSpace="pre",r.textContent=e,document.body.appendChild(r);const i=r.scrollWidth;return document.body.removeChild(r),i}colorToHex(e){const t=document.createElement("div");t.style.color=e,document.body.appendChild(t);const r=getComputedStyle(t).color;document.body.removeChild(t);const i=r.match(/\d+/g);if(!i)throw new Error("Invalid color input");let s="#";for(let o=0;o<3;o++){let a=parseInt(i[o]).toString(16);a.length===1&&(a="0"+a),s+=a}return s}sizeFrom_svgPath(e){let t=1/0,r=1/0,i=-1/0,s=-1/0;const o=e.match(/[a-zA-Z][^a-zA-Z]*/g)||[];let a=0,l=0;for(const f of o){const d=f[0],p=f.slice(1).trim().split(/[\s,]+/).map(Number);switch(d){case"M":case"L":[a,l]=p;break;case"a":case"A":u(p);break;case"H":a=p[0];break;case"V":l=p[0];break;case"Z":break;default:throw new Error(`Unsupported command: ${d}`)}t=Math.min(t,a),r=Math.min(r,l),i=Math.max(i,a),s=Math.max(s,l)}function u(f){const d=a,p=l;let[g,b,A,S,v,x,E]=f;a=x,l=E;const L=A*Math.PI/180,z=(d-x)/2,k=(p-E)/2,y=Math.cos(L)*z+Math.sin(L)*k,w=-Math.sin(L)*z+Math.cos(L)*k,D=y*y/(g*g)+w*w/(b*b);D>1&&(g*=Math.sqrt(D),b*=Math.sqrt(D));const N=S===v?-1:1,M=(g*g*(b*b)-g*g*(w*w)-b*b*(y*y))/(g*g*(w*w)+b*b*(y*y)),O=N*Math.sqrt(Math.max(M,0)),H=O*(g*w/b),j=O*-(b*y/g),Z=(d+x)/2+Math.cos(L)*H-Math.sin(L)*j,ge=(p+E)/2+Math.sin(L)*H+Math.cos(L)*j;t=Math.min(t,d,x,Z-g,Z+g),r=Math.min(r,p,E,ge-b,ge+b),i=Math.max(i,d,x,Z-g,Z+g),s=Math.max(s,p,E,ge-b,ge+b)}return new Xe(i-t,s-r)}stringify_object(e){return JSON.stringify(e,this.removeExtras,2)}removeExtras(e,t){if(!M_.extras.includes(e))return t}};V_.extras=["dbType","baseID","isDirty","idHashed","hidChild","hidParent","isEditing","isGrabbed","bulkRootID","oneAncestry","page_states","needsBulkFetch","selectionRange","lastModifyDate","awaitingCreation","already_persisted","hasPersistentStorage"];let ly=V_;const we=new ly;class uy{persist_json_object_toFile(e,t){const r=we.stringify_object(e),i=new Blob([r],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=t,s.click(),URL.revokeObjectURL(s.href)}async fetch_json_object_fromFile(e,t,r){return await zl.extract_json_object_fromFile(new File([],e,{}),t,r)}async extract_json_object_fromFile(e,t,r=()=>{}){return new Promise((i,s)=>{const o=new FileReader;let a=new Object;o.onload=function(l){var h;const u=(h=l.target)==null?void 0:h.result;if(!u||u.length==0)r("Empty file.");else try{return a=JSON.parse(u),t(a),{success:a}}catch(f){r(`Error parsing JSON: '${u}' ${f.message}`)}},o.onerror=function(){r("Error reading file.")},o.readAsText(e)})}}let zl=new uy;class cy{constructor(){this.info_type=Kr.focus,this.debug_cursor=!1,this.tree_types=!1,this.arrowheads=!1,this.traits=!1,this.tiny_dots=!0}queryStradial_apply(){var a,l;const e=ae.queryStradial,t=((a=e.get("hide"))==null?void 0:a.split(I.comma))??[],r=((l=e.get("show"))==null?void 0:l.split(I.comma))??[],i=Object.fromEntries(t.map(u=>[u,!1])??{}),o={...Object.fromEntries(r.map(u=>[u,!0])??{}),...i};for(const[u,h]of Object.entries(o))switch(u){case"details":tr.set(h);break;case"traits":this.traits=h,nt.write_key(it.traits,h);break;case"tiny_dots":this.tiny_dots=h,nt.write_key(it.tiny_dots,h);break;case"arrowheads":this.arrowheads=h,nt.write_key(it.arrowheads,h);break}}restore_state(){this.traits=nt.read_key(it.traits)??!1,this.tiny_dots=nt.read_key(it.tiny_dots)??!1,tr.set(nt.read_key(it.details)??!1),this.arrowheads=nt.read_key(it.arrowheads)??!1,this.info_type=nt.read_key(it.info_type)??Kr.focus,Ei.set(nt.read_key(it.tree_type)??yi.children)}reactivity_subscribe(){Ei.subscribe(e=>{nt.write_key(it.tree_type,e)}),tr.subscribe(e=>{nt.write_key(it.details,e),Qe.restore_state(),Oe.signal_relayoutWidgets_fromFocus()})}}let ln=new cy,mo;const hy=new Uint8Array(16);function fy(){if(!mo&&(mo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mo(hy)}const Lt=[];for(let n=0;n<256;++n)Lt.push((n+256).toString(16).slice(1));function dy(n,e=0){return Lt[n[e+0]]+Lt[n[e+1]]+Lt[n[e+2]]+Lt[n[e+3]]+"-"+Lt[n[e+4]]+Lt[n[e+5]]+"-"+Lt[n[e+6]]+Lt[n[e+7]]+"-"+Lt[n[e+8]]+Lt[n[e+9]]+"-"+Lt[n[e+10]]+Lt[n[e+11]]+Lt[n[e+12]]+Lt[n[e+13]]+Lt[n[e+14]]+Lt[n[e+15]]}const _y=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ch={randomUUID:_y};function py(n,e,t){if(ch.randomUUID&&!e&&!n)return ch.randomUUID();n=n||{};const r=n.random||(n.rng||fy)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return dy(r)}class Mt{constructor(e=Mt.newID()){this.idHashed=e.hash(),this.id=e}static newID(e="NEW"){return e+we.removeAll("-",py()).slice(10,24)}isHoverInverted(e){return!1}setID(e=Mt.newID()){this.idHashed=e.hash(),this.id=e}}var bt=(n=>(n.postgres="postgres",n.airtable="airtable",n.firebase="firebase",n.local="local",n.test="test",n))(bt||{}),Ce=(n=>(n.relationships="Relationships",n.predicates="Predicates",n.hierarchy="Hierarchy",n.progeny="Progeny",n.things="Things",n.traits="Traits",n.access="Access",n.users="Users",n))(Ce||{});class xi extends Mt{constructor(e,t,r=!1){super(t),this.lastModifyDate=new Date,this.awaitingCreation=!1,this.isDirty=!1,this.dbType=e,this.already_persisted=r,this.hasPersistentStorage=e!="test",this.isDirty=this.hasPersistentStorage&&!r}async persist(){}set_isDirty(){this.isDirty=!0}updateModifyDate(){this.lastModifyDate=new Date}static persistent_fromJSON(e){const t=JSON.parse(e);return new xi(t.dbType,t.id,!0)}wasModifiedWithinMS(e){const r=new Date().getTime()-this.lastModifyDate.getTime()<e;return r||console.log("slow: needs remote save"),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},gy=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],a=n[t++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},L_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,l=i+2<n.length,u=l?n[i+2]:0,h=s>>2,f=(s&3)<<4|a>>4;let d=(a&15)<<2|u>>6,p=u&63;l||(p=64,o||(d=64)),r.push(t[h],t[f],t[d],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(x_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):gy(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const u=i<n.length?t[n.charAt(i)]:64;++i;const f=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||u==null||f==null)throw new my;const d=s<<2|a>>4;if(r.push(d),u!==64){const p=a<<4&240|u>>2;if(r.push(p),f!==64){const g=u<<6&192|f;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class my extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yy=function(n){const e=x_(n);return L_.encodeByteArray(e,!0)},Wo=function(n){return yy(n).replace(/\./g,"")},by=function(n){try{return L_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wy(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vy=()=>wy().__FIREBASE_DEFAULTS__,ky=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ty=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&by(n[1]);return e&&JSON.parse(e)},mu=()=>{try{return vy()||ky()||Ty()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ey=n=>{var e,t;return(t=(e=mu())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Ay=n=>{const e=Ey(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},z_=()=>{var n;return(n=mu())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cy(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Wo(JSON.stringify(t)),Wo(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ry(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Py(){var n;const e=(n=mu())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Sy(){return!Py()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Dy(){try{return typeof indexedDB=="object"}catch{return!1}}function Oy(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny="FirebaseError";class Li extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Ny,Object.setPrototypeOf(this,Li.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,F_.prototype.create)}}class F_{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Vy(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Li(i,a,r)}}function Vy(n,e){return n.replace(My,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const My=/\{\$([^}]+)}/g;function Fl(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(hh(s)&&hh(o)){if(!Fl(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function hh(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nr(n){return n&&n._delegate?n._delegate:n}let Xo=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Iy;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(zy(e))try{this.getOrInitializeService({instanceIdentifier:Mr})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Mr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mr){return this.instances.has(e)}getOptions(e=Mr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ly(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Mr){return this.component?this.component.multipleInstances?e:Mr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ly(n){return n===Mr?void 0:n}function zy(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new xy(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ye;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ye||(Ye={}));const By={debug:Ye.DEBUG,verbose:Ye.VERBOSE,info:Ye.INFO,warn:Ye.WARN,error:Ye.ERROR,silent:Ye.SILENT},Uy=Ye.INFO,jy={[Ye.DEBUG]:"log",[Ye.VERBOSE]:"log",[Ye.INFO]:"info",[Ye.WARN]:"warn",[Ye.ERROR]:"error"},qy=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=jy[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class B_{constructor(e){this.name=e,this._logLevel=Uy,this._logHandler=qy,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?By[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ye.DEBUG,...e),this._logHandler(this,Ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ye.VERBOSE,...e),this._logHandler(this,Ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ye.INFO,...e),this._logHandler(this,Ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ye.WARN,...e),this._logHandler(this,Ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ye.ERROR,...e),this._logHandler(this,Ye.ERROR,...e)}}const Hy=(n,e)=>e.some(t=>n instanceof t);let fh,dh;function Gy(){return fh||(fh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ky(){return dh||(dh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const U_=new WeakMap,Bl=new WeakMap,j_=new WeakMap,_l=new WeakMap,yu=new WeakMap;function Wy(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(gr(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&U_.set(t,n)}).catch(()=>{}),yu.set(e,n),e}function Xy(n){if(Bl.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Bl.set(n,e)}let Ul={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Bl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||j_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return gr(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Yy(n){Ul=n(Ul)}function Qy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(pl(this),e,...t);return j_.set(r,e.sort?e.sort():[e]),gr(r)}:Ky().includes(n)?function(...e){return n.apply(pl(this),e),gr(U_.get(this))}:function(...e){return gr(n.apply(pl(this),e))}}function Jy(n){return typeof n=="function"?Qy(n):(n instanceof IDBTransaction&&Xy(n),Hy(n,Gy())?new Proxy(n,Ul):n)}function gr(n){if(n instanceof IDBRequest)return Wy(n);if(_l.has(n))return _l.get(n);const e=Jy(n);return e!==n&&(_l.set(n,e),yu.set(e,n)),e}const pl=n=>yu.get(n);function Zy(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=gr(o);return r&&o.addEventListener("upgradeneeded",l=>{r(gr(o.result),l.oldVersion,l.newVersion,gr(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const $y=["get","getKey","getAll","getAllKeys","count"],eb=["put","add","delete","clear"],gl=new Map;function _h(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(gl.get(e))return gl.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=eb.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||$y.includes(t)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),i&&l.done]))[0]};return gl.set(e,s),s}Yy(n=>({...n,get:(e,t,r)=>_h(e,t)||n.get(e,t,r),has:(e,t)=>!!_h(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(nb(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function nb(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const jl="@firebase/app",ph="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rr=new B_("@firebase/app"),rb="@firebase/app-compat",ib="@firebase/analytics-compat",sb="@firebase/analytics",ob="@firebase/app-check-compat",ab="@firebase/app-check",lb="@firebase/auth",ub="@firebase/auth-compat",cb="@firebase/database",hb="@firebase/data-connect",fb="@firebase/database-compat",db="@firebase/functions",_b="@firebase/functions-compat",pb="@firebase/installations",gb="@firebase/installations-compat",mb="@firebase/messaging",yb="@firebase/messaging-compat",bb="@firebase/performance",wb="@firebase/performance-compat",vb="@firebase/remote-config",kb="@firebase/remote-config-compat",Tb="@firebase/storage",Eb="@firebase/storage-compat",Ab="@firebase/firestore",Ib="@firebase/vertexai-preview",Cb="@firebase/firestore-compat",Rb="firebase",Pb="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ql="[DEFAULT]",Sb={[jl]:"fire-core",[rb]:"fire-core-compat",[sb]:"fire-analytics",[ib]:"fire-analytics-compat",[ab]:"fire-app-check",[ob]:"fire-app-check-compat",[lb]:"fire-auth",[ub]:"fire-auth-compat",[cb]:"fire-rtdb",[hb]:"fire-data-connect",[fb]:"fire-rtdb-compat",[db]:"fire-fn",[_b]:"fire-fn-compat",[pb]:"fire-iid",[gb]:"fire-iid-compat",[mb]:"fire-fcm",[yb]:"fire-fcm-compat",[bb]:"fire-perf",[wb]:"fire-perf-compat",[vb]:"fire-rc",[kb]:"fire-rc-compat",[Tb]:"fire-gcs",[Eb]:"fire-gcs-compat",[Ab]:"fire-fst",[Cb]:"fire-fst-compat",[Ib]:"fire-vertex","fire-js":"fire-js",[Rb]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yo=new Map,Db=new Map,Hl=new Map;function gh(n,e){try{n.container.addComponent(e)}catch(t){rr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Qo(n){const e=n.name;if(Hl.has(e))return rr.debug(`There were multiple attempts to register component ${e}.`),!1;Hl.set(e,n);for(const t of Yo.values())gh(t,n);for(const t of Db.values())gh(t,n);return!0}function Ob(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mr=new F_("app","Firebase",Nb);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Xo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mb=Pb;function q_(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ql,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw mr.create("bad-app-name",{appName:String(i)});if(t||(t=z_()),!t)throw mr.create("no-options");const s=Yo.get(i);if(s){if(Fl(t,s.options)&&Fl(r,s.config))return s;throw mr.create("duplicate-app",{appName:i})}const o=new Fy(i);for(const l of Hl.values())o.addComponent(l);const a=new Vb(t,r,o);return Yo.set(i,a),a}function xb(n=ql){const e=Yo.get(n);if(!e&&n===ql&&z_())return q_();if(!e)throw mr.create("no-app",{appName:n});return e}function bi(n,e,t){var r;let i=(r=Sb[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),rr.warn(a.join(" "));return}Qo(new Xo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lb="firebase-heartbeat-database",zb=1,Is="firebase-heartbeat-store";let ml=null;function H_(){return ml||(ml=Zy(Lb,zb,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Is)}catch(t){console.warn(t)}}}}).catch(n=>{throw mr.create("idb-open",{originalErrorMessage:n.message})})),ml}async function Fb(n){try{const t=(await H_()).transaction(Is),r=await t.objectStore(Is).get(G_(n));return await t.done,r}catch(e){if(e instanceof Li)rr.warn(e.message);else{const t=mr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});rr.warn(t.message)}}}async function mh(n,e){try{const r=(await H_()).transaction(Is,"readwrite");await r.objectStore(Is).put(e,G_(n)),await r.done}catch(t){if(t instanceof Li)rr.warn(t.message);else{const r=mr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});rr.warn(r.message)}}}function G_(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bb=1024,Ub=30*24*60*60*1e3;class jb{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Hb(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=yh();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=Ub}),this._storage.overwrite(this._heartbeatsCache))}catch(r){rr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=yh(),{heartbeatsToSend:r,unsentEntries:i}=qb(this._heartbeatsCache.heartbeats),s=Wo(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return rr.warn(t),""}}}function yh(){return new Date().toISOString().substring(0,10)}function qb(n,e=Bb){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),bh(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),bh(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Hb{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Dy()?Oy().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Fb(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return mh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return mh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function bh(n){return Wo(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gb(n){Qo(new Xo("platform-logger",e=>new tb(e),"PRIVATE")),Qo(new Xo("heartbeat",e=>new jb(e),"PRIVATE")),bi(jl,ph,n),bi(jl,ph,"esm2017"),bi("fire-js","")}Gb("");class Kb{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}var wh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var qr,K_;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,y){function w(){}w.prototype=y.prototype,k.D=y.prototype,k.prototype=new w,k.prototype.constructor=k,k.C=function(D,N,M){for(var O=Array(arguments.length-2),H=2;H<arguments.length;H++)O[H-2]=arguments[H];return y.prototype[N].apply(D,O)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,y,w){w||(w=0);var D=Array(16);if(typeof y=="string")for(var N=0;16>N;++N)D[N]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(N=0;16>N;++N)D[N]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=k.g[0],w=k.g[1],N=k.g[2];var M=k.g[3],O=y+(M^w&(N^M))+D[0]+3614090360&4294967295;y=w+(O<<7&4294967295|O>>>25),O=M+(N^y&(w^N))+D[1]+3905402710&4294967295,M=y+(O<<12&4294967295|O>>>20),O=N+(w^M&(y^w))+D[2]+606105819&4294967295,N=M+(O<<17&4294967295|O>>>15),O=w+(y^N&(M^y))+D[3]+3250441966&4294967295,w=N+(O<<22&4294967295|O>>>10),O=y+(M^w&(N^M))+D[4]+4118548399&4294967295,y=w+(O<<7&4294967295|O>>>25),O=M+(N^y&(w^N))+D[5]+1200080426&4294967295,M=y+(O<<12&4294967295|O>>>20),O=N+(w^M&(y^w))+D[6]+2821735955&4294967295,N=M+(O<<17&4294967295|O>>>15),O=w+(y^N&(M^y))+D[7]+4249261313&4294967295,w=N+(O<<22&4294967295|O>>>10),O=y+(M^w&(N^M))+D[8]+1770035416&4294967295,y=w+(O<<7&4294967295|O>>>25),O=M+(N^y&(w^N))+D[9]+2336552879&4294967295,M=y+(O<<12&4294967295|O>>>20),O=N+(w^M&(y^w))+D[10]+4294925233&4294967295,N=M+(O<<17&4294967295|O>>>15),O=w+(y^N&(M^y))+D[11]+2304563134&4294967295,w=N+(O<<22&4294967295|O>>>10),O=y+(M^w&(N^M))+D[12]+1804603682&4294967295,y=w+(O<<7&4294967295|O>>>25),O=M+(N^y&(w^N))+D[13]+4254626195&4294967295,M=y+(O<<12&4294967295|O>>>20),O=N+(w^M&(y^w))+D[14]+2792965006&4294967295,N=M+(O<<17&4294967295|O>>>15),O=w+(y^N&(M^y))+D[15]+1236535329&4294967295,w=N+(O<<22&4294967295|O>>>10),O=y+(N^M&(w^N))+D[1]+4129170786&4294967295,y=w+(O<<5&4294967295|O>>>27),O=M+(w^N&(y^w))+D[6]+3225465664&4294967295,M=y+(O<<9&4294967295|O>>>23),O=N+(y^w&(M^y))+D[11]+643717713&4294967295,N=M+(O<<14&4294967295|O>>>18),O=w+(M^y&(N^M))+D[0]+3921069994&4294967295,w=N+(O<<20&4294967295|O>>>12),O=y+(N^M&(w^N))+D[5]+3593408605&4294967295,y=w+(O<<5&4294967295|O>>>27),O=M+(w^N&(y^w))+D[10]+38016083&4294967295,M=y+(O<<9&4294967295|O>>>23),O=N+(y^w&(M^y))+D[15]+3634488961&4294967295,N=M+(O<<14&4294967295|O>>>18),O=w+(M^y&(N^M))+D[4]+3889429448&4294967295,w=N+(O<<20&4294967295|O>>>12),O=y+(N^M&(w^N))+D[9]+568446438&4294967295,y=w+(O<<5&4294967295|O>>>27),O=M+(w^N&(y^w))+D[14]+3275163606&4294967295,M=y+(O<<9&4294967295|O>>>23),O=N+(y^w&(M^y))+D[3]+4107603335&4294967295,N=M+(O<<14&4294967295|O>>>18),O=w+(M^y&(N^M))+D[8]+1163531501&4294967295,w=N+(O<<20&4294967295|O>>>12),O=y+(N^M&(w^N))+D[13]+2850285829&4294967295,y=w+(O<<5&4294967295|O>>>27),O=M+(w^N&(y^w))+D[2]+4243563512&4294967295,M=y+(O<<9&4294967295|O>>>23),O=N+(y^w&(M^y))+D[7]+1735328473&4294967295,N=M+(O<<14&4294967295|O>>>18),O=w+(M^y&(N^M))+D[12]+2368359562&4294967295,w=N+(O<<20&4294967295|O>>>12),O=y+(w^N^M)+D[5]+4294588738&4294967295,y=w+(O<<4&4294967295|O>>>28),O=M+(y^w^N)+D[8]+2272392833&4294967295,M=y+(O<<11&4294967295|O>>>21),O=N+(M^y^w)+D[11]+1839030562&4294967295,N=M+(O<<16&4294967295|O>>>16),O=w+(N^M^y)+D[14]+4259657740&4294967295,w=N+(O<<23&4294967295|O>>>9),O=y+(w^N^M)+D[1]+2763975236&4294967295,y=w+(O<<4&4294967295|O>>>28),O=M+(y^w^N)+D[4]+1272893353&4294967295,M=y+(O<<11&4294967295|O>>>21),O=N+(M^y^w)+D[7]+4139469664&4294967295,N=M+(O<<16&4294967295|O>>>16),O=w+(N^M^y)+D[10]+3200236656&4294967295,w=N+(O<<23&4294967295|O>>>9),O=y+(w^N^M)+D[13]+681279174&4294967295,y=w+(O<<4&4294967295|O>>>28),O=M+(y^w^N)+D[0]+3936430074&4294967295,M=y+(O<<11&4294967295|O>>>21),O=N+(M^y^w)+D[3]+3572445317&4294967295,N=M+(O<<16&4294967295|O>>>16),O=w+(N^M^y)+D[6]+76029189&4294967295,w=N+(O<<23&4294967295|O>>>9),O=y+(w^N^M)+D[9]+3654602809&4294967295,y=w+(O<<4&4294967295|O>>>28),O=M+(y^w^N)+D[12]+3873151461&4294967295,M=y+(O<<11&4294967295|O>>>21),O=N+(M^y^w)+D[15]+530742520&4294967295,N=M+(O<<16&4294967295|O>>>16),O=w+(N^M^y)+D[2]+3299628645&4294967295,w=N+(O<<23&4294967295|O>>>9),O=y+(N^(w|~M))+D[0]+4096336452&4294967295,y=w+(O<<6&4294967295|O>>>26),O=M+(w^(y|~N))+D[7]+1126891415&4294967295,M=y+(O<<10&4294967295|O>>>22),O=N+(y^(M|~w))+D[14]+2878612391&4294967295,N=M+(O<<15&4294967295|O>>>17),O=w+(M^(N|~y))+D[5]+4237533241&4294967295,w=N+(O<<21&4294967295|O>>>11),O=y+(N^(w|~M))+D[12]+1700485571&4294967295,y=w+(O<<6&4294967295|O>>>26),O=M+(w^(y|~N))+D[3]+2399980690&4294967295,M=y+(O<<10&4294967295|O>>>22),O=N+(y^(M|~w))+D[10]+4293915773&4294967295,N=M+(O<<15&4294967295|O>>>17),O=w+(M^(N|~y))+D[1]+2240044497&4294967295,w=N+(O<<21&4294967295|O>>>11),O=y+(N^(w|~M))+D[8]+1873313359&4294967295,y=w+(O<<6&4294967295|O>>>26),O=M+(w^(y|~N))+D[15]+4264355552&4294967295,M=y+(O<<10&4294967295|O>>>22),O=N+(y^(M|~w))+D[6]+2734768916&4294967295,N=M+(O<<15&4294967295|O>>>17),O=w+(M^(N|~y))+D[13]+1309151649&4294967295,w=N+(O<<21&4294967295|O>>>11),O=y+(N^(w|~M))+D[4]+4149444226&4294967295,y=w+(O<<6&4294967295|O>>>26),O=M+(w^(y|~N))+D[11]+3174756917&4294967295,M=y+(O<<10&4294967295|O>>>22),O=N+(y^(M|~w))+D[2]+718787259&4294967295,N=M+(O<<15&4294967295|O>>>17),O=w+(M^(N|~y))+D[9]+3951481745&4294967295,k.g[0]=k.g[0]+y&4294967295,k.g[1]=k.g[1]+(N+(O<<21&4294967295|O>>>11))&4294967295,k.g[2]=k.g[2]+N&4294967295,k.g[3]=k.g[3]+M&4294967295}r.prototype.u=function(k,y){y===void 0&&(y=k.length);for(var w=y-this.blockSize,D=this.B,N=this.h,M=0;M<y;){if(N==0)for(;M<=w;)i(this,k,M),M+=this.blockSize;if(typeof k=="string"){for(;M<y;)if(D[N++]=k.charCodeAt(M++),N==this.blockSize){i(this,D),N=0;break}}else for(;M<y;)if(D[N++]=k[M++],N==this.blockSize){i(this,D),N=0;break}}this.h=N,this.o+=y},r.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var y=1;y<k.length-8;++y)k[y]=0;var w=8*this.o;for(y=k.length-8;y<k.length;++y)k[y]=w&255,w/=256;for(this.u(k),k=Array(16),y=w=0;4>y;++y)for(var D=0;32>D;D+=8)k[w++]=this.g[y]>>>D&255;return k};function s(k,y){var w=a;return Object.prototype.hasOwnProperty.call(w,k)?w[k]:w[k]=y(k)}function o(k,y){this.h=y;for(var w=[],D=!0,N=k.length-1;0<=N;N--){var M=k[N]|0;D&&M==y||(w[N]=M,D=!1)}this.g=w}var a={};function l(k){return-128<=k&&128>k?s(k,function(y){return new o([y|0],0>y?-1:0)}):new o([k|0],0>k?-1:0)}function u(k){if(isNaN(k)||!isFinite(k))return f;if(0>k)return A(u(-k));for(var y=[],w=1,D=0;k>=w;D++)y[D]=k/w|0,w*=4294967296;return new o(y,0)}function h(k,y){if(k.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(k.charAt(0)=="-")return A(h(k.substring(1),y));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(y,8)),D=f,N=0;N<k.length;N+=8){var M=Math.min(8,k.length-N),O=parseInt(k.substring(N,N+M),y);8>M?(M=u(Math.pow(y,M)),D=D.j(M).add(u(O))):(D=D.j(w),D=D.add(u(O)))}return D}var f=l(0),d=l(1),p=l(16777216);n=o.prototype,n.m=function(){if(b(this))return-A(this).m();for(var k=0,y=1,w=0;w<this.g.length;w++){var D=this.i(w);k+=(0<=D?D:4294967296+D)*y,y*=4294967296}return k},n.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if(g(this))return"0";if(b(this))return"-"+A(this).toString(k);for(var y=u(Math.pow(k,6)),w=this,D="";;){var N=E(w,y).g;w=S(w,N.j(y));var M=((0<w.g.length?w.g[0]:w.h)>>>0).toString(k);if(w=N,g(w))return M+D;for(;6>M.length;)M="0"+M;D=M+D}},n.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function g(k){if(k.h!=0)return!1;for(var y=0;y<k.g.length;y++)if(k.g[y]!=0)return!1;return!0}function b(k){return k.h==-1}n.l=function(k){return k=S(this,k),b(k)?-1:g(k)?0:1};function A(k){for(var y=k.g.length,w=[],D=0;D<y;D++)w[D]=~k.g[D];return new o(w,~k.h).add(d)}n.abs=function(){return b(this)?A(this):this},n.add=function(k){for(var y=Math.max(this.g.length,k.g.length),w=[],D=0,N=0;N<=y;N++){var M=D+(this.i(N)&65535)+(k.i(N)&65535),O=(M>>>16)+(this.i(N)>>>16)+(k.i(N)>>>16);D=O>>>16,M&=65535,O&=65535,w[N]=O<<16|M}return new o(w,w[w.length-1]&-2147483648?-1:0)};function S(k,y){return k.add(A(y))}n.j=function(k){if(g(this)||g(k))return f;if(b(this))return b(k)?A(this).j(A(k)):A(A(this).j(k));if(b(k))return A(this.j(A(k)));if(0>this.l(p)&&0>k.l(p))return u(this.m()*k.m());for(var y=this.g.length+k.g.length,w=[],D=0;D<2*y;D++)w[D]=0;for(D=0;D<this.g.length;D++)for(var N=0;N<k.g.length;N++){var M=this.i(D)>>>16,O=this.i(D)&65535,H=k.i(N)>>>16,j=k.i(N)&65535;w[2*D+2*N]+=O*j,v(w,2*D+2*N),w[2*D+2*N+1]+=M*j,v(w,2*D+2*N+1),w[2*D+2*N+1]+=O*H,v(w,2*D+2*N+1),w[2*D+2*N+2]+=M*H,v(w,2*D+2*N+2)}for(D=0;D<y;D++)w[D]=w[2*D+1]<<16|w[2*D];for(D=y;D<2*y;D++)w[D]=0;return new o(w,0)};function v(k,y){for(;(k[y]&65535)!=k[y];)k[y+1]+=k[y]>>>16,k[y]&=65535,y++}function x(k,y){this.g=k,this.h=y}function E(k,y){if(g(y))throw Error("division by zero");if(g(k))return new x(f,f);if(b(k))return y=E(A(k),y),new x(A(y.g),A(y.h));if(b(y))return y=E(k,A(y)),new x(A(y.g),y.h);if(30<k.g.length){if(b(k)||b(y))throw Error("slowDivide_ only works with positive integers.");for(var w=d,D=y;0>=D.l(k);)w=L(w),D=L(D);var N=z(w,1),M=z(D,1);for(D=z(D,2),w=z(w,2);!g(D);){var O=M.add(D);0>=O.l(k)&&(N=N.add(w),M=O),D=z(D,1),w=z(w,1)}return y=S(k,N.j(y)),new x(N,y)}for(N=f;0<=k.l(y);){for(w=Math.max(1,Math.floor(k.m()/y.m())),D=Math.ceil(Math.log(w)/Math.LN2),D=48>=D?1:Math.pow(2,D-48),M=u(w),O=M.j(y);b(O)||0<O.l(k);)w-=D,M=u(w),O=M.j(y);g(M)&&(M=d),N=N.add(M),k=S(k,O)}return new x(N,k)}n.A=function(k){return E(this,k).h},n.and=function(k){for(var y=Math.max(this.g.length,k.g.length),w=[],D=0;D<y;D++)w[D]=this.i(D)&k.i(D);return new o(w,this.h&k.h)},n.or=function(k){for(var y=Math.max(this.g.length,k.g.length),w=[],D=0;D<y;D++)w[D]=this.i(D)|k.i(D);return new o(w,this.h|k.h)},n.xor=function(k){for(var y=Math.max(this.g.length,k.g.length),w=[],D=0;D<y;D++)w[D]=this.i(D)^k.i(D);return new o(w,this.h^k.h)};function L(k){for(var y=k.g.length+1,w=[],D=0;D<y;D++)w[D]=k.i(D)<<1|k.i(D-1)>>>31;return new o(w,k.h)}function z(k,y){var w=y>>5;y%=32;for(var D=k.g.length-w,N=[],M=0;M<D;M++)N[M]=0<y?k.i(M+w)>>>y|k.i(M+w+1)<<32-y:k.i(M+w);return new o(N,k.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,K_=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,qr=o}).apply(typeof wh<"u"?wh:typeof self<"u"?self:typeof window<"u"?window:{});var yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var W_,as,X_,No,Gl,Y_,Q_,J_;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,_,m){return c==Array.prototype||c==Object.prototype||(c[_]=m.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof yo=="object"&&yo];for(var _=0;_<c.length;++_){var m=c[_];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function i(c,_){if(_)e:{var m=r;c=c.split(".");for(var R=0;R<c.length-1;R++){var U=c[R];if(!(U in m))break e;m=m[U]}c=c[c.length-1],R=m[c],_=_(R),_!=R&&_!=null&&e(m,c,{configurable:!0,writable:!0,value:_})}}function s(c,_){c instanceof String&&(c+="");var m=0,R=!1,U={next:function(){if(!R&&m<c.length){var q=m++;return{value:_(q,c[q]),done:!1}}return R=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}i("Array.prototype.values",function(c){return c||function(){return s(this,function(_,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var _=typeof c;return _=_!="object"?_:c?Array.isArray(c)?"array":_:"null",_=="array"||_=="object"&&typeof c.length=="number"}function u(c){var _=typeof c;return _=="object"&&c!=null||_=="function"}function h(c,_,m){return c.call.apply(c.bind,arguments)}function f(c,_,m){if(!c)throw Error();if(2<arguments.length){var R=Array.prototype.slice.call(arguments,2);return function(){var U=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(U,R),c.apply(_,U)}}return function(){return c.apply(_,arguments)}}function d(c,_,m){return d=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,d.apply(null,arguments)}function p(c,_){var m=Array.prototype.slice.call(arguments,1);return function(){var R=m.slice();return R.push.apply(R,arguments),c.apply(this,R)}}function g(c,_){function m(){}m.prototype=_.prototype,c.aa=_.prototype,c.prototype=new m,c.prototype.constructor=c,c.Qb=function(R,U,q){for(var he=Array(arguments.length-2),ct=2;ct<arguments.length;ct++)he[ct-2]=arguments[ct];return _.prototype[U].apply(R,he)}}function b(c){const _=c.length;if(0<_){const m=Array(_);for(let R=0;R<_;R++)m[R]=c[R];return m}return[]}function A(c,_){for(let m=1;m<arguments.length;m++){const R=arguments[m];if(l(R)){const U=c.length||0,q=R.length||0;c.length=U+q;for(let he=0;he<q;he++)c[U+he]=R[he]}else c.push(R)}}class S{constructor(_,m){this.i=_,this.j=m,this.h=0,this.g=null}get(){let _;return 0<this.h?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}function v(c){return/^[\s\xa0]*$/.test(c)}function x(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function E(c){return E[" "](c),c}E[" "]=function(){};var L=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function z(c,_,m){for(const R in c)_.call(m,c[R],R,c)}function k(c,_){for(const m in c)_.call(void 0,c[m],m,c)}function y(c){const _={};for(const m in c)_[m]=c[m];return _}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function D(c,_){let m,R;for(let U=1;U<arguments.length;U++){R=arguments[U];for(m in R)c[m]=R[m];for(let q=0;q<w.length;q++)m=w[q],Object.prototype.hasOwnProperty.call(R,m)&&(c[m]=R[m])}}function N(c){var _=1;c=c.split(":");const m=[];for(;0<_&&c.length;)m.push(c.shift()),_--;return c.length&&m.push(c.join(":")),m}function M(c){a.setTimeout(()=>{throw c},0)}function O(){var c=ee;let _=null;return c.g&&(_=c.g,c.g=c.g.next,c.g||(c.h=null),_.next=null),_}class H{constructor(){this.h=this.g=null}add(_,m){const R=j.get();R.set(_,m),this.h?this.h.next=R:this.g=R,this.h=R}}var j=new S(()=>new Z,c=>c.reset());class Z{constructor(){this.next=this.g=this.h=null}set(_,m){this.h=_,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let ge,le=!1,ee=new H,fe=()=>{const c=a.Promise.resolve(void 0);ge=()=>{c.then(Ve)}};var Ve=()=>{for(var c;c=O();){try{c.h.call(c.g)}catch(m){M(m)}var _=j;_.j(c),100>_.h&&(_.h++,c.next=_.g,_.g=c)}le=!1};function ye(){this.s=this.s,this.C=this.C}ye.prototype.s=!1,ye.prototype.ma=function(){this.s||(this.s=!0,this.N())},ye.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(c,_){this.type=c,this.g=this.target=_,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Be=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,_=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};a.addEventListener("test",m,_),a.removeEventListener("test",m,_)}catch{}return c}();function be(c,_){if(Ae.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var m=this.type=c.type,R=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=_,_=c.relatedTarget){if(L){e:{try{E(_.nodeName);var U=!0;break e}catch{}U=!1}U||(_=null)}}else m=="mouseover"?_=c.fromElement:m=="mouseout"&&(_=c.toElement);this.relatedTarget=_,R?(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:et[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&be.aa.h.call(this)}}g(be,Ae);var et={2:"touch",3:"pen",4:"mouse"};be.prototype.h=function(){be.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var rt="closure_listenable_"+(1e6*Math.random()|0),vt=0;function Ht(c,_,m,R,U){this.listener=c,this.proxy=null,this.src=_,this.type=m,this.capture=!!R,this.ha=U,this.key=++vt,this.da=this.fa=!1}function kn(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function $t(c){this.src=c,this.g={},this.h=0}$t.prototype.add=function(c,_,m,R,U){var q=c.toString();c=this.g[q],c||(c=this.g[q]=[],this.h++);var he=Dn(c,_,R,U);return-1<he?(_=c[he],m||(_.fa=!1)):(_=new Ht(_,this.src,q,!!R,U),_.fa=m,c.push(_)),_};function Sn(c,_){var m=_.type;if(m in c.g){var R=c.g[m],U=Array.prototype.indexOf.call(R,_,void 0),q;(q=0<=U)&&Array.prototype.splice.call(R,U,1),q&&(kn(_),c.g[m].length==0&&(delete c.g[m],c.h--))}}function Dn(c,_,m,R){for(var U=0;U<c.length;++U){var q=c[U];if(!q.da&&q.listener==_&&q.capture==!!m&&q.ha==R)return U}return-1}var On="closure_lm_"+(1e6*Math.random()|0),oe={};function kt(c,_,m,R,U){if(R&&R.once)return ft(c,_,m,R,U);if(Array.isArray(_)){for(var q=0;q<_.length;q++)kt(c,_[q],m,R,U);return null}return m=Sr(m),c&&c[rt]?c.K(_,m,u(R)?!!R.capture:!!R,U):pe(c,_,m,!1,R,U)}function pe(c,_,m,R,U,q){if(!_)throw Error("Invalid event type");var he=u(U)?!!U.capture:!!U,ct=Ui(c);if(ct||(c[On]=ct=new $t(c)),m=ct.add(_,m,R,he,q),m.proxy)return m;if(R=We(),m.proxy=R,R.src=c,R.listener=m,c.addEventListener)Be||(U=he),U===void 0&&(U=!1),c.addEventListener(_.toString(),R,U);else if(c.attachEvent)c.attachEvent(Rt(_.toString()),R);else if(c.addListener&&c.removeListener)c.addListener(R);else throw Error("addEventListener and attachEvent are unavailable.");return m}function We(){function c(m){return _.call(c.src,c.listener,m)}const _=Pr;return c}function ft(c,_,m,R,U){if(Array.isArray(_)){for(var q=0;q<_.length;q++)ft(c,_[q],m,R,U);return null}return m=Sr(m),c&&c[rt]?c.L(_,m,u(R)?!!R.capture:!!R,U):pe(c,_,m,!0,R,U)}function He(c,_,m,R,U){if(Array.isArray(_))for(var q=0;q<_.length;q++)He(c,_[q],m,R,U);else R=u(R)?!!R.capture:!!R,m=Sr(m),c&&c[rt]?(c=c.i,_=String(_).toString(),_ in c.g&&(q=c.g[_],m=Dn(q,m,R,U),-1<m&&(kn(q[m]),Array.prototype.splice.call(q,m,1),q.length==0&&(delete c.g[_],c.h--)))):c&&(c=Ui(c))&&(_=c.g[_.toString()],c=-1,_&&(c=Dn(_,m,R,U)),(m=-1<c?_[c]:null)&&me(m))}function me(c){if(typeof c!="number"&&c&&!c.da){var _=c.src;if(_&&_[rt])Sn(_.i,c);else{var m=c.type,R=c.proxy;_.removeEventListener?_.removeEventListener(m,R,c.capture):_.detachEvent?_.detachEvent(Rt(m),R):_.addListener&&_.removeListener&&_.removeListener(R),(m=Ui(_))?(Sn(m,c),m.h==0&&(m.src=null,_[On]=null)):kn(c)}}}function Rt(c){return c in oe?oe[c]:oe[c]="on"+c}function Pr(c,_){if(c.da)c=!0;else{_=new be(_,this);var m=c.listener,R=c.ha||c.src;c.fa&&me(c),c=m.call(R,_)}return c}function Ui(c){return c=c[On],c instanceof $t?c:null}var ji="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sr(c){return typeof c=="function"?c:(c[ji]||(c[ji]=function(_){return c.handleEvent(_)}),c[ji])}function gt(){ye.call(this),this.i=new $t(this),this.M=this,this.F=null}g(gt,ye),gt.prototype[rt]=!0,gt.prototype.removeEventListener=function(c,_,m,R){He(this,c,_,m,R)};function Pt(c,_){var m,R=c.F;if(R)for(m=[];R;R=R.F)m.push(R);if(c=c.M,R=_.type||_,typeof _=="string")_=new Ae(_,c);else if(_ instanceof Ae)_.target=_.target||c;else{var U=_;_=new Ae(R,c),D(_,U)}if(U=!0,m)for(var q=m.length-1;0<=q;q--){var he=_.g=m[q];U=$s(he,R,!0,_)&&U}if(he=_.g=c,U=$s(he,R,!0,_)&&U,U=$s(he,R,!1,_)&&U,m)for(q=0;q<m.length;q++)he=_.g=m[q],U=$s(he,R,!1,_)&&U}gt.prototype.N=function(){if(gt.aa.N.call(this),this.i){var c=this.i,_;for(_ in c.g){for(var m=c.g[_],R=0;R<m.length;R++)kn(m[R]);delete c.g[_],c.h--}}this.F=null},gt.prototype.K=function(c,_,m,R){return this.i.add(String(c),_,!1,m,R)},gt.prototype.L=function(c,_,m,R){return this.i.add(String(c),_,!0,m,R)};function $s(c,_,m,R){if(_=c.i.g[String(_)],!_)return!0;_=_.concat();for(var U=!0,q=0;q<_.length;++q){var he=_[q];if(he&&!he.da&&he.capture==m){var ct=he.listener,xt=he.ha||he.src;he.fa&&Sn(c.i,he),U=ct.call(xt,R)!==!1&&U}}return U&&!R.defaultPrevented}function fc(c,_,m){if(typeof c=="function")m&&(c=d(c,m));else if(c&&typeof c.handleEvent=="function")c=d(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(_)?-1:a.setTimeout(c,_||0)}function dc(c){c.g=fc(()=>{c.g=null,c.i&&(c.i=!1,dc(c))},c.l);const _=c.h;c.h=null,c.m.apply(null,_)}class om extends ye{constructor(_,m){super(),this.m=_,this.l=m,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:dc(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qi(c){ye.call(this),this.h=c,this.g={}}g(qi,ye);var _c=[];function pc(c){z(c.g,function(_,m){this.g.hasOwnProperty(m)&&me(_)},c),c.g={}}qi.prototype.N=function(){qi.aa.N.call(this),pc(this)},qi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xa=a.JSON.stringify,am=a.JSON.parse,lm=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function Ya(){}Ya.prototype.h=null;function gc(c){return c.h||(c.h=c.i())}function mc(){}var Hi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qa(){Ae.call(this,"d")}g(Qa,Ae);function Ja(){Ae.call(this,"c")}g(Ja,Ae);var Dr={},yc=null;function eo(){return yc=yc||new gt}Dr.La="serverreachability";function bc(c){Ae.call(this,Dr.La,c)}g(bc,Ae);function Gi(c){const _=eo();Pt(_,new bc(_))}Dr.STAT_EVENT="statevent";function wc(c,_){Ae.call(this,Dr.STAT_EVENT,c),this.stat=_}g(wc,Ae);function en(c){const _=eo();Pt(_,new wc(_,c))}Dr.Ma="timingevent";function vc(c,_){Ae.call(this,Dr.Ma,c),this.size=_}g(vc,Ae);function Ki(c,_){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},_)}function Wi(){this.g=!0}Wi.prototype.xa=function(){this.g=!1};function um(c,_,m,R,U,q){c.info(function(){if(c.g)if(q)for(var he="",ct=q.split("&"),xt=0;xt<ct.length;xt++){var Je=ct[xt].split("=");if(1<Je.length){var Gt=Je[0];Je=Je[1];var Kt=Gt.split("_");he=2<=Kt.length&&Kt[1]=="type"?he+(Gt+"="+Je+"&"):he+(Gt+"=redacted&")}}else he=null;else he=q;return"XMLHTTP REQ ("+R+") [attempt "+U+"]: "+_+`
`+m+`
`+he})}function cm(c,_,m,R,U,q,he){c.info(function(){return"XMLHTTP RESP ("+R+") [ attempt "+U+"]: "+_+`
`+m+`
`+q+" "+he})}function ei(c,_,m,R){c.info(function(){return"XMLHTTP TEXT ("+_+"): "+fm(c,m)+(R?" "+R:"")})}function hm(c,_){c.info(function(){return"TIMEOUT: "+_})}Wi.prototype.info=function(){};function fm(c,_){if(!c.g)return _;if(!_)return null;try{var m=JSON.parse(_);if(m){for(c=0;c<m.length;c++)if(Array.isArray(m[c])){var R=m[c];if(!(2>R.length)){var U=R[1];if(Array.isArray(U)&&!(1>U.length)){var q=U[0];if(q!="noop"&&q!="stop"&&q!="close")for(var he=1;he<U.length;he++)U[he]=""}}}}return Xa(m)}catch{return _}}var to={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},kc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Za;function no(){}g(no,Ya),no.prototype.g=function(){return new XMLHttpRequest},no.prototype.i=function(){return{}},Za=new no;function ur(c,_,m,R){this.j=c,this.i=_,this.l=m,this.R=R||1,this.U=new qi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Tc}function Tc(){this.i=null,this.g="",this.h=!1}var Ec={},$a={};function el(c,_,m){c.L=1,c.v=oo(Yn(_)),c.m=m,c.P=!0,Ac(c,null)}function Ac(c,_){c.F=Date.now(),ro(c),c.A=Yn(c.v);var m=c.A,R=c.R;Array.isArray(R)||(R=[String(R)]),Fc(m.i,"t",R),c.C=0,m=c.j.J,c.h=new Tc,c.g=rh(c.j,m?_:null,!c.m),0<c.O&&(c.M=new om(d(c.Y,c,c.g),c.O)),_=c.U,m=c.g,R=c.ca;var U="readystatechange";Array.isArray(U)||(U&&(_c[0]=U.toString()),U=_c);for(var q=0;q<U.length;q++){var he=kt(m,U[q],R||_.handleEvent,!1,_.h||_);if(!he)break;_.g[he.key]=he}_=c.H?y(c.H):{},c.m?(c.u||(c.u="POST"),_["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,_)):(c.u="GET",c.g.ea(c.A,c.u,null,_)),Gi(),um(c.i,c.u,c.A,c.l,c.R,c.m)}ur.prototype.ca=function(c){c=c.target;const _=this.M;_&&Qn(c)==3?_.j():this.Y(c)},ur.prototype.Y=function(c){try{if(c==this.g)e:{const Kt=Qn(this.g);var _=this.g.Ba();const ri=this.g.Z();if(!(3>Kt)&&(Kt!=3||this.g&&(this.h.h||this.g.oa()||Kc(this.g)))){this.J||Kt!=4||_==7||(_==8||0>=ri?Gi(3):Gi(2)),tl(this);var m=this.g.Z();this.X=m;t:if(Ic(this)){var R=Kc(this.g);c="";var U=R.length,q=Qn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Or(this),Xi(this);var he="";break t}this.h.i=new a.TextDecoder}for(_=0;_<U;_++)this.h.h=!0,c+=this.h.i.decode(R[_],{stream:!(q&&_==U-1)});R.length=0,this.h.g+=c,this.C=0,he=this.h.g}else he=this.g.oa();if(this.o=m==200,cm(this.i,this.u,this.A,this.l,this.R,Kt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var ct,xt=this.g;if((ct=xt.g?xt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(ct)){var Je=ct;break t}}Je=null}if(m=Je)ei(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nl(this,m);else{this.o=!1,this.s=3,en(12),Or(this),Xi(this);break e}}if(this.P){m=!0;let Nn;for(;!this.J&&this.C<he.length;)if(Nn=dm(this,he),Nn==$a){Kt==4&&(this.s=4,en(14),m=!1),ei(this.i,this.l,null,"[Incomplete Response]");break}else if(Nn==Ec){this.s=4,en(15),ei(this.i,this.l,he,"[Invalid Chunk]"),m=!1;break}else ei(this.i,this.l,Nn,null),nl(this,Nn);if(Ic(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kt!=4||he.length!=0||this.h.h||(this.s=1,en(16),m=!1),this.o=this.o&&m,!m)ei(this.i,this.l,he,"[Invalid Chunked Response]"),Or(this),Xi(this);else if(0<he.length&&!this.W){this.W=!0;var Gt=this.j;Gt.g==this&&Gt.ba&&!Gt.M&&(Gt.j.info("Great, no buffering proxy detected. Bytes received: "+he.length),ll(Gt),Gt.M=!0,en(11))}}else ei(this.i,this.l,he,null),nl(this,he);Kt==4&&Or(this),this.o&&!this.J&&(Kt==4?$c(this.j,this):(this.o=!1,ro(this)))}else Sm(this.g),m==400&&0<he.indexOf("Unknown SID")?(this.s=3,en(12)):(this.s=0,en(13)),Or(this),Xi(this)}}}catch{}finally{}};function Ic(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function dm(c,_){var m=c.C,R=_.indexOf(`
`,m);return R==-1?$a:(m=Number(_.substring(m,R)),isNaN(m)?Ec:(R+=1,R+m>_.length?$a:(_=_.slice(R,R+m),c.C=R+m,_)))}ur.prototype.cancel=function(){this.J=!0,Or(this)};function ro(c){c.S=Date.now()+c.I,Cc(c,c.I)}function Cc(c,_){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Ki(d(c.ba,c),_)}function tl(c){c.B&&(a.clearTimeout(c.B),c.B=null)}ur.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(hm(this.i,this.A),this.L!=2&&(Gi(),en(17)),Or(this),this.s=2,Xi(this)):Cc(this,this.S-c)};function Xi(c){c.j.G==0||c.J||$c(c.j,c)}function Or(c){tl(c);var _=c.M;_&&typeof _.ma=="function"&&_.ma(),c.M=null,pc(c.U),c.g&&(_=c.g,c.g=null,_.abort(),_.ma())}function nl(c,_){try{var m=c.j;if(m.G!=0&&(m.g==c||rl(m.h,c))){if(!c.K&&rl(m.h,c)&&m.G==3){try{var R=m.Da.g.parse(_)}catch{R=null}if(Array.isArray(R)&&R.length==3){var U=R;if(U[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<c.F)fo(m),co(m);else break e;al(m),en(18)}}else m.za=U[1],0<m.za-m.T&&37500>U[2]&&m.F&&m.v==0&&!m.C&&(m.C=Ki(d(m.Za,m),6e3));if(1>=Sc(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Vr(m,11)}else if((c.K||m.g==c)&&fo(m),!v(_))for(U=m.Da.g.parse(_),_=0;_<U.length;_++){let Je=U[_];if(m.T=Je[0],Je=Je[1],m.G==2)if(Je[0]=="c"){m.K=Je[1],m.ia=Je[2];const Gt=Je[3];Gt!=null&&(m.la=Gt,m.j.info("VER="+m.la));const Kt=Je[4];Kt!=null&&(m.Aa=Kt,m.j.info("SVER="+m.Aa));const ri=Je[5];ri!=null&&typeof ri=="number"&&0<ri&&(R=1.5*ri,m.L=R,m.j.info("backChannelRequestTimeoutMs_="+R)),R=m;const Nn=c.g;if(Nn){const po=Nn.g?Nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(po){var q=R.h;q.g||po.indexOf("spdy")==-1&&po.indexOf("quic")==-1&&po.indexOf("h2")==-1||(q.j=q.l,q.g=new Set,q.h&&(il(q,q.h),q.h=null))}if(R.D){const ul=Nn.g?Nn.g.getResponseHeader("X-HTTP-Session-Id"):null;ul&&(R.ya=ul,dt(R.I,R.D,ul))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-c.F,m.j.info("Handshake RTT: "+m.R+"ms")),R=m;var he=c;if(R.qa=nh(R,R.J?R.ia:null,R.W),he.K){Dc(R.h,he);var ct=he,xt=R.L;xt&&(ct.I=xt),ct.B&&(tl(ct),ro(ct)),R.g=he}else Jc(R);0<m.i.length&&ho(m)}else Je[0]!="stop"&&Je[0]!="close"||Vr(m,7);else m.G==3&&(Je[0]=="stop"||Je[0]=="close"?Je[0]=="stop"?Vr(m,7):ol(m):Je[0]!="noop"&&m.l&&m.l.ta(Je),m.v=0)}}Gi(4)}catch{}}var _m=class{constructor(c,_){this.g=c,this.map=_}};function Rc(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Pc(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Sc(c){return c.h?1:c.g?c.g.size:0}function rl(c,_){return c.h?c.h==_:c.g?c.g.has(_):!1}function il(c,_){c.g?c.g.add(_):c.h=_}function Dc(c,_){c.h&&c.h==_?c.h=null:c.g&&c.g.has(_)&&c.g.delete(_)}Rc.prototype.cancel=function(){if(this.i=Oc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Oc(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let _=c.i;for(const m of c.g.values())_=_.concat(m.D);return _}return b(c.i)}function pm(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var _=[],m=c.length,R=0;R<m;R++)_.push(c[R]);return _}_=[],m=0;for(R in c)_[m++]=c[R];return _}function gm(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var _=[];c=c.length;for(var m=0;m<c;m++)_.push(m);return _}_=[],m=0;for(const R in c)_[m++]=R;return _}}}function Nc(c,_){if(c.forEach&&typeof c.forEach=="function")c.forEach(_,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,_,void 0);else for(var m=gm(c),R=pm(c),U=R.length,q=0;q<U;q++)_.call(void 0,R[q],m&&m[q],c)}var Vc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mm(c,_){if(c){c=c.split("&");for(var m=0;m<c.length;m++){var R=c[m].indexOf("="),U=null;if(0<=R){var q=c[m].substring(0,R);U=c[m].substring(R+1)}else q=c[m];_(q,U?decodeURIComponent(U.replace(/\+/g," ")):"")}}}function Nr(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Nr){this.h=c.h,io(this,c.j),this.o=c.o,this.g=c.g,so(this,c.s),this.l=c.l;var _=c.i,m=new Ji;m.i=_.i,_.g&&(m.g=new Map(_.g),m.h=_.h),Mc(this,m),this.m=c.m}else c&&(_=String(c).match(Vc))?(this.h=!1,io(this,_[1]||"",!0),this.o=Yi(_[2]||""),this.g=Yi(_[3]||"",!0),so(this,_[4]),this.l=Yi(_[5]||"",!0),Mc(this,_[6]||"",!0),this.m=Yi(_[7]||"")):(this.h=!1,this.i=new Ji(null,this.h))}Nr.prototype.toString=function(){var c=[],_=this.j;_&&c.push(Qi(_,xc,!0),":");var m=this.g;return(m||_=="file")&&(c.push("//"),(_=this.o)&&c.push(Qi(_,xc,!0),"@"),c.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&c.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(Qi(m,m.charAt(0)=="/"?wm:bm,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",Qi(m,km)),c.join("")};function Yn(c){return new Nr(c)}function io(c,_,m){c.j=m?Yi(_,!0):_,c.j&&(c.j=c.j.replace(/:$/,""))}function so(c,_){if(_){if(_=Number(_),isNaN(_)||0>_)throw Error("Bad port number "+_);c.s=_}else c.s=null}function Mc(c,_,m){_ instanceof Ji?(c.i=_,Tm(c.i,c.h)):(m||(_=Qi(_,vm)),c.i=new Ji(_,c.h))}function dt(c,_,m){c.i.set(_,m)}function oo(c){return dt(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Yi(c,_){return c?_?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Qi(c,_,m){return typeof c=="string"?(c=encodeURI(c).replace(_,ym),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function ym(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var xc=/[#\/\?@]/g,bm=/[#\?:]/g,wm=/[#\?]/g,vm=/[#\?@]/g,km=/#/g;function Ji(c,_){this.h=this.g=null,this.i=c||null,this.j=!!_}function cr(c){c.g||(c.g=new Map,c.h=0,c.i&&mm(c.i,function(_,m){c.add(decodeURIComponent(_.replace(/\+/g," ")),m)}))}n=Ji.prototype,n.add=function(c,_){cr(this),this.i=null,c=ti(this,c);var m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(_),this.h+=1,this};function Lc(c,_){cr(c),_=ti(c,_),c.g.has(_)&&(c.i=null,c.h-=c.g.get(_).length,c.g.delete(_))}function zc(c,_){return cr(c),_=ti(c,_),c.g.has(_)}n.forEach=function(c,_){cr(this),this.g.forEach(function(m,R){m.forEach(function(U){c.call(_,U,R,this)},this)},this)},n.na=function(){cr(this);const c=Array.from(this.g.values()),_=Array.from(this.g.keys()),m=[];for(let R=0;R<_.length;R++){const U=c[R];for(let q=0;q<U.length;q++)m.push(_[R])}return m},n.V=function(c){cr(this);let _=[];if(typeof c=="string")zc(this,c)&&(_=_.concat(this.g.get(ti(this,c))));else{c=Array.from(this.g.values());for(let m=0;m<c.length;m++)_=_.concat(c[m])}return _},n.set=function(c,_){return cr(this),this.i=null,c=ti(this,c),zc(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[_]),this.h+=1,this},n.get=function(c,_){return c?(c=this.V(c),0<c.length?String(c[0]):_):_};function Fc(c,_,m){Lc(c,_),0<m.length&&(c.i=null,c.g.set(ti(c,_),b(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],_=Array.from(this.g.keys());for(var m=0;m<_.length;m++){var R=_[m];const q=encodeURIComponent(String(R)),he=this.V(R);for(R=0;R<he.length;R++){var U=q;he[R]!==""&&(U+="="+encodeURIComponent(String(he[R]))),c.push(U)}}return this.i=c.join("&")};function ti(c,_){return _=String(_),c.j&&(_=_.toLowerCase()),_}function Tm(c,_){_&&!c.j&&(cr(c),c.i=null,c.g.forEach(function(m,R){var U=R.toLowerCase();R!=U&&(Lc(this,R),Fc(this,U,m))},c)),c.j=_}function Em(c,_){const m=new Wi;if(a.Image){const R=new Image;R.onload=p(hr,m,"TestLoadImage: loaded",!0,_,R),R.onerror=p(hr,m,"TestLoadImage: error",!1,_,R),R.onabort=p(hr,m,"TestLoadImage: abort",!1,_,R),R.ontimeout=p(hr,m,"TestLoadImage: timeout",!1,_,R),a.setTimeout(function(){R.ontimeout&&R.ontimeout()},1e4),R.src=c}else _(!1)}function Am(c,_){const m=new Wi,R=new AbortController,U=setTimeout(()=>{R.abort(),hr(m,"TestPingServer: timeout",!1,_)},1e4);fetch(c,{signal:R.signal}).then(q=>{clearTimeout(U),q.ok?hr(m,"TestPingServer: ok",!0,_):hr(m,"TestPingServer: server error",!1,_)}).catch(()=>{clearTimeout(U),hr(m,"TestPingServer: error",!1,_)})}function hr(c,_,m,R,U){try{U&&(U.onload=null,U.onerror=null,U.onabort=null,U.ontimeout=null),R(m)}catch{}}function Im(){this.g=new lm}function Cm(c,_,m){const R=m||"";try{Nc(c,function(U,q){let he=U;u(U)&&(he=Xa(U)),_.push(R+q+"="+encodeURIComponent(he))})}catch(U){throw _.push(R+"type="+encodeURIComponent("_badmap")),U}}function ao(c){this.l=c.Ub||null,this.j=c.eb||!1}g(ao,Ya),ao.prototype.g=function(){return new lo(this.l,this.j)},ao.prototype.i=function(c){return function(){return c}}({});function lo(c,_){gt.call(this),this.D=c,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}g(lo,gt),n=lo.prototype,n.open=function(c,_){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=_,this.readyState=1,$i(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const _={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(_.body=c),(this.D||a).fetch(new Request(this.A,_)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Zi(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,$i(this)),this.g&&(this.readyState=3,$i(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bc(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function Bc(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var _=c.value?c.value:new Uint8Array(0);(_=this.v.decode(_,{stream:!c.done}))&&(this.response=this.responseText+=_)}c.done?Zi(this):$i(this),this.readyState==3&&Bc(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Zi(this))},n.Qa=function(c){this.g&&(this.response=c,Zi(this))},n.ga=function(){this.g&&Zi(this)};function Zi(c){c.readyState=4,c.l=null,c.j=null,c.v=null,$i(c)}n.setRequestHeader=function(c,_){this.u.append(c,_)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],_=this.h.entries();for(var m=_.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=_.next();return c.join(`\r
`)};function $i(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(lo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Uc(c){let _="";return z(c,function(m,R){_+=R,_+=":",_+=m,_+=`\r
`}),_}function sl(c,_,m){e:{for(R in m){var R=!1;break e}R=!0}R||(m=Uc(m),typeof c=="string"?m!=null&&encodeURIComponent(String(m)):dt(c,_,m))}function Tt(c){gt.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}g(Tt,gt);var Rm=/^https?$/i,Pm=["POST","PUT"];n=Tt.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,_,m,R){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);_=_?_.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Za.g(),this.v=this.o?gc(this.o):gc(Za),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(_,String(c),!0),this.B=!1}catch(q){jc(this,q);return}if(c=m||"",m=new Map(this.headers),R)if(Object.getPrototypeOf(R)===Object.prototype)for(var U in R)m.set(U,R[U]);else if(typeof R.keys=="function"&&typeof R.get=="function")for(const q of R.keys())m.set(q,R.get(q));else throw Error("Unknown input type for opt_headers: "+String(R));R=Array.from(m.keys()).find(q=>q.toLowerCase()=="content-type"),U=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Pm,_,void 0))||R||U||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[q,he]of m)this.g.setRequestHeader(q,he);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gc(this),this.u=!0,this.g.send(c),this.u=!1}catch(q){jc(this,q)}};function jc(c,_){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=_,c.m=5,qc(c),uo(c)}function qc(c){c.A||(c.A=!0,Pt(c,"complete"),Pt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Pt(this,"complete"),Pt(this,"abort"),uo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),uo(this,!0)),Tt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Hc(this):this.bb())},n.bb=function(){Hc(this)};function Hc(c){if(c.h&&typeof o<"u"&&(!c.v[1]||Qn(c)!=4||c.Z()!=2)){if(c.u&&Qn(c)==4)fc(c.Ea,0,c);else if(Pt(c,"readystatechange"),Qn(c)==4){c.h=!1;try{const he=c.Z();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break e;default:_=!1}var m;if(!(m=_)){var R;if(R=he===0){var U=String(c.D).match(Vc)[1]||null;!U&&a.self&&a.self.location&&(U=a.self.location.protocol.slice(0,-1)),R=!Rm.test(U?U.toLowerCase():"")}m=R}if(m)Pt(c,"complete"),Pt(c,"success");else{c.m=6;try{var q=2<Qn(c)?c.g.statusText:""}catch{q=""}c.l=q+" ["+c.Z()+"]",qc(c)}}finally{uo(c)}}}}function uo(c,_){if(c.g){Gc(c);const m=c.g,R=c.v[0]?()=>{}:null;c.g=null,c.v=null,_||Pt(c,"ready");try{m.onreadystatechange=R}catch{}}}function Gc(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function Qn(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<Qn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var _=this.g.responseText;return c&&_.indexOf(c)==0&&(_=_.substring(c.length)),am(_)}};function Kc(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function Sm(c){const _={};c=(c.g&&2<=Qn(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let R=0;R<c.length;R++){if(v(c[R]))continue;var m=N(c[R]);const U=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const q=_[U]||[];_[U]=q,q.push(m)}k(_,function(R){return R.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function es(c,_,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||_}function Wc(c){this.Aa=0,this.i=[],this.j=new Wi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=es("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=es("baseRetryDelayMs",5e3,c),this.cb=es("retryDelaySeedMs",1e4,c),this.Wa=es("forwardChannelMaxRetries",2,c),this.wa=es("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new Rc(c&&c.concurrentRequestLimit),this.Da=new Im,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Wc.prototype,n.la=8,n.G=1,n.connect=function(c,_,m,R){en(0),this.W=c,this.H=_||{},m&&R!==void 0&&(this.H.OSID=m,this.H.OAID=R),this.F=this.X,this.I=nh(this,null,this.W),ho(this)};function ol(c){if(Xc(c),c.G==3){var _=c.U++,m=Yn(c.I);if(dt(m,"SID",c.K),dt(m,"RID",_),dt(m,"TYPE","terminate"),ts(c,m),_=new ur(c,c.j,_),_.L=2,_.v=oo(Yn(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(_.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=_.v,m=!0),m||(_.g=rh(_.j,null),_.g.ea(_.v)),_.F=Date.now(),ro(_)}th(c)}function co(c){c.g&&(ll(c),c.g.cancel(),c.g=null)}function Xc(c){co(c),c.u&&(a.clearTimeout(c.u),c.u=null),fo(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function ho(c){if(!Pc(c.h)&&!c.s){c.s=!0;var _=c.Ga;ge||fe(),le||(ge(),le=!0),ee.add(_,c),c.B=0}}function Dm(c,_){return Sc(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=_.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Ki(d(c.Ga,c,_),eh(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const U=new ur(this,this.j,c);let q=this.o;if(this.S&&(q?(q=y(q),D(q,this.S)):q=this.S),this.m!==null||this.O||(U.H=q,q=null),this.P)e:{for(var _=0,m=0;m<this.i.length;m++){t:{var R=this.i[m];if("__data__"in R.map&&(R=R.map.__data__,typeof R=="string")){R=R.length;break t}R=void 0}if(R===void 0)break;if(_+=R,4096<_){_=m;break e}if(_===4096||m===this.i.length-1){_=m+1;break e}}_=1e3}else _=1e3;_=Qc(this,U,_),m=Yn(this.I),dt(m,"RID",c),dt(m,"CVER",22),this.D&&dt(m,"X-HTTP-Session-Id",this.D),ts(this,m),q&&(this.O?_="headers="+encodeURIComponent(String(Uc(q)))+"&"+_:this.m&&sl(m,this.m,q)),il(this.h,U),this.Ua&&dt(m,"TYPE","init"),this.P?(dt(m,"$req",_),dt(m,"SID","null"),U.T=!0,el(U,m,null)):el(U,m,_),this.G=2}}else this.G==3&&(c?Yc(this,c):this.i.length==0||Pc(this.h)||Yc(this))};function Yc(c,_){var m;_?m=_.l:m=c.U++;const R=Yn(c.I);dt(R,"SID",c.K),dt(R,"RID",m),dt(R,"AID",c.T),ts(c,R),c.m&&c.o&&sl(R,c.m,c.o),m=new ur(c,c.j,m,c.B+1),c.m===null&&(m.H=c.o),_&&(c.i=_.D.concat(c.i)),_=Qc(c,m,1e3),m.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),il(c.h,m),el(m,R,_)}function ts(c,_){c.H&&z(c.H,function(m,R){dt(_,R,m)}),c.l&&Nc({},function(m,R){dt(_,R,m)})}function Qc(c,_,m){m=Math.min(c.i.length,m);var R=c.l?d(c.l.Na,c.l,c):null;e:{var U=c.i;let q=-1;for(;;){const he=["count="+m];q==-1?0<m?(q=U[0].g,he.push("ofs="+q)):q=0:he.push("ofs="+q);let ct=!0;for(let xt=0;xt<m;xt++){let Je=U[xt].g;const Gt=U[xt].map;if(Je-=q,0>Je)q=Math.max(0,U[xt].g-100),ct=!1;else try{Cm(Gt,he,"req"+Je+"_")}catch{R&&R(Gt)}}if(ct){R=he.join("&");break e}}}return c=c.i.splice(0,m),_.D=c,R}function Jc(c){if(!c.g&&!c.u){c.Y=1;var _=c.Fa;ge||fe(),le||(ge(),le=!0),ee.add(_,c),c.v=0}}function al(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Ki(d(c.Fa,c),eh(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,Zc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Ki(d(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,en(10),co(this),Zc(this))};function ll(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function Zc(c){c.g=new ur(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var _=Yn(c.qa);dt(_,"RID","rpc"),dt(_,"SID",c.K),dt(_,"AID",c.T),dt(_,"CI",c.F?"0":"1"),!c.F&&c.ja&&dt(_,"TO",c.ja),dt(_,"TYPE","xmlhttp"),ts(c,_),c.m&&c.o&&sl(_,c.m,c.o),c.L&&(c.g.I=c.L);var m=c.g;c=c.ia,m.L=1,m.v=oo(Yn(_)),m.m=null,m.P=!0,Ac(m,c)}n.Za=function(){this.C!=null&&(this.C=null,co(this),al(this),en(19))};function fo(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function $c(c,_){var m=null;if(c.g==_){fo(c),ll(c),c.g=null;var R=2}else if(rl(c.h,_))m=_.D,Dc(c.h,_),R=1;else return;if(c.G!=0){if(_.o)if(R==1){m=_.m?_.m.length:0,_=Date.now()-_.F;var U=c.B;R=eo(),Pt(R,new vc(R,m)),ho(c)}else Jc(c);else if(U=_.s,U==3||U==0&&0<_.X||!(R==1&&Dm(c,_)||R==2&&al(c)))switch(m&&0<m.length&&(_=c.h,_.i=_.i.concat(m)),U){case 1:Vr(c,5);break;case 4:Vr(c,10);break;case 3:Vr(c,6);break;default:Vr(c,2)}}}function eh(c,_){let m=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(m*=2),m*_}function Vr(c,_){if(c.j.info("Error code "+_),_==2){var m=d(c.fb,c),R=c.Xa;const U=!R;R=new Nr(R||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||io(R,"https"),oo(R),U?Em(R.toString(),m):Am(R.toString(),m)}else en(2);c.G=0,c.l&&c.l.sa(_),th(c),Xc(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),en(2)):(this.j.info("Failed to ping google.com"),en(1))};function th(c){if(c.G=0,c.ka=[],c.l){const _=Oc(c.h);(_.length!=0||c.i.length!=0)&&(A(c.ka,_),A(c.ka,c.i),c.h.i.length=0,b(c.i),c.i.length=0),c.l.ra()}}function nh(c,_,m){var R=m instanceof Nr?Yn(m):new Nr(m);if(R.g!="")_&&(R.g=_+"."+R.g),so(R,R.s);else{var U=a.location;R=U.protocol,_=_?_+"."+U.hostname:U.hostname,U=+U.port;var q=new Nr(null);R&&io(q,R),_&&(q.g=_),U&&so(q,U),m&&(q.l=m),R=q}return m=c.D,_=c.ya,m&&_&&dt(R,m,_),dt(R,"VER",c.la),ts(c,R),R}function rh(c,_,m){if(_&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return _=c.Ca&&!c.pa?new Tt(new ao({eb:m})):new Tt(c.pa),_.Ha(c.J),_}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ih(){}n=ih.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function _o(){}_o.prototype.g=function(c,_){return new _n(c,_)};function _n(c,_){gt.call(this),this.g=new Wc(_),this.l=c,this.h=_&&_.messageUrlParams||null,c=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(c?c["X-WebChannel-Content-Type"]=_.messageContentType:c={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.va&&(c?c["X-WebChannel-Client-Profile"]=_.va:c={"X-WebChannel-Client-Profile":_.va}),this.g.S=c,(c=_&&_.Sb)&&!v(c)&&(this.g.m=c),this.v=_&&_.supportsCrossDomainXhr||!1,this.u=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!v(_)&&(this.g.D=_,c=this.h,c!==null&&_ in c&&(c=this.h,_ in c&&delete c[_])),this.j=new ni(this)}g(_n,gt),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){ol(this.g)},_n.prototype.o=function(c){var _=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.u&&(m={},m.__data__=Xa(c),c=m);_.i.push(new _m(_.Ya++,c)),_.G==3&&ho(_)},_n.prototype.N=function(){this.g.l=null,delete this.j,ol(this.g),delete this.g,_n.aa.N.call(this)};function sh(c){Qa.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var _=c.__sm__;if(_){e:{for(const m in _){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,_=_!==null&&c in _?_[c]:void 0),this.data=_}else this.data=c}g(sh,Qa);function oh(){Ja.call(this),this.status=1}g(oh,Ja);function ni(c){this.g=c}g(ni,ih),ni.prototype.ua=function(){Pt(this.g,"a")},ni.prototype.ta=function(c){Pt(this.g,new sh(c))},ni.prototype.sa=function(c){Pt(this.g,new oh)},ni.prototype.ra=function(){Pt(this.g,"b")},_o.prototype.createWebChannel=_o.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,J_=function(){return new _o},Q_=function(){return eo()},Y_=Dr,Gl={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},to.NO_ERROR=0,to.TIMEOUT=8,to.HTTP_ERROR=6,No=to,kc.COMPLETE="complete",X_=kc,mc.EventType=Hi,Hi.OPEN="a",Hi.CLOSE="b",Hi.ERROR="c",Hi.MESSAGE="d",gt.prototype.listen=gt.prototype.K,as=mc,Tt.prototype.listenOnce=Tt.prototype.L,Tt.prototype.getLastError=Tt.prototype.Ka,Tt.prototype.getLastErrorCode=Tt.prototype.Ba,Tt.prototype.getStatus=Tt.prototype.Z,Tt.prototype.getResponseJson=Tt.prototype.Oa,Tt.prototype.getResponseText=Tt.prototype.oa,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Ha,W_=Tt}).apply(typeof yo<"u"?yo:typeof self<"u"?self:typeof window<"u"?window:{});const vh="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Qt.UNAUTHENTICATED=new Qt(null),Qt.GOOGLE_CREDENTIALS=new Qt("google-credentials-uid"),Qt.FIRST_PARTY=new Qt("first-party-uid"),Qt.MOCK_USER=new Qt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zi="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr=new B_("@firebase/firestore");function ns(){return Wr.logLevel}function ve(n,...e){if(Wr.logLevel<=Ye.DEBUG){const t=e.map(bu);Wr.debug(`Firestore (${zi}): ${n}`,...t)}}function ir(n,...e){if(Wr.logLevel<=Ye.ERROR){const t=e.map(bu);Wr.error(`Firestore (${zi}): ${n}`,...t)}}function Ii(n,...e){if(Wr.logLevel<=Ye.WARN){const t=e.map(bu);Wr.warn(`Firestore (${zi}): ${n}`,...t)}}function bu(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n="Unexpected state"){const e=`FIRESTORE (${zi}) INTERNAL ASSERTION FAILED: `+n;throw ir(e),new Error(e)}function ot(n,e){n||Ne()}function xe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ie extends Li{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wb{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qt.UNAUTHENTICATED))}shutdown(){}}class Xb{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Yb{constructor(e){this.t=e,this.currentUser=Qt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ot(this.o===void 0);let r=this.i;const i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let s=new yr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new yr,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{ve("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ve("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yr)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ve("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ot(typeof r.accessToken=="string"),new Z_(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ot(e===null||typeof e=="string"),new Qt(e)}}class Qb{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Qt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Jb{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Qb(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Qt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Zb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $b{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ot(this.o===void 0);const r=s=>{s.error!=null&&ve("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,ve("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{ve("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):ve("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ot(typeof t.token=="string"),this.R=t.token,new Zb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e0(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=e0(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function Ze(n,e){return n<e?-1:n>e?1:0}function Ci(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ie(re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ie(re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ie(re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ie(re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ot.fromMillis(Date.now())}static fromDate(e){return Ot.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ot(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ze(this.nanoseconds,e.nanoseconds):Ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Me(e)}static min(){return new Me(new Ot(0,0))}static max(){return new Me(new Ot(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ne(),r===void 0?r=e.length-t:r>e.length-t&&Ne(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Cs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Cs?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class mt extends Cs{construct(e,t,r){return new mt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ie(re.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new mt(t)}static emptyPath(){return new mt([])}}const t0=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ut extends Cs{construct(e,t,r){return new Ut(e,t,r)}static isValidIdentifier(e){return t0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ut.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ut(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new Ie(re.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new Ie(re.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Ie(re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new Ie(re.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ut(t)}static emptyPath(){return new Ut([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.path=e}static fromPath(e){return new Re(mt.fromString(e))}static fromName(e){return new Re(mt.fromString(e).popFirst(5))}static empty(){return new Re(mt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&mt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return mt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new mt(e.slice()))}}function n0(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Me.fromTimestamp(r===1e9?new Ot(t+1,0):new Ot(t,r));return new Tr(i,Re.empty(),e)}function r0(n){return new Tr(n.readTime,n.key,-1)}class Tr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Tr(Me.min(),Re.empty(),-1)}static max(){return new Tr(Me.max(),Re.empty(),-1)}}function i0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Re.comparator(n.documentKey,e.documentKey),t!==0?t:Ze(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class o0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bs(n){if(n.code!==re.FAILED_PRECONDITION||n.message!==s0)throw n;ve("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ne((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ne?t:ne.resolve(t)}catch(t){return ne.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ne.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ne.reject(t)}static resolve(e){return new ne((t,r)=>{t(e)})}static reject(e){return new ne((t,r)=>{r(e)})}static waitFor(e){return new ne((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=ne.resolve(!1);for(const r of e)t=t.next(i=>i?ne.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new ne((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===s&&r(o)},h=>i(h))}})}static doWhile(e,t){return new ne((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}function a0(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Us(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}wu.oe=-1;function ba(n){return n==null}function Jo(n){return n===0&&1/n==-1/0}function l0(n){return typeof n=="number"&&Number.isInteger(n)&&!Jo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ep(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.comparator=e,this.root=t||Bt.EMPTY}insert(e,t){return new wt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Bt.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bo(this.root,e,this.comparator,!1)}getReverseIterator(){return new bo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bo(this.root,e,this.comparator,!0)}}class bo{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Bt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Bt.RED,this.left=i??Bt.EMPTY,this.right=s??Bt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Bt(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Bt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Bt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Bt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Bt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ne();const e=this.left.check();if(e!==this.right.check())throw Ne();return e+(this.isRed()?0:1)}}Bt.EMPTY=null,Bt.RED=!0,Bt.BLACK=!1;Bt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne()}get value(){throw Ne()}get color(){throw Ne()}get left(){throw Ne()}get right(){throw Ne()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Bt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Th(this.data.getIterator())}getIteratorFrom(e){return new Th(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new jt(this.comparator);return t.data=e,t}}class Th{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this.fields=e,e.sort(Ut.comparator)}static empty(){return new bn([])}unionWith(e){let t=new jt(Ut.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new bn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ci(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new tp("Invalid base64 string: "+s):s}}(e);return new qt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new qt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qt.EMPTY_BYTE_STRING=new qt("");const u0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Er(n){if(ot(!!n),typeof n=="string"){let e=0;const t=u0.exec(n);if(ot(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Et(n.seconds),nanos:Et(n.nanos)}}function Et(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Xr(n){return typeof n=="string"?qt.fromBase64String(n):qt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vu(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function ku(n){const e=n.mapValue.fields.__previous_value__;return vu(e)?ku(e):e}function Rs(n){const e=Er(n.mapValue.fields.__local_write_time__.timestampValue);return new Ot(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e,t,r,i,s,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class Ps{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ps("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Ps&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Yr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vu(n)?4:f0(n)?9007199254740991:h0(n)?10:11:Ne()}function Kn(n,e){if(n===e)return!0;const t=Yr(n);if(t!==Yr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Rs(n).isEqual(Rs(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Er(i.timestampValue),a=Er(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Xr(i.bytesValue).isEqual(Xr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Et(i.geoPointValue.latitude)===Et(s.geoPointValue.latitude)&&Et(i.geoPointValue.longitude)===Et(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Et(i.integerValue)===Et(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Et(i.doubleValue),a=Et(s.doubleValue);return o===a?Jo(o)===Jo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ci(n.arrayValue.values||[],e.arrayValue.values||[],Kn);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(kh(o)!==kh(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Kn(o[l],a[l])))return!1;return!0}(n,e);default:return Ne()}}function Ss(n,e){return(n.values||[]).find(t=>Kn(t,e))!==void 0}function Ri(n,e){if(n===e)return 0;const t=Yr(n),r=Yr(e);if(t!==r)return Ze(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ze(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Et(s.integerValue||s.doubleValue),l=Et(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Eh(n.timestampValue,e.timestampValue);case 4:return Eh(Rs(n),Rs(e));case 5:return Ze(n.stringValue,e.stringValue);case 6:return function(s,o){const a=Xr(s),l=Xr(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Ze(a[u],l[u]);if(h!==0)return h}return Ze(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=Ze(Et(s.latitude),Et(o.latitude));return a!==0?a:Ze(Et(s.longitude),Et(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Ah(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,l,u,h;const f=s.fields||{},d=o.fields||{},p=(a=f.value)===null||a===void 0?void 0:a.arrayValue,g=(l=d.value)===null||l===void 0?void 0:l.arrayValue,b=Ze(((u=p==null?void 0:p.values)===null||u===void 0?void 0:u.length)||0,((h=g==null?void 0:g.values)===null||h===void 0?void 0:h.length)||0);return b!==0?b:Ah(p,g)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===wo.mapValue&&o===wo.mapValue)return 0;if(s===wo.mapValue)return 1;if(o===wo.mapValue)return-1;const a=s.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const d=Ze(l[f],h[f]);if(d!==0)return d;const p=Ri(a[l[f]],u[h[f]]);if(p!==0)return p}return Ze(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Ne()}}function Eh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ze(n,e);const t=Er(n),r=Er(e),i=Ze(t.seconds,r.seconds);return i!==0?i:Ze(t.nanos,r.nanos)}function Ah(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=Ri(t[i],r[i]);if(s)return s}return Ze(t.length,r.length)}function Pi(n){return Kl(n)}function Kl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Er(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Xr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Kl(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Kl(t.fields[o])}`;return i+"}"}(n.mapValue):Ne()}function Wl(n){return!!n&&"integerValue"in n}function Tu(n){return!!n&&"arrayValue"in n}function Ih(n){return!!n&&"nullValue"in n}function Ch(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Vo(n){return!!n&&"mapValue"in n}function h0(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ps(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Zr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ps(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ps(n.arrayValue.values[t]);return e}return Object.assign({},n)}function f0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.value=e}static empty(){return new an({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Vo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ps(t)}setAll(e){let t=Ut.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ps(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Vo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Vo(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Zr(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new an(ps(this.value))}}function np(n){const e=[];return Zr(n.fields,(t,r)=>{const i=new Ut([t]);if(Vo(r)){const s=np(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new bn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Jt(e,0,Me.min(),Me.min(),Me.min(),an.empty(),0)}static newFoundDocument(e,t,r,i){return new Jt(e,1,t,Me.min(),r,i,0)}static newNoDocument(e,t){return new Jt(e,2,t,Me.min(),Me.min(),an.empty(),0)}static newUnknownDocument(e,t){return new Jt(e,3,t,Me.min(),Me.min(),an.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=an.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=an.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(e,t){this.position=e,this.inclusive=t}}function Rh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(s.field.isKeyField()?r=Re.comparator(Re.fromName(o.referenceValue),t.key):r=Ri(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ph(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Kn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e,t="asc"){this.field=e,this.dir=t}}function d0(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{}class St extends rp{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new p0(e,t,r):t==="array-contains"?new y0(e,r):t==="in"?new b0(e,r):t==="not-in"?new w0(e,r):t==="array-contains-any"?new v0(e,r):new St(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new g0(e,r):new m0(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ri(t,this.value)):t!==null&&Yr(this.value)===Yr(t)&&this.matchesComparison(Ri(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wn extends rp{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Wn(e,t)}matches(e){return ip(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ip(n){return n.op==="and"}function sp(n){return _0(n)&&ip(n)}function _0(n){for(const e of n.filters)if(e instanceof Wn)return!1;return!0}function Xl(n){if(n instanceof St)return n.field.canonicalString()+n.op.toString()+Pi(n.value);if(sp(n))return n.filters.map(e=>Xl(e)).join(",");{const e=n.filters.map(t=>Xl(t)).join(",");return`${n.op}(${e})`}}function op(n,e){return n instanceof St?function(r,i){return i instanceof St&&r.op===i.op&&r.field.isEqual(i.field)&&Kn(r.value,i.value)}(n,e):n instanceof Wn?function(r,i){return i instanceof Wn&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&op(o,i.filters[a]),!0):!1}(n,e):void Ne()}function ap(n){return n instanceof St?function(t){return`${t.field.canonicalString()} ${t.op} ${Pi(t.value)}`}(n):n instanceof Wn?function(t){return t.op.toString()+" {"+t.getFilters().map(ap).join(" ,")+"}"}(n):"Filter"}class p0 extends St{constructor(e,t,r){super(e,t,r),this.key=Re.fromName(r.referenceValue)}matches(e){const t=Re.comparator(e.key,this.key);return this.matchesComparison(t)}}class g0 extends St{constructor(e,t){super(e,"in",t),this.keys=lp("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class m0 extends St{constructor(e,t){super(e,"not-in",t),this.keys=lp("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function lp(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Re.fromName(r.referenceValue))}class y0 extends St{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Tu(t)&&Ss(t.arrayValue,this.value)}}class b0 extends St{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ss(this.value.arrayValue,t)}}class w0 extends St{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ss(this.value.arrayValue,t)}}class v0 extends St{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Tu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ss(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}}function Sh(n,e=null,t=[],r=[],i=null,s=null,o=null){return new k0(n,e,t,r,i,s,o)}function Eu(n){const e=xe(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Xl(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ba(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Pi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Pi(r)).join(",")),e.ue=t}return e.ue}function Au(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!d0(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!op(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ph(n.startAt,e.startAt)&&Ph(n.endAt,e.endAt)}function Yl(n){return Re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function T0(n,e,t,r,i,s,o,a){return new wa(n,e,t,r,i,s,o,a)}function Iu(n){return new wa(n)}function Dh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function E0(n){return n.collectionGroup!==null}function gs(n){const e=xe(n);if(e.ce===null){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new jt(Ut.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new $o(s,r))}),t.has(Ut.keyField().canonicalString())||e.ce.push(new $o(Ut.keyField(),r))}return e.ce}function qn(n){const e=xe(n);return e.le||(e.le=A0(e,gs(n))),e.le}function A0(n,e){if(n.limitType==="F")return Sh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new $o(i.field,s)});const t=n.endAt?new Zo(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zo(n.startAt.position,n.startAt.inclusive):null;return Sh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ql(n,e,t){return new wa(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function va(n,e){return Au(qn(n),qn(e))&&n.limitType===e.limitType}function up(n){return`${Eu(qn(n))}|lt:${n.limitType}`}function ci(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>ap(i)).join(", ")}]`),ba(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Pi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Pi(i)).join(",")),`Target(${r})`}(qn(n))}; limitType=${n.limitType})`}function ka(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Re.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of gs(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,l){const u=Rh(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,gs(r),i)||r.endAt&&!function(o,a,l){const u=Rh(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,gs(r),i))}(n,e)}function I0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function cp(n){return(e,t)=>{let r=!1;for(const i of gs(n)){const s=C0(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function C0(n,e,t){const r=n.field.isKeyField()?Re.comparator(e.key,t.key):function(s,o,a){const l=o.data.field(s),u=a.data.field(s);return l!==null&&u!==null?Ri(l,u):Ne()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ne()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zr(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return ep(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R0=new wt(Re.comparator);function sr(){return R0}const hp=new wt(Re.comparator);function ls(...n){let e=hp;for(const t of n)e=e.insert(t.key,t);return e}function fp(n){let e=hp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function zr(){return ms()}function dp(){return ms()}function ms(){return new Fi(n=>n.toString(),(n,e)=>n.isEqual(e))}const P0=new wt(Re.comparator),S0=new jt(Re.comparator);function je(...n){let e=S0;for(const t of n)e=e.add(t);return e}const D0=new jt(Ze);function O0(){return D0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jo(e)?"-0":e}}function _p(n){return{integerValue:""+n}}function N0(n,e){return l0(e)?_p(e):Cu(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(){this._=void 0}}function V0(n,e,t){return n instanceof Ds?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&vu(s)&&(s=ku(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Os?gp(n,e):n instanceof Ns?mp(n,e):function(i,s){const o=pp(i,s),a=Oh(o)+Oh(i.Pe);return Wl(o)&&Wl(i.Pe)?_p(a):Cu(i.serializer,a)}(n,e)}function M0(n,e,t){return n instanceof Os?gp(n,e):n instanceof Ns?mp(n,e):t}function pp(n,e){return n instanceof ea?function(r){return Wl(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class Ds extends Ta{}class Os extends Ta{constructor(e){super(),this.elements=e}}function gp(n,e){const t=yp(e);for(const r of n.elements)t.some(i=>Kn(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ns extends Ta{constructor(e){super(),this.elements=e}}function mp(n,e){let t=yp(e);for(const r of n.elements)t=t.filter(i=>!Kn(i,r));return{arrayValue:{values:t}}}class ea extends Ta{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Oh(n){return Et(n.integerValue||n.doubleValue)}function yp(n){return Tu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,t){this.field=e,this.transform=t}}function L0(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Os&&i instanceof Os||r instanceof Ns&&i instanceof Ns?Ci(r.elements,i.elements,Kn):r instanceof ea&&i instanceof ea?Kn(r.Pe,i.Pe):r instanceof Ds&&i instanceof Ds}(n.transform,e.transform)}class z0{constructor(e,t){this.version=e,this.transformResults=t}}class An{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new An}static exists(e){return new An(void 0,e)}static updateTime(e){return new An(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Mo(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ea{}function bp(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ru(n.key,An.none()):new js(n.key,n.data,An.none());{const t=n.data,r=an.empty();let i=new jt(Ut.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Cr(n.key,r,new bn(i.toArray()),An.none())}}function F0(n,e,t){n instanceof js?function(i,s,o){const a=i.value.clone(),l=Vh(i.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Cr?function(i,s,o){if(!Mo(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=Vh(i.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(wp(i)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ys(n,e,t,r){return n instanceof js?function(s,o,a,l){if(!Mo(s.precondition,o))return a;const u=s.value.clone(),h=Mh(s.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Cr?function(s,o,a,l){if(!Mo(s.precondition,o))return a;const u=Mh(s.fieldTransforms,l,o),h=o.data;return h.setAll(wp(s)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(s,o,a){return Mo(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function B0(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=pp(r.transform,i||null);s!=null&&(t===null&&(t=an.empty()),t.set(r.field,s))}return t||null}function Nh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ci(r,i,(s,o)=>L0(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class js extends Ea{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Cr extends Ea{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function wp(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Vh(n,e,t){const r=new Map;ot(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,M0(o,a,t[i]))}return r}function Mh(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,V0(s,o,e))}return r}class Ru extends Ea{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class U0 extends Ea{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&F0(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ys(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ys(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=dp();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const l=bp(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(Me.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),je())}isEqual(e){return this.batchId===e.batchId&&Ci(this.mutations,e.mutations,(t,r)=>Nh(t,r))&&Ci(this.baseMutations,e.baseMutations,(t,r)=>Nh(t,r))}}class Pu{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){ot(e.mutations.length===r.length);let i=function(){return P0}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Pu(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ct,Ge;function G0(n){switch(n){default:return Ne();case re.CANCELLED:case re.UNKNOWN:case re.DEADLINE_EXCEEDED:case re.RESOURCE_EXHAUSTED:case re.INTERNAL:case re.UNAVAILABLE:case re.UNAUTHENTICATED:return!1;case re.INVALID_ARGUMENT:case re.NOT_FOUND:case re.ALREADY_EXISTS:case re.PERMISSION_DENIED:case re.FAILED_PRECONDITION:case re.ABORTED:case re.OUT_OF_RANGE:case re.UNIMPLEMENTED:case re.DATA_LOSS:return!0}}function vp(n){if(n===void 0)return ir("GRPC error has no .code"),re.UNKNOWN;switch(n){case Ct.OK:return re.OK;case Ct.CANCELLED:return re.CANCELLED;case Ct.UNKNOWN:return re.UNKNOWN;case Ct.DEADLINE_EXCEEDED:return re.DEADLINE_EXCEEDED;case Ct.RESOURCE_EXHAUSTED:return re.RESOURCE_EXHAUSTED;case Ct.INTERNAL:return re.INTERNAL;case Ct.UNAVAILABLE:return re.UNAVAILABLE;case Ct.UNAUTHENTICATED:return re.UNAUTHENTICATED;case Ct.INVALID_ARGUMENT:return re.INVALID_ARGUMENT;case Ct.NOT_FOUND:return re.NOT_FOUND;case Ct.ALREADY_EXISTS:return re.ALREADY_EXISTS;case Ct.PERMISSION_DENIED:return re.PERMISSION_DENIED;case Ct.FAILED_PRECONDITION:return re.FAILED_PRECONDITION;case Ct.ABORTED:return re.ABORTED;case Ct.OUT_OF_RANGE:return re.OUT_OF_RANGE;case Ct.UNIMPLEMENTED:return re.UNIMPLEMENTED;case Ct.DATA_LOSS:return re.DATA_LOSS;default:return Ne()}}(Ge=Ct||(Ct={}))[Ge.OK=0]="OK",Ge[Ge.CANCELLED=1]="CANCELLED",Ge[Ge.UNKNOWN=2]="UNKNOWN",Ge[Ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ge[Ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ge[Ge.NOT_FOUND=5]="NOT_FOUND",Ge[Ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ge[Ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ge[Ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ge[Ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ge[Ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ge[Ge.ABORTED=10]="ABORTED",Ge[Ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ge[Ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ge[Ge.INTERNAL=13]="INTERNAL",Ge[Ge.UNAVAILABLE=14]="UNAVAILABLE",Ge[Ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K0(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W0=new qr([4294967295,4294967295],0);function xh(n){const e=K0().encode(n),t=new K_;return t.update(e),new Uint8Array(t.digest())}function Lh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new qr([t,r],0),new qr([i,s],0)]}class Su{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new us(`Invalid padding: ${t}`);if(r<0)throw new us(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new us(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new us(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=qr.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(qr.fromNumber(r)));return i.compare(W0)===1&&(i=new qr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=xh(e),[r,i]=Lh(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Su(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=xh(e),[r,i]=Lh(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class us extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,qs.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Aa(Me.min(),i,new wt(Ze),sr(),je())}}class qs{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new qs(r,t,je(),je(),je())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}}class kp{constructor(e,t){this.targetId=e,this.me=t}}class Tp{constructor(e,t,r=qt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class zh{constructor(){this.fe=0,this.ge=Bh(),this.pe=qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=je(),t=je(),r=je();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Ne()}}),new qs(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Bh()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ot(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class X0{constructor(e){this.Le=e,this.Be=new Map,this.ke=sr(),this.qe=Fh(),this.Qe=new wt(Ze)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ne()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,r=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Yl(s))if(r===0){const o=new Re(s.path);this.Ue(t,o,Jt.newNoDocument(o,Me.min()))}else ot(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=Xr(r).toUint8Array()}catch(l){if(l instanceof tp)return Ii("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Su(o,i,s)}catch(l){return Ii(l instanceof us?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,o)=>{const a=this.Je(o);if(a){if(s.current&&Yl(a.target)){const l=new Re(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Jt.newNoDocument(l,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=je();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new Aa(e,t,this.Qe,this.ke,r);return this.ke=sr(),this.qe=Fh(),this.Qe=new wt(Ze),i}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new zh,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new jt(Ze),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ve("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new zh),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Fh(){return new wt(Re.comparator)}function Bh(){return new wt(Re.comparator)}const Y0=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Q0=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),J0=(()=>({and:"AND",or:"OR"}))();class Z0{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Jl(n,e){return n.useProto3Json||ba(e)?e:{value:e}}function ta(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ep(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function $0(n,e){return ta(n,e.toTimestamp())}function Hn(n){return ot(!!n),Me.fromTimestamp(function(t){const r=Er(t);return new Ot(r.seconds,r.nanos)}(n))}function Du(n,e){return Zl(n,e).canonicalString()}function Zl(n,e){const t=function(i){return new mt(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Ap(n){const e=mt.fromString(n);return ot(Sp(e)),e}function $l(n,e){return Du(n.databaseId,e.path)}function yl(n,e){const t=Ap(e);if(t.get(1)!==n.databaseId.projectId)throw new Ie(re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ie(re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Re(Cp(t))}function Ip(n,e){return Du(n.databaseId,e)}function e1(n){const e=Ap(n);return e.length===4?mt.emptyPath():Cp(e)}function eu(n){return new mt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Cp(n){return ot(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Uh(n,e,t){return{name:$l(n,e),fields:t.value.mapValue.fields}}function t1(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Ne()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,h){return u.useProto3Json?(ot(h===void 0||typeof h=="string"),qt.fromBase64String(h||"")):(ot(h===void 0||h instanceof Buffer||h instanceof Uint8Array),qt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?re.UNKNOWN:vp(u.code);return new Ie(h,u.message||"")}(o);t=new Tp(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=yl(n,r.document.name),s=Hn(r.document.updateTime),o=r.document.createTime?Hn(r.document.createTime):Me.min(),a=new an({mapValue:{fields:r.document.fields}}),l=Jt.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new xo(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=yl(n,r.document),s=r.readTime?Hn(r.readTime):Me.min(),o=Jt.newNoDocument(i,s),a=r.removedTargetIds||[];t=new xo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=yl(n,r.document),s=r.removedTargetIds||[];t=new xo([],s,i,null)}else{if(!("filter"in e))return Ne();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new H0(i,s),a=r.targetId;t=new kp(a,o)}}return t}function n1(n,e){let t;if(e instanceof js)t={update:Uh(n,e.key,e.value)};else if(e instanceof Ru)t={delete:$l(n,e.key)};else if(e instanceof Cr)t={update:Uh(n,e.key,e.data),updateMask:h1(e.fieldMask)};else{if(!(e instanceof U0))return Ne();t={verify:$l(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Ds)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Os)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ns)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ea)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ne()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:$0(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Ne()}(n,e.precondition)),t}function r1(n,e){return n&&n.length>0?(ot(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Hn(i.updateTime):Hn(s);return o.isEqual(Me.min())&&(o=Hn(s)),new z0(o,i.transformResults||[])}(t,e))):[]}function i1(n,e){return{documents:[Ip(n,e.path)]}}function s1(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Ip(n,i);const s=function(u){if(u.length!==0)return Pp(Wn.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(u){if(u.length!==0)return u.map(h=>function(d){return{field:hi(d.field),direction:l1(d.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Jl(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:i}}function o1(n){let e=e1(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){ot(r===1);const h=t.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(f){const d=Rp(f);return d instanceof Wn&&sp(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(d=>function(g){return new $o(fi(g.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(f){let d;return d=typeof f=="object"?f.value:f,ba(d)?null:d}(t.limit));let l=null;t.startAt&&(l=function(f){const d=!!f.before,p=f.values||[];return new Zo(p,d)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const d=!f.before,p=f.values||[];return new Zo(p,d)}(t.endAt)),T0(e,i,o,s,a,"F",l,u)}function a1(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Rp(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=fi(t.unaryFilter.field);return St.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=fi(t.unaryFilter.field);return St.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=fi(t.unaryFilter.field);return St.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=fi(t.unaryFilter.field);return St.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ne()}}(n):n.fieldFilter!==void 0?function(t){return St.create(fi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ne()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Wn.create(t.compositeFilter.filters.map(r=>Rp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ne()}}(t.compositeFilter.op))}(n):Ne()}function l1(n){return Y0[n]}function u1(n){return Q0[n]}function c1(n){return J0[n]}function hi(n){return{fieldPath:n.canonicalString()}}function fi(n){return Ut.fromServerFormat(n.fieldPath)}function Pp(n){return n instanceof St?function(t){if(t.op==="=="){if(Ch(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NAN"}};if(Ih(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ch(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NOT_NAN"}};if(Ih(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hi(t.field),op:u1(t.op),value:t.value}}}(n):n instanceof Wn?function(t){const r=t.getFilters().map(i=>Pp(i));return r.length===1?r[0]:{compositeFilter:{op:c1(t.op),filters:r}}}(n):Ne()}function h1(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Sp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,t,r,i,s=Me.min(),o=Me.min(),a=qt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new _r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new _r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f1{constructor(e){this.ct=e}}function d1(n){const e=o1({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ql(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(){this.un=new p1}addToCollectionParentIndex(e,t){return this.un.add(t),ne.resolve()}getCollectionParents(e,t){return ne.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ne.resolve()}deleteFieldIndex(e,t){return ne.resolve()}deleteAllFieldIndexes(e){return ne.resolve()}createTargetIndexes(e,t){return ne.resolve()}getDocumentsMatchingTarget(e,t){return ne.resolve(null)}getIndexType(e,t){return ne.resolve(0)}getFieldIndexes(e,t){return ne.resolve([])}getNextCollectionGroupToUpdate(e){return ne.resolve(null)}getMinOffset(e,t){return ne.resolve(Tr.min())}getMinOffsetFromCollectionGroup(e,t){return ne.resolve(Tr.min())}updateCollectionGroup(e,t,r){return ne.resolve()}updateIndexEntries(e,t){return ne.resolve()}}class p1{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new jt(mt.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new jt(mt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Si(0)}static kn(){return new Si(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(){this.changes=new Fi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?ne.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ys(r.mutation,i,bn.empty(),Ot.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,je()).next(()=>r))}getLocalViewOfDocuments(e,t,r=je()){const i=zr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ls();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=zr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,je()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=sr();const o=ms(),a=function(){return ms()}();return t.forEach((l,u)=>{const h=r.get(u.key);i.has(u.key)&&(h===void 0||h.mutation instanceof Cr)?s=s.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),ys(h.mutation,u,h.mutation.getFieldMask(),Ot.now())):o.set(u.key,bn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>{var f;return a.set(u,new m1(h,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ms();let i=new wt((o,a)=>o-a),s=je();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||bn.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(i.get(a.batchId)||je()).add(l);i=i.insert(a.batchId,f)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=dp();h.forEach(d=>{if(!s.has(d)){const p=bp(t.get(d),r.get(d));p!==null&&f.set(d,p),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return ne.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return Re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):E0(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):ne.resolve(zr());let a=-1,l=s;return o.next(u=>ne.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(h)?ne.resolve():this.remoteDocumentCache.getEntry(e,h).next(d=>{l=l.insert(h,d)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,je())).next(h=>({batchId:a,changes:fp(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Re(t)).next(r=>{let i=ls();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=ls();return this.indexManager.getCollectionParents(e,s).next(a=>ne.forEach(a,l=>{const u=function(f,d){return new wa(d,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(h=>{h.forEach((f,d)=>{o=o.insert(f,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Jt.newInvalidDocument(h)))});let a=ls();return o.forEach((l,u)=>{const h=s.get(l);h!==void 0&&ys(h.mutation,u,bn.empty(),Ot.now()),ka(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ne.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Hn(i.createTime)}}(t)),ne.resolve()}getNamedQuery(e,t){return ne.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:d1(i.bundledQuery),readTime:Hn(i.readTime)}}(t)),ne.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(){this.overlays=new wt(Re.comparator),this.Ir=new Map}getOverlay(e,t){return ne.resolve(this.overlays.get(t))}getOverlays(e,t){const r=zr();return ne.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),ne.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),ne.resolve()}getOverlaysForCollection(e,t,r){const i=zr(),s=t.length+1,o=new Re(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return ne.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new wt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=zr(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=zr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=i)););return ne.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new q0(t,r));let s=this.Ir.get(t);s===void 0&&(s=je(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(){this.sessionToken=qt.EMPTY_BYTE_STRING}getSessionToken(e){return ne.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ne.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(){this.Tr=new jt(Nt.Er),this.dr=new jt(Nt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Nt(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Nt(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Re(new mt([])),r=new Nt(t,e),i=new Nt(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Re(new mt([])),r=new Nt(t,e),i=new Nt(t,e+1);let s=je();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Nt(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Nt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Re.comparator(e.key,t.key)||Ze(e.wr,t.wr)}static Ar(e,t){return Ze(e.wr,t.wr)||Re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new jt(Nt.Er)}checkEmpty(e){return ne.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new j0(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.br=this.br.add(new Nt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ne.resolve(o)}lookupMutationBatch(e,t){return ne.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.vr(r),s=i<0?0:i;return ne.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ne.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ne.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Nt(t,0),i=new Nt(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{const a=this.Dr(o.wr);s.push(a)}),ne.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Ze);return t.forEach(i=>{const s=new Nt(i,0),o=new Nt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),ne.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Re.isDocumentKey(s)||(s=s.child(""));const o=new Nt(new Re(s),0);let a=new jt(Ze);return this.br.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(l.wr)),!0)},o),ne.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){ot(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return ne.forEach(t.mutations,i=>{const s=new Nt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Nt(t,0),i=this.br.firstAfterOrEqual(r);return ne.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ne.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(e){this.Mr=e,this.docs=function(){return new wt(Re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return ne.resolve(r?r.document.mutableCopy():Jt.newInvalidDocument(t))}getEntries(e,t){let r=sr();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Jt.newInvalidDocument(i))}),ne.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=sr();const o=t.path,a=new Re(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||i0(r0(h),r)<=0||(i.has(h.key)||ka(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return ne.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Ne()}Or(e,t){return ne.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new E1(this)}getSize(e){return ne.resolve(this.size)}}class E1 extends g1{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),ne.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e){this.persistence=e,this.Nr=new Fi(t=>Eu(t),Au),this.lastRemoteSnapshotVersion=Me.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ou,this.targetCount=0,this.kr=Si.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),ne.resolve()}getLastRemoteSnapshotVersion(e){return ne.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ne.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ne.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),ne.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Si(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ne.resolve()}updateTargetData(e,t){return this.Kn(t),ne.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ne.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),ne.waitFor(s).next(()=>i)}getTargetCount(e){return ne.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return ne.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),ne.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),ne.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ne.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return ne.resolve(r)}containsKey(e,t){return ne.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(e,t){this.qr={},this.overlays={},this.Qr=new wu(0),this.Kr=!1,this.Kr=!0,this.$r=new v1,this.referenceDelegate=e(this),this.Ur=new A1(this),this.indexManager=new _1,this.remoteDocumentCache=function(i){return new T1(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new f1(t),this.Gr=new b1(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new w1,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new k1(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ve("MemoryPersistence","Starting transaction:",e);const i=new C1(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return ne.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class C1 extends o0{constructor(e){super(),this.currentSequenceNumber=e}}class Nu{constructor(e){this.persistence=e,this.Jr=new Ou,this.Yr=null}static Zr(e){return new Nu(e)}get Xr(){if(this.Yr)return this.Yr;throw Ne()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),ne.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),ne.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ne.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ne.forEach(this.Xr,r=>{const i=Re.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,Me.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return ne.or([()=>ne.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=je(),i=je();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Vu(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Sy()?8:a0(Ry())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new R1;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(ns()<=Ye.DEBUG&&ve("QueryEngine","SDK will not create cache indexes for query:",ci(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ne.resolve()):(ns()<=Ye.DEBUG&&ve("QueryEngine","Query:",ci(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(ns()<=Ye.DEBUG&&ve("QueryEngine","The SDK decides to create cache indexes for query:",ci(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qn(t))):ne.resolve())}Yi(e,t){if(Dh(t))return ne.resolve(null);let r=qn(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ql(t,null,"F"),r=qn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=je(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.ts(t,a);return this.ns(t,u,o,l.readTime)?this.Yi(e,Ql(t,null,"F")):this.rs(e,u,t,l)}))})))}Zi(e,t,r,i){return Dh(t)||i.isEqual(Me.min())?ne.resolve(null):this.Ji.getDocuments(e,r).next(s=>{const o=this.ts(t,s);return this.ns(t,o,r,i)?ne.resolve(null):(ns()<=Ye.DEBUG&&ve("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ci(t)),this.rs(e,o,t,n0(i,-1)).next(a=>a))})}ts(e,t){let r=new jt(cp(e));return t.forEach((i,s)=>{ka(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return ns()<=Ye.DEBUG&&ve("QueryEngine","Using full collection scan to execute query:",ci(t)),this.Ji.getDocumentsMatchingQuery(e,t,Tr.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new wt(Ze),this._s=new Fi(s=>Eu(s),Au),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new y1(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function D1(n,e,t,r){return new S1(n,e,t,r)}async function Dp(n,e){const t=xe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=je();for(const u of i){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of s){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})}function O1(n,e){const t=xe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,d=f.keys();let p=ne.resolve();return d.forEach(g=>{p=p.next(()=>h.getEntry(l,g)).next(b=>{const A=u.docVersions.get(g);ot(A!==null),b.version.compareTo(A)<0&&(f.applyToRemoteDocument(b,u),b.isValidDocument()&&(b.setReadTime(u.commitVersion),h.addEntry(b)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=je();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Op(n){const e=xe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function N1(n,e){const t=xe(n),r=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const d=i.get(f);if(!d)return;a.push(t.Ur.removeMatchingKeys(s,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,h.addedDocuments,f)));let p=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?p=p.withResumeToken(qt.EMPTY_BYTE_STRING,Me.min()).withLastLimboFreeSnapshotVersion(Me.min()):h.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(h.resumeToken,r)),i=i.insert(f,p),function(b,A,S){return b.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(d,p,h)&&a.push(t.Ur.updateTargetData(s,p))});let l=sr(),u=je();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),a.push(V1(s,o,e.documentUpdates).next(h=>{l=h.Ps,u=h.Is})),!r.isEqual(Me.min())){const h=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(h)}return ne.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(t.os=i,s))}function V1(n,e,t){let r=je(),i=je();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=sr();return t.forEach((a,l)=>{const u=s.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(Me.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ve("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Ps:o,Is:i}})}function M1(n,e){const t=xe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function x1(n,e){const t=xe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,ne.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new _r(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function tu(n,e,t){const r=xe(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Us(o))throw o;ve("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)}function jh(n,e,t){const r=xe(n);let i=Me.min(),s=je();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=xe(l),d=f._s.get(h);return d!==void 0?ne.resolve(f.os.get(d)):f.Ur.getTargetData(u,h)}(r,o,qn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:Me.min(),t?s:je())).next(a=>(L1(r,I0(e),a),{documents:a,Ts:s})))}function L1(n,e,t){let r=n.us.get(e)||Me.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}class qh{constructor(){this.activeTargetIds=O0()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class z1{constructor(){this.so=new qh,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new qh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ve("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ve("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vo=null;function bl(){return vo===null?vo=function(){return 268435456+Math.round(2147483648*Math.random())}():vo++,"0x"+vo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wt="WebChannelConnection";class j1 extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){const a=bl(),l=this.xo(t,r.toUriEncodedString());ve("RestConnection",`Sending RPC '${t}' ${a}:`,l,i);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,l,u,i).then(h=>(ve("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Ii("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",i),h})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+zi}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){const i=B1[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){const s=bl();return new Promise((o,a)=>{const l=new W_;l.setWithCredentials(!0),l.listenOnce(X_.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case No.NO_ERROR:const h=l.getResponseJson();ve(Wt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),o(h);break;case No.TIMEOUT:ve(Wt,`RPC '${e}' ${s} timed out`),a(new Ie(re.DEADLINE_EXCEEDED,"Request time out"));break;case No.HTTP_ERROR:const f=l.getStatus();if(ve(Wt,`RPC '${e}' ${s} failed with status:`,f,"response text:",l.getResponseText()),f>0){let d=l.getResponseJson();Array.isArray(d)&&(d=d[0]);const p=d==null?void 0:d.error;if(p&&p.status&&p.message){const g=function(A){const S=A.toLowerCase().replace(/_/g,"-");return Object.values(re).indexOf(S)>=0?S:re.UNKNOWN}(p.status);a(new Ie(g,p.message))}else a(new Ie(re.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Ie(re.UNAVAILABLE,"Connection failed."));break;default:Ne()}}finally{ve(Wt,`RPC '${e}' ${s} completed.`)}});const u=JSON.stringify(i);ve(Wt,`RPC '${e}' ${s} sending request:`,i),l.send(t,"POST",u,r,15)})}Bo(e,t,r){const i=bl(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=J_(),a=Q_(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=s.join("");ve(Wt,`Creating RPC '${e}' stream ${i}: ${h}`,l);const f=o.createWebChannel(h,l);let d=!1,p=!1;const g=new U1({Io:A=>{p?ve(Wt,`Not sending because RPC '${e}' stream ${i} is closed:`,A):(d||(ve(Wt,`Opening RPC '${e}' stream ${i} transport.`),f.open(),d=!0),ve(Wt,`RPC '${e}' stream ${i} sending:`,A),f.send(A))},To:()=>f.close()}),b=(A,S,v)=>{A.listen(S,x=>{try{v(x)}catch(E){setTimeout(()=>{throw E},0)}})};return b(f,as.EventType.OPEN,()=>{p||(ve(Wt,`RPC '${e}' stream ${i} transport opened.`),g.yo())}),b(f,as.EventType.CLOSE,()=>{p||(p=!0,ve(Wt,`RPC '${e}' stream ${i} transport closed`),g.So())}),b(f,as.EventType.ERROR,A=>{p||(p=!0,Ii(Wt,`RPC '${e}' stream ${i} transport errored:`,A),g.So(new Ie(re.UNAVAILABLE,"The operation could not be completed")))}),b(f,as.EventType.MESSAGE,A=>{var S;if(!p){const v=A.data[0];ot(!!v);const x=v,E=x.error||((S=x[0])===null||S===void 0?void 0:S.error);if(E){ve(Wt,`RPC '${e}' stream ${i} received error:`,E);const L=E.status;let z=function(w){const D=Ct[w];if(D!==void 0)return vp(D)}(L),k=E.message;z===void 0&&(z=re.INTERNAL,k="Unknown error status: "+L+" with message "+E.message),p=!0,g.So(new Ie(z,k)),f.close()}else ve(Wt,`RPC '${e}' stream ${i} received:`,v),g.bo(v)}}),b(a,Y_.STAT_EVENT,A=>{A.stat===Gl.PROXY?ve(Wt,`RPC '${e}' stream ${i} detected buffering proxy`):A.stat===Gl.NOPROXY&&ve(Wt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{g.wo()},0),g}}function wl(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ia(n){return new Z0(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&ve("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t,r,i,s,o,a,l){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Np(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===re.RESOURCE_EXHAUSTED?(ir(t.toString()),ir("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===re.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{const i=new Ie(re.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ve("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ve("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class q1 extends Vp{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=t1(this.serializer,e),r=function(s){if(!("targetChange"in s))return Me.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?Me.min():o.readTime?Hn(o.readTime):Me.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=eu(this.serializer),t.addTarget=function(s,o){let a;const l=o.target;if(a=Yl(l)?{documents:i1(s,l)}:{query:s1(s,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Ep(s,o.resumeToken);const u=Jl(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(Me.min())>0){a.readTime=ta(s,o.snapshotVersion.toTimestamp());const u=Jl(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=a1(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=eu(this.serializer),t.removeTarget=e,this.a_(t)}}class H1 extends Vp{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ot(!!e.streamToken),this.lastStreamToken=e.streamToken,ot(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ot(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=r1(e.writeResults,e.commitTime),r=Hn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=eu(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>n1(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1 extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new Ie(re.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Zl(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Ie(re.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Zl(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ie(re.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class K1{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ir(t),this.D_=!1):ve("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(async()=>{$r(this)&&(ve("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=xe(l);u.L_.add(4),await Hs(u),u.q_.set("Unknown"),u.L_.delete(4),await Ca(u)}(this))})}),this.q_=new K1(r,i)}}async function Ca(n){if($r(n))for(const e of n.B_)await e(!0)}async function Hs(n){for(const e of n.B_)await e(!1)}function Mp(n,e){const t=xe(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),zu(t)?Lu(t):Bi(t).r_()&&xu(t,e))}function Mu(n,e){const t=xe(n),r=Bi(t);t.N_.delete(e),r.r_()&&xp(t,e),t.N_.size===0&&(r.r_()?r.o_():$r(t)&&t.q_.set("Unknown"))}function xu(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Me.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bi(n).A_(e)}function xp(n,e){n.Q_.xe(e),Bi(n).R_(e)}function Lu(n){n.Q_=new X0({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Bi(n).start(),n.q_.v_()}function zu(n){return $r(n)&&!Bi(n).n_()&&n.N_.size>0}function $r(n){return xe(n).L_.size===0}function Lp(n){n.Q_=void 0}async function X1(n){n.q_.set("Online")}async function Y1(n){n.N_.forEach((e,t)=>{xu(n,e)})}async function Q1(n,e){Lp(n),zu(n)?(n.q_.M_(e),Lu(n)):n.q_.set("Unknown")}async function J1(n,e,t){if(n.q_.set("Online"),e instanceof Tp&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.N_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))}(n,e)}catch(r){ve("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await na(n,r)}else if(e instanceof xo?n.Q_.Ke(e):e instanceof kp?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Me.min()))try{const r=await Op(n.localStore);t.compareTo(r)>=0&&await function(s,o){const a=s.Q_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=s.N_.get(u);h&&s.N_.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=s.N_.get(l);if(!h)return;s.N_.set(l,h.withResumeToken(qt.EMPTY_BYTE_STRING,h.snapshotVersion)),xp(s,l);const f=new _r(h.target,l,u,h.sequenceNumber);xu(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ve("RemoteStore","Failed to raise snapshot:",r),await na(n,r)}}async function na(n,e,t){if(!Us(e))throw e;n.L_.add(1),await Hs(n),n.q_.set("Offline"),t||(t=()=>Op(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ve("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Ca(n)})}function zp(n,e){return e().catch(t=>na(n,t,e))}async function Ra(n){const e=xe(n),t=Ar(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Z1(e);)try{const i=await M1(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,$1(e,i)}catch(i){await na(e,i)}Fp(e)&&Bp(e)}function Z1(n){return $r(n)&&n.O_.length<10}function $1(n,e){n.O_.push(e);const t=Ar(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Fp(n){return $r(n)&&!Ar(n).n_()&&n.O_.length>0}function Bp(n){Ar(n).start()}async function ew(n){Ar(n).p_()}async function tw(n){const e=Ar(n);for(const t of n.O_)e.m_(t.mutations)}async function nw(n,e,t){const r=n.O_.shift(),i=Pu.from(r,e,t);await zp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await Ra(n)}async function rw(n,e){e&&Ar(n).V_&&await async function(r,i){if(function(o){return G0(o)&&o!==re.ABORTED}(i.code)){const s=r.O_.shift();Ar(r).s_(),await zp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await Ra(r)}}(n,e),Fp(n)&&Bp(n)}async function Gh(n,e){const t=xe(n);t.asyncQueue.verifyOperationInProgress(),ve("RemoteStore","RemoteStore received new credentials");const r=$r(t);t.L_.add(3),await Hs(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Ca(t)}async function iw(n,e){const t=xe(n);e?(t.L_.delete(2),await Ca(t)):e||(t.L_.add(2),await Hs(t),t.q_.set("Unknown"))}function Bi(n){return n.K_||(n.K_=function(t,r,i){const s=xe(t);return s.w_(),new q1(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:X1.bind(null,n),Ro:Y1.bind(null,n),mo:Q1.bind(null,n),d_:J1.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),zu(n)?Lu(n):n.q_.set("Unknown")):(await n.K_.stop(),Lp(n))})),n.K_}function Ar(n){return n.U_||(n.U_=function(t,r,i){const s=xe(t);return s.w_(),new H1(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ew.bind(null,n),mo:rw.bind(null,n),f_:tw.bind(null,n),g_:nw.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Ra(n)):(await n.U_.stop(),n.O_.length>0&&(ve("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new yr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new Fu(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ie(re.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Bu(n,e){if(ir("AsyncQueue",`${e}: ${n}`),Us(n))return new Ie(re.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Re.comparator(t.key,r.key):(t,r)=>Re.comparator(t.key,r.key),this.keyedMap=ls(),this.sortedSet=new wt(this.comparator)}static emptySet(e){return new wi(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof wi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new wi;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(){this.W_=new wt(Re.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ne():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Di{constructor(e,t,r,i,s,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Di(e,t,wi.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&va(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class ow{constructor(){this.queries=Wh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const i=xe(t),s=i.queries;i.queries=Wh(),s.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new Ie(re.ABORTED,"Firestore shutting down"))}}function Wh(){return new Fi(n=>up(n),va)}async function Up(n,e){const t=xe(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new sw,r=e.J_()?0:1);try{switch(r){case 0:s.z_=await t.onListen(i,!0);break;case 1:s.z_=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const a=Bu(o,`Initialization of query '${ci(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Uu(t)}async function jp(n,e){const t=xe(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function aw(n,e){const t=xe(n);let r=!1;for(const i of e){const s=i.query,o=t.queries.get(s);if(o){for(const a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&Uu(t)}function lw(n,e,t){const r=xe(n),i=r.queries.get(e);if(i)for(const s of i.j_)s.onError(t);r.queries.delete(e)}function Uu(n){n.Y_.forEach(e=>{e.next()})}var nu,Xh;(Xh=nu||(nu={})).ea="default",Xh.Cache="cache";class qp{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Di(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Di.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==nu.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(e){this.key=e}}class Gp{constructor(e){this.key=e}}class uw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=je(),this.mutatedKeys=je(),this.Aa=cp(e),this.Ra=new wi(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Kh,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,f)=>{const d=i.get(h),p=ka(this.query,f)?f:null,g=!!d&&this.mutatedKeys.has(d.key),b=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let A=!1;d&&p?d.data.isEqual(p.data)?g!==b&&(r.track({type:3,doc:p}),A=!0):this.ga(d,p)||(r.track({type:2,doc:p}),A=!0,(l&&this.Aa(p,l)>0||u&&this.Aa(p,u)<0)&&(a=!0)):!d&&p?(r.track({type:0,doc:p}),A=!0):d&&!p&&(r.track({type:1,doc:d}),A=!0,(l||u)&&(a=!0)),A&&(p?(o=o.add(p),s=b?s.add(h):s.delete(h)):(o=o.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(p,g){const b=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne()}};return b(p)-b(g)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),i=i!=null&&i;const a=t&&!i?this.ya():[],l=this.da.size===0&&this.current&&!i?1:0,u=l!==this.Ea;return this.Ea=l,o.length!==0||u?{snapshot:new Di(this.query,e.Ra,s,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Kh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=je(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Gp(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Hp(r))}),t}ba(e){this.Ta=e.Ts,this.da=je();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Di.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class cw{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class hw{constructor(e){this.key=e,this.va=!1}}class fw{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Fi(a=>up(a),va),this.Ma=new Map,this.xa=new Set,this.Oa=new wt(Re.comparator),this.Na=new Map,this.La=new Ou,this.Ba={},this.ka=new Map,this.qa=Si.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function dw(n,e,t=!0){const r=Jp(n);let i;const s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await Kp(r,e,t,!0),i}async function _w(n,e){const t=Jp(n);await Kp(t,e,!0,!1)}async function Kp(n,e,t,r){const i=await x1(n.localStore,qn(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t);let a;return r&&(a=await pw(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Mp(n.remoteStore,i),a}async function pw(n,e,t,r,i){n.Ka=(f,d,p)=>async function(b,A,S,v){let x=A.view.ma(S);x.ns&&(x=await jh(b.localStore,A.query,!1).then(({documents:k})=>A.view.ma(k,x)));const E=v&&v.targetChanges.get(A.targetId),L=v&&v.targetMismatches.get(A.targetId)!=null,z=A.view.applyChanges(x,b.isPrimaryClient,E,L);return Qh(b,A.targetId,z.wa),z.snapshot}(n,f,d,p);const s=await jh(n.localStore,e,!0),o=new uw(e,s.Ts),a=o.ma(s.documents),l=qs.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,l);Qh(n,t,u.wa);const h=new cw(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot}async function gw(n,e,t){const r=xe(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!va(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await tu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Mu(r.remoteStore,i.targetId),ru(r,i.targetId)}).catch(Bs)):(ru(r,i.targetId),await tu(r.localStore,i.targetId,!0))}async function mw(n,e){const t=xe(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Mu(t.remoteStore,r.targetId))}async function yw(n,e,t){const r=Aw(n);try{const i=await function(o,a){const l=xe(o),u=Ot.now(),h=a.reduce((p,g)=>p.add(g.key),je());let f,d;return l.persistence.runTransaction("Locally write mutations","readwrite",p=>{let g=sr(),b=je();return l.cs.getEntries(p,h).next(A=>{g=A,g.forEach((S,v)=>{v.isValidDocument()||(b=b.add(S))})}).next(()=>l.localDocuments.getOverlayedDocuments(p,g)).next(A=>{f=A;const S=[];for(const v of a){const x=B0(v,f.get(v.key).overlayedDocument);x!=null&&S.push(new Cr(v.key,x,np(x.value.mapValue),An.exists(!0)))}return l.mutationQueue.addMutationBatch(p,u,S,a)}).next(A=>{d=A;const S=A.applyToLocalDocumentSet(f,b);return l.documentOverlayCache.saveOverlays(p,A.batchId,S)})}).then(()=>({batchId:d.batchId,changes:fp(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,l){let u=o.Ba[o.currentUser.toKey()];u||(u=new wt(Ze)),u=u.insert(a,l),o.Ba[o.currentUser.toKey()]=u}(r,i.batchId,t),await Gs(r,i.changes),await Ra(r.remoteStore)}catch(i){const s=Bu(i,"Failed to persist write");t.reject(s)}}async function Wp(n,e){const t=xe(n);try{const r=await N1(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Na.get(s);o&&(ot(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?ot(o.va):i.removedDocuments.size>0&&(ot(o.va),o.va=!1))}),await Gs(t,r,e)}catch(r){await Bs(r)}}function Yh(n,e,t){const r=xe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Fa.forEach((s,o)=>{const a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const l=xe(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const d of f.j_)d.Z_(a)&&(u=!0)}),u&&Uu(l)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function bw(n,e,t){const r=xe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Na.get(e),s=i&&i.key;if(s){let o=new wt(Re.comparator);o=o.insert(s,Jt.newNoDocument(s,Me.min()));const a=je().add(s),l=new Aa(Me.min(),new Map,new wt(Ze),o,a);await Wp(r,l),r.Oa=r.Oa.remove(s),r.Na.delete(e),ju(r)}else await tu(r.localStore,e,!1).then(()=>ru(r,e,t)).catch(Bs)}async function ww(n,e){const t=xe(n),r=e.batch.batchId;try{const i=await O1(t.localStore,e);Yp(t,r,null),Xp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Gs(t,i)}catch(i){await Bs(i)}}async function vw(n,e,t){const r=xe(n);try{const i=await function(o,a){const l=xe(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(ot(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);Yp(r,e,t),Xp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Gs(r,i)}catch(i){await Bs(i)}}function Xp(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Yp(n,e,t){const r=xe(n);let i=r.Ba[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function ru(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Qp(n,r)})}function Qp(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Mu(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),ju(n))}function Qh(n,e,t){for(const r of t)r instanceof Hp?(n.La.addReference(r.key,e),kw(n,r)):r instanceof Gp?(ve("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Qp(n,r.key)):Ne()}function kw(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ve("SyncEngine","New document in limbo: "+t),n.xa.add(r),ju(n))}function ju(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Re(mt.fromString(e)),r=n.qa.next();n.Na.set(r,new hw(t)),n.Oa=n.Oa.insert(t,r),Mp(n.remoteStore,new _r(qn(Iu(t.path)),r,"TargetPurposeLimboResolution",wu.oe))}}async function Gs(n,e,t){const r=xe(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){i.push(u);const f=Vu.Wi(l.targetId,u);s.push(f)}}))}),await Promise.all(o),r.Ca.d_(i),await async function(l,u){const h=xe(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>ne.forEach(u,d=>ne.forEach(d.$i,p=>h.persistence.referenceDelegate.addReference(f,d.targetId,p)).next(()=>ne.forEach(d.Ui,p=>h.persistence.referenceDelegate.removeReference(f,d.targetId,p)))))}catch(f){if(!Us(f))throw f;ve("LocalStore","Failed to update sequence numbers: "+f)}for(const f of u){const d=f.targetId;if(!f.fromCache){const p=h.os.get(d),g=p.snapshotVersion,b=p.withLastLimboFreeSnapshotVersion(g);h.os=h.os.insert(d,b)}}}(r.localStore,s))}async function Tw(n,e){const t=xe(n);if(!t.currentUser.isEqual(e)){ve("SyncEngine","User change. New user:",e.toKey());const r=await Dp(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(l=>{l.reject(new Ie(re.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Gs(t,r.hs)}}function Ew(n,e){const t=xe(n),r=t.Na.get(e);if(r&&r.va)return je().add(r.key);{let i=je();const s=t.Ma.get(e);if(!s)return i;for(const o of s){const a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function Jp(n){const e=xe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ew.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bw.bind(null,e),e.Ca.d_=aw.bind(null,e.eventManager),e.Ca.$a=lw.bind(null,e.eventManager),e}function Aw(n){const e=xe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ww.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vw.bind(null,e),e}class ra{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ia(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return D1(this.persistence,new P1,e.initialUser,this.serializer)}Ga(e){return new I1(Nu.Zr,this.serializer)}Wa(e){return new z1}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ra.provider={build:()=>new ra};class iu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Yh(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Tw.bind(null,this.syncEngine),await iw(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new ow}()}createDatastore(e){const t=Ia(e.databaseInfo.databaseId),r=function(s){return new j1(s)}(e.databaseInfo);return function(s,o,a,l){return new G1(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new W1(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Yh(this.syncEngine,t,0),function(){return Hh.D()?new Hh:new F1}())}createSyncEngine(e,t){return function(i,s,o,a,l,u,h){const f=new fw(i,s,o,a,l,u);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const s=xe(i);ve("RemoteStore","RemoteStore shutting down."),s.L_.add(5),await Hs(s),s.k_.shutdown(),s.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}iu.provider={build:()=>new iu};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ir("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Qt.UNAUTHENTICATED,this.clientId=$_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{ve("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ve("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Bu(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function vl(n,e){n.asyncQueue.verifyOperationInProgress(),ve("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Dp(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Jh(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Cw(n);ve("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Gh(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Gh(e.remoteStore,i)),n._onlineComponents=e}async function Cw(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ve("FirestoreClient","Using user provided OfflineComponentProvider");try{await vl(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===re.FAILED_PRECONDITION||i.code===re.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Ii("Error using user provided cache. Falling back to memory cache: "+t),await vl(n,new ra)}}else ve("FirestoreClient","Using default OfflineComponentProvider"),await vl(n,new ra);return n._offlineComponents}async function $p(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ve("FirestoreClient","Using user provided OnlineComponentProvider"),await Jh(n,n._uninitializedComponentsProvider._online)):(ve("FirestoreClient","Using default OnlineComponentProvider"),await Jh(n,new iu))),n._onlineComponents}function Rw(n){return $p(n).then(e=>e.syncEngine)}async function su(n){const e=await $p(n),t=e.eventManager;return t.onListen=dw.bind(null,e.syncEngine),t.onUnlisten=gw.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_w.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=mw.bind(null,e.syncEngine),t}function Pw(n,e,t={}){const r=new yr;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,u){const h=new Zp({next:d=>{h.Za(),o.enqueueAndForget(()=>jp(s,f)),d.fromCache&&l.source==="server"?u.reject(new Ie(re.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),f=new qp(a,h,{includeMetadataChanges:!0,_a:!0});return Up(s,f)}(await su(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg(n,e,t){if(!t)throw new Ie(re.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Sw(n,e,t,r){if(e===!0&&r===!0)throw new Ie(re.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function $h(n){if(!Re.isDocumentKey(n))throw new Ie(re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ef(n){if(Re.isDocumentKey(n))throw new Ie(re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function qu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ne()}function In(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ie(re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=qu(n);throw new Ie(re.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Ie(re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ie(re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Sw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=eg((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new Ie(re.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new Ie(re.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new Ie(re.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Pa{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tf({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ie(re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ie(re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tf(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Wb;switch(r.type){case"firstParty":return new Jb(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ie(re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Zh.get(t);r&&(ve("ComponentProvider","Removing Datastore"),Zh.delete(t),r.terminate())}(this),Promise.resolve()}}function Dw(n,e,t,r={}){var i;const s=(n=In(n,Pa))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ii("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Qt.MOCK_USER;else{a=Cy(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new Ie(re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Qt(u)}n._authCredentials=new Xb(new Z_(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ks(this.firestore,e,this._query)}}class hn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new br(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hn(this.firestore,e,this._key)}}class br extends Ks{constructor(e,t,r){super(e,t,Iu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hn(this.firestore,null,new Re(e))}withConverter(e){return new br(this.firestore,e,this._path)}}function rs(n,e,...t){if(n=nr(n),tg("collection","path",e),n instanceof Pa){const r=mt.fromString(e,...t);return ef(r),new br(n,null,r)}{if(!(n instanceof hn||n instanceof br))throw new Ie(re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(mt.fromString(e,...t));return ef(r),new br(n.firestore,null,r)}}function zt(n,e,...t){if(n=nr(n),arguments.length===1&&(e=$_.newId()),tg("doc","path",e),n instanceof Pa){const r=mt.fromString(e,...t);return $h(r),new hn(n,null,new Re(r))}{if(!(n instanceof hn||n instanceof br))throw new Ie(re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(mt.fromString(e,...t));return $h(r),new hn(n.firestore,n instanceof br?n.converter:null,new Re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Np(this,"async_queue_retry"),this.Vu=()=>{const r=wl();r&&ve("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=wl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=wl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new yr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Us(e))throw e;ve("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ir("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const i=Fu.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&Ne()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function rf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class Ir extends Pa{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new nf,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new nf(e),this._firestoreClient=void 0,await e}}}function Ow(n,e){const t=typeof n=="object"?n:xb(),r=typeof n=="string"?n:e||"(default)",i=Ob(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=Ay("firestore");s&&Dw(i,...s)}return i}function Hu(n){if(n._terminated)throw new Ie(re.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Nw(n),n._firestoreClient}function Nw(n){var e,t,r;const i=n._freezeSettings(),s=function(a,l,u,h){return new c0(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,eg(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Iw(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Oi(qt.fromBase64String(e))}catch(t){throw new Ie(re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Oi(qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ie(re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ie(re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ie(re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ze(this._lat,e._lat)||Ze(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw=/^__.*__$/;class Mw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Cr(e,this.data,this.fieldMask,t,this.fieldTransforms):new js(e,this.data,t,this.fieldTransforms)}}class ng{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Cr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function rg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne()}}class Wu{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Wu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return ia(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(rg(this.Cu)&&Vw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class xw{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ia(e)}Qu(e,t,r,i=!1){return new Wu({Cu:e,methodName:t,qu:r,path:Ut.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xu(n){const e=n._freezeSettings(),t=Ia(n._databaseId);return new xw(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ig(n,e,t,r,i,s={}){const o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);Qu("Data must be an object, but it was:",o,r);const a=sg(r,o);let l,u;if(s.merge)l=new bn(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const h=[];for(const f of s.mergeFields){const d=ou(e,f,t);if(!o.contains(d))throw new Ie(re.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);ag(h,d)||h.push(d)}l=new bn(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new Mw(new an(a),l,u)}class Ws extends Da{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ws}}class Yu extends Da{_toFieldTransform(e){return new x0(e.path,new Ds)}isEqual(e){return e instanceof Yu}}function Lw(n,e,t,r){const i=n.Qu(1,e,t);Qu("Data must be an object, but it was:",i,r);const s=[],o=an.empty();Zr(r,(l,u)=>{const h=Ju(e,l,t);u=nr(u);const f=i.Nu(h);if(u instanceof Ws)s.push(h);else{const d=Oa(u,f);d!=null&&(s.push(h),o.set(h,d))}});const a=new bn(s);return new ng(o,a,i.fieldTransforms)}function zw(n,e,t,r,i,s){const o=n.Qu(1,e,t),a=[ou(e,r,t)],l=[i];if(s.length%2!=0)throw new Ie(re.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(ou(e,s[d])),l.push(s[d+1]);const u=[],h=an.empty();for(let d=a.length-1;d>=0;--d)if(!ag(u,a[d])){const p=a[d];let g=l[d];g=nr(g);const b=o.Nu(p);if(g instanceof Ws)u.push(p);else{const A=Oa(g,b);A!=null&&(u.push(p),h.set(p,A))}}const f=new bn(u);return new ng(h,f,o.fieldTransforms)}function Oa(n,e){if(og(n=nr(n)))return Qu("Unsupported field value:",e,n),sg(n,e);if(n instanceof Da)return function(r,i){if(!rg(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let l=Oa(a,i.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=nr(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return N0(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Ot.fromDate(r);return{timestampValue:ta(i.serializer,s)}}if(r instanceof Ot){const s=new Ot(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ta(i.serializer,s)}}if(r instanceof Gu)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Oi)return{bytesValue:Ep(i.serializer,r._byteString)};if(r instanceof hn){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Du(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ku)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Cu(a.serializer,l)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${qu(r)}`)}(n,e)}function sg(n,e){const t={};return ep(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zr(n,(r,i)=>{const s=Oa(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function og(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ot||n instanceof Gu||n instanceof Oi||n instanceof hn||n instanceof Da||n instanceof Ku)}function Qu(n,e,t){if(!og(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=qu(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function ou(n,e,t){if((e=nr(e))instanceof Sa)return e._internalPath;if(typeof e=="string")return Ju(n,e);throw ia("Field path arguments must be of type string or ",n,!1,void 0,t)}const Fw=new RegExp("[~\\*/\\[\\]]");function Ju(n,e,t){if(e.search(Fw)>=0)throw ia(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Sa(...e.split("."))._internalPath}catch{throw ia(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ia(n,e,t,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new Ie(re.INVALID_ARGUMENT,a+n+l)}function ag(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new hn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Bw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ug("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Bw extends lg{data(){return super.data()}}function ug(n,e){return typeof e=="string"?Ju(n,e):e instanceof Sa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ie(re.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uw{convertValue(e,t="none"){switch(Yr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Et(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ne()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Zr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;const s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Et(o.doubleValue));return new Ku(s)}convertGeoPoint(e){return new Gu(Et(e.latitude),Et(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ku(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Rs(e));default:return null}}convertTimestamp(e){const t=Er(e);return new Ot(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=mt.fromString(e);ot(Sp(r));const i=new Ps(r.get(1),r.get(3)),s=new Re(r.popFirst(5));return i.isEqual(t)||ir(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fg extends lg{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Lo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ug("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Lo extends fg{data(e={}){return super.data(e)}}class dg{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new cs(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Lo(this._firestore,this._userDataWriter,r.key,r,new cs(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ie(re.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const l=new Lo(i._firestore,i._userDataWriter,a.doc.key,a.doc,new cs(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const l=new Lo(i._firestore,i._userDataWriter,a.doc.key,a.doc,new cs(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:jw(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function jw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne()}}class Zu extends Uw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Oi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new hn(this.firestore,null,t)}}function ko(n){n=In(n,Ks);const e=In(n.firestore,Ir),t=Hu(e),r=new Zu(e);return cg(n._query),Pw(t,n._query).then(i=>new dg(e,r,n,i))}function is(n,e,t){n=In(n,hn);const r=In(n.firestore,Ir),i=hg(n.converter,e,t);return Na(r,[ig(Xu(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,An.none())])}function qw(n,e,t,...r){n=In(n,hn);const i=In(n.firestore,Ir),s=Xu(i);let o;return o=typeof(e=nr(e))=="string"||e instanceof Sa?zw(s,"updateDoc",n._key,e,t,r):Lw(s,"updateDoc",n._key,e),Na(i,[o.toMutation(n._key,An.exists(!0))])}function oi(n){return Na(In(n.firestore,Ir),[new Ru(n._key,An.none())])}function ai(n,e){const t=In(n.firestore,Ir),r=zt(n),i=hg(n.converter,e);return Na(t,[ig(Xu(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,An.exists(!1))]).then(()=>r)}function Hw(n,...e){var t,r,i;n=nr(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||rf(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(rf(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,u,h;if(n instanceof hn)u=In(n.firestore,Ir),h=Iu(n._key.path),l={next:f=>{e[o]&&e[o](Gw(u,n,f))},error:e[o+1],complete:e[o+2]};else{const f=In(n,Ks);u=In(f.firestore,Ir),h=f._query;const d=new Zu(u);l={next:p=>{e[o]&&e[o](new dg(u,d,f,p))},error:e[o+1],complete:e[o+2]},cg(n._query)}return function(d,p,g,b){const A=new Zp(b),S=new qp(p,A,g);return d.asyncQueue.enqueueAndForget(async()=>Up(await su(d),S)),()=>{A.Za(),d.asyncQueue.enqueueAndForget(async()=>jp(await su(d),S))}}(Hu(u),h,a,l)}function Na(n,e){return function(r,i){const s=new yr;return r.asyncQueue.enqueueAndForget(async()=>yw(await Rw(r),i,s)),s.promise}(Hu(n),e)}function Gw(n,e,t){const r=t.docs.get(e._key),i=new Zu(n);return new fg(n,i,e._key,r,new cs(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kw(){return new Ws("deleteField")}function Ww(){return new Yu("serverTimestamp")}(function(e,t=!0){(function(i){zi=i})(Mb),Qo(new Kb("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Ir(new Yb(r.getProvider("auth-internal")),new $b(r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Ie(re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ps(u.options.projectId,h)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),bi(vh,"4.7.3",e),bi(vh,"4.7.3","esm2017")})();var Xw="firebase",Yw="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bi(Xw,Yw,"app");class Va{constructor(){this.loadTime=null,this.isPersistent=!1,this.baseID=I.empty,this.dbType=I.empty,this.isRemote=!1,this.hasData=!1}async fetch_all(){}async remove_all(){}queryStradial_apply(){}async fetch_hierarchy_from(e){}async thing_persistentUpdate(e){}async thing_persistentDelete(e){}async thing_remember_persistentCreate(e){}async trait_persistentUpdate(e){}async trait_persistentDelete(e){}async trait_remember_persistentCreate(e){}async predicate_persistentUpdate(e){}async predicate_persistentDelete(e){}async predicate_remember_persistentCreate(e){}async relationship_persistentUpdate(e){}async relationship_persistentDelete(e){}async relationship_remember_persistentCreate(e){}async persistAll(){const e=this.hierarchy;await this.persistAll_identifiables(e.things),await this.persistAll_identifiables(e.traits),await this.persistAll_identifiables(e.predicates),await this.persistAll_identifiables(e.relationships)}async persistAll_identifiables(e){for(const t of e)t.isDirty&&(t.isDirty=!1,await t.persist())}}class Vs extends Va{constructor(){super(...arguments),this.firebaseConfig={appId:"1:224721814373:web:0c60f394c056ef3decd78c",apiKey:"AIzaSyAFy4H3Ej5zfI46fvCJpBfUxmyQco-dx9U",authDomain:"seriously-4536d.firebaseapp.com",storageBucket:"seriously-4536d.appspot.com",messagingSenderId:"224721814373",measurementId:"G-9PY9LVK813",projectId:"seriously-4536d"},this.isRemote=!0,this.baseID="Public",this.isPersistent=!0,this.bulksName="Bulks",this.deferSnapshots=!1,this.dbType=bt.firebase,this.app=q_(this.firebaseConfig),this.firestore=Ow(this.app),this.deferredSnapshots=[]}reportError(e){console.log(e)}queryStradial_apply(){const e=nt.read_key(it.base_id),t=ae.queryStradial.get("name")??ae.queryStradial.get("dbid")??e??"Public";nt.write_key(it.base_id,t),this.baseID=t}async remove_all(){const e=zt(this.firestore,this.bulksName,this.baseID);await this.subcollections_persistentDeleteIn(e);try{await oi(e)}catch(t){this.reportError(t)}}async fetch_all(){await this.recordLoginIP(),await this.fetch_documentsOf(Ce.predicates),await this.fetch_hierarchy_from(this.baseID),await this.fetch_bulkAliases()}async fetch_hierarchy_from(e){await this.fetch_documentsOf(Ce.things,e),await this.fetch_documentsOf(Ce.traits,e),await this.fetch_documentsOf(Ce.relationships,e)}async fetch_documentsOf(e,t=null){try{const r=t?rs(this.firestore,this.bulksName,t,e):rs(this.firestore,e);let i=await ko(r);const s=this.bulk_for(t);if(t&&(i.empty&&(await this.document_defaults_ofType_persistentCreateIn(e,t,r),i=await ko(r)),this.setup_handle_docChanges(t,e,r)),s)switch(e){case Ce.things:s.thingsCollection=r;break;case Ce.traits:s.traitsCollection=r;break;case Ce.relationships:s.relationshipsCollection=r;break}else e==Ce.predicates&&(this.predicatesCollection=r);const o=i.docs;ie.log_remote("READ "+o.length+" from "+t+":"+e);for(const a of o){const l=a.id,u=a.data();await this.document_ofType_remember_validated(e,l,u,t??this.baseID)}}catch(r){this.reportError(r)}}bulk_for(e){if(e){this.bulks||(this.bulks=[new sf(this.baseID)]);const t=this.bulks;if(t){for(const i of t)if(i.baseID==e)return i;const r=new sf(e);return t.push(r),r}}return null}async fetch_bulkAliases(){const e=this.hierarchy,t=e.root;if(this.baseID==I.name_bulkAdmin&&t){const r=await e.ancestry_roots();if(r){e.rootsAncestry=r;try{const i=rs(this.firestore,this.bulksName);let s=await ko(i);for(const o of s.docs){const a=o.id;if(a!=this.baseID){let l=e.bulks_alias_forTitle_ofThing(a);l?l.thing_isBulk_expanded&&await e.ancestry_redraw_persistentFetchBulk_browseRight(l):(l=e.thing_runtimeCreate(this.baseID,Mt.newID(),a,"red",Ft.bulk),await e.relationship_remember_persistent_addChild_toAncestry(l,r))}}}catch(i){this.reportError(i)}}}}snapshot_deferOne(e,t,r){const i=new Qw(e,t,r);this.deferredSnapshots.push(i)}handle_deferredSnapshots(){for(this.deferSnapshots=!1;this.deferredSnapshots.length>0;){const e=this.deferredSnapshots.pop();e&&e.snapshot.docChanges().forEach(t=>{this.handle_docChanges(e.baseID,e.datum_type,t)})}}setup_handle_docChanges(e,t,r){Hw(r,i=>{this.hierarchy.isAssembled&&(this.deferSnapshots?this.snapshot_deferOne(e,t,i):i.docChanges().forEach(s=>{this.handle_docChanges(e,t,s)}))})}async handle_docChanges(e,t,r){const i=r.doc,s=i.data();if(Vs.data_isValidOfKind(t,s)){const o=i.id;try{switch(t){case Ce.things:this.thing_handle_docChanges(e,o,r,s);break;case Ce.traits:this.trait_handle_docChanges(e,o,r,s);break;case Ce.relationships:this.relationship_handle_docChanges(e,o,r,s);break}}catch(a){this.reportError(a)}ie.log_remote("HANDLE "+e+":"+t+I.space+r.type)}}async document_defaults_ofType_persistentCreateIn(e,t,r){if(t){const i=zt(this.firestore,this.bulksName,t);await is(i,{isReal:!0},{merge:!0}),await qw(i,{isReal:Kw()})}switch(e){case Ce.predicates:this.hierarchy.predicate_defaults_remember_runtimeCreate();break;case Ce.things:await this.root_default_remember_persistentCreateIn(r);break}}async document_ofType_remember_validated(e,t,r,i){if(Vs.data_isValidOfKind(e,r)){const s=this.hierarchy;switch(e){case Ce.predicates:s.predicate_remember_runtimeCreate(t,r.kind,r.isBidirectional);break;case Ce.traits:s.trait_remember_runtimeCreate(i,t,r.ownerID,r.type,r.text,!0);break;case Ce.things:s.thing_remember_runtimeCreate(i,t,r.title,r.color,r.type??r.trait,!0,!r.type);break;case Ce.relationships:s.relationship_remember_runtimeCreateUnique(i,t,r.predicate.id,r.parent.id,r.child.id,r.order,Un.isFromPersistent);break}}}async subcollections_persistentDeleteIn(e){const t=["Things","Relationships"];for(const r of t){const i=rs(e,r),s=await ko(i);for(const o of s.docs)await oi(o.ref)}}async thing_remember_persistentCreate(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.thingsCollection;if(t){const s={...new kl(e)};e.awaitingCreation=!0,this.addedThing=e;try{this.deferSnapshots=!0;const o=await ai(t,s);e.awaitingCreation=!1,e.already_persisted=!0,this.hierarchy.thing_remember_updateID_to(e,o.id),this.handle_deferredSnapshots(),e.log(yt.remote,"CREATE T")}catch(o){this.reportError(o)}}}async root_default_remember_persistentCreateIn(e){const t=["title","color","type"],r=new Ni(this.baseID,Mt.newID(),this.baseID,"coral",Ft.root,!0),i=await ai(e,we.convertToObject(r,t));r.log(yt.remote,"CREATE T"),this.hierarchy.root=r,r.setID(i.id)}async thing_persistentUpdate(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.thingsCollection;if(t){const i=zt(t,e.id),o={...new kl(e)};try{await is(i,o),e.log(yt.remote,"UPDATE T")}catch(a){this.reportError(a)}}}async thing_persistentDelete(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.thingsCollection;if(t)try{const i=zt(t,e.id);await oi(i),e.log(yt.remote,"DELETE T")}catch(i){this.reportError(i)}}thing_extractChangesFromPersistent(e,t){const r=!t.isEqualTo(e);return r&&(e.title=t.virginTitle,e.color=t.color,e.type=t.type),r}thing_handle_docChanges(e,t,r,i){const s=new kl(i),o=this.hierarchy;let a=o.thing_forHID(t.hash());if(s){switch(r.type){case"added":if(a||s.isEqualTo(this.addedThing)||s.type==Ft.root)return;a=o.thing_remember_runtimeCreate(e,t,s.title,s.color,s.type,!0);break;case"removed":a&&o.thing_forget(a);break;case"modified":if(!a||a.wasModifiedWithinMS(800)||!this.thing_extractChangesFromPersistent(a,s))return;break}Oe.signal_rebuildGraph_fromFocus()}}trait_extractChangesFromPersistent(e,t){const r=!t.isEqualTo(e);return r&&(e.ownerID=t.ownerID,e.type=t.type,e.text=t.text),r}async trait_persistentDelete(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.traitsCollection;if(t)try{const i=zt(t,e.id);await oi(i),e.log(yt.remote,"DELETE T")}catch(i){this.reportError(i)}}async trait_persistentUpdate(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.traitsCollection;if(t){const i=zt(t,e.id),o={...new Tl(e)};try{await is(i,o),e.log(yt.remote,"UPDATE T")}catch(a){this.reportError(a)}}}async trait_remember_persistentCreate(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.traitsCollection;if(t){const s={...new Tl(e)};e.awaitingCreation=!0,this.addedTrait=e;try{this.deferSnapshots=!0;const o=await ai(t,s),a=this.hierarchy;e.awaitingCreation=!1,e.already_persisted=!0,a.trait_forget(e),e.setID(o.id),a.trait_remember(e),this.handle_deferredSnapshots(),e.log(yt.remote,"CREATE T")}catch(o){this.reportError(o)}}}trait_handle_docChanges(e,t,r,i){const s=new Tl(i);if(s){const o=this.hierarchy;let a=o.trait_forHID(t.hash());switch(r.type){case"added":if(a||s.isEqualTo(this.addedTrait))return;a=o.trait_remember_runtimeCreate(e,t,s.ownerID,s.type,s.text,!0);break;case"removed":a&&o.trait_forget(a);break;case"modified":if(!a||a.wasModifiedWithinMS(800)||!this.trait_extractChangesFromPersistent(a,s))return;break}setTimeout(()=>{o.traits_refreshKnowns(),Oe.signal_rebuildGraph_fromFocus()},20)}}async predicate_persistentUpdate(e){const t=this.predicatesCollection;if(t)try{const r=zt(t,e.id),s={...new of(e)};await is(r,s),e.log(yt.remote,"UPDATE P")}catch(r){this.reportError(r)}}async predicate_persistentDelete(e){const t=this.predicatesCollection;if(t)try{const r=zt(t,e.id);await oi(r),e.log(yt.remote,"DELETE P")}catch(r){this.reportError(r)}}async predicate_remember_persistentCreate(e){const t=this.predicatesCollection;if(t){const i={...new of(e)};e.awaitingCreation=!0;try{this.deferSnapshots=!0;const s=await ai(t,i),o=this.hierarchy;e.awaitingCreation=!1,e.already_persisted=!0,o.predicate_forget(e),e.setID(s.id),o.predicate_remember(e),this.handle_deferredSnapshots(),e.log(yt.remote,"CREATE P")}catch(s){this.reportError(s)}}}async relationship_persistentDelete(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.relationshipsCollection;if(t)try{const i=zt(t,e.id);await oi(i),e.log(yt.remote,"DELETE R")}catch(i){this.reportError(i)}}async relationship_persistentUpdate(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.relationshipsCollection;if(t)try{const i=zt(t,e.id),o={...new El(e)};await is(i,o),e.log(yt.remote,"UPDATE R")}catch(i){this.reportError(i)}}relationship_extractChangesFromPersistent(e,t){const r=e.kindPredicate!=t.predicate.id||e.idParent!=t.parent.id||e.idChild!=t.child.id||e.order!=t.order;return r&&(e.idChild=t.child.id,e.idParent=t.parent.id,e.already_persisted=!0,e.kindPredicate=t.predicate.id,e.order_setTo_persistentMaybe(t.order+I.halfIncrement)),r}async relationship_remember_persistentCreate(e){var r;const t=(r=this.bulk_for(e.baseID))==null?void 0:r.relationshipsCollection;if(t){const s={...new El(e)};e.awaitingCreation=!0;try{this.deferSnapshots=!0;const o=await ai(t,s),a=this.hierarchy;e.awaitingCreation=!1,e.already_persisted=!0,a.relationship_forget(e),e.setID(o.id),a.relationship_remember(e),this.handle_deferredSnapshots(),e.log(yt.remote,"CREATE R")}catch(o){this.reportError(o)}}}relationship_handle_docChanges(e,t,r,i){const s=new El(i);if(s){const o=this.hierarchy;let a=o.relationship_forHID(t.hash());switch(r.type){case"added":if(a)return;a=o.relationship_remember_runtimeCreateUnique(e,t,s.predicate.id,s.parent.id,s.child.id,s.order,Un.isFromPersistent);break;default:if(a)switch(r.type){case"modified":if(a.wasModifiedWithinMS(800)||!this.relationship_extractChangesFromPersistent(a,s))return;break;case"removed":o.relationship_forget(a);break}else return;break}setTimeout(()=>{o.relationships_refreshKnowns(),o.rootAncestry.order_normalizeRecursive_persistentMaybe(!0),Oe.signal_rebuildGraph_fromFocus()},20)}}static data_isValidOfKind(e,t){switch(e){case Ce.things:if(t.hasNoData)return!1;break;case Ce.traits:if(t.hasNoData)return!1;break;case Ce.predicates:if(!t.kind)return!1;break;case Ce.relationships:const s=t;if(!s.predicate||!s.parent||!s.child)return!1;break;default:return!1}return!0}async recordLoginIP(){await this.getUserIPAddress().then(async e=>{if(e&&e!="69.181.235.85"){const t=ae.queryStradial.toString()??"empty",r=rs(this.firestore,"access_logs"),s={...{queries:t,build:I.build_number,ipAddress:e,timestamp:Ww()}};try{await ai(r,s)}catch(o){this.reportError(o)}}})}async getUserIPAddress(){try{const e=await fetch("https://ipv4.icanhazip.com");if(!e.ok)throw new Error("Unable to fetch IP address.");return(await e.text()).replace(/\n/g,I.empty)}catch(e){return this.reportError("Error fetching IP address:"+e),null}}}class sf{constructor(e){this.baseID=I.empty,this.thingsCollection=null,this.traitsCollection=null,this.relationshipsCollection=null,this.baseID=e}}class Qw{constructor(e,t,r){this.baseID=e,this.snapshot=r,this.datum_type=t}}class kl{constructor(e){const t=e;this.title=t.title,this.type=t.type,this.color=t.color}get virginTitle(){const e=this.title;return e.includes("@")?e.split("@")[0]:e}isEqualTo(e){return!!e&&e.title==this.title&&e.type==this.type&&e.color==this.color}}class Tl{constructor(e){const t=e;this.ownerID=t.ownerID,this.type=t.type,this.text=t.text}isEqualTo(e){return!!e&&e.ownerID==this.ownerID&&e.type==this.type&&e.text==this.text}}class of{constructor(e){const t=e;this.isBidirectional=t.isBidirectional,this.stateIndex=t.stateIndex,this.kind=t.kind}isEqualTo(e){return!!e&&e.isBidirectional==this.isBidirectional&&e.stateIndex==this.stateIndex&&e.kind==this.kind}}class El{constructor(e){var i;const t=(i=pi.bulk_for(pi.baseID))==null?void 0:i.thingsCollection,r=pi.predicatesCollection;if(this.order=e.order,t&&r)try{if(e instanceof vi)e.isValid&&(this.child=zt(t,e.idChild),this.parent=zt(t,e.idParent),this.predicate=zt(r,e.kindPredicate));else{const s=e;Vs.data_isValidOfKind(Ce.relationships,e)&&(this.child=zt(t,s.child.id),this.parent=zt(t,s.parent.id),this.predicate=zt(r,s.predicate.id))}}catch(s){pi.reportError(s)}}isEqualTo(e){return!!e&&e.kindPredicate==this.predicate.kind&&e.idParent==this.parent.id&&e.idChild==this.child.id&&e.order==this.order}}const pi=new Vs;var af=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function To(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _g={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function(){function t(r,i,s){function o(u,h){if(!i[u]){if(!r[u]){var f=typeof To=="function"&&To;if(!h&&f)return f(u,!0);if(a)return a(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var p=i[u]={exports:{}};r[u][0].call(p.exports,function(g){var b=r[u][1][g];return o(b||g)},p,p.exports,t,r,i,s)}return i[u].exports}for(var a=typeof To=="function"&&To,l=0;l<s.length;l++)o(s[l]);return o}return t}()({1:[function(t,r,i){var s,o=typeof window<"u"?window:typeof self<"u"?self:null;if(!o)s=t("abort-controller");else if("signal"in new Request("https://airtable.com"))s=o.AbortController;else{var a=t("abortcontroller-polyfill/dist/cjs-ponyfill");s=a.AbortController}r.exports=s},{"abort-controller":20,"abortcontroller-polyfill/dist/cjs-ponyfill":19}],2:[function(t,r,i){var s=function(){function o(a,l,u){this.error=a,this.message=l,this.statusCode=u}return o.prototype.toString=function(){return[this.message,"(",this.error,")",this.statusCode?"[Http code "+this.statusCode+"]":""].join("")},o}();r.exports=s},{}],3:[function(t,r,i){var s=this&&this.__assign||function(){return s=Object.assign||function(k){for(var y,w=1,D=arguments.length;w<D;w++){y=arguments[w];for(var N in y)Object.prototype.hasOwnProperty.call(y,N)&&(k[N]=y[N])}return k},s.apply(this,arguments)},o=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}},a=o(t("lodash/get")),l=o(t("lodash/isPlainObject")),u=o(t("lodash/keys")),h=o(t("./fetch")),f=o(t("./abort-controller")),d=o(t("./object_to_query_param_string")),p=o(t("./airtable_error")),g=o(t("./table")),b=o(t("./http_headers")),A=o(t("./run_action")),S=o(t("./package_version")),v=o(t("./exponential_backoff_with_jitter")),x="Airtable.js/"+S.default,E=function(){function k(y,w){this._airtable=y,this._id=w}return k.prototype.table=function(y){return new g.default(this,null,y)},k.prototype.makeRequest=function(y){var w=this,D;y===void 0&&(y={});var N=a.default(y,"method","GET").toUpperCase(),M=this._airtable._endpointUrl+"/v"+this._airtable._apiVersionMajor+"/"+this._id+a.default(y,"path","/")+"?"+d.default(a.default(y,"qs",{})),O=new f.default,H=this._getRequestHeaders(Object.assign({},this._airtable._customHeaders,(D=y.headers)!==null&&D!==void 0?D:{})),j={method:N,headers:H,signal:O.signal};"body"in y&&L(N)&&(j.body=JSON.stringify(y.body));var Z=setTimeout(function(){O.abort()},this._airtable._requestTimeout);return new Promise(function(ge,le){h.default(M,j).then(function(ee){if(clearTimeout(Z),ee.status===429&&!w._airtable._noRetryIfRateLimited){var fe=a.default(y,"_numAttempts",0),Ve=v.default(fe);setTimeout(function(){var ye=s(s({},y),{_numAttempts:fe+1});w.makeRequest(ye).then(ge).catch(le)},Ve)}else ee.json().then(function(ye){var Ae=w._checkStatusForError(ee.status,ye)||z(ee.status,ye);Ae?le(Ae):ge({statusCode:ee.status,headers:ee.headers,body:ye})}).catch(function(){var ye=z(ee.status);le(ye)})}).catch(function(ee){clearTimeout(Z),ee=new p.default("CONNECTION_ERROR",ee.message,null),le(ee)})})},k.prototype.runAction=function(y,w,D,N,M){A.default(this,y,w,D,N,M,0)},k.prototype._getRequestHeaders=function(y){var w=new b.default;w.set("Authorization","Bearer "+this._airtable._apiKey),w.set("User-Agent",x),w.set("Content-Type","application/json");for(var D=0,N=u.default(y);D<N.length;D++){var M=N[D];w.set(M,y[M])}return w.toJSON()},k.prototype._checkStatusForError=function(y,w){var D=(w??{error:{}}).error,N=D===void 0?{}:D,M=N.type,O=N.message;return y===401?new p.default("AUTHENTICATION_REQUIRED","You should provide valid api key to perform this operation",y):y===403?new p.default("NOT_AUTHORIZED","You are not authorized to perform this operation",y):y===404?new p.default("NOT_FOUND",O??"Could not find what you are looking for",y):y===413?new p.default("REQUEST_TOO_LARGE","Request body is too large",y):y===422?new p.default(M??"UNPROCESSABLE_ENTITY",O??"The operation cannot be processed",y):y===429?new p.default("TOO_MANY_REQUESTS","You have made too many requests in a short period of time. Please retry your request later",y):y===500?new p.default("SERVER_ERROR","Try again. If the problem persists, contact support.",y):y===503?new p.default("SERVICE_UNAVAILABLE","The service is temporarily unavailable. Please retry shortly.",y):y>=400?new p.default(M??"UNEXPECTED_ERROR",O??"An unexpected error occurred",y):null},k.prototype.doCall=function(y){return this.table(y)},k.prototype.getId=function(){return this._id},k.createFunctor=function(y,w){var D=new k(y,w),N=function(M){return D.doCall(M)};return N._base=D,N.table=D.table.bind(D),N.makeRequest=D.makeRequest.bind(D),N.runAction=D.runAction.bind(D),N.getId=D.getId.bind(D),N},k}();function L(k){return k!=="GET"&&k!=="DELETE"}function z(k,y){return l.default(y)?null:new p.default("UNEXPECTED_ERROR","The response from Airtable was invalid JSON. Please try again soon.",k)}r.exports=E},{"./abort-controller":1,"./airtable_error":2,"./exponential_backoff_with_jitter":6,"./fetch":7,"./http_headers":9,"./object_to_query_param_string":11,"./package_version":12,"./run_action":16,"./table":17,"lodash/get":77,"lodash/isPlainObject":89,"lodash/keys":93}],4:[function(t,r,i){function s(o,a,l){return l===void 0&&(l=void 0),function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];var f;l===void 0?f=u.length>0?u.length-1:0:f=l;var d=u[f];if(typeof d=="function"){o.apply(a,u);return}else{for(var p=[],g=Math.max(u.length,f),b=0;b<g;b++)p.push(u[b]);return new Promise(function(A,S){p.push(function(v,x){v?S(v):A(x)}),o.apply(a,p)})}}}r.exports=s},{}],5:[function(t,r,i){var s={};function o(a,l,u){return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];s[l]||(s[l]=!0,console.warn(u)),a.apply(this,h)}}r.exports=o},{}],6:[function(t,r,i){var s=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}},o=s(t("./internal_config.json"));function a(l){var u=o.default.INITIAL_RETRY_DELAY_IF_RATE_LIMITED*Math.pow(2,l),h=Math.min(o.default.MAX_RETRY_DELAY_IF_RATE_LIMITED,u),f=Math.random()*h;return f}r.exports=a},{"./internal_config.json":10}],7:[function(t,r,i){var s=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}},o=s(t("node-fetch")),a=typeof window<"u"?window:typeof self<"u"?self:null;r.exports=a?a.fetch.bind(a):o.default},{"node-fetch":20}],8:[function(t,r,i){function s(o,a){return Object.prototype.hasOwnProperty.call(o,a)}r.exports=s},{}],9:[function(t,r,i){var s=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}},o=s(t("lodash/keys")),a=typeof window<"u",l=function(){function u(){this._headersByLowercasedKey={}}return u.prototype.set=function(h,f){var d=h.toLowerCase();d==="x-airtable-user-agent"&&(d="user-agent",h="User-Agent"),this._headersByLowercasedKey[d]={headerKey:h,headerValue:f}},u.prototype.toJSON=function(){for(var h={},f=0,d=o.default(this._headersByLowercasedKey);f<d.length;f++){var p=d[f],g=this._headersByLowercasedKey[p],b=void 0;a&&p==="user-agent"?b="X-Airtable-User-Agent":b=g.headerKey,h[b]=g.headerValue}return h},u}();r.exports=l},{"lodash/keys":93}],10:[function(t,r,i){r.exports={INITIAL_RETRY_DELAY_IF_RATE_LIMITED:5e3,MAX_RETRY_DELAY_IF_RATE_LIMITED:6e5}},{}],11:[function(t,r,i){var s=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}},o=s(t("lodash/isArray")),a=s(t("lodash/isNil")),l=s(t("lodash/keys"));function u(f,d,p){if(o.default(d))for(var g=0;g<d.length;g++){var b=d[g];/\[\]$/.test(f)?p(f,b):u(f+"["+(typeof b=="object"&&b!==null?g:"")+"]",b,p)}else if(typeof d=="object")for(var A=0,S=l.default(d);A<S.length;A++){var v=S[A],b=d[v];u(f+"["+v+"]",b,p)}else p(f,d)}function h(f){for(var d=[],p=function(v,x){x=a.default(x)?"":x,d.push(encodeURIComponent(v)+"="+encodeURIComponent(x))},g=0,b=l.default(f);g<b.length;g++){var A=b[g],S=f[A];u(A,S,p)}return d.join("&").replace(/%20/g,"+")}r.exports=h},{"lodash/isArray":79,"lodash/isNil":85,"lodash/keys":93}],12:[function(t,r,i){r.exports="0.12.2"},{}],13:[function(t,r,i){var s=this&&this.__assign||function(){return s=Object.assign||function(v){for(var x,E=1,L=arguments.length;E<L;E++){x=arguments[E];for(var z in x)Object.prototype.hasOwnProperty.call(x,z)&&(v[z]=x[z])}return v},s.apply(this,arguments)},o=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}},a=o(t("lodash/isFunction")),l=o(t("lodash/keys")),u=o(t("./record")),h=o(t("./callback_to_promise")),f=o(t("./has")),d=t("./query_params"),p=o(t("./object_to_query_param_string")),g=function(){function v(x,E){this._table=x,this._params=E,this.firstPage=h.default(b,this),this.eachPage=h.default(A,this,1),this.all=h.default(S,this)}return v.validateParams=function(x){for(var E={},L=[],z=[],k=0,y=l.default(x);k<y.length;k++){var w=y[k],D=x[w];if(f.default(v.paramValidators,w)){var N=v.paramValidators[w],M=N(D);M.pass?E[w]=D:z.push(M.error)}else L.push(w)}return{validParams:E,ignoredKeys:L,errors:z}},v.paramValidators=d.paramValidators,v}();function b(v){if(!a.default(v))throw new Error("The first parameter to `firstPage` must be a function");this.eachPage(function(x){v(null,x)},function(x){v(x,null)})}function A(v,x){var E=this;if(!a.default(v))throw new Error("The first parameter to `eachPage` must be a function");if(!a.default(x)&&x!==void 0)throw new Error("The second parameter to `eachPage` must be a function or undefined");var L=s({},this._params),z="/"+this._table._urlEncodedNameOrId()+"?"+p.default(L),k={},y=null,w,D;if(L.method==="post"||z.length>d.URL_CHARACTER_LENGTH_LIMIT){y=L,w="post",D="/"+this._table._urlEncodedNameOrId()+"/listRecords";for(var N=Object.keys(L),M=0,O=N;M<O.length;M++){var H=O[M];d.shouldListRecordsParamBePassedAsParameter(H)?k[H]=L[H]:y[H]=L[H]}}else w="get",k=L,D="/"+this._table._urlEncodedNameOrId();var j=function(){E._table._base.runAction(w,D,k,y,function(Z,ge,le){if(Z)x(Z,null);else{var ee=void 0;le.offset?(L.offset=le.offset,ee=j):ee=function(){x(null)};var fe=le.records.map(function(Ve){return new u.default(E._table,null,Ve)});v(fe,ee)}})};j()}function S(v){if(!a.default(v))throw new Error("The first parameter to `all` must be a function");var x=[];this.eachPage(function(E,L){x.push.apply(x,E),L()},function(E){E?v(E,null):v(null,x)})}r.exports=g},{"./callback_to_promise":4,"./has":8,"./object_to_query_param_string":11,"./query_params":14,"./record":15,"lodash/isFunction":83,"lodash/keys":93}],14:[function(t,r,i){var s=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(i,"__esModule",{value:!0}),i.shouldListRecordsParamBePassedAsParameter=i.URL_CHARACTER_LENGTH_LIMIT=i.paramValidators=void 0;var o=s(t("./typecheck")),a=s(t("lodash/isString")),l=s(t("lodash/isNumber")),u=s(t("lodash/isPlainObject")),h=s(t("lodash/isBoolean"));i.paramValidators={fields:o.default(o.default.isArrayOf(a.default),"the value for `fields` should be an array of strings"),filterByFormula:o.default(a.default,"the value for `filterByFormula` should be a string"),maxRecords:o.default(l.default,"the value for `maxRecords` should be a number"),pageSize:o.default(l.default,"the value for `pageSize` should be a number"),offset:o.default(l.default,"the value for `offset` should be a number"),sort:o.default(o.default.isArrayOf(function(f){return u.default(f)&&a.default(f.field)&&(f.direction===void 0||["asc","desc"].includes(f.direction))}),'the value for `sort` should be an array of sort objects. Each sort object must have a string `field` value, and an optional `direction` value that is "asc" or "desc".'),view:o.default(a.default,"the value for `view` should be a string"),cellFormat:o.default(function(f){return a.default(f)&&["json","string"].includes(f)},'the value for `cellFormat` should be "json" or "string"'),timeZone:o.default(a.default,"the value for `timeZone` should be a string"),userLocale:o.default(a.default,"the value for `userLocale` should be a string"),method:o.default(function(f){return a.default(f)&&["get","post"].includes(f)},'the value for `method` should be "get" or "post"'),returnFieldsByFieldId:o.default(h.default,"the value for `returnFieldsByFieldId` should be a boolean"),recordMetadata:o.default(o.default.isArrayOf(a.default),"the value for `recordMetadata` should be an array of strings")},i.URL_CHARACTER_LENGTH_LIMIT=15e3,i.shouldListRecordsParamBePassedAsParameter=function(f){return f==="timeZone"||f==="userLocale"}},{"./typecheck":18,"lodash/isBoolean":81,"lodash/isNumber":86,"lodash/isPlainObject":89,"lodash/isString":90}],15:[function(t,r,i){var s=this&&this.__assign||function(){return s=Object.assign||function(g){for(var b,A=1,S=arguments.length;A<S;A++){b=arguments[A];for(var v in b)Object.prototype.hasOwnProperty.call(b,v)&&(g[v]=b[v])}return g},s.apply(this,arguments)},o=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}},a=o(t("./callback_to_promise")),l=function(){function g(b,A,S){this._table=b,this.id=A||S.id,S&&(this.commentCount=S.commentCount),this.setRawJson(S),this.save=a.default(u,this),this.patchUpdate=a.default(h,this),this.putUpdate=a.default(f,this),this.destroy=a.default(d,this),this.fetch=a.default(p,this),this.updateFields=this.patchUpdate,this.replaceFields=this.putUpdate}return g.prototype.getId=function(){return this.id},g.prototype.get=function(b){return this.fields[b]},g.prototype.set=function(b,A){this.fields[b]=A},g.prototype.setRawJson=function(b){this._rawJson=b,this.fields=this._rawJson&&this._rawJson.fields||{}},g}();function u(g){this.putUpdate(this.fields,g)}function h(g,b,A){var S=this;A||(A=b,b={});var v=s({fields:g},b);this._table._base.runAction("patch","/"+this._table._urlEncodedNameOrId()+"/"+this.id,{},v,function(x,E,L){if(x){A(x);return}S.setRawJson(L),A(null,S)})}function f(g,b,A){var S=this;A||(A=b,b={});var v=s({fields:g},b);this._table._base.runAction("put","/"+this._table._urlEncodedNameOrId()+"/"+this.id,{},v,function(x,E,L){if(x){A(x);return}S.setRawJson(L),A(null,S)})}function d(g){var b=this;this._table._base.runAction("delete","/"+this._table._urlEncodedNameOrId()+"/"+this.id,{},null,function(A){if(A){g(A);return}g(null,b)})}function p(g){var b=this;this._table._base.runAction("get","/"+this._table._urlEncodedNameOrId()+"/"+this.id,{},null,function(A,S,v){if(A){g(A);return}b.setRawJson(v),g(null,b)})}r.exports=l},{"./callback_to_promise":4}],16:[function(t,r,i){var s=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}},o=s(t("./exponential_backoff_with_jitter")),a=s(t("./object_to_query_param_string")),l=s(t("./package_version")),u=s(t("./fetch")),h=s(t("./abort-controller")),f="Airtable.js/"+l.default;function d(p,g,b,A,S,v,x){var E=p._airtable._endpointUrl+"/v"+p._airtable._apiVersionMajor+"/"+p._id+b+"?"+a.default(A),L={authorization:"Bearer "+p._airtable._apiKey,"x-api-version":p._airtable._apiVersion,"x-airtable-application-id":p.getId(),"content-type":"application/json"},z=typeof window<"u";z?L["x-airtable-user-agent"]=f:L["User-Agent"]=f;var k=new h.default,y=g.toUpperCase(),w={method:y,headers:L,signal:k.signal};S!==null&&(y==="GET"||y==="HEAD"?console.warn("body argument to runAction are ignored with GET or HEAD requests"):w.body=JSON.stringify(S));var D=setTimeout(function(){k.abort()},p._airtable._requestTimeout);u.default(E,w).then(function(N){if(clearTimeout(D),N.status===429&&!p._airtable._noRetryIfRateLimited){var M=o.default(x);setTimeout(function(){d(p,g,b,A,S,v,x+1)},M)}else N.json().then(function(O){var H=p._checkStatusForError(N.status,O),j={};Object.keys(N).forEach(function(Z){j[Z]=N[Z]}),j.body=O,j.statusCode=N.status,v(H,j,O)}).catch(function(){v(p._checkStatusForError(N.status))})}).catch(function(N){clearTimeout(D),v(N)})}r.exports=d},{"./abort-controller":1,"./exponential_backoff_with_jitter":6,"./fetch":7,"./object_to_query_param_string":11,"./package_version":12}],17:[function(t,r,i){var s=this&&this.__assign||function(){return s=Object.assign||function(b){for(var A,S=1,v=arguments.length;S<v;S++){A=arguments[S];for(var x in A)Object.prototype.hasOwnProperty.call(A,x)&&(b[x]=A[x])}return b},s.apply(this,arguments)},o=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}},a=o(t("lodash/isPlainObject")),l=o(t("./deprecate")),u=o(t("./query")),h=t("./query_params"),f=o(t("./object_to_query_param_string")),d=o(t("./record")),p=o(t("./callback_to_promise")),g=function(){function b(A,S,v){if(!S&&!v)throw new Error("Table name or table ID is required");this._base=A,this.id=S,this.name=v,this.find=p.default(this._findRecordById,this),this.select=this._selectRecords.bind(this),this.create=p.default(this._createRecords,this),this.update=p.default(this._updateRecords.bind(this,!1),this),this.replace=p.default(this._updateRecords.bind(this,!0),this),this.destroy=p.default(this._destroyRecord,this),this.list=l.default(this._listRecords.bind(this),"table.list","Airtable: `list()` is deprecated. Use `select()` instead."),this.forEach=l.default(this._forEachRecord.bind(this),"table.forEach","Airtable: `forEach()` is deprecated. Use `select()` instead.")}return b.prototype._findRecordById=function(A,S){var v=new d.default(this,A);v.fetch(S)},b.prototype._selectRecords=function(A){if(A===void 0&&(A={}),arguments.length>1&&console.warn("Airtable: `select` takes only one parameter, but it was given "+arguments.length+" parameters. Use `eachPage` or `firstPage` to fetch records."),a.default(A)){var S=u.default.validateParams(A);if(S.errors.length){var v=S.errors.map(function(x){return"  * "+x});throw new Error("Airtable: invalid parameters for `select`:\n"+v.join(`
`))}return S.ignoredKeys.length&&console.warn("Airtable: the following parameters to `select` will be ignored: "+S.ignoredKeys.join(", ")),new u.default(this,S.validParams)}else throw new Error("Airtable: the parameter for `select` should be a plain object or undefined.")},b.prototype._urlEncodedNameOrId=function(){return this.id||encodeURIComponent(this.name)},b.prototype._createRecords=function(A,S,v){var x=this,E=Array.isArray(A);v||(v=S,S={});var L;E?L=s({records:A},S):L=s({fields:A},S),this._base.runAction("post","/"+this._urlEncodedNameOrId()+"/",{},L,function(z,k,y){if(z){v(z);return}var w;E?w=y.records.map(function(D){return new d.default(x,D.id,D)}):w=new d.default(x,y.id,y),v(null,w)})},b.prototype._updateRecords=function(A,S,v,x,E){var L=this,z;if(Array.isArray(S)){var k=S;z=a.default(v)?v:{},E=x||v;var y=A?"put":"patch",w=s({records:k},z);this._base.runAction(y,"/"+this._urlEncodedNameOrId()+"/",{},w,function(O,H,j){if(O){E(O);return}var Z=j.records.map(function(ge){return new d.default(L,ge.id,ge)});E(null,Z)})}else{var D=S,N=v;z=a.default(x)?x:{},E=E||x;var M=new d.default(this,D);A?M.putUpdate(N,z,E):M.patchUpdate(N,z,E)}},b.prototype._destroyRecord=function(A,S){var v=this;if(Array.isArray(A)){var x={records:A};this._base.runAction("delete","/"+this._urlEncodedNameOrId(),x,null,function(L,z,k){if(L){S(L);return}var y=k.records.map(function(w){var D=w.id;return new d.default(v,D,null)});S(null,y)})}else{var E=new d.default(this,A);E.destroy(S)}},b.prototype._listRecords=function(A,S,v,x){var E=this;x||(x=v,v={});var L="/"+this._urlEncodedNameOrId()+"?"+f.default(v),z,k={},y=null,w;if(typeof v!="function"&&v.method==="post"||L.length>h.URL_CHARACTER_LENGTH_LIMIT){z="/"+this._urlEncodedNameOrId()+"/listRecords",y=s(s({},A&&{pageSize:A}),S&&{offset:S}),w="post";for(var D=Object.keys(v),N=0,M=D;N<M.length;N++){var O=M[N];h.shouldListRecordsParamBePassedAsParameter(O)?k[O]=v[O]:y[O]=v[O]}}else w="get",z="/"+this._urlEncodedNameOrId()+"/",k=s({limit:A,offset:S},v);this._base.runAction(w,z,k,y,function(H,j,Z){if(H){x(H);return}var ge=Z.records.map(function(le){return new d.default(E,null,le)});x(null,ge,Z.offset)})},b.prototype._forEachRecord=function(A,S,v){var x=this;arguments.length===2&&(v=S,S=A,A={});var E=b.__recordsPerPageForIteration||100,L=null,z=function(){x._listRecords(E,L,A,function(k,y,w){if(k){v(k);return}for(var D=0;D<y.length;D++)S(y[D]);w?(L=w,z()):v()})};z()},b}();r.exports=g},{"./callback_to_promise":4,"./deprecate":5,"./object_to_query_param_string":11,"./query":13,"./query_params":14,"./record":15,"lodash/isPlainObject":89}],18:[function(t,r,i){function s(o,a){return function(l){return o(l)?{pass:!0}:{pass:!1,error:a}}}s.isOneOf=function(a){return a.includes.bind(a)},s.isArrayOf=function(o){return function(a){return Array.isArray(a)&&a.every(o)}},r.exports=s},{}],19:[function(t,r,i){Object.defineProperty(i,"__esModule",{value:!0});function s(E,L){if(!(E instanceof L))throw new TypeError("Cannot call a class as a function")}function o(E,L){for(var z=0;z<L.length;z++){var k=L[z];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(E,k.key,k)}}function a(E,L,z){return L&&o(E.prototype,L),z&&o(E,z),E}function l(E,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function");E.prototype=Object.create(L&&L.prototype,{constructor:{value:E,writable:!0,configurable:!0}}),L&&h(E,L)}function u(E){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},u(E)}function h(E,L){return h=Object.setPrototypeOf||function(k,y){return k.__proto__=y,k},h(E,L)}function f(E){if(E===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E}function d(E,L){return L&&(typeof L=="object"||typeof L=="function")?L:f(E)}function p(E,L){for(;!Object.prototype.hasOwnProperty.call(E,L)&&(E=u(E),E!==null););return E}function g(E,L,z){return typeof Reflect<"u"&&Reflect.get?g=Reflect.get:g=function(y,w,D){var N=p(y,w);if(N){var M=Object.getOwnPropertyDescriptor(N,w);return M.get?M.get.call(D):M.value}},g(E,L,z||E)}var b=function(){function E(){s(this,E),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return a(E,[{key:"addEventListener",value:function(z,k){z in this.listeners||(this.listeners[z]=[]),this.listeners[z].push(k)}},{key:"removeEventListener",value:function(z,k){if(z in this.listeners){for(var y=this.listeners[z],w=0,D=y.length;w<D;w++)if(y[w]===k){y.splice(w,1);return}}}},{key:"dispatchEvent",value:function(z){var k=this;if(z.type in this.listeners){for(var y=function(O){setTimeout(function(){return O.call(k,z)})},w=this.listeners[z.type],D=0,N=w.length;D<N;D++)y(w[D]);return!z.defaultPrevented}}}]),E}(),A=function(E){l(L,E);function L(){var z;return s(this,L),z=d(this,u(L).call(this)),z.listeners||b.call(f(z)),Object.defineProperty(f(z),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(f(z),"onabort",{value:null,writable:!0,configurable:!0}),z}return a(L,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(k){k.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,k)),g(u(L.prototype),"dispatchEvent",this).call(this,k)}}]),L}(b),S=function(){function E(){s(this,E),Object.defineProperty(this,"signal",{value:new A,writable:!0,configurable:!0})}return a(E,[{key:"abort",value:function(){var z;try{z=new Event("abort")}catch{typeof document<"u"?document.createEvent?(z=document.createEvent("Event"),z.initEvent("abort",!1,!1)):(z=document.createEventObject(),z.type="abort"):z={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(z)}},{key:"toString",value:function(){return"[object AbortController]"}}]),E}();typeof Symbol<"u"&&Symbol.toStringTag&&(S.prototype[Symbol.toStringTag]="AbortController",A.prototype[Symbol.toStringTag]="AbortSignal");function v(E){return E.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):typeof E.Request=="function"&&!E.Request.prototype.hasOwnProperty("signal")||!E.AbortController}function x(E){typeof E=="function"&&(E={fetch:E});var L=E,z=L.fetch,k=L.Request,y=k===void 0?z.Request:k,w=L.AbortController,D=L.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,N=D===void 0?!1:D;if(!v({fetch:z,Request:y,AbortController:w,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:N}))return{fetch:z,Request:M};var M=y;(M&&!M.prototype.hasOwnProperty("signal")||N)&&(M=function(Z,ge){var le;ge&&ge.signal&&(le=ge.signal,delete ge.signal);var ee=new y(Z,ge);return le&&Object.defineProperty(ee,"signal",{writable:!1,enumerable:!1,configurable:!0,value:le}),ee},M.prototype=y.prototype);var O=z,H=function(Z,ge){var le=M&&M.prototype.isPrototypeOf(Z)?Z.signal:ge?ge.signal:void 0;if(le){var ee;try{ee=new DOMException("Aborted","AbortError")}catch{ee=new Error("Aborted"),ee.name="AbortError"}if(le.aborted)return Promise.reject(ee);var fe=new Promise(function(Ve,ye){le.addEventListener("abort",function(){return ye(ee)},{once:!0})});return ge&&ge.signal&&delete ge.signal,Promise.race([fe,O(Z,ge)])}return O(Z,ge)};return{fetch:H,Request:M}}i.AbortController=S,i.AbortSignal=A,i.abortableFetch=x},{}],20:[function(t,r,i){},{}],21:[function(t,r,i){var s=t("./_hashClear"),o=t("./_hashDelete"),a=t("./_hashGet"),l=t("./_hashHas"),u=t("./_hashSet");function h(f){var d=-1,p=f==null?0:f.length;for(this.clear();++d<p;){var g=f[d];this.set(g[0],g[1])}}h.prototype.clear=s,h.prototype.delete=o,h.prototype.get=a,h.prototype.has=l,h.prototype.set=u,r.exports=h},{"./_hashClear":46,"./_hashDelete":47,"./_hashGet":48,"./_hashHas":49,"./_hashSet":50}],22:[function(t,r,i){var s=t("./_listCacheClear"),o=t("./_listCacheDelete"),a=t("./_listCacheGet"),l=t("./_listCacheHas"),u=t("./_listCacheSet");function h(f){var d=-1,p=f==null?0:f.length;for(this.clear();++d<p;){var g=f[d];this.set(g[0],g[1])}}h.prototype.clear=s,h.prototype.delete=o,h.prototype.get=a,h.prototype.has=l,h.prototype.set=u,r.exports=h},{"./_listCacheClear":56,"./_listCacheDelete":57,"./_listCacheGet":58,"./_listCacheHas":59,"./_listCacheSet":60}],23:[function(t,r,i){var s=t("./_getNative"),o=t("./_root"),a=s(o,"Map");r.exports=a},{"./_getNative":42,"./_root":72}],24:[function(t,r,i){var s=t("./_mapCacheClear"),o=t("./_mapCacheDelete"),a=t("./_mapCacheGet"),l=t("./_mapCacheHas"),u=t("./_mapCacheSet");function h(f){var d=-1,p=f==null?0:f.length;for(this.clear();++d<p;){var g=f[d];this.set(g[0],g[1])}}h.prototype.clear=s,h.prototype.delete=o,h.prototype.get=a,h.prototype.has=l,h.prototype.set=u,r.exports=h},{"./_mapCacheClear":61,"./_mapCacheDelete":62,"./_mapCacheGet":63,"./_mapCacheHas":64,"./_mapCacheSet":65}],25:[function(t,r,i){var s=t("./_root"),o=s.Symbol;r.exports=o},{"./_root":72}],26:[function(t,r,i){var s=t("./_baseTimes"),o=t("./isArguments"),a=t("./isArray"),l=t("./isBuffer"),u=t("./_isIndex"),h=t("./isTypedArray"),f=Object.prototype,d=f.hasOwnProperty;function p(g,b){var A=a(g),S=!A&&o(g),v=!A&&!S&&l(g),x=!A&&!S&&!v&&h(g),E=A||S||v||x,L=E?s(g.length,String):[],z=L.length;for(var k in g)(b||d.call(g,k))&&!(E&&(k=="length"||v&&(k=="offset"||k=="parent")||x&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||u(k,z)))&&L.push(k);return L}r.exports=p},{"./_baseTimes":35,"./_isIndex":51,"./isArguments":78,"./isArray":79,"./isBuffer":82,"./isTypedArray":92}],27:[function(t,r,i){function s(o,a){for(var l=-1,u=o==null?0:o.length,h=Array(u);++l<u;)h[l]=a(o[l],l,o);return h}r.exports=s},{}],28:[function(t,r,i){var s=t("./eq");function o(a,l){for(var u=a.length;u--;)if(s(a[u][0],l))return u;return-1}r.exports=o},{"./eq":76}],29:[function(t,r,i){var s=t("./_castPath"),o=t("./_toKey");function a(l,u){u=s(u,l);for(var h=0,f=u.length;l!=null&&h<f;)l=l[o(u[h++])];return h&&h==f?l:void 0}r.exports=a},{"./_castPath":38,"./_toKey":74}],30:[function(t,r,i){var s=t("./_Symbol"),o=t("./_getRawTag"),a=t("./_objectToString"),l="[object Null]",u="[object Undefined]",h=s?s.toStringTag:void 0;function f(d){return d==null?d===void 0?u:l:h&&h in Object(d)?o(d):a(d)}r.exports=f},{"./_Symbol":25,"./_getRawTag":44,"./_objectToString":70}],31:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isObjectLike"),a="[object Arguments]";function l(u){return o(u)&&s(u)==a}r.exports=l},{"./_baseGetTag":30,"./isObjectLike":88}],32:[function(t,r,i){var s=t("./isFunction"),o=t("./_isMasked"),a=t("./isObject"),l=t("./_toSource"),u=/[\\^$.*+?()[\]{}|]/g,h=/^\[object .+?Constructor\]$/,f=Function.prototype,d=Object.prototype,p=f.toString,g=d.hasOwnProperty,b=RegExp("^"+p.call(g).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(S){if(!a(S)||o(S))return!1;var v=s(S)?b:h;return v.test(l(S))}r.exports=A},{"./_isMasked":54,"./_toSource":75,"./isFunction":83,"./isObject":87}],33:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isLength"),a=t("./isObjectLike"),l="[object Arguments]",u="[object Array]",h="[object Boolean]",f="[object Date]",d="[object Error]",p="[object Function]",g="[object Map]",b="[object Number]",A="[object Object]",S="[object RegExp]",v="[object Set]",x="[object String]",E="[object WeakMap]",L="[object ArrayBuffer]",z="[object DataView]",k="[object Float32Array]",y="[object Float64Array]",w="[object Int8Array]",D="[object Int16Array]",N="[object Int32Array]",M="[object Uint8Array]",O="[object Uint8ClampedArray]",H="[object Uint16Array]",j="[object Uint32Array]",Z={};Z[k]=Z[y]=Z[w]=Z[D]=Z[N]=Z[M]=Z[O]=Z[H]=Z[j]=!0,Z[l]=Z[u]=Z[L]=Z[h]=Z[z]=Z[f]=Z[d]=Z[p]=Z[g]=Z[b]=Z[A]=Z[S]=Z[v]=Z[x]=Z[E]=!1;function ge(le){return a(le)&&o(le.length)&&!!Z[s(le)]}r.exports=ge},{"./_baseGetTag":30,"./isLength":84,"./isObjectLike":88}],34:[function(t,r,i){var s=t("./_isPrototype"),o=t("./_nativeKeys"),a=Object.prototype,l=a.hasOwnProperty;function u(h){if(!s(h))return o(h);var f=[];for(var d in Object(h))l.call(h,d)&&d!="constructor"&&f.push(d);return f}r.exports=u},{"./_isPrototype":55,"./_nativeKeys":68}],35:[function(t,r,i){function s(o,a){for(var l=-1,u=Array(o);++l<o;)u[l]=a(l);return u}r.exports=s},{}],36:[function(t,r,i){var s=t("./_Symbol"),o=t("./_arrayMap"),a=t("./isArray"),l=t("./isSymbol"),u=1/0,h=s?s.prototype:void 0,f=h?h.toString:void 0;function d(p){if(typeof p=="string")return p;if(a(p))return o(p,d)+"";if(l(p))return f?f.call(p):"";var g=p+"";return g=="0"&&1/p==-u?"-0":g}r.exports=d},{"./_Symbol":25,"./_arrayMap":27,"./isArray":79,"./isSymbol":91}],37:[function(t,r,i){function s(o){return function(a){return o(a)}}r.exports=s},{}],38:[function(t,r,i){var s=t("./isArray"),o=t("./_isKey"),a=t("./_stringToPath"),l=t("./toString");function u(h,f){return s(h)?h:o(h,f)?[h]:a(l(h))}r.exports=u},{"./_isKey":52,"./_stringToPath":73,"./isArray":79,"./toString":96}],39:[function(t,r,i){var s=t("./_root"),o=s["__core-js_shared__"];r.exports=o},{"./_root":72}],40:[function(t,r,i){(function(s){var o=typeof s=="object"&&s&&s.Object===Object&&s;r.exports=o}).call(this,typeof af<"u"?af:typeof self<"u"?self:typeof window<"u"?window:{})},{}],41:[function(t,r,i){var s=t("./_isKeyable");function o(a,l){var u=a.__data__;return s(l)?u[typeof l=="string"?"string":"hash"]:u.map}r.exports=o},{"./_isKeyable":53}],42:[function(t,r,i){var s=t("./_baseIsNative"),o=t("./_getValue");function a(l,u){var h=o(l,u);return s(h)?h:void 0}r.exports=a},{"./_baseIsNative":32,"./_getValue":45}],43:[function(t,r,i){var s=t("./_overArg"),o=s(Object.getPrototypeOf,Object);r.exports=o},{"./_overArg":71}],44:[function(t,r,i){var s=t("./_Symbol"),o=Object.prototype,a=o.hasOwnProperty,l=o.toString,u=s?s.toStringTag:void 0;function h(f){var d=a.call(f,u),p=f[u];try{f[u]=void 0;var g=!0}catch{}var b=l.call(f);return g&&(d?f[u]=p:delete f[u]),b}r.exports=h},{"./_Symbol":25}],45:[function(t,r,i){function s(o,a){return o==null?void 0:o[a]}r.exports=s},{}],46:[function(t,r,i){var s=t("./_nativeCreate");function o(){this.__data__=s?s(null):{},this.size=0}r.exports=o},{"./_nativeCreate":67}],47:[function(t,r,i){function s(o){var a=this.has(o)&&delete this.__data__[o];return this.size-=a?1:0,a}r.exports=s},{}],48:[function(t,r,i){var s=t("./_nativeCreate"),o="__lodash_hash_undefined__",a=Object.prototype,l=a.hasOwnProperty;function u(h){var f=this.__data__;if(s){var d=f[h];return d===o?void 0:d}return l.call(f,h)?f[h]:void 0}r.exports=u},{"./_nativeCreate":67}],49:[function(t,r,i){var s=t("./_nativeCreate"),o=Object.prototype,a=o.hasOwnProperty;function l(u){var h=this.__data__;return s?h[u]!==void 0:a.call(h,u)}r.exports=l},{"./_nativeCreate":67}],50:[function(t,r,i){var s=t("./_nativeCreate"),o="__lodash_hash_undefined__";function a(l,u){var h=this.__data__;return this.size+=this.has(l)?0:1,h[l]=s&&u===void 0?o:u,this}r.exports=a},{"./_nativeCreate":67}],51:[function(t,r,i){var s=9007199254740991,o=/^(?:0|[1-9]\d*)$/;function a(l,u){var h=typeof l;return u=u??s,!!u&&(h=="number"||h!="symbol"&&o.test(l))&&l>-1&&l%1==0&&l<u}r.exports=a},{}],52:[function(t,r,i){var s=t("./isArray"),o=t("./isSymbol"),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,l=/^\w*$/;function u(h,f){if(s(h))return!1;var d=typeof h;return d=="number"||d=="symbol"||d=="boolean"||h==null||o(h)?!0:l.test(h)||!a.test(h)||f!=null&&h in Object(f)}r.exports=u},{"./isArray":79,"./isSymbol":91}],53:[function(t,r,i){function s(o){var a=typeof o;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?o!=="__proto__":o===null}r.exports=s},{}],54:[function(t,r,i){var s=t("./_coreJsData"),o=function(){var l=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}();function a(l){return!!o&&o in l}r.exports=a},{"./_coreJsData":39}],55:[function(t,r,i){var s=Object.prototype;function o(a){var l=a&&a.constructor,u=typeof l=="function"&&l.prototype||s;return a===u}r.exports=o},{}],56:[function(t,r,i){function s(){this.__data__=[],this.size=0}r.exports=s},{}],57:[function(t,r,i){var s=t("./_assocIndexOf"),o=Array.prototype,a=o.splice;function l(u){var h=this.__data__,f=s(h,u);if(f<0)return!1;var d=h.length-1;return f==d?h.pop():a.call(h,f,1),--this.size,!0}r.exports=l},{"./_assocIndexOf":28}],58:[function(t,r,i){var s=t("./_assocIndexOf");function o(a){var l=this.__data__,u=s(l,a);return u<0?void 0:l[u][1]}r.exports=o},{"./_assocIndexOf":28}],59:[function(t,r,i){var s=t("./_assocIndexOf");function o(a){return s(this.__data__,a)>-1}r.exports=o},{"./_assocIndexOf":28}],60:[function(t,r,i){var s=t("./_assocIndexOf");function o(a,l){var u=this.__data__,h=s(u,a);return h<0?(++this.size,u.push([a,l])):u[h][1]=l,this}r.exports=o},{"./_assocIndexOf":28}],61:[function(t,r,i){var s=t("./_Hash"),o=t("./_ListCache"),a=t("./_Map");function l(){this.size=0,this.__data__={hash:new s,map:new(a||o),string:new s}}r.exports=l},{"./_Hash":21,"./_ListCache":22,"./_Map":23}],62:[function(t,r,i){var s=t("./_getMapData");function o(a){var l=s(this,a).delete(a);return this.size-=l?1:0,l}r.exports=o},{"./_getMapData":41}],63:[function(t,r,i){var s=t("./_getMapData");function o(a){return s(this,a).get(a)}r.exports=o},{"./_getMapData":41}],64:[function(t,r,i){var s=t("./_getMapData");function o(a){return s(this,a).has(a)}r.exports=o},{"./_getMapData":41}],65:[function(t,r,i){var s=t("./_getMapData");function o(a,l){var u=s(this,a),h=u.size;return u.set(a,l),this.size+=u.size==h?0:1,this}r.exports=o},{"./_getMapData":41}],66:[function(t,r,i){var s=t("./memoize"),o=500;function a(l){var u=s(l,function(f){return h.size===o&&h.clear(),f}),h=u.cache;return u}r.exports=a},{"./memoize":94}],67:[function(t,r,i){var s=t("./_getNative"),o=s(Object,"create");r.exports=o},{"./_getNative":42}],68:[function(t,r,i){var s=t("./_overArg"),o=s(Object.keys,Object);r.exports=o},{"./_overArg":71}],69:[function(t,r,i){var s=t("./_freeGlobal"),o=typeof i=="object"&&i&&!i.nodeType&&i,a=o&&typeof r=="object"&&r&&!r.nodeType&&r,l=a&&a.exports===o,u=l&&s.process,h=function(){try{var f=a&&a.require&&a.require("util").types;return f||u&&u.binding&&u.binding("util")}catch{}}();r.exports=h},{"./_freeGlobal":40}],70:[function(t,r,i){var s=Object.prototype,o=s.toString;function a(l){return o.call(l)}r.exports=a},{}],71:[function(t,r,i){function s(o,a){return function(l){return o(a(l))}}r.exports=s},{}],72:[function(t,r,i){var s=t("./_freeGlobal"),o=typeof self=="object"&&self&&self.Object===Object&&self,a=s||o||Function("return this")();r.exports=a},{"./_freeGlobal":40}],73:[function(t,r,i){var s=t("./_memoizeCapped"),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,l=s(function(u){var h=[];return u.charCodeAt(0)===46&&h.push(""),u.replace(o,function(f,d,p,g){h.push(p?g.replace(a,"$1"):d||f)}),h});r.exports=l},{"./_memoizeCapped":66}],74:[function(t,r,i){var s=t("./isSymbol"),o=1/0;function a(l){if(typeof l=="string"||s(l))return l;var u=l+"";return u=="0"&&1/l==-o?"-0":u}r.exports=a},{"./isSymbol":91}],75:[function(t,r,i){var s=Function.prototype,o=s.toString;function a(l){if(l!=null){try{return o.call(l)}catch{}try{return l+""}catch{}}return""}r.exports=a},{}],76:[function(t,r,i){function s(o,a){return o===a||o!==o&&a!==a}r.exports=s},{}],77:[function(t,r,i){var s=t("./_baseGet");function o(a,l,u){var h=a==null?void 0:s(a,l);return h===void 0?u:h}r.exports=o},{"./_baseGet":29}],78:[function(t,r,i){var s=t("./_baseIsArguments"),o=t("./isObjectLike"),a=Object.prototype,l=a.hasOwnProperty,u=a.propertyIsEnumerable,h=s(function(){return arguments}())?s:function(f){return o(f)&&l.call(f,"callee")&&!u.call(f,"callee")};r.exports=h},{"./_baseIsArguments":31,"./isObjectLike":88}],79:[function(t,r,i){var s=Array.isArray;r.exports=s},{}],80:[function(t,r,i){var s=t("./isFunction"),o=t("./isLength");function a(l){return l!=null&&o(l.length)&&!s(l)}r.exports=a},{"./isFunction":83,"./isLength":84}],81:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isObjectLike"),a="[object Boolean]";function l(u){return u===!0||u===!1||o(u)&&s(u)==a}r.exports=l},{"./_baseGetTag":30,"./isObjectLike":88}],82:[function(t,r,i){var s=t("./_root"),o=t("./stubFalse"),a=typeof i=="object"&&i&&!i.nodeType&&i,l=a&&typeof r=="object"&&r&&!r.nodeType&&r,u=l&&l.exports===a,h=u?s.Buffer:void 0,f=h?h.isBuffer:void 0,d=f||o;r.exports=d},{"./_root":72,"./stubFalse":95}],83:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isObject"),a="[object AsyncFunction]",l="[object Function]",u="[object GeneratorFunction]",h="[object Proxy]";function f(d){if(!o(d))return!1;var p=s(d);return p==l||p==u||p==a||p==h}r.exports=f},{"./_baseGetTag":30,"./isObject":87}],84:[function(t,r,i){var s=9007199254740991;function o(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=s}r.exports=o},{}],85:[function(t,r,i){function s(o){return o==null}r.exports=s},{}],86:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isObjectLike"),a="[object Number]";function l(u){return typeof u=="number"||o(u)&&s(u)==a}r.exports=l},{"./_baseGetTag":30,"./isObjectLike":88}],87:[function(t,r,i){function s(o){var a=typeof o;return o!=null&&(a=="object"||a=="function")}r.exports=s},{}],88:[function(t,r,i){function s(o){return o!=null&&typeof o=="object"}r.exports=s},{}],89:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./_getPrototype"),a=t("./isObjectLike"),l="[object Object]",u=Function.prototype,h=Object.prototype,f=u.toString,d=h.hasOwnProperty,p=f.call(Object);function g(b){if(!a(b)||s(b)!=l)return!1;var A=o(b);if(A===null)return!0;var S=d.call(A,"constructor")&&A.constructor;return typeof S=="function"&&S instanceof S&&f.call(S)==p}r.exports=g},{"./_baseGetTag":30,"./_getPrototype":43,"./isObjectLike":88}],90:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isArray"),a=t("./isObjectLike"),l="[object String]";function u(h){return typeof h=="string"||!o(h)&&a(h)&&s(h)==l}r.exports=u},{"./_baseGetTag":30,"./isArray":79,"./isObjectLike":88}],91:[function(t,r,i){var s=t("./_baseGetTag"),o=t("./isObjectLike"),a="[object Symbol]";function l(u){return typeof u=="symbol"||o(u)&&s(u)==a}r.exports=l},{"./_baseGetTag":30,"./isObjectLike":88}],92:[function(t,r,i){var s=t("./_baseIsTypedArray"),o=t("./_baseUnary"),a=t("./_nodeUtil"),l=a&&a.isTypedArray,u=l?o(l):s;r.exports=u},{"./_baseIsTypedArray":33,"./_baseUnary":37,"./_nodeUtil":69}],93:[function(t,r,i){var s=t("./_arrayLikeKeys"),o=t("./_baseKeys"),a=t("./isArrayLike");function l(u){return a(u)?s(u):o(u)}r.exports=l},{"./_arrayLikeKeys":26,"./_baseKeys":34,"./isArrayLike":80}],94:[function(t,r,i){var s=t("./_MapCache"),o="Expected a function";function a(l,u){if(typeof l!="function"||u!=null&&typeof u!="function")throw new TypeError(o);var h=function(){var f=arguments,d=u?u.apply(this,f):f[0],p=h.cache;if(p.has(d))return p.get(d);var g=l.apply(this,f);return h.cache=p.set(d,g)||p,g};return h.cache=new(a.Cache||s),h}a.Cache=s,r.exports=a},{"./_MapCache":24}],95:[function(t,r,i){function s(){return!1}r.exports=s},{}],96:[function(t,r,i){var s=t("./_baseToString");function o(a){return a==null?"":s(a)}r.exports=o},{"./_baseToString":36}],airtable:[function(t,r,i){var s=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}},o=s(t("./base")),a=s(t("./record")),l=s(t("./table")),u=s(t("./airtable_error")),h=function(){function f(d){d===void 0&&(d={});var p=f.default_config(),g=d.apiVersion||f.apiVersion||p.apiVersion;if(Object.defineProperties(this,{_apiKey:{value:d.apiKey||f.apiKey||p.apiKey},_apiVersion:{value:g},_apiVersionMajor:{value:g.split(".")[0]},_customHeaders:{value:d.customHeaders||{}},_endpointUrl:{value:d.endpointUrl||f.endpointUrl||p.endpointUrl},_noRetryIfRateLimited:{value:d.noRetryIfRateLimited||f.noRetryIfRateLimited||p.noRetryIfRateLimited},_requestTimeout:{value:d.requestTimeout||f.requestTimeout||p.requestTimeout}}),!this._apiKey)throw new Error("An API key is required to connect to Airtable")}return f.prototype.base=function(d){return o.default.createFunctor(this,d)},f.default_config=function(){return{endpointUrl:"https://api.airtable.com",apiVersion:"0.1.0",apiKey:"",noRetryIfRateLimited:!1,requestTimeout:300*1e3}},f.configure=function(d){var p=d.apiKey,g=d.endpointUrl,b=d.apiVersion,A=d.noRetryIfRateLimited,S=d.requestTimeout;f.apiKey=p,f.endpointUrl=g,f.apiVersion=b,f.noRetryIfRateLimited=A,f.requestTimeout=S},f.base=function(d){return new f().base(d)},f.Base=o.default,f.Record=a.default,f.Table=l.default,f.Error=u.default,f}();r.exports=h},{"./airtable_error":2,"./base":3,"./record":15,"./table":17}]},{},["airtable"])("airtable")})})(_g);var Zw=_g.exports;const Al=Jw(Zw);class $w extends Va{constructor(){super(...arguments),this.personalAccessToken="patGTiWbebGZTw0fh.dd17a194aea98f9e4e918d333babde7bcd39903b4179b139ac8866a5f3cfe5b6",this.baseCatalist=new Al({apiKey:this.personalAccessToken}).base("apphGUCbYIEJLvRrR"),this.basePublic=new Al({apiKey:this.personalAccessToken}).base("appq1IjzmiRdlZi3H"),this.base=this.basePublic,this.relationships_table=this.base(Ce.relationships),this.predicates_table=this.base(Ce.predicates),this.things_table=this.base(Ce.things),this.traits_table=this.base(Ce.traits),this.access_table=this.base(Ce.access),this.users_table=this.base(Ce.users),this.dbType=bt.airtable,this.isPersistent=!0,this.baseID=I.empty,this.isRemote=!0,this.relationships_errorMessage="Error in Relationships:",this.things_errorMessage="Error in Things:",this.traits_errorMessage="Error in Traits:"}async fetch_hierarchy_from(e){}queryStradial_apply(){const e=ae.queryStradial.get("name")??ae.queryStradial.get("dbid");if(e){const t=e.split(I.comma);if(t.length>1){const r=t[0];this.personalAccessToken=t[1],this.base=new Al({apiKey:this.personalAccessToken}).base(r),this.relationships_table=this.base(Ce.relationships),this.predicates_table=this.base(Ce.predicates),this.things_table=this.base(Ce.things),this.access_table=this.base(Ce.access),this.users_table=this.base(Ce.users)}}}async fetch_all(){await this.things_readAll(),await this.traits_readAll(),await this.predicates_readAll(),await this.relationships_readAll(),await this.access_readAll(),await this.users_readAll()}async things_readAll(){this.hierarchy.things_forgetAll();try{await this.things_table.select().all().then(t=>{const r=t;for(const i of r){const s=i.id,o=i.fields;this.hierarchy.thing_remember_runtimeCreate(I.empty,s,o.title,o.color,o.type??o.trait,!0,!o.type)}})}catch(e){ie.log_error(this.things_errorMessage+" (things_readAll) "+e)}}async thing_remember_persistentCreate(e){try{const t=await this.things_table.create(e.fields);e.already_persisted=!0,e.awaitingCreation=!1,this.hierarchy.thing_remember_updateID_to(e,t.id)}catch(t){e.log(yt.remote,this.things_errorMessage+t)}}async thing_persistentUpdate(e){try{await this.things_table.update(e.id,e.fields)}catch(t){e.log(yt.remote,this.things_errorMessage+t)}}async thing_persistentDelete(e){try{await this.things_table.destroy(e.id)}catch(t){e.log(yt.remote,this.things_errorMessage+t)}}async traits_readAll(){this.hierarchy.traits_forgetAll();try{const e=await this.traits_table.select().all();for(const t of e){const r=t.id,i=t.fields.text,s=t.fields.type,o=t.fields.ownerID;this.hierarchy.trait_remember_runtimeCreateUnique(I.empty,r,o[0],s,i,!0)}}catch(e){ie.log_error(this.traits_errorMessage+e)}}async trait_persistentUpdate(e){try{await this.traits_table.update(e.id,e.fields)}catch(t){e.log(yt.remote,this.traits_errorMessage+t)}}async trait_persistentDelete(e){try{await this.traits_table.destroy(e.id)}catch(t){e.log(yt.remote,this.traits_errorMessage+t)}}async trait_remember_persistentCreate(e){try{const r=(await this.traits_table.create(e.fields)).id;e.setID(r),e.already_persisted=!0,this.hierarchy.trait_remember(e)}catch(t){e.log(yt.remote,this.traits_errorMessage+t)}}async relationships_readAll(){this.hierarchy.relationships_forgetAll();try{const e=await this.relationships_table.select().all();for(const t of e){const r=t.id,i=t.fields.order,s=t.fields.parent,o=t.fields.child,a=t.fields.kindPredicate;this.hierarchy.relationship_remember_runtimeCreateUnique(I.empty,r,a,s[0],o[0],i,Un.isFromPersistent)}}catch(e){ie.log_error(this.relationships_errorMessage+e)}}async relationship_remember_persistentCreate(e){if(e&&!e.already_persisted)try{const r=(await this.relationships_table.create(e.fields)).id;e.setID(r),e.already_persisted=!0,this.hierarchy.relationships_refreshKnowns()}catch(t){e.log(yt.remote,this.relationships_errorMessage+t)}}async relationship_persistentUpdate(e){this.relationships_table.update(e.id,e.fields)}async relationship_persistentDelete(e){try{this.hierarchy.relationships=we.strip_invalid(this.hierarchy.relationships),this.hierarchy.relationships_refreshKnowns(),await this.relationships_table.destroy(e.id)}catch(t){e.log(yt.remote,this.relationships_errorMessage+t)}}async predicates_readAll(){try{const e=await this.predicates_table.select().all();for(const t of e){const r=t.fields,i=t.id,s=r.kind,o=r.isBidirectional??!1;this.hierarchy.predicate_remember_runtimeCreate(i,s,o)}}catch(e){ie.log_error("Error in Predicates:"+e)}}async access_readAll(){try{const e=await this.access_table.select().all();for(const t of e){const r=t.id,i=t.fields.kind;this.hierarchy.access_runtimeCreate(r,i)}}catch(e){ie.log_error("Error in Access:"+e)}}async users_readAll(){try{const e=await this.users_table.select().all();for(const t of e){const r=t.id;this.hierarchy.user_runtimeCreate(r,t.fields.name,t.fields.email,t.fields.phone)}}catch(e){ie.log_error("Error in Users:"+e)}}}const ev=new $w;class tv extends Va{constructor(){super(...arguments),this.baseID=I.baseID_file,this.dbType=bt.local,this.isPersistent=!0}get h(){return this.hierarchy}async remove_all(){nt.write_key(it.local,null)}async persistAll(){const e=we.stringify_object(this.h.all_data);nt.write_key(it.local,e)}async fetch_all(){const e=nt.read_key(it.local);if(e){const t=JSON.parse(e);if(!t.hid&&!t.id){await this.h.extract_hierarchy_from(t);return}}this.h.predicate_defaults_remember_runtimeCreate(),this.h.thing_remember_runtimeCreateUnique(this.baseID,Ni.newID(),"click here to edit this title","limegreen",Ft.root)}async thing_persistentUpdate(e){this.persistAll()}async thing_persistentDelete(e){this.persistAll()}async thing_remember_persistentCreate(e){this.h.thing_remember(e),this.persistAll()}async trait_persistentUpdate(e){this.persistAll()}async trait_persistentDelete(e){this.persistAll()}async trait_remember_persistentCreate(e){this.h.trait_remember(e),this.persistAll()}async predicate_persistentUpdate(e){this.persistAll()}async predicate_persistentDelete(e){this.persistAll()}async predicate_remember_persistentCreate(e){this.h.predicate_remember(e),this.persistAll()}async relationship_persistentUpdate(e){this.persistAll()}async relationship_persistentDelete(e){this.persistAll()}async relationship_remember_persistentCreate(e){this.h.relationship_remember(e),this.persistAll()}}const nv=new tv;class rv extends Va{constructor(){super(...arguments),this.baseID=I.baseID_test,this.dbType=bt.test}async persistAll(){}async fetch_all(){const e="A",t="B",r="C",i="D",s="E",o="F",a="R",l=this.hierarchy,u=tt.contains,h=tt.isRelated;l.predicate_defaults_remember_runtimeCreate(),l.thing_remember_runtimeCreateUnique(this.baseID,e,"Active","red","a"),l.thing_remember_runtimeCreateUnique(this.baseID,t,"Maintain","blue","b"),l.thing_remember_runtimeCreateUnique(this.baseID,r,"Curiosity","#d96726","c"),l.thing_remember_runtimeCreateUnique(this.baseID,i,"Autonomy","purple","d"),l.thing_remember_runtimeCreateUnique(this.baseID,s,"Aesthetics","mediumvioletred","e"),l.thing_remember_runtimeCreateUnique(this.baseID,o,"Connections","coral","f"),l.thing_remember_runtimeCreateUnique(this.baseID,a,"Life","limegreen",Ft.root),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cra",u,a,e,0),l.relationship_remember_runtimeCreateUnique(this.baseID,"Crb",u,a,t,1),l.relationship_remember_runtimeCreateUnique(this.baseID,"Crc",u,a,r,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Crd",u,a,i,3),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cre",u,a,s,4),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cab",u,e,t,0),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cac",u,e,r,1),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cad",u,e,i,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cae",u,e,s,3),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cbc",u,t,r,0),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cbd",u,t,i,1),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cbe",u,t,s,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cbf",u,t,o,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Ccd",u,r,i,0),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cce",u,r,s,1),l.relationship_remember_runtimeCreateUnique(this.baseID,"Cde",u,i,s,0),l.relationship_remember_runtimeCreateUnique(this.baseID,"Rrb",h,a,t,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Rbd",h,t,i,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Rac",h,e,r,2),l.relationship_remember_runtimeCreateUnique(this.baseID,"Rce",h,r,s,2),this.makeMore(20,"G",u,t,!0),this.makeMore(5,"G",u,t,!1),this.makeMore(5,"G",h,t,!1)}makeMore(e,t,r,i,s){for(let o=0;o<e;o++){const a=this.hierarchy,l=t.charCodeAt(0)+o,u=String.fromCharCode(l),h=String.fromCharCode(l+32),f=a.predicate_forKind(r),d=(f==null?void 0:f.isBidirectional)??!1,p=s?i+u:u+i,g=s?u:p,A=(d?"R":"C")+p,S=s?p:i,v=s?i:p;if(a.thing_remember_runtimeCreateUnique(this.baseID,p,g,"red",h),a.relationship_remember_runtimeCreateUnique(this.baseID,A,r,v,S,1),s||d){const x="CR"+u;a.relationship_remember_runtimeCreateUnique(this.baseID,x,tt.contains,a.root.id,p,1)}}}async thing_remember_persistentCreate(e){this.hierarchy.thing_remember(e)}async trait_remember_persistentCreate(e){this.hierarchy.trait_remember(e)}async relationship_remember_persistentCreate(e){this.hierarchy.relationship_remember(e)}}const iv=new rv;function lf(n){switch(n){case bt.firebase:return pi;case bt.airtable:return ev;case bt.test:return iv;default:return nv}}class sv{constructor(){this.eraseDB=!1;let e=!1;this.db=pi,di.subscribe(t=>{t&&(!e||t&&this.db.dbType!=t)&&(e=!0,setTimeout(async()=>{await this.hierarchy_setup_fetch_andBuild_forDBType(t)},10))})}queryStradial_apply(){const t=ae.queryStradial.get("db");t&&(this.db_set_accordingToType(t),di.set(t)),this.db.queryStradial_apply()}db_set_accordingToType(e){this.db=lf(e)}db_change_toNext(e){this.db_change_toType(this.db_next_get(e))}restore_db(){let e=nt.read_key(it.db)??"firebase";e=="file"&&(e="local"),di.set(e)}get startupExplanation(){const e=this.db.dbType;let t=I.empty;switch(e){case bt.firebase:t=`, from ${this.db.baseID}`;break;case bt.test:return I.empty}return`(loading your ${e} data${t})`}async hierarchy_setup_fetch_andBuild_forDBType(e){if(nt.write_key(it.db,e),this.db_set_accordingToType(e),this.queryStradial_apply(),this.db.hasData){const t=this.db.hierarchy;t&&(Fe.set(t),t.reset_hierarchy())}else Go.set(jn.fetch),await this.hierarchy_create_fetch_andBuild();setTimeout(async()=>{Go.set(jn.ready),Oe.signal_rebuildGraph_fromFocus()},1)}async hierarchy_create_fetch_andBuild(){Oo.set(null);const e=new Date().getTime(),t=this.db,r=t.hierarchy=new av(t);Fe.set(r),this.eraseDB&&await t.remove_all(),r.hierarchy_forgetAll(),await t.fetch_all(),await r.conclude_fetch_andPersist(),t.isRemote&&this.set_loadTime_from(e)}set_loadTime_from(e){const t=new Date().getTime()-e,r=Math.trunc(t/100)/10,i=r==Math.trunc(r),s=i?0:1,o=i?"":"s",l=`${(t/1e3).toFixed(s)} second${o}`;this.db.loadTime=l,Oo.set(l)}db_change_toType(e){const t=lf(e);nt.write_key(it.db,e),di.set(e),Oo.set(t.loadTime)}db_next_get(e){switch(this.db.dbType){case bt.airtable:return e?bt.test:bt.firebase;case bt.test:return e?bt.firebase:bt.airtable;default:return e?bt.airtable:bt.test}}}const st=new sv;class ov{constructor(){this.child_wrapperTypes_byType={},this.wrappers_byType_andHID={}}wrappers_byHID_forType(e){return this.wrappers_byType_andHID[e]}wrapper_forHID_andType(e,t){const r=this.wrappers_byHID_forType(t);return r?r[e]:null}wrapper_add(e){const t=this.wrappers_byType_andHID,r=t[e.type]??{},i=e.idHashed,s=e.type;r[i]=e,t[s]=r}addType_toParent(e,t){let r=this.child_wrapperTypes_byType[t]??[];r.includes(e)||(r.push(e),this.child_wrapperTypes_byType[t]=r)}addType_toHitHierarchy(e){for(const t of ar.parentTypes_for(e))this.addType_toParent(e,t),this.addType_toHitHierarchy(t)}add_toHitHierarchy(e){for(const t of e.parentTypes)this.addType_toParent(e.type,t),this.addType_toHitHierarchy(t)}respondTo_closure(e,t){const r=this.hitsFor(e,ht.app);for(const i of r)if(i.handle_event(e,t))return}hitsFor(e,t){const r=this.wrappers_byHID_forType(t);if(r){const i=Object.values(r);for(const s of i){const o=s.idHashed,a=get(s_hierarchy).ancestry_forHID(o),l=(a==null?void 0:a.title)??s.idHashed;if(ie.log_action(`hitsFor ${t} ${l}`),s.isHit(e)){if(this.hitsForChildTypesOf(e,t).length==0)return i;break}}}else return this.hitsForChildTypesOf(e,t);return[]}hitsForChildTypesOf(e,t){ie.log_action(`hitsForChildTypesOf ${t}`);let r=[];const i=this.child_wrapperTypes_byType[t]??[];for(const s of i)r=we.concatenateArrays(r,this.hitsFor(e,s));return r}}const pg=new ov;class av{constructor(e){this.ancestry_byKind_andHash={},this.predicate_byDirection={},this.traits_byOwnerHID={},this.relationship_byHID={},this.predicate_byKind={},this.things_byType={},this.traits_byType={},this.relationships_byParentHID={},this.relationships_byChildHID={},this.ancestry_byHID={},this.access_byKind={},this.access_byHID={},this.thing_byHID={},this.trait_byHID={},this.user_byHID={},this.ids_translated={},this.relationships=[],this.predicates=[],this.things=[],this.traits=[],this.fetching_dataTypes=[Ce.things,Ce.traits,Ce.predicates,Ce.relationships],this.saving_dataTypes=[Ce.relationships,Ce.things,Ce.traits,Ce.predicates],this.replace_rootID=I.empty,this.isAssembled=!1,this.grabs=new Mv,this.db=e,Oe.handle_rebuildGraph(0,t=>{var r;(r=t==null?void 0:t.thing)==null||r.oneAncestries_rebuildForSubtree()})}get hasNothing(){return!this.root}get idRoot(){return this.root.id??null}get depth(){let e=1;const t=Object.values(this.ancestry_byHID);for(const r of t){const i=r.depth;e<i&&(e=i)}return e}setup_root_andAncestry(){const e=this.ancestry_remember_createUnique();if(!e)alert("No root ancestry. Please, write me at sand@gizmolab.com");else{const t=se(At),r=e.thing;this.rootAncestry=e,r&&(this.root=r),(!t||t.length==0)&&e.grab()}}async handle_tool_clicked(e,t){const r=t.event,i=se(_t);if(i){switch(e){case te.more:ie.log_tools("needs more");break;case te.create:await this.ancestry_edit_persistentCreateChildOf(i);break;case te.next:this.ancestry_relayout_toolCluster_nextParent((r==null?void 0:r.altKey)??!1);return;case te.add_parent:this.toggleAlteration(pr.adding,t.isLong);return;case te.delete_confirm:await this.ancestries_rebuild_traverse_persistentDelete([i]);break;case te.delete_parent:this.toggleAlteration(pr.deleting,t.isLong);return}_t.set(null),Oe.signal_relayoutWidgets_fromFocus()}}async handle_key_down(e){var r;let t=this.grabs.latestAncestryGrabbed(!0);if(e.type=="keydown"&&!ae.isEditing_text){const i=e.altKey,s=e.shiftKey,o=e.metaKey,a=this.rootAncestry,l=s&&i,u=e.key.toLowerCase(),h=["alt","meta","shift","control"],f=new Date().getTime();let d=!1;if(!h.includes(u)){if(t||(t=a,d=a.becomeFocus()),ae.allow_GraphEditing){if(t&&ae.allow_TitleEditing)switch(u){case I.space:await this.ancestry_edit_persistentCreateChildOf(t);break;case"d":await this.thing_edit_persistentDuplicate(t);break;case"-":o||await this.thing_edit_persistentAddLine(t);break;case"tab":await this.ancestry_edit_persistentCreateChildOf(t.parentAncestry);break;case"enter":t.startEdit();break}switch(u){case"delete":case"backspace":await this.ancestries_rebuild_traverse_persistentDelete(se(At)),At.set([]);break}}if(t)switch(u){case"/":d=t.becomeFocus();break;case"arrowright":e.preventDefault(),await this.ancestry_rebuild_persistentMoveRight(t,t.isParental,s,i,l,!1);break;case"arrowleft":e.preventDefault(),await this.ancestry_rebuild_persistentMoveRight(t,!t.isParental,s,i,l,!1);break}switch(u){case"!":d=(r=this.rootAncestry)==null?void 0:r.becomeFocus();break;case"`":e.preventDefault(),this.latestAncestryGrabbed_toggleEditing_Tools();break;case"arrowup":await this.latestAncestryGrabbed_rebuild_persistentMoveUp_maybe(!0,s,i,l);break;case"arrowdown":await this.latestAncestryGrabbed_rebuild_persistentMoveUp_maybe(!1,s,i,l);break;case"escape":se(_t)&&this.clear_editingTools()}d&&Oe.signal_rebuildGraph_fromFocus();const p=(new Date().getTime()-f).toFixed(1);ie.log_key(`H  (${p}) ${u}`),setTimeout(async()=>{await this.db.persistAll()},1)}}}clear_editingTools(){Tn.set(null),_t.set(null)}get focus(){const e=se(lt);return e?e.thing:this.root}async latestAncestryGrabbed_rebuild_persistentMoveUp_maybe(e,t,r,i){const s=this.grabs.latestAncestryGrabbed(e);s&&this.ancestry_rebuild_persistentMoveUp_maybe(s,e,t,r,i)}latestAncestryGrabbed_toggleEditing_Tools(e=!0){const t=this.grabs.latestAncestryGrabbed(e);t&&!t.isRoot&&(_t.set(t.toolsGrabbed?null:t),Oe.signal_rebuildGraph_fromFocus())}thing_child_forRelationshipHID(e){if(e||e==0){const t=this.relationship_forHID(e);if(t)return this.thing_forHID(t.idChild.hash())}return this.root}things_refreshKnowns(){const e=this.things;this.things_forgetAll(),e.map(t=>this.thing_remember(t))}things_forgetAll(){this.things=[],this.thing_byHID={},this.things_byType={}}things_forAncestries(e){const t=Array();for(const r of e){const i=r==null?void 0:r.thing;i&&t.push(i)}return t}things_forAncestry(e){const t=e.kindPredicate==tt.contains;let r=t?[this.root]:[];const i=e.ids_hashed;if(!t||i.length!=0)for(const s of i){const o=this.relationship_forHID(s);o&&(r.length==0&&!t&&r.push(o.parent),r.push(o.child))}return we.strip_invalid(r)}thing_forHID(e){return this.thing_byHID[e??void 0]}thing_remember_updateID_to(e,t){this.relationships_translate_idsFromTo_forParents(e.id,t,!1),this.relationships_translate_idsFromTo_forParents(e.id,t,!0),this.thing_forget(e),e.setID(t),this.thing_remember(e)}thing_forget(e){const t=this.things_byType[e.type];delete this.thing_byHID[e.idHashed],this.things=we.strip_invalid(this.things),t&&(this.things_byType[e.type]=we.strip_invalid(t))}thing_remember_runtimeCreateUnique(e,t,r,i,s,o=!1){let a=this.thing_forHID((t==null?void 0:t.hash())??null);return a||(a=this.thing_remember_runtimeCreate(e,t,r,i,s,o)),a}async thing_remember_persistentRelocateChild(e,t,r){let i=this.relationship_whereID_isChild(e.id);i&&i.idParent==t.id&&(this.relationship_forget(i),i.idParent=r.id,this.relationship_remember(i),i.persist())}async thing_edit_persistentAddLine(e,t=!0){const r=e.parentAncestry,i=r==null?void 0:r.thing,s=e.thing;if(s&&i&&r){const o=e.order+(t?.5:-.5),a=this.thing_runtimeCreate(s.baseID,Mt.newID(),I.title_line,i.color,I.empty);await this.ancestry_edit_persistentAddAsChild(r,a,o,!1)}}thing_remember_runtimeCreate(e,t,r,i,s,o=!1,a=!1){const l=this.thing_runtimeCreate(e,t,r,i,s,o);return this.thing_remember(l),a&&l.set_isDirty(),l}async thing_remember_runtimeCopy(e,t){const r=new Ni(e,Mt.newID(),t.title,t.color,t.type);return[Ft.roots,Ft.root,Ft.bulk].includes(t.type)&&(r.type=I.empty),this.thing_remember(r),r}async thing_edit_persistentDuplicate(e){const t=e.thing,r=t==null?void 0:t.id,i=e.parentAncestry;if(t&&r&&i){const s=await this.thing_remember_runtimeCopy(r,t);s.title="idea",await this.ancestry_edit_persistentAddAsChild(i,s,e.order+.5)}}thing_remember(e){if(e&&!this.thing_forHID(e.idHashed)){this.thing_byHID[e.idHashed]=e;let t=this.things_byType[e.type]??[];t.map(r=>r.id).includes(e.id)||(t.push(e),this.things_byType[e.type]=t),this.things.map(r=>r.id).includes(e.id)||this.things.push(e),e.isRoot&&(!e.baseID||[I.empty,this.db.baseID].includes(this.db.baseID))&&(this.root=e)}}thing_runtimeCreate(e,t,r,i,s,o=!1){let a=null;if(t&&s==Ft.root&&e!=this.db.baseID)a=this.bulks_remember_rootID_ofThing(e,t,i);else if(a=new Ni(e,t,r,i,s,o),a.isBulkAlias&&(a.needsBulkFetch=!0,r.includes("@"))){const l=r.split("@");a.title=l[0],a.bulkRootID=l[1]}return a}thing_build_fromDict(e){const t=this.root;if(t&&this.replace_rootID==e.id&&!this.db.isRemote)t.title=e.title;else{let r=e.type;t&&!this.replace_rootID&&r==Ft.root&&(r=I.empty),this.thing_remember_runtimeCreateUnique(this.db.baseID,e.id,e.title,e.color,r)}}async thing_forget_persistentDelete(e){const t=we.uniquely_concatenateArrays(this.relationships_byChildHID[e.idHashed]??[],this.relationships_byParentHID[e.idHashed]??[]);this.thing_forget(e),await this.db.thing_persistentDelete(e);for(const r of e.ancestries)this.ancestry_forget(r);for(const r of e.traits)this.trait_forget(r),await this.db.trait_persistentDelete(r);for(const r of t)this.relationship_forget(r),await this.db.relationship_persistentDelete(r)}bulks_alias_forTitle_ofThing(e){if(e){for(const t of this.things_byType[Ft.bulk])if(t.title==e)return t}return null}bulks_remember_rootID_ofThing(e,t,r){const i=this.bulks_alias_forTitle_ofThing(e);return i&&(this.thing_byHID[t.hash()]=i,i.needsBulkFetch=!0,i.bulkRootID=t,i.color=r),i}async bulks_thing_remember_recursive_persistentRelocateRight(e,t){const r=t.thing;let i=null;const s=e.thing;if(s&&r){const o=r.isBulkAlias?r.title:r.baseID,a=await this.thing_remember_runtimeCopy(o,s);if(i=t.extend_withChild(a),i){await this.relationship_remember_persistent_addChild_toAncestry(a,t);for(const l of e.childAncestries)this.bulks_thing_remember_recursive_persistentRelocateRight(l,i);i.isExpanded||setTimeout(()=>{i&&(i.expand(),e.collapse())},2),await this.ancestry_forget_persistentUpdate(e)}}return i}traits_forOwnerHID(e){var r;const t=e?(r=this.traits_byOwnerHID)==null?void 0:r[e]:null;return t instanceof Array?t:null}traits_refreshKnowns(){const e=this.traits;this.traits_forgetAll(),e.map(t=>this.trait_remember(t))}traits_forgetAll(){this.traits_byOwnerHID={},this.traits_byType={},this.trait_byHID={},this.traits=[]}trait_forHID(e){return this.trait_byHID[e??void 0]}trait_runtimeCreate(e,t,r,i,s,o=!1){return new tc(e,t,r,i,s,o)}trait_remember_runtimeCreateUnique(e,t,r,i,s,o=!1){return this.trait_forHID(t==null?void 0:t.hash())??this.trait_remember_runtimeCreate(e,t,r,i,s,o)}trait_forType_ownerHID(e,t){var i;const r=(i=this.traits_forOwnerHID(t))==null?void 0:i.filter(s=>s.type==e);return r?r[0]:null}trait_build_fromDict(e){this.trait_remember_runtimeCreateUnique(this.db.baseID,e.id,e.ownerID,e.type,e.text)}trait_forget(e){delete this.trait_byHID[e.idHashed],delete this.traits_byOwnerHID[e.ownerID.hash()],this.traits=this.traits.filter(t=>t!==e),this.traits_byType[e.type]=this.traits_byType[e.type].filter(t=>t!==e)}trait_remember(e){const t=e.ownerID.hash();this.trait_byHID[e.idHashed]=e,(this.traits_byOwnerHID[t]=this.traits_byOwnerHID[t]||[]).push(e),(this.traits_byType[e.type]=this.traits_byType[e.type]||[]).push(e),this.traits.push(e)}trait_remember_runtimeCreate(e,t,r,i,s,o=!1){const a=this.trait_runtimeCreate(e,t,r,i,s,o);return this.trait_remember(a),a}trait_setText_forType_ownerHID(e,t,r){let i=this.trait_forType_ownerHID(t,r.hash());i?i.text=e:i=this.trait_remember_runtimeCreate(this.db.baseID,Mt.newID(),r,t,e),i.set_isDirty()}relationships_refreshKnowns(){const e=this.relationships;this.relationships_forgetAll(),e.map(t=>this.relationship_remember(t))}relationships_forgetAll(){this.relationships_byParentHID={},this.relationships_byChildHID={},this.relationship_byHID={},this.relationships=[]}relationships_forPredicateThingIsChild(e,t,r){const i=r?this.relationships_byChildHID:this.relationships_byParentHID,s=t.hash(),o=i[s],a=[];if(Array.isArray(o))for(const l of o)l.kindPredicate==e&&a.push(l);return a}async relationships_persistentCreateMissing(e){if(this.idRoot)for(const t of this.things){const r=t.id;t.type!=Ft.root&&t.baseID==e&&(this.relationship_whereID_isChild(r)||await this.relationship_remember_persistentCreateUnique(e,Mt.newID(),tt.contains,this.idRoot,r,0,Un.getPersistentID))}}async relationships_removeHavingNullReferences(){const e=Array();for(const t of this.relationships){let r=t.parent;(!t.child||!r)&&(r=t.parent,e.push(t))}for(;e.length>0;){const t=e.pop();t&&(await this.db.relationship_persistentDelete(t),this.relationship_forget(t))}}relationships_translate_idsFromTo_forParents(e,t,r){for(const i of this.predicates){const s=this.relationships_forPredicateThingIsChild(i.kind,e,r);for(const o of s)!r&&o.idParent!=t&&(this.relationship_forget(o),o.hidParent=t.hash(),o.isDirty=!0,o.idParent=t,this.relationship_remember(o)),r&&o.idChild!=t&&(this.relationship_forget(o),o.hidChild=t.hash(),o.isDirty=!0,o.idChild=t,this.relationship_remember(o))}}relationship_forHID(e){return this.relationship_byHID[e??void 0]}relationship_forget_forHID(e,t,r){let i=e[t]??[];we.remove(i,r),e[t]=i}relationship_forget(e){we.remove(this.relationships,e),delete this.relationship_byHID[e.idHashed],this.relationship_forget_forHID(this.relationships_byChildHID,e.idChild.hash(),e),this.relationship_forget_forHID(this.relationships_byParentHID,e.idParent.hash(),e)}relationship_whereID_isChild(e,t=!0){const r=this.relationships_forPredicateThingIsChild(tt.contains,e,t);return r.length>0?r[0]:null}relationship_build_fromDict(e){let t=e.idParent;t&&(t==e.idChild?console.log("preventing infinite recursion"):this.relationship_remember_runtimeCreateUnique(this.db.baseID,e.id,e.kindPredicate,t,e.idChild,e.order))}relationship_remember_byKnown(e,t,r){if(t||t==I.empty){const i=t.hash();let s=r[i]??[];s.map(o=>o.id).includes(e.id)||s.push(e),r[i]=s}}relationship_forPredicateKind_parent_child(e,t,r){const i=this.relationships_forPredicateThingIsChild(e,t,!1);if(Array.isArray(i)){for(const s of i)if(s.idChild==r)return s}return null}async relationship_remember_persistentCreateUnique(e,t,r,i,s,o,a=Un.isFromPersistent){let l=this.relationship_forPredicateKind_parent_child(r,i,s);return l?l.order_setTo_persistentMaybe(o,!0):(l=new vi(e,t,r,i,s,o,a==Un.isFromPersistent),await this.db.relationship_remember_persistentCreate(l)),l}relationship_remember(e){this.relationship_byHID[e.idHashed]||(this.relationships.map(t=>t.id).includes(e.id)||this.relationships.push(e),this.relationship_byHID[e.idHashed]=e,this.relationship_remember_byKnown(e,e.idChild,this.relationships_byChildHID),this.relationship_remember_byKnown(e,e.idParent,this.relationships_byParentHID),e.baseID!=this.db.baseID&&ie.log_error(`relationship crossing dbs: ${e.description}`))}async relationship_remember_persistent_addChild_toAncestry(e,t,r=tt.contains){const i=t.thing;if(e&&i&&!e.isBulkAlias){const o=i.isBulkAlias||e.baseID!=this.db.baseID?e.baseID:i.baseID;e.already_persisted||await this.db.thing_remember_persistentCreate(e);const a=await this.relationship_remember_persistentCreateUnique(o,Mt.newID(),r,i.idBridging,e.id,0,Un.getPersistentID),l=t.uniquelyAppendID(a.id);return we.ancestries_orders_normalize_persistentMaybe(t.childAncestries),l}}async relationship_forget_persistentDelete(e,t,r){const i=e.thing,s=e.parentAncestry,o=this.relationship_forPredicateKind_parent_child(r,t.idThing,e.idThing);s&&o&&((i==null?void 0:i.hasParents)??!1)&&(this.relationship_forget(o),t.hasChildRelationships?s.order_normalizeRecursive_persistentMaybe(!0):t.collapse(),await this.db.relationship_persistentDelete(o))}relationship_remember_runtimeCreateUnique(e,t,r,i,s,o,a=Un.none){var d;let l=this.relationship_forPredicateKind_parent_child(r,s,i),u=this.relationship_forPredicateKind_parent_child(r,i,s);const h=((d=this.predicate_forKind(r))==null?void 0:d.isBidirectional)??!1,f=a==Un.isFromPersistent;return u||(u=new vi(e,t,r,i,s,o,f),this.relationship_remember(u)),h&&!l&&(l=new vi(e,Mt.newID(),r,s,i,o,f),this.relationship_remember(l)),u==null||u.order_setTo_persistentMaybe(o),l==null||l.order_setTo_persistentMaybe(o),u}ancestries_forgetAll(){this.ancestry_byKind_andHash={},this.ancestry_byHID={}}async ancestries_rebuild_traverse_persistentDelete(e){if(se(lt)){for(const t of e){const r=t.thing,i=t.parentAncestry;if(i){const s=i.parentAncestry;if(r&&s&&!t.isEditing&&!r.isBulkAlias){const o=i.children;let a=o.indexOf(r);o.splice(a,1),i.grabOnly(),o.length==0&&(i.collapse(),s.isVisible||s.becomeFocus()),await t.traverse_async(async l=>(await this.ancestry_forget_persistentUpdate(l),!1))}}}Oe.signal_rebuildGraph_fromFocus()}}ancestry_forHID(e){return this.ancestry_byHID[e]??null}get ancestry_forBreadcrumbs(){const e=this.grabs.ancestry_lastGrabbed,t=se(lt),r=!!e&&t.isAProgenyOf(e);return e&&e.isVisible&&!r?e:t}async ancestry_forget_persistentUpdate(e){const t=e.thing;e.childAncestries.map(r=>this.ancestry_forget_persistentUpdate(r)),this.ancestry_forget(e),t&&await this.thing_forget_persistentDelete(t)}ancestry_forget(e){if(e){const t=e.idHashed;let r=this.ancestry_byKind_andHash[e.kindPredicate]??{};delete this.ancestry_byHID[t],delete r[t],this.ancestry_byKind_andHash[e.kindPredicate]=r}}ancestry_remember(e){const t=e.idHashed;let r=this.ancestry_byKind_andHash[e.kindPredicate]??{};this.ancestry_byHID[t]=e,r[t]=e,this.ancestry_byKind_andHash[e.kindPredicate]=r}async ancestry_edit_persistentCreateChildOf(e){const t=e==null?void 0:e.thing;if(t&&e){const r=await this.thing_remember_runtimeCopy(t.baseID,t);r.title="idea",e.expand(),await this.ancestry_edit_persistentAddAsChild(e,r,0)}}ancestry_relayout_toolCluster_nextParent(e=!1){const t=se(_t);if(t){let r=t;r.grabOnly(),Oe.signal_relayoutWidgets_fromFocus(),_t.set(r)}}async ancestry_edit_persistentAddAsChild(e,t,r,i=!0){var o;const s=await this.relationship_remember_persistent_addChild_toAncestry(t,e);s.grabOnly(),(o=s.relationship)==null||o.order_setTo_persistentMaybe(r),Oe.signal_rebuildGraph_fromFocus(),i&&setTimeout(()=>{s.startEdit()},20)}async ancestry_remember_bulk_persistentRelocateRight(e,t){const r=await this.bulks_thing_remember_recursive_persistentRelocateRight(e,t);r&&(t.signal_relayoutWidgets(),t.isExpanded?r.grabOnly():t.grabOnly())}ancestry_remember_createUnique(e=I.empty,t=tt.contains){const r=e.hash();let s=(this.ancestry_byKind_andHash[t]??{})[r];return s||(s=new mg(this.db.dbType,e,t),this.ancestry_remember(s)),s}async ancestry_roots(){let e=null;const t=this.rootAncestry;if(t){for(const i of this.things_byType[Ft.roots])if(i.title=="roots")return t.extend_withChild(i)??null;const r=this.thing_runtimeCreate(this.db.baseID,Mt.newID(),"roots","red",Ft.roots);await this.relationship_remember_persistent_addChild_toAncestry(r,t).then(i=>{e=i})}return e}async ancestry_redraw_persistentFetchBulk_browseRight(e,t=null,r=!1){if(this.rootsAncestry&&e&&e.title!="roots"){await this.db.fetch_hierarchy_from(e.title),this.relationships_refreshKnowns();const i=t==null?void 0:t.childAncestries;i&&i.length>0&&(r&&i[0].grabOnly(),t==null||t.expand(),Oe.signal_rebuildGraph_fromFocus())}}async ancestry_rebuild_persistentMoveRight(e,t,r,i,s,o){if(i){if(ae.allow_GraphEditing){const a=this.grabs.latestAncestryGrabbed(!0);a&&this.ancestry_rebuild_persistentRelocateRight(a,t,s)}}else{const a=e.thing;a&&(t&&a.needsBulkFetch?await this.ancestry_redraw_persistentFetchBulk_browseRight(a,e,!0):this.ancestry_rebuild_runtimeBrowseRight(e,t,r,s,o))}}ancestry_rebuild_persistentMoveUp_maybe(e,t,r,i,s){var a,l;const o=e.parentAncestry;if(o){let u=!1,h=!1;const f=o.children,d=f.length,p=e==null?void 0:e.thing;if(!f||d==0)this.ancestry_rebuild_runtimeBrowseRight(e,!0,s,t,!0);else if(p){const g=ae.showing_radial;if(!(((a=e.predicate)==null?void 0:a.isBidirectional)??!1)&&e.isParental||!g){const A=f.indexOf(p),S=A.increment(!t,d);if(o&&!i){const v=o.extend_withChild(f[S]);v&&(v.isVisible||(o.isFocus?g?u=v.assureIsVisible_inClusters():alert("PROGRAMMING ERROR: child of focus is not visible"):u=o.becomeFocus()),r?v.toggleGrab():v.grabOnly(),h=!0)}else if(ae.allow_GraphEditing&&i){u=!0,we.ancestries_orders_normalize_persistentMaybe(o.childAncestries,!1);const x=((t?A==0:A+1==d)==t?1:-1)*I.halfIncrement,E=S+x;(l=e.relationship)==null||l.order_setTo_persistentMaybe(E),we.ancestries_orders_normalize_persistentMaybe(o.childAncestries)}}u?Oe.signal_rebuildGraph_fromFocus():h&&Oe.signal_relayoutWidgets_fromFocus()}}}ancestry_rebuild_persistentRelocateRight(e,t,r){var a;const i=e.thing,s=t?e.ancestry_ofNextSibling(!1):e.stripBack(2),o=s==null?void 0:s.thing;if(i&&o&&s){if(i.isInDifferentBulkThan(o))this.ancestry_remember_bulk_persistentRelocateRight(e,s);else{const l=e.relationship;if(l){const u=t?l.order:0;l.idParent=o.id,l.order_setTo_persistentMaybe(u+.5,!0)}this.relationships_refreshKnowns(),(a=s.extend_withChild(i))==null||a.grabOnly(),this.rootAncestry.order_normalizeRecursive_persistentMaybe(!0),s.isExpanded||s.expand(),s.isVisible||s.becomeFocus()}Oe.signal_rebuildGraph_fromFocus()}}ancestry_rebuild_runtimeBrowseRight(e,t,r,i,s){const o=e.parentAncestry,a=e.extend_withChild(e.firstChild);let l=t?a:o;const u=!(l!=null&&l.isFocus);let h=!1;if(t)if(e.hasRelevantRelationships)r&&(l=null),h=e.expand(),se(vr)==kr.radial&&(h=e.becomeFocus()||h);else return;else{const f=this.rootAncestry;i?h=f==null?void 0:f.becomeFocus():r?l&&(e.isExpanded?(h=e.collapse(),l=this.grabs.areInvisible?e:null):(l.isExpanded||f&&!f.ancestry_hasEqualID(l))&&(h=l.collapse())):s?h=e.toggleExpanded():u&&l&&!l.isExpanded&&(h=l.expand())}if(mn.set(null),l&&(l.grabOnly(),!t&&o)){const f=o&&o.ancestry_hasEqualID(l),d=(!r||f)&&u,p=o.isRoot||!o.isVisible;d&&p&&o.becomeFocus()&&(h=!0)}h?Oe.signal_rebuildGraph_fromFocus():Oe.signal_relayoutWidgets_fromFocus()}predicate_forKind(e){return e?this.predicate_byKind[e]:null}predicates_byDirection(e){return this.predicate_byDirection[e?1:0]}predicates_forgetAll(){this.relationship_byHID={},this.predicates=[]}predicates_refreshKnowns(){const e=this.predicates;this.predicates_forgetAll(),e.map(t=>this.predicate_remember(t))}predicate_defaults_remember_runtimeCreate(){this.predicate_remember_runtimeCreateUnique(Xt.newID(),tt.explains,!1,!1),this.predicate_remember_runtimeCreateUnique(Xt.newID(),tt.contains,!1,!1),this.predicate_remember_runtimeCreateUnique(Xt.newID(),tt.requires,!1,!1),this.predicate_remember_runtimeCreateUnique(Xt.newID(),tt.supports,!1,!1),this.predicate_remember_runtimeCreateUnique(Xt.newID(),tt.isRelated,!0,!1),this.predicate_remember_runtimeCreateUnique(Xt.newID(),tt.appreciates,!1,!1)}kindPredicateFor_idRelationship(e){const t=this.relationship_forHID(e.hash());return(t==null?void 0:t.kindPredicate)??"bad kind: missing relationship"}predicate_build_fromDict(e){const t=this.predicate_remember_runtimeCreateUnique(e.id,e.kind,e.isBidirectional,!1);t.stateIndex=e.stateIndex}predicate_forget(e){let t=this.predicates_byDirection(e.isBidirectional)??[];we.remove(t,e),this.predicate_byDirection[e.isBidirectional?1:0]=t,we.remove(this.predicates,e),delete this.predicate_byKind[e.kind]}predicate_remember(e){this.predicate_byKind[e.kind]=e;let t=this.predicates_byDirection(e.isBidirectional)??[];this.predicates.map(r=>r.id).includes(e.id)||this.predicates.push(e),t.map(r=>r.id).includes(e.id)||(t.push(e),this.predicate_byDirection[e.isBidirectional?1:0]=t)}predicate_remember_runtimeCreateUnique(e,t,r,i=!0){let s=this.predicate_forKind(t);return s||(s=this.predicate_remember_runtimeCreate(e,t,r,i)),s}predicate_remember_runtimeCreate(e,t,r,i=!0){let s=new Xt(e,t,r,i);return this.predicate_remember(s),s}access_runtimeCreate(e,t){const r=new ec(this.db.dbType,e,t);this.access_byHID[e.hash()]=r,this.access_byKind[t]=r}user_runtimeCreate(e,t,r,i){const s=new nc(this.db.dbType,e,t,r,i);this.user_byHID[e.hash()]=s}select_file_toUpload(e){xn.set(Le.open),this.replace_rootID=e?I.empty:null}get data_toSave(){const e=this.user_selected_ancestry;return e.isRoot?this.all_data:this.progeny_dataFor(e)}save_toFile(){const e=this.data_toSave,t=`${e.title.toLowerCase()}.json`;zl.persist_json_object_toFile(e,t)}async fetch_fromFile(e){await zl.extract_json_object_fromFile(e,async t=>{const r=t;r&&await this.extract_hierarchy_from(r)})}get user_selected_ancestry(){const e=se(lt);let t=this.grabs.ancestry_lastGrabbed;return e&&ln.info_type==Kr.focus?e:t||e||this.rootAncestry}get all_data(){const e=this.root;let t={title:e.title,idRoot:e.id};for(const r of this.saving_dataTypes)switch(r){case Ce.things:t[r]=this.things;break;case Ce.traits:t[r]=this.traits;break;case Ce.predicates:t[r]=this.predicates;break;case Ce.relationships:t[r]=this.relationships;break}return t}progeny_dataFor(e){let t=!0;const r=e.thing;let i={id:(r==null?void 0:r.id)??I.empty,title:(r==null?void 0:r.title)??I.unknown},s=[],o=[],a=[];return i[Ce.predicates]=this.predicates,e.traverse(l=>{const u=l.thing,h=u==null?void 0:u.traits,f=l.relationship;return h&&(a=we.uniquely_concatenateArrays(a,h)),u&&o.filter(d=>d.id==u.id).length==0&&o.push(u),!t&&f&&s.filter(d=>d.id==f.id).length==0&&s.push(f),t=!1,!1}),i[Ce.relationships]=s,i[Ce.things]=o,i[Ce.traits]=a,i}restore_hierarchy(){nt.restore_focus(),nt.restore_grabbed_andExpanded(!0)}reset_hierarchy(){mn.set(null),_t.set(null),this.restore_hierarchy(),this.isAssembled=!0,this.db.hasData=!0}async conclude_fetch_andPersist(){await this.relationships_persistentCreateMissing(this.db.baseID),this.reset_hierarchy(),await this.db.persistAll(),D_.set(this.things.length)}async extract_hierarchy_from(e){e.hid&&(e.idRoot=e.hid),e.id&&(e.idRoot=e.id),this.replace_rootID!=null?(this.replace_rootID=e.idRoot,await this.rebuild_hierarchy_with(e)):await this.build_andAdd_progeny_with(e),Oe.signal_rebuildGraph_fromFocus()}async build_andAdd_progeny_with(e){for(const i of this.fetching_dataTypes)this.build_objects_fromArray_ofType(e[i],i);const t=this.thing_forHID(e.idRoot.hash()),r=this.user_selected_ancestry;await this.relationship_remember_persistent_addChild_toAncestry(t,r),await this.db.persistAll()}async rebuild_hierarchy_with(e){this.hierarchy_forgetAll_exceptPredicates(),this.thing_remember(this.root);for(const t of this.fetching_dataTypes)this.build_objects_fromArray_ofType(e[t],t);this.relationships_translate_idsFromTo_forParents(e.idRoot,this.idRoot,!1),await this.conclude_fetch_andPersist()}build_objects_fromArray_ofType(e,t){for(const r of e)switch(t){case Ce.things:this.thing_build_fromDict(r);break;case Ce.traits:this.trait_build_fromDict(r);break;case Ce.predicates:this.predicate_build_fromDict(r);break;case Ce.relationships:this.relationship_build_fromDict(r);break}}hierarchy_forgetAll_exceptPredicates(){this.things_forgetAll(),this.traits_forgetAll(),this.ancestries_forgetAll(),this.relationships_forgetAll()}hierarchy_forgetAll(){this.things_forgetAll(),this.traits_forgetAll(),this.predicates_forgetAll(),this.ancestries_forgetAll(),this.relationships_forgetAll()}hierarchy_refreshKnowns(){this.ancestries_forgetAll(),this.things_refreshKnowns(),this.traits_refreshKnowns(),this.predicates_refreshKnowns(),this.relationships_refreshKnowns()}toggleAlteration(e,t){var o;const r=(o=se(Tn))==null?void 0:o.type,i=t?Xt.isRelated:Xt.contains,s=e==r?null:new Sv(e,i);s?ie.log_tools(`needs ${e} ${i==null?void 0:i.kind} alteration`):ie.log_tools(`end ${e} alteration`),Tn.set(s)}}var yt=(n=>(n.hide_radial="hide_radial",n.reticule="reticule",n.segments="segments",n.origins="origins",n.persist="persist",n.rebuild="rebuild",n.action="action",n.colors="colors",n.cursor="cursor",n.crumbs="crumbs",n.layout="layout",n.radial="radial",n.remote="remote",n.things="things",n.signal="signal",n.build="build",n.error="error",n.graph="graph",n.lines="lines",n.mount="mount",n.mouse="mouse",n.hover="hover",n.order="order",n.tools="tools",n.edit="edit",n.info="info",n.key="key",n))(yt||{});let lv=class{constructor(e){this.flags=e}hasOption(e){return this.flags.includes(e)}log_key(e){this.log_maybe("key",e)}log_edit(e){this.log_maybe("edit",e)}log_build(e){this.log_maybe("build",e)}log_error(e){this.log_maybe("error",e)}log_hover(e){this.log_maybe("hover",e)}log_mount(e){this.log_maybe("mount",e)}log_mouse(e){this.log_maybe("mouse",e)}log_tools(e){this.log_maybe("tools",e)}log_action(e){this.log_maybe("action",e)}log_crumbs(e){this.log_maybe("crumbs",e)}log_cursor(e){this.log_maybe("cursor",e)}log_layout(e){this.log_maybe("layout",e)}log_radial(e){this.log_maybe("radial",e)}log_remote(e){this.log_maybe("remote",e)}log_signal(e){this.log_maybe("signal",e)}log_origins(e){this.log_maybe("origins",e)}log_persist(e){this.log_maybe("persist",e)}log_rebuild(e){this.log_maybe("rebuild",e)}log_segments(e){this.log_maybe("segments",e)}log_target(e,t){console.log(`Method '${t}' is called on class '${e.constructor.name}'`)}log_maybe(e,t){this.hasOption(e)&&console.log(e.toUpperCase(),t)}get hide_radial(){return this.hasOption("hide_radial")}get reticule(){return this.hasOption("reticule")}get cursor(){return this.hasOption("cursor")}get graph(){return this.hasOption("graph")}get lines(){return this.hasOption("lines")}get radial(){return this.hasOption("radial")}get tools(){return this.hasOption("tools")}get info(){return this.hasOption("info")}queryStradial_apply(){const e=ae.queryStradial.get("debug");if(e){const t=e.split(",");for(const r of t)switch(r){case"hide_radial":this.flags.push("hide_radial");break;case"reticule":this.flags.push("reticule");break;case"segments":this.flags.push("segments");break;case"origins":this.flags.push("origins");break;case"persist":this.flags.push("persist");break;case"rebuild":this.flags.push("rebuild");break;case"action":this.flags.push("action");break;case"colors":this.flags.push("colors");break;case"crumbs":this.flags.push("crumbs");break;case"cursor":this.flags.push("cursor");break;case"layout":this.flags.push("layout");break;case"radial":this.flags.push("radial");break;case"remote":this.flags.push("remote");break;case"signal":this.flags.push("signal");break;case"things":this.flags.push("things");break;case"build":this.flags.push("build");break;case"error":this.flags.push("error");break;case"graph":this.flags.push("graph");break;case"hover":this.flags.push("hover");break;case"lines":this.flags.push("lines");break;case"mount":this.flags.push("mount");break;case"mouse":this.flags.push("mouse");break;case"order":this.flags.push("order");break;case"tools":this.flags.push("tools");break;case"edit":this.flags.push("edit");break;case"info":this.flags.push("info");break;case"key":this.flags.push("key");break}}}};const ie=new lv([]);class au{constructor(e,t){this.start=e,this.end=t}}var lu=(n=>(n.double="double",n.long="long",n))(lu||{});class uv{get hasTimer(){return!!this.mouse_doubleClick_timer||!!this.mouse_longClick_timer}reset(){this.mouse_doubleClick_timer&&(clearTimeout(this.mouse_doubleClick_timer),this.mouse_doubleClick_timer=null),this.mouse_longClick_timer&&(clearTimeout(this.mouse_longClick_timer),this.mouse_longClick_timer=null)}setTimeout(e,t,r){e=="long"&&!this.mouse_longClick_timer?setTimeout(()=>{t()},I.threshold_longClick):e=="double"&&!this.mouse_doubleClick_timer&&setTimeout(()=>{t()},I.threshold_doubleClick)}}var gg={},Rr={};Object.defineProperty(Rr,"__esModule",{value:!0});Rr.Collector=void 0;class cv{constructor(e){this.emit=(...t)=>{e.emitCollecting(this,t)}}}Rr.Collector=cv;var Ma={};Object.defineProperty(Ma,"__esModule",{value:!0});Ma.CollectorArray=void 0;const hv=Rr;class fv extends hv.Collector{constructor(){super(...arguments),this.result=[]}handleResult(e){return this.result.push(e),!0}getResult(){return this.result}reset(){this.result.length=0}}Ma.CollectorArray=fv;var xa={};Object.defineProperty(xa,"__esModule",{value:!0});xa.CollectorLast=void 0;const dv=Rr;class _v extends dv.Collector{handleResult(e){return this.result=e,!0}getResult(){return this.result}reset(){delete this.result}}xa.CollectorLast=_v;var La={};Object.defineProperty(La,"__esModule",{value:!0});La.CollectorUntil0=void 0;const pv=Rr;class gv extends pv.Collector{constructor(){super(...arguments),this.result=!1}handleResult(e){return this.result=e,this.result}getResult(){return this.result}reset(){this.result=!1}}La.CollectorUntil0=gv;var za={};Object.defineProperty(za,"__esModule",{value:!0});za.CollectorWhile0=void 0;const mv=Rr;class yv extends mv.Collector{constructor(){super(...arguments),this.result=!1}handleResult(e){return this.result=e,!this.result}getResult(){return this.result}reset(){this.result=!1}}za.CollectorWhile0=yv;var Fa={},Ba={};Object.defineProperty(Ba,"__esModule",{value:!0});Ba.SignalConnectionImpl=void 0;class bv{constructor(e,t){this.link=e,this.parentCleanup=t}disconnect(){return this.link!==null?(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0):!1}set enabled(e){this.link&&this.link.setEnabled(e)}get enabled(){return this.link!==null&&this.link.isEnabled()}}Ba.SignalConnectionImpl=bv;var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});Ua.SignalLink=void 0;class $u{constructor(e=null,t=null,r=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=e??this,this.next=t??this,this.order=r}isEnabled(){return this.enabled&&!this.newLink}setEnabled(e){this.enabled=e}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(e,t){let r=this.prev;for(;r!==this&&!(r.order<=t);)r=r.prev;const i=new $u(r,r.next,t);return i.callback=e,r.next=i,i.next.prev=i,i}}Ua.SignalLink=$u;Object.defineProperty(Fa,"__esModule",{value:!0});Fa.Signal=void 0;const wv=Ba,vv=Ua;class kv{constructor(){this.head=new vv.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(e,t=0){this.connectionsCount++;const r=this.head.insert(e,t);return this.emitDepth>0&&(this.hasNewLinks=!0,r.newLink=!0),new wv.SignalConnectionImpl(r,()=>this.decrementConnectionCount())}decrementConnectionCount(){this.connectionsCount--}disconnect(e){for(let t=this.head.next;t!==this.head;t=t.next)if(t.callback===e)return this.decrementConnectionCount(),t.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...e){this.emitDepth++;for(let t=this.head.next;t!==this.head;t=t.next)t.isEnabled()&&t.callback&&t.callback.apply(null,e);this.emitDepth--,this.unsetNewLink()}emitCollecting(e,t){this.emitDepth++;for(let r=this.head.next;r!==this.head;r=r.next)if(r.isEnabled()&&r.callback){const i=r.callback.apply(null,t);if(!e.handleResult(i))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let e=this.head.next;e!==this.head;e=e.next)e.newLink=!1;this.hasNewLinks=!1}}}Fa.Signal=kv;var ja={};Object.defineProperty(ja,"__esModule",{value:!0});ja.SignalConnections=void 0;class Tv{constructor(){this.list=[]}add(e){this.list.push(e)}disconnectAll(){for(const e of this.list)e.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}}ja.SignalConnections=Tv;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SignalConnections=n.Signal=n.CollectorWhile0=n.CollectorUntil0=n.CollectorLast=n.CollectorArray=n.Collector=void 0;var e=Rr;Object.defineProperty(n,"Collector",{enumerable:!0,get:function(){return e.Collector}});var t=Ma;Object.defineProperty(n,"CollectorArray",{enumerable:!0,get:function(){return t.CollectorArray}});var r=xa;Object.defineProperty(n,"CollectorLast",{enumerable:!0,get:function(){return r.CollectorLast}});var i=La;Object.defineProperty(n,"CollectorUntil0",{enumerable:!0,get:function(){return i.CollectorUntil0}});var s=za;Object.defineProperty(n,"CollectorWhile0",{enumerable:!0,get:function(){return s.CollectorWhile0}});var o=Fa;Object.defineProperty(n,"Signal",{enumerable:!0,get:function(){return o.Signal}});var a=ja;Object.defineProperty(n,"SignalConnections",{enumerable:!0,get:function(){return a.SignalConnections}})})(gg);class Ev{constructor(){this.signal_isInFlight=!1,this.highestPriorities={},this.handler=new gg.Signal}signal_altering(e=null){this.signal("alterState",e)}signal_rebuildGraph_fromFocus(){this.signal_rebuildGraph(se(lt))}signal_relayoutWidgets(e=null){this.signal("relayout",e)}signal_relayoutWidgets_fromFocus(){this.signal_relayoutWidgets(se(lt))}handle_rebuildGraph(e,t){return this.handle_signalOfKind(e,"rebuild",t)}handle_relayoutWidgets(e,t){return this.handle_signalOfKind(e,"relayout",t)}handle_altering(e){return this.handle_signalOfKind(0,"alterState",e)}handle_anySignal(e){return this.handler.connect((t,r)=>{e(t,r)})}handle_signalOfKind(e,t,r){const i=this.highestPriorities[t];return(!i||e>i)&&(this.highestPriorities[t]=e),this.handler.connect((s,o,a)=>{s.includes(t)&&a==e&&r(o)})}signal(e,t=null){if(this.signal_isInFlight)ie.log_signal(`${e} in flight`);else if(!se(dl)||e!="relayout"){this.signal_isInFlight=!0;const r=this.highestPriorities[e]??0;for(let i=0;i<=r;i++)ie.log_signal(`${e}`),this.handler.emit([e],t,i);this.signal_isInFlight=!1}}signal_rebuildGraph(e=null){dl.set(!0),this.signal("rebuild",e),dl.set(!1)}}const Oe=new Ev;var rn=(n=>(n[n.up=$e.three_quarters]="up",n[n.down=$e.quarter]="down",n[n.right=$e.half]="right",n[n.left=$e.zero]="left",n))(rn||{});class Av{line_connecting(e,t){return`M ${e.x} ${e.y} L ${t.x} ${t.y}`}line_atAngle(e,t,r){return this.line_connecting(e,G.fromPolar(t,r).offsetBy(e))}dash(e,t){const r=e/2;return`M${t} ${r} L${e-t} ${r}`}x_cross(e,t){const r=t+2,i=e-r;return`M ${r} ${r} L ${i} ${i} M ${r} ${i} L ${i} ${r}`}t_cross(e,t){const r=e/2,i=(r-t)*2;return`M ${t+2} ${r} L ${i+1} ${r} M ${r} ${t+2} L ${r} ${e-t-2}`}circle_atOffset(e,t,r=G.zero){const i=r.offsetEquallyBy(e/2);return this.circle(i,t/2)}circle(e,t,r=!0){const i=r?0:1,s=t*2*(r?1:-1);return`M${e.x-t} ${e.y} a ${t} ${t} 0 0 ${i} ${s} 0 a ${t} ${t} 0 0 ${i} ${-s} 0`}annulus(e,t,r,i=G.zero){const s=e.offsetBy(i),o=s.offsetByX(e.x*2);return`${this.circle(s,t,!0)} ${this.circle(o,t-r,!1)}`}oval(e,t=!0,r=2.3){const i=e/2,s=i-(t?1:r),o=i-(t?r:1),a=s*2;return`M${i-s} ${i} a ${s} ${o} 0 1 0 ${a} 0 a ${s} ${o} 0 1 0 ${-a} 0`}arc(e,t,r,i,s){const o=e.offsetBy(G.fromPolar(t,s)),a=e.offsetBy(G.fromPolar(t,i)),l=(i-s).angle_normalized()>Math.PI?1:0;return`
M ${a.x} ${a.y} 
A ${t} ${t} 0 ${l} ${r} 
${o.x} ${o.y}`}arrow_head(e,t,r=5){return""}arrowed_arc(e,t,r,i=32){return this.arc(e,t,1,0,0)}arrowed_line(e,t=32){return""}arc_partial(e,t,r,i,s){const o=e.offsetBy(G.fromPolar(t,s));return`
A ${t} ${t} 0 ${r} ${i} 
${o.x} ${o.y}`}startOutAt(e,t,r){const i=e.offsetBy(G.fromPolar(t,r));return`
M ${i.x} ${i.y}`}half_circle(e,t){const r=[rn.up,rn.down].includes(t),i=e/2;if(r){const s=t==rn.up;return`M ${s?0:e} ${i}
				A ${i} ${i} 0 0 1 ${i+(s?i:-i)} ${i}`}else{const s=t==rn.right;return`M ${i} ${s?0:e}
				A ${i} ${i} 0 0 1 ${i} ${s?i*2:0}`}}line(e,t=G.zero){const r=e.x+t.x,i=e.y+t.y;return r>=0&&i>=0?`M ${t.x} ${t.y} L ${r} ${i}`:r>=0&&i<0?`M ${t.x} ${-i} L ${r} ${t.y}`:r<0&&i>=0?`M ${-r} ${t.y} L ${t.x} ${i}`:`M ${-r} ${-i} L ${t.x} ${t.y}`}polygon(e,t,r=3,i){const s=we.polygonPoints(e,r,t),o=G.square(e);let a=r,l="M ";for(;a>0;)if(a--,!i.includes(a)){const u=a==0?I.empty:" L ",h=o.offsetBy(s[a]);l=l+`${h.x} ${h.y}${u}`}return l+" Z"}tinyDots_circular(e,t){if(t==0)return I.empty;let r=0,i=I.empty;const s=e/3,o=t%2!=0,a=Math.PI*2/t;let l=new G(o?s:0,o?0:s);for(;r++<t;)i=i+this.circle_atOffset(e,2,l.offsetByXY(-.7,.3)),l=l.rotate_by(a);return i}oblong(e,t,r=on.full){const i=[on.full,on.right].includes(r),s=[on.full,on.left].includes(r),o=t.height/2,a=t.width/2,l=e.x,u=e.y,h=l-a+(s?0:o),f=l+a+(i?0:o),d=u-o,p=u+o,g=`${h}, ${d}`,b=`${f}, ${d}`,A=`${f}, ${p}`,S=`${h}, ${p}`,v=`${o}, ${o} 0 0 1`;switch(r){case on.middle:return`M ${g} L ${b} L ${A} L ${S} L ${g} Z`;case on.right:return`M ${g} L ${b} A ${v} ${A} L ${S} L ${g} Z`;case on.left:return`M ${g} L ${b} L ${A} L ${S} A ${v} ${g} Z`;case on.full:return`M ${g} L ${b} A ${v} ${A} L ${S} A ${v} ${g} Z`}}ellipses(e,t,r=!0,i=3,s=6){const o=Math.min(4,i),a=e/(o-1)-t;let l=2.5+(o>2?0:.5),u=0,h=[];const f=[[l]];for(;u<o;){const d=l+t*2;f[u][1]=d,u+1<o&&(l=d+a-t/o,f[u+1]=[l]),u++}return r?h=f.map(d=>`M ${d[0]} ${s} A ${t} ${t} 0 1 1 ${d[1]} ${s} A ${t} ${t} 0 1 1 ${d[0]} ${s}`):h=f.map(d=>`M ${s} ${d[0]} A ${t} ${t} 0 1 1 ${s} ${d[1]} A ${t} ${t} 0 1 1 ${s} ${d[0]}`),h.join(I.space)}fat_polygon(e,t,r=3){const i=Math.PI/r,s=G.square(e/2),o=G.x(e/3),a=G.x(e/2),l=i/5;let u=[],h=0;for(;h++<r;){const p=t+h*i*2,g=p-i,b=g-l,A=g+l;u.push({controlOne:a.rotate_by(b).offsetBy(s),controlTwo:a.rotate_by(A).offsetBy(s),end:o.rotate_by(p).offsetBy(s)})}const f=u[r-1].end,d=u.map(p=>`C${p.controlOne.description} ${p.controlTwo.description} ${p.end.description}`);return"M"+f.description+I.comma+d.join(I.space)+"Z"}get rotateSVG(){return`<svg class='rotate-svg' width="48px" height="48px" viewBox="0 0 48 48">
			<circle cx="24" cy="24" r="20" stroke="black" stroke-width="2" fill="none" />
			<path class='rotate-path' d="M 4 24 a 20 20 0 0 1 40 0" fill="none" stroke="black" stroke-width="2"/>
			<polygon points="44 24 38 18 38 30" fill="black"/>
		</svg>`}get hammer(){return"M4 12			C4 7.58172 7.58172 4 12 4			C12.5523 4 13 3.55228 13 3			C13 2.44772 12.5523 2 12 2			C6.47715 2 2 6.47715 2 12			C2 17.5228 6.47715 22 12 22			C14.7611 22 17.2625 20.8796 19.0711 19.0711			C19.4616 18.6805 19.4616 18.0474 19.0711 17.6569			C18.6805 17.2663 18.0474 17.2663 17.6569 17.6569			C16.208 19.1057 14.2094 20 12 20			C7.58172 20 4 16.4183 4 12Z			M13 6			C13 5.44772 12.5523 5 12 5			C11.4477 5 11 5.44772 11 6V12			C11 12.2652 11.1054 12.5196 11.2929 12.7071			L14.2929 15.7071			C14.6834 16.0976 15.3166 16.0976 15.7071 15.7071			C16.0976 15.3166 16.0976 14.6834 15.7071 14.2929			L13 11.5858V6			Z			M21.7483 15.1674			C21.535 15.824 20.8298 16.1833 20.1732 15.97			C19.5167 15.7566 19.1574 15.0514 19.3707 14.3949			C19.584 13.7383 20.2892 13.379 20.9458 13.5923			C21.6023 13.8057 21.9617 14.5108 21.7483 15.1674Z			M21.0847 11.8267			C21.7666 11.7187 22.2318 11.0784 22.1238 10.3966			C22.0158 9.71471 21.3755 9.2495 20.6937 9.3575			C20.0118 9.46549 19.5466 10.1058 19.6546 10.7877			C19.7626 11.4695 20.4029 11.9347 21.0847 11.8267Z			M20.2924 5.97522			C20.6982 6.53373 20.5744 7.31544 20.0159 7.72122			C19.4574 8.127 18.6757 8.00319 18.2699 7.44468			C17.8641 6.88617 17.9879 6.10446 18.5464 5.69868			C19.1049 5.2929 19.8867 5.41671 20.2924 5.97522Z			M17.1997 4.54844			C17.5131 3.93333 17.2685 3.18061 16.6534 2.86719			C16.0383 2.55378 15.2856 2.79835 14.9722 3.41346			C14.6588 4.02858 14.9033 4.78129 15.5185 5.09471			C16.1336 5.40812 16.8863 5.16355 17.1997 4.54844			Z"}}const ze=new Av;class qa{constructor(e=0,t=0,r=0){this.toChildren=!1,this.thing_id=I.empty,this.widgets_shown=0,this.total_widgets=0,this.kind=I.empty,this.index=0,this.index=e.force_between(0,r-t),this.total_widgets=r,this.widgets_shown=t}static create_paging_state_from(e){let t=e.split(I.generic_separator);const[r,i,s,...o]=t;if(o.length>2){const a=o.map(u=>Number(u)),l=new qa(a[0],a[1],a[2]);return l.toChildren=r=="true",l.thing_id=s,l.kind=i,l}return null}get stateIndex(){var e;return((e=this.predicate)==null?void 0:e.stateIndex)??-1}get isPaging(){return this.widgets_shown<this.total_widgets}get indexOf_followingPage(){return this.index+this.widgets_shown}get maximum_paging_index(){return this.total_widgets-this.widgets_shown}get thing(){return se(Fe).thing_forHID(this.thing_id.hash())??null}get predicate(){return se(Fe).predicate_forKind(this.kind)??null}get canShow(){return Math.round(se(yn)**1.5*Math.PI/45/I.row_height)+1}get sub_key(){return`${this.thing_id}${I.generic_separator}${this.kind}${I.generic_separator}${this.toChildren}`}get description(){return[`${this.toChildren}`,`${this.kind}`,`${this.thing_id}`,`${this.index}`,`${this.widgets_shown}`,`${this.total_widgets}`].join(I.generic_separator)}index_isVisible(e){return e.isBetween(this.index,this.indexOf_followingPage-1,!0)}addTo_paging_index_for(e){return e==0?!1:this.update_index_toShow(this.index+e)}update_index_toShow(e){const t=this.index;return e==this.indexOf_followingPage?this.index=(this.index+1).force_between(0,this.maximum_paging_index):this.index=e.force_between(0,this.maximum_paging_index),this.index!=t}onePage_from(e){this.total_widgets=e.length,this.widgets_shown=Math.min(this.canShow,this.total_widgets),this.update_index_toShow(this.index)&&ma.set(this);const t=Math.round(this.index);return e.slice(t,t+this.widgets_shown)}}class Iv{constructor(e=I.empty){this.outward_paging_states=[],this.inward_paging_states=[],this.thing_id=I.empty,this.thing_id=e}get thing(){return se(Fe).thing_forHID(this.thing_id.hash())??null}get description(){return this.description_for(!0)+I.big_separator+this.description_for(!1)}paging_state_for(e){return this.paging_state_forPointsOut(e.toChildren,e.predicate)}paging_states_for(e){return e?this.outward_paging_states:this.inward_paging_states}add_paging_state(e){const t=this.paging_states_for(e.toChildren);t[e.stateIndex]=e}description_for(e){const t=this.paging_states_for(e);let r,i=I.empty;for(const s of t)i=i+r+s.description,r=I.small_separator;return i}paging_state_forPointsOut(e,t){let r=this.paging_states_for(e);const i=t.stateIndex;let s=r[i];return s||(s=new qa,s.kind=t.kind,s.toChildren=e,s.thing_id=this.thing_id,r[i]=s),s}}var it=(n=>(n.relationships="relationships",n.details_type="details_type",n.ring_radius="ring_radius",n.page_states="page_states",n.user_offset="user_offset",n.graph_type="graph_type",n.ring_angle="ring_angle",n.arrowheads="arrowheads",n.tree_type="tree_type",n.info_type="info_type",n.font_size="font_size",n.tiny_dots="tiny_dots",n.expanded="expanded",n.grabbed="grabbed",n.details="details",n.base_id="base_id",n.traits="traits",n.scale="scale",n.focus="focus",n.local="local",n.info="info",n.font="font",n.db="db",n))(it||{});class Cv{constructor(){this.usesRelationships=localStorage.relationships,this.ignoreAncestries=!this.usesRelationships||this.usesRelationships=="undefined"}read_key(e){return this.parse(localStorage[e])}write_key(e,t){localStorage[e]=JSON.stringify(t)}writeDB_key(e,t){this.write_key(this.dbKey_for(e),t)}readDB_key(e){return this.read_key(this.dbKey_for(e))}dbKey_for(e){return this.keyPair_for(st.db.dbType,e)}delete_paging_state_for(e){this.write_keyPair(this.dbKey_for("page_states"),e,null)}keyPair_for(e,t){return`${e}${I.generic_separator}${t}`}reset(){const e=Object.keys(it).filter(t=>isNaN(Number(t))).map(t=>it[t]);for(const t of e)t!="local"&&this.write_key(t,null)}parse(e){return!e||e=="undefined"?null:JSON.parse(e)}write_keyPair(e,t,r){const i=this.read_key(e)??[],s=this.keyPair_for(e,t);this.write_key(s,r),(i.length==0||!i.includes(t))&&(i.push(t),this.write_key(e,i))}delete_sub_keys_forKey(e){const t=this.read_key(e)??[];this.write_key(e,null);for(const r of t){const i=this.keyPair_for(e,r);this.write_key(i,null)}}read_sub_keys_forKey(e){let t=[];const r=this.read_key(e)??[];for(const i of r){const s=this.read_key(this.keyPair_for(e,i));s&&t.push(s)}return t}ancestry_forID(e){const t=se(Fe),i=e.split(I.generic_separator).slice(-1)[0],s=t.kindPredicateFor_idRelationship(i);return t.ancestry_remember_createUnique(e,s)}ancestries_forKey(e){const t=this.read_key(e),r=(t==null?void 0:t.length)??0;if(!this.ignoreAncestries&&r>0){let i=[];for(const s of t)i.push(this.ancestry_forID(s));return i}return[]}reactivity_subscribe(){yn.subscribe(e=>{this.write_key("ring_radius",e)}),Ei.subscribe(e=>{this.write_key("tree_type",e)}),vr.subscribe(e=>{this.write_key("graph_type",e)}),Ho.subscribe(e=>{this.write_key("details_type",e)}),ks.subscribe(e=>{this.write_key("ring_angle",e)}),ma.subscribe(e=>{if(e){const t=this.dbKey_for("page_states");this.write_keyPair(t,e.sub_key,e.description)}}),ln.reactivity_subscribe()}restore_defaults(){this.ignoreAncestries&&this.write_key("relationships",!0),Km.set(this.read_key("font_size")??14),ks.set(this.read_key("ring_angle")??0),vr.set(this.read_key("graph_type")??kr.tree),Ei.set(this.read_key("tree_type")??yi.children),zn.set(this.read_key("font")??"Times New Roman"),Ho.set(this.read_key("details_type")??[Ue.storage]),yn.set(Math.max(this.read_key("ring_radius")??0,I.innermost_ring_radius)),this.reactivity_subscribe()}restore_page_states(){const e=this.read_sub_keys_forKey(this.dbKey_for("page_states"))??I.empty;for(const t of e){const r=qa.create_paging_state_from(t);if(r){const i=r==null?void 0:r.thing;i?i.page_states.add_paging_state(r):nt.delete_paging_state_for(r.sub_key)}}}restore_grabbed_andExpanded(e=!1){const r=[se(Fe).rootAncestry],i=st.eraseDB,s=i?[]:this.ancestries_forKey(this.dbKey_for("expanded")),o=i?r:this.ancestries_forKey(this.dbKey_for("grabbed"))??r;At.set(o),ie.log_persist(`^ GRABBED ${o.map(a=>a.title)}`),Gr.set(s),ie.log_persist(`^ EXPANDED ${s.map(a=>a.title)}`),setTimeout(()=>{At.subscribe(a=>{ie.log_persist(`  GRABBED ${a.map(l=>l.title)}`),this.writeDB_key("grabbed",a?a.map(l=>l.id):null)}),Gr.subscribe(a=>{ie.log_persist(`  EXPANDED ${a.map(l=>l.title)}`),this.writeDB_key("expanded",a?a.map(l=>l.id):null)})},100)}restore_focus(){var r;const e=se(Fe);e.setup_root_andAncestry();let t=e.rootAncestry;if(!this.ignoreAncestries&&!st.eraseDB){const i=this.readDB_key("focus");if(i||i==I.empty){const s=e.ancestry_remember_createUnique(i);s&&(t=s)}}if(!t.thing){const i=(r=e.grabs.ancestry_lastGrabbed)==null?void 0:r.parentAncestry;i&&(t=i)}t.becomeFocus(!0),lt.subscribe(i=>{this.writeDB_key("focus",i?i.id:null)})}}const nt=new Cv;class mg extends Mt{constructor(e,t=I.empty,r=tt.contains,i=!0){super(t),this._thing=null,this.isParental=!0,this.isRoot=!1,this.dbType=e,this.isParental=i,this.kindPredicate=r}destroy(){this.unsubscribe(),this._thing=null}signal_rebuildGraph(){Oe.signal_rebuildGraph(this)}signal_relayoutWidgets(){Oe.signal_relayoutWidgets(this)}get hasChildRelationships(){return this.childRelationships.length>0}get hasParentRelationships(){return this.parentRelationships.length>0}get isFocus(){return this.matchesStore(lt)}get toolsGrabbed(){return this.matchesStore(_t)}get showsChildRelationships(){return this.isExpanded&&this.hasChildRelationships}get isEditing(){var e;return this.ancestry_hasEqualID((e=se(mn))==null?void 0:e.editing)}get isStoppingEdit(){var e;return this.ancestry_hasEqualID((e=se(mn))==null?void 0:e.stopping)}get isGrabbed(){return this.includedInStore_ofAncestries(At)}get isInvalid(){return this.containsReciprocals||this.containsMixedPredicates}get hasRelationships(){return this.hasParentRelationships||this.hasChildRelationships}get isExpanded(){return this.isRoot||this.includedInStore_ofAncestries(Gr)}get hasRelevantRelationships(){return this.isParental?this.hasChildRelationships:this.hasParentRelationships}get endID(){return this.idAt()}get title(){var e;return((e=this.thing)==null?void 0:e.title)??"missing title"}get description(){return`${this.kindPredicate} ${this.titles.join(":")}`}get depth(){return this.ids.length+1}get order(){var e;return((e=this.relationship)==null?void 0:e.order)??-1}get visibleProgeny_halfHeight(){return this.visibleProgeny_height()/2}get siblingIndex(){return this.siblingAncestries.map(e=>e.id).indexOf(this.id)}get visibleProgeny_halfSize(){return this.visibleProgeny_size.dividedInHalf}get visibleProgeny_size(){return new Xe(this.visibleProgeny_width(),this.visibleProgeny_height())}get firstChild(){return this.children[0]}get lastChild(){return this.children.slice(-1)[0]}get hierarchy(){return se(Fe)}get titleRect(){return this.rect_ofWrapper(this.titleWrapper)}get idBridging(){var e;return((e=this.thing)==null?void 0:e.idBridging)??null}get parentAncestry(){return this.stripBack()}get predicate(){return this.hierarchy.predicate_forKind(this.kindPredicate)}get relationship(){return this.relationshipAt()}get widget_map(){var e;return((e=se(Br))==null?void 0:e.widget_mapFor(this))??null}get titleWrapper(){return pg.wrapper_forHID_andType(this.idHashed,ht.title)}get ids_hashed(){return this.ids.map(e=>e.hash())}get titles(){var e;return((e=this.ancestors)==null?void 0:e.map(t=>` "${t?t.title:"null"}"`))??[]}get ancestors(){return this.hierarchy.things_forAncestry(this)}get children(){return this.hierarchy.things_forAncestries(this.childAncestries)}get childAncestries(){return this.childAncestries_ofKind(this.kindPredicate)}get siblingAncestries(){var e;return((e=this.parentAncestry)==null?void 0:e.childAncestries)??[]}get childRelationships(){return this.relationships_forParents_ofKind(this.kindPredicate,!1)}get parentRelationships(){return this.relationships_forParents_ofKind(this.kindPredicate,!0)}get relationships(){const e=this.ids_hashed.map(t=>this.hierarchy.relationship_forHID(t))??[];return we.strip_invalid(e)}get svgAngleOf_reveal(){var t;return(((t=this.widget_map)==null?void 0:t.points_right)??!0)==this.hasChildRelationships?rn.right:rn.left}get showsReveal(){var r,i;const e=this.hasRelevantRelationships||(((r=this.thing)==null?void 0:r.isBulkAlias)??!1);return!(((i=this.predicate)==null?void 0:i.isBidirectional)??!1)&&e}get isEditable(){var r;const e=((r=this.thing)==null?void 0:r.isBulkAlias)??!0;return(!this.isRoot||st.db.dbType==bt.local)&&ae.allow_TitleEditing&&!e}get ids(){return this.isRoot?[]:this.id.split(I.generic_separator)}get idThing(){var e;return this.isRoot?this.hierarchy.idRoot??I.unknown:((e=this.relationship)==null?void 0:e.idChild)??I.unknown}get paging_state(){const e=this.predicate,t=se(Br);if(e&&t){const r=t==null?void 0:t.cluster_map_forChildren(this.isParental,e);return(r==null?void 0:r.paging_state_ofAncestry(this))??null}return null}get thing(){let e=this._thing;return e||(e=this.thingAt(1)??null,this._thing=e),e&&!e.oneAncestry&&this.predicate&&!this.predicate.isBidirectional&&(e.oneAncestry=this),e&&e.isRoot&&(this.isRoot=!0),e}get isVisible(){var e,t;if(ae.showing_radial)return((t=(e=this.parentAncestry)==null?void 0:e.paging_state)==null?void 0:t.index_isVisible(this.siblingIndex))??!1;{const r=se(lt),i=this.incorporates(r),s=this.isAllExpandedFrom(r);return i&&s}}get hasGrandChildren(){if(this.hasChildRelationships){for(const e of this.childAncestries)if(e.hasChildRelationships)return!0}return!1}get containsReciprocals(){let e=null,t=null;for(const r of this.relationships){if((t||t==I.empty)&&(e||e==I.empty)&&t==r.idChild&&e==r.idParent)return!0;e=r.idChild,t=r.idParent}return!1}get containsMixedPredicates(){let e=null;for(const t of this.relationships)if(e||(e=t.kindPredicate),e&&(e!=this.kindPredicate||![e,this.kindPredicate].includes(t.kindPredicate)))return!0;return!1}get canConnect_toToolsAncestry(){const e=se(Tn),t=e==null?void 0:e.predicate;if(e&&t){const r=se(_t),i=r==null?void 0:r.thing,s=this.thing;if(s&&i&&r&&s.idHashed!=i.idHashed&&!r.ancestry_hasEqualID(this)){const a=t.kind==tt.isRelated?!1:s.parentIDs.includes(i.id),l=this.thing_isImmediateParentOf(r,t.kind),u=this.isAProgenyOf(r);return e.type==pr.deleting?l:!(l||u||a)}}return!1}rect_ofWrapper(e){return(e==null?void 0:e.boundingRect)??null}matchesStore(e){var t;return((t=se(e))==null?void 0:t.ancestry_hasEqualID(this))??!1}includesPredicateKind(e){var t;return((t=this.thing)==null?void 0:t.hasParents_forKind(e))??!1}includedInStore_ofAncestries(e){return this.includedInAncestries(se(e))}sharesAnID(e){return e?this.ids.some(t=>e.ids.includes(t)):!1}showsClusterFor(e){return this.includesPredicateKind(e.kind)&&this.hasThings(e)}relationshipAt(e=1){return this.hierarchy.relationship_forHID(this.idAt(e).hash())??null}ancestry_hasEqualID(e){return!!e&&this.idHashed==e.idHashed&&this.dbType==e.dbType}relationships_forParents_ofKind(e,t){var r;return((r=this.thing)==null?void 0:r.relationships_forParents_ofKind(e,t))??[]}isAProgenyOf(e){let t=!1;return e.traverse(r=>r.idHashed==this.idHashed?(t=!0,!0):!1),t}ancestry_ofNextSibling(e){const t=this.siblingAncestries,r=t.map(i=>i.id).indexOf(this.id);if(r!=-1){let i=r.increment(e,t.length);return r==0&&(i=1),t[i]}return null}childAncestries_ofKind(e){let t=[];const r=e==tt.contains,i=this.relationships_forParents_ofKind(e,!1);if(i.length>0){for(const s of i)if(s.kindPredicate==e){let o;r?o=this.uniquelyAppendID(s.id):o=this.hierarchy.ancestry_remember_createUnique(s.id,e),o&&t.push(o)}r&&this.hierarchy.db.isPersistent&&we.ancestries_orders_normalize_persistentMaybe(t)}return t}thingAt(e){const t=this.relationshipAt(e);return t&&this.id!=I.empty?t.child:this.hierarchy.root}thing_isImmediateParentOf(e,t){var i;const r=this.idThing;if(r!=I.unknown){const s=(i=e.thing)==null?void 0:i.parents_forKind(t);return(s==null?void 0:s.map(o=>o.id).includes(r))??!1}return!1}uniquelyAppendID(e){let t=this.ids;t.push(e);const r=this.hierarchy.ancestry_remember_createUnique(t.join(I.generic_separator));if(r){if(r.containsMixedPredicates)return this.hierarchy.ancestry_forget(r),null;if(r.containsReciprocals)return this.hierarchy.ancestry_forget(r),null}return r}includedInAncestries(e){return e.filter(r=>this.ancestry_hasEqualID(r)).length>0}hasThings(e){var t;switch(e.kind){case tt.contains:return((t=this.thing)==null?void 0:t.hasParents_forKind(e.kind))??!1;case tt.isRelated:return this.hasRelationships;default:return!1}}idAt(e=1){const t=this.ids;return e>t.length?I.empty:t.slice(-Math.max(1,e))[0]}isHoverInverted(e){const t=this.isGrabbed||this.isEditing;switch(e){case dn.reveal:return this.isExpanded==t;default:return t}}dotColor(e){const t=this.thing;if(t){const r=this.isGrabbed||this.isEditing;if(e!=r)return t.color}return I.color_background}visibleParentAncestries(e=1){var i;const t=((i=this.thing)==null?void 0:i.parentAncestries)??[],r=[];for(const s of t){const o=s.stripBack(e);o&&o.isVisible&&r.push(s)}return r}stripBack(e=1){if(e==0)return this;const t=this.ids.slice(0,-e);return t.length<1?this.hierarchy.rootAncestry:this.hierarchy.ancestry_remember_createUnique(t.join(I.generic_separator))}extend_withChild(e){var r;const t=(r=this.thing)==null?void 0:r.idBridging;if(e&&t){const i=this.hierarchy.relationship_forPredicateKind_parent_child(tt.contains,t,e.id);if(i)return this.uniquelyAppendID(i.id)}return null}isAllExpandedFrom(e){if(e&&!this.ancestry_hasEqualID(e)){const t=this.parentAncestry;if(!t||!t.isExpanded&&!t.isAllExpandedFrom(e))return!1}return!0}things_childrenFor(e){var i;const t=(i=this.thing)==null?void 0:i.relationships_forParents_ofKind(e,!0);let r=[];if(!this.isRoot&&t)for(const s of t){const o=s.parent;o&&r.push(o)}return r}layout_breadcrumbs_within(e){const t=[],r=[];let i=0,s=0;const o=this.ancestors??[];ie.log_crumbs(`${o.map(u=>u.title)}`);for(const u of o)if(u){const h=we.getWidthOf(u.breadcrumb_title)+29;if(s+h>e)break;s+=h,t.push(h),r.push(u),ie.log_crumbs(`${h} ${u.title}`),i=i*100+h}let a=(e-s)/2,l=[a];for(const u of t)a+=u,l.push(a);return[r,t,l,i]}incorporates(e){if(e){const t=this.ids,r=e.ids;let i=0;for(;i<r.length;){if(t[i]!=r[i])return!1;i++}return!0}return!1}visibleProgeny_height(e=[]){if(this.thing){if(!e.includes(this.id)&&this.showsChildRelationships){let r=0;for(const i of this.childAncestries)r+=i.visibleProgeny_height([...e,this.id]);return Math.max(r,I.row_height)}return I.row_height}return 0}visibleProgeny_width(e=!1,t=[]){const r=this.thing;if(r){const i=this.idHashed;let s=e?0:r.titleWidth+6;if(!t.includes(i)&&this.showsChildRelationships){let o=0;for(const a of this.childAncestries){const l=a.visibleProgeny_width(!1,[...t,i]);o<l&&(o=l)}s+=o+I.line_stretch+I.dot_size*(e?2:1)}return s}return 0}expand(){return this.expanded_setTo(!0)}collapse(){return this.expanded_setTo(!1)}toggleGrab(){this.isGrabbed?this.ungrab():this.grab()}toggleExpanded(){return this.isExpanded?this.collapse():this.expand()}assureIsVisible_inClusters(){var e,t;return((t=(e=this.parentAncestry)==null?void 0:e.paging_state)==null?void 0:t.update_index_toShow(this.siblingIndex))??!1}grabOnly(){At.set([this]),this.toggle_editingTools()}becomeFocus(e=!1){const t=se(lt),r=e||!t||!this.ancestry_hasEqualID(t);return r&&(Tn.set(null),lt.set(this)),this.expand(),r}assureIsVisible_inTree(){let e=this;do if(e=(e==null?void 0:e.parentAncestry)??null,e){if(e.isVisible){e.becomeFocus();return}e.expand()}while(!e);this.hierarchy.rootAncestry.expand(),this.hierarchy.rootAncestry.becomeFocus()}handle_singleClick_onDragDot(e){var t,r,i;((t=this.predicate)==null?void 0:t.isBidirectional)??!1?(i=(r=this.thing)==null?void 0:r.oneAncestry)==null||i.handle_singleClick_onDragDot(e):(mn==null||mn.set(null),se(Tn)?this.ancestry_alterMaybe(this):!e&&ae.showing_radial?this.becomeFocus():e||this.isGrabbed?this.toggleGrab():this.grabOnly(),Oe.signal_rebuildGraph_fromFocus())}grab(){At.update(e=>{let t=e??[];if(t){const r=t.indexOf(this);t.length==0?t.push(this):r!=t.length-1&&(r!=-1&&t.splice(r,1),t.push(this))}return t}),this.toggle_editingTools()}ungrab(){const e=this.hierarchy.rootAncestry;At.update(r=>{let i=r??[];if(i){const s=i.indexOf(this);s!=-1&&i.splice(s,1),i.length==0&&i.push(e)}return i}),(se(At)??[]).length==0&&!ae.showing_radial?e.grabOnly():this.toggle_editingTools()}toggle_editingTools(){const e=se(_t);e&&(Tn.set(null),this.ancestry_hasEqualID(e)?_t.set(null):this.isRoot||_t.set(this))}async ancestry_alterMaybe(e){var t;if(e.canConnect_toToolsAncestry){const r=se(Tn),i=se(_t),s=(t=r==null?void 0:r.predicate)==null?void 0:t.kind;if(r&&i&&s)switch(this.hierarchy.clear_editingTools(),r.type){case pr.deleting:await this.hierarchy.relationship_forget_persistentDelete(i,e,s);break;case pr.adding:const o=i.thing;o&&(await this.hierarchy.relationship_remember_persistent_addChild_toAncestry(o,e,s),Oe.signal_rebuildGraph_fromFocus());break}}}order_normalizeRecursive_persistentMaybe(e,t=[]){const r=this.idHashed,i=this.childAncestries;if(!t.includes(r)&&i&&i.length>1){we.ancestries_orders_normalize_persistentMaybe(i,e);for(const s of i)s.order_normalizeRecursive_persistentMaybe(e,[...t,r])}}expanded_setTo(e){let t=!1;return(!this.isRoot||e)&&Gr.update(r=>{let i=r??[];if(i){const s=i.map(a=>a.id).indexOf(this.id),o=s!=-1;e&&!o&&(i.push(this),t=!0),o&&!e&&(i.splice(s,1),t=!0)}return i}),t}startEdit(){this.isEditable&&(ie.log_edit(`EDIT ${this.title}`),this.grabOnly(),mn.set(new Pv(this)))}traverse(e){if(!e(this))for(const t of this.childAncestries)t.traverse(e)}async traverse_async(e){try{if(!await e(this))for(const t of this.childAncestries)await t.traverse_async(e)}catch(t){console.error("Error during traverse_async:",t)}}}class Rv extends mg{constructor(e){super(e.dbType,e.id,e.kindPredicate,!1),this.original=e}becomeFocus(){return this.original.becomeFocus()}}class uf{constructor(){var e,t;this.tools_widget_map=null,this.parent_cluster_maps=[],this.child_cluster_maps=[],ie.log_layout(`GEOMETRY (ts)  ${(t=(e=se(lt))==null?void 0:e.thing)==null?void 0:t.title}`),this.layoutAll_clusters(),ma.subscribe(r=>{this.update_forPaging_state(r)})}destructor(){this.child_cluster_maps.forEach(e=>e.destructor()),this.parent_cluster_maps.forEach(e=>e.destructor())}get cluster_maps(){return we.concatenateArrays(this.parent_cluster_maps,this.child_cluster_maps)}cluster_maps_forChildren(e){return e?this.child_cluster_maps:this.parent_cluster_maps}cluster_map_forChildren(e,t){return this.cluster_maps_forChildren(e)[t.stateIndex]}widget_mapFor(e){const t=this.widget_maps.filter(r=>r.widget_ancestry==e);return t.length>0?t[0]:null}get widget_maps(){const e=se(_t);let t=[];this.tools_widget_map=null;for(const r of this.cluster_maps)if(r)for(const i of r.widget_maps)i.widget_ancestry==e?this.tools_widget_map=i:t.push(i);return t}get cluster_mapFor_mouseLocation(){for(const e of this.cluster_maps)if(e&&e.thumb_isHit)return e;return null}layout_clusterFor(e,t,r){var i,s,o;if(t){const a=(o=(s=(i=se(lt))==null?void 0:i.thing)==null?void 0:s.page_states)==null?void 0:o.paging_state_forPointsOut(r,t),l=(a==null?void 0:a.onePage_from(e))??[],u=new Nv(e.length,l,t,r),h=this.cluster_maps_forChildren(r);h[t.stateIndex]=u}}parent_ancestries_maybeFor(e,t){let r=e.uniqueAncestries_for(t)??[];return t.id==Xt.idContains&&(r=r.map(i=>new Rv(i))),r}layoutAll_clusters(){this.destructor();const e=se(lt),t=e.thing;let r=e.childAncestries;if(this.layout_clusterFor(r,Xt.contains,!0),t)for(const i of se(Fe).predicates){let s=this.parent_ancestries_maybeFor(t,i);this.layout_clusterFor(s,i,!1)}}update_forPaging_state(e){const t=se(lt);if(e&&t)if(e.toChildren){let r=t.childAncestries;this.layout_clusterFor(r,Xt.contains,!0)}else{const r=t.thing;if(r)for(const i of se(Fe).predicates){let s=r.uniqueAncestries_for(i)??[];this.layout_clusterFor(s,i,!1)}}}}class Pv{constructor(e){this.stopping=null,this.editing=e}stop(){this.stopping=this.editing}get isStopping(){return!!this.editing&&!!this.stopping&&this.editing.ancestry_hasEqualID(this.stopping)}}class Sv{constructor(e,t){this.predicate=t??Xt.contains,this.type=e}get description(){var e;return`${this.type} ${((e=this.predicate)==null?void 0:e.description)??"unpredicated"}`}}class yg extends De{constructor(e,t,r,i,s,o=null,a=I.empty){super(t.origin.copy,t.size.copy),this.points_right=!0,this.subtype=I.empty,this.element_state=pt.element_state_for(i,dn.widget,a),this.points_right=o?new $e(o).angle_pointsRight:!0,this.child=(i==null?void 0:i.thing)??null,this.parent_ancestry=s,this.widget_ancestry=i,this.childOrigin=r,this.childAngle=o,this.curveType=e,this.subtype=a,this.child||console.log("geometry Widget_MapRect ... has no child")}destroy(){this.parent_ancestry=null,this.widget_ancestry=null}get responder(){return this.element_state.responder}}class sa{constructor(e=.1){this.base64_rotateSVG=btoa(encodeURIComponent(ze.rotateSVG)),this.active_angle=null,this.basis_angle=null,this.isHovering=!1,this.basis_opacity=e}get hover_cursor(){return"alias"}reset(){this.basis_angle=this.active_angle=null}get isHighlighted(){return this.isHovering||this.isActive}get isActive(){return!!this.basis_angle||this.active_angle==0}get active_cursor(){return new $e(this.active_angle).cursor_forAngle}get stroke_opacity(){return this.isHighlighted?this.basis_opacity*2:this.basis_opacity}get fill_opacity(){return this.isHighlighted?this.basis_opacity*.3:this.basis_opacity*.1}get cursor(){return this.isActive?this.active_cursor:this.isHovering?this.hover_cursor:I.cursor_default}get three_level_opacity(){return this.isActive?1:this.isHovering?this.basis_opacity*4:this.basis_opacity*1.5}}class Dv extends sa{constructor(){super(.03),this.basis_radius=null}get hover_cursor(){return"all-scroll"}reset(){super.reset(),this.basis_radius=null}get isActive(){return!!this.basis_radius}get stroke_opacity(){return this.isHighlighted?this.basis_opacity*5:this.basis_opacity}get fill_opacity(){return this.isHighlighted?this.basis_opacity*.5:this.basis_opacity*.15}}class Ov{constructor(e,t,r,i){this.widgetMapRects=[],this.childHeight=0;const s=r.visibleProgeny_height(),o=e+s/2,a=this.getDirection(o),l=new De(i,new Xe(I.line_stretch,o-1)),u=this.originForChildrenOf(r,l),h=new yg(a,l,u,r,t);this.childHeight=s,this.widgetMapRects.push(h)}originForChildrenOf(e,t){const r=e.thing;let i,s=0;return r&&(s=t.extent.y-e.visibleProgeny_halfHeight,i=t.origin.x+r.titleWidth+I.dot_size+I.line_stretch+4.5),new G(i,s)}getDirection(e){return e>1?gn.down:e<-1?gn.up:gn.flat}}class bg{constructor(e,t,r){this.color_background=I.color_background,this.responder=null,this.defaultCursor=I.cursor_default,this.hoverCursor=I.cursor_default,this.hoverColor="transparent",this.type=dn.none,this.hoverIgnore=!1,this.isInverted=!1,this.subtype=I.empty,this.name=I.empty,this.isOut=!0,this.name=pt.name_from(e,t,r),this.identifiable=e,this.subtype=r,this.type=t}static none(){return{}}get ancestry(){return this.identifiable}get invertColor(){return this.isInverted||this.isHovering}get cursor(){return this.isHovering?this.hoverCursor:this.defaultCursor}get fill(){return this.invertColor?this.hoverColor:this.color_background}get stroke(){return this.invertColor?this.color_background:this.hoverColor}get isHovering(){return this.hoverIgnore?!1:this.isOut==this.identifiable.isHoverInverted(this.type)}set_forHovering(e,t){this.hoverCursor=t,this.hoverColor=e}get border(){var t;let e=(t=this.ancestry.thing)==null?void 0:t.color;if(e){if(this.ancestry.isEditing)return`dashed ${e} 1px`;if(this.ancestry.isGrabbed)return`solid ${e} 1px`}return"none"}}class Nv{constructor(e,t,r,i){this.widget_maps=[],this.focus_ancestry=se(lt),this.ancestries=[],this.color=I.thing_color_default,this.arc_straddles_nadir=!1,this.arc_straddles_zero=!1,this.arc_in_lower_half=!1,this.label_center=G.zero,this.thumb_map=new cf,this.label_position_angle=0,this.cluster_title=I.empty,this.arc_map=new cf,this.center=G.zero,this.widgets_shown=0,this.total_widgets=0,this.isPaging=!1,this.total_widgets=e,this.ancestries=t,this.toChildren=i,this.predicate=r,ie.log_build(` C MAP (ts)  ${e}  ${this.direction_kind}`),this.update_all(),yn.subscribe(s=>{this.arc_map.outside_arc_radius!=s&&this.update_all()})}destructor(){this.ancestries=[]}update_all(){var e;this.widgets_shown=this.ancestries.length,this.isPaging=this.widgets_shown<this.total_widgets,this.center=se(cn).size.asPoint.dividedInHalf,this.color=we.opacitize(((e=this.focus_ancestry.thing)==null?void 0:e.color)??this.color,.2),this.update_fork_angle(),this.update_widget_angles(),this.update_label_geometry(),this.update_label_forIndex(),this.update_thumb_angles()}get paging_radius(){return I.paging_arc_thickness*.8}get maximum_paging_index(){return this.total_widgets-this.widgets_shown}get titles(){return this.ancestries.map(e=>e.title).join(", ")}get description(){return`(${this.cluster_title}) ${this.titles}`}get paging_index_ofFocus(){var e;return((e=this.paging_state_ofFocus)==null?void 0:e.index)??0}get paging_rotation(){return pt.rotation_state_forName(this.name)}get kind(){var e;return((e=this.predicate)==null?void 0:e.kind.unCamelCase().lastWord())??I.empty}get isParental(){var e;return!this.toChildren&&!((e=this.predicate)!=null&&e.isBidirectional)}get name(){return`${this.focus_ancestry.title}-cluster-${this.direction_kind}`}get fork_radial(){return G.fromPolar(se(yn),this.arc_map.fork_angle)}get paging_state_ofFocus(){return this.paging_state_ofAncestry(this.focus_ancestry)}get thumb_isHit(){const e=G.square(-se(yn)),t=Qe.mouse_vector_ofOffset_fromGraphCenter(e);return this.isPaging&&!!t&&t.isContainedBy_path(this.thumb_map.svgPathFor_arc)}get direction_kind(){const e=this.total_widgets==1;return this.isParental?e?"parent":"parents":this.toChildren?e?"child":"children":this.kind}update_label_geometry(){const e=this.arc_map.center_angle,t=this.arc_in_lower_half?$e.quarter:$e.three_quarters,r=se(yn)-I.ring_rotation_thickness+(this.arc_in_lower_half?5:0)+15;this.label_center=this.center.offsetBy(G.fromPolar(r,e)),this.arc_map.label_text_angle=t-e,this.label_position_angle=e}update_label_forIndex(){let e=`${this.total_widgets} ${this.direction_kind}`;if(this.isPaging){const t=Math.round(this.paging_index_ofFocus),r=this.widgets_shown<2?I.empty:`-${t+this.widgets_shown}`;e+=` (${t+1}${r})`}this.cluster_title=e}paging_state_ofAncestry(e){var t,r;return((r=(t=e.thing)==null?void 0:t.page_states)==null?void 0:r.paging_state_for(this))??null}adjust_paging_index_byAdding_angle(e){const t=this.paging_state_ofFocus;if(t){const r=(-this.arc_map.spread_angle).angle_normalized(),s=e/r*this.maximum_paging_index,o=t.addTo_paging_index_for(s)??!1;return this.update_thumb_angles(),o&&this.update_label_forIndex(),o||s!=0}return!1}compute_paging_fraction(e){let t=e.angle_normalized(),r=this.arc_map.end_angle.angle_normalized(),i=this.arc_map.start_angle.angle_normalized();const s=we.quadrant_ofAngle(r);if(s!=Yt.upperRight){let o=we.basis_angle_ofQuadrant(s)+$e.quarter;t=t.add_angle_normalized(-o),i=i.add_angle_normalized(-o),r=r.add_angle_normalized(-o)}if(i<t)return 0;if(r>t)return 1;{const o=(i-t).angle_normalized(),a=(-this.arc_map.spread_angle).angle_normalized();return(o/a).force_between(0,1)}}update_arc_angles(e,t,r){e==t&&(this.arc_map.start_angle=r),e==0&&(this.arc_map.end_angle=r)}update_fork_angle(){const e=2*Math.PI/3,t=se(ks),i=(this.predicate.isBidirectional?t+e:this.toChildren?t:t-e).angle_normalized()??0;this.arc_map.update_fork_angle(i)}update_widget_angles(){if(this.widget_maps=[],this.widgets_shown>0&&this.predicate){const e=se(yn),t=new G(e+I.ring_widget_padding,0),r=new $e(this.arc_map.fork_angle).angle_pointsRight,i=this.center.offsetByXY(2,-1.5),s=this.widgets_shown-1;let o=0;for(;o<this.widgets_shown;){const a=r?s-o:o,l=this.ancestries[a],u=this.angle_at_index(o),h=i.offsetBy(t.rotate_by(u)),f=new yg(gn.flat,new De,h,l,this.focus_ancestry,u);this.widget_maps.push(f),o+=1}this.arc_map.finalize_angles(),this.arc_in_lower_half=this.fork_radial.y<0,this.arc_straddles_zero=this.arc_map.arc_straddles(0),this.arc_straddles_nadir=this.arc_map.arc_straddles($e.three_quarters)}}angle_at_index(e){const t=this.widgets_shown-1,r=t/2-e,i=se(yn),s=this.fork_radial;let o=s.y+r*(I.row_height-2),a=!1;const l=Math.abs(o);l>i&&(a=!0,o=i*(o/l)-o%i);let u=-Math.asin(o/i);return a==s.x>0&&(u=$e.half-u),this.update_arc_angles(e,t,u),u}update_thumb_angles(){const e=this.arc_map.spread_angle,t=e<0,r=t?1:-1,i=t==this.arc_straddles_nadir?-1:1,o=(this.arc_straddles_nadir?(-e).angle_normalized():e)/this.total_widgets*r,l=this.arc_map.start_angle*i+o*this.paging_index_ofFocus,u=l+o*this.widgets_shown;this.thumb_map.update_fork_angle((l+u)/2),this.thumb_map.start_angle=l,this.thumb_map.end_angle=u}}const wg=class vg{constructor(e,t,r,i,s,o,a,l){this.relative_font_size=I.font_size,this.title_origin=G.x(8),this.part=on.right,this.font_size="0.95em",this.origin=G.zero,this.isSelected=!1,this.viewBox=I.empty,this.size=Xe.zero,this.title=I.empty,this.name=I.empty,this.path=I.empty,this.height=0,this.width=0,this.index=0,this.left=0,this.relative_font_size=r.fontSize_relativeTo(I.font_size),this.width=we.getWidth_ofString_withSize(t,r)+this.relative_font_size-2,this.part=this.part_forIndex(s,o),this.size=new Xe(this.width,l),this.isSelected=i,this.font_size=r,this.height=l,this.title=t,this.index=s,this.left=a,this.name=e,this.setup_path()}get description(){return`${this.title} ${this.part} ${this.path}`}static grab_segment_map(e,t,r,i,s,o,a,l){let u=`${t}-${e}-at-${s}`,h=pt.segment_map_forName(u);return h?h.isSelected=i:(h=new vg(e,t,r,i,s,o,a,l),pt.set_segment_map_forName(h,u)),h}setup_path(){const e=this.index==0,t=5-this.height/6,r=this.size.expandedEquallyBy(-2),s=this.size.asPoint.dividedInHalf.offsetByXY(e?10:-10,-1),o=(e?2:0)+1+this.relative_font_size/2;this.path=ze.oblong(s,r,this.part),this.title_origin=new G(o,t),this.viewBox=De.createSizeRect(r).viewBox,this.origin=G.x(this.left)}part_forIndex(e,t){switch(e){case 0:return on.left;case t:return on.right;default:return on.middle}}};wg.segment_gap=14;let Vv=wg;class Xs extends xi{constructor(e,t,r,i=!1){super(e,r,i),this.baseID=t}log(e,t){}isInDifferentBulkThan(e){return this.baseID!=e.baseID}static datum_fromJSON(e){const t=JSON.parse(e);return new Xs(t.dbType,t.baseID,t.id,!0)}}class vi extends Xs{constructor(e,t,r,i,s,o=0,a=!1){super(st.db.dbType,e,t,a),this.kindPredicate=r,this.hidParent=i.hash(),this.hidChild=s.hash(),this.idParent=i,this.idChild=s,this.order=o}get child(){return this.thing(!0)}get parent(){return this.thing(!1)}get isValid(){return!!this.kindPredicate&&!!this.idParent&&!!this.idChild}get predicate(){return se(Fe).predicate_forKind(this.kindPredicate)}get fields(){return{kindPredicate:this.kindPredicate,parent:[this.idParent],child:[this.idChild],order:this.order}}get verbose(){const e=this.already_persisted?"STORED":"DIRTY";return`BASE ${this.baseID} ${e} [${this.order}] ${this.id} ${this.description}`}get description(){var r;const e=this.child?this.child.description:this.idChild;return`${this.parent?this.parent.description:this.idParent} ${(r=this.predicate)==null?void 0:r.kind} ${e}`}log(e,t){ie.log_maybe(e,`${t} ${this.description}`)}static relationship_fromJSON(e){const t=JSON.parse(e);return new vi(t.baseID,t.id,t.kindPredicate,t.idParent,t.idChild,t.order,!0)}thing(e){const t=e?this.idChild:this.idParent;return se(Fe).thing_forHID(t.hash())??null}order_setTo_persistentMaybe(e,t=!1){Math.abs(this.order-e)>.001&&(this.order=e,t&&this.set_isDirty())}async persist(){this.awaitingCreation||(this.updateModifyDate(),this.already_persisted?await st.db.relationship_persistentUpdate(this):st.db.isPersistent&&await st.db.relationship_remember_persistentCreate(this))}}class nn{constructor(e,t,r,i,s,o,a,l,u,h=!1){this.clicks=0,this.isDouble=a,this.element=t,this.isHover=r,this.isMove=u,this.isLong=l,this.isDown=s,this.event=e,this.isOut=i,this.isHit=h,this.isUp=o}get isShapeHit(){return!1}get isEmpty(){return!this.isHover&&!this.isOut&&!this.isDown&&!this.isUp&&!this.isDouble&&!this.isLong&&!this.isMove&&!this.isHit}get copy(){return new nn(this.event,this.element,this.isHover,this.isOut,this.isDown,this.isUp,this.isDouble,this.isLong,this.isMove,this.isHit)}get isElementHit(){return!!this.event&&!!this.element&&De.rect_forElement_containsEvent(this.element,this.event)}get description(){let e=[];return this.isHover&&e.push("hover"),this.isOut&&e.push("out"),this.isDown&&e.push("down"),this.isUp&&e.push("up"),this.isDouble&&e.push("double"),this.isLong&&e.push("long"),this.isMove&&e.push("move"),this.isHit&&e.push("hit"),e.length==0?"empty mouse state":e.join(", ")}descriptionFor(e=""){return`${e} states: ${this.description}`}static empty(e=null){return new nn(e,null,!1,!1,!1,!0,!1,!1,!1)}static hit(e=null){return new nn(e,null,!1,!1,!1,!0,!1,!1,!1,!0)}static up(e,t){return new nn(e,t,!1,!1,!1,!0,!1,!1,!1)}static down(e,t){return new nn(e,t,!1,!1,!0,!1,!1,!1,!1)}static long(e,t){return new nn(e,t,!1,!1,!1,!1,!1,!0,!1)}static hover(e,t,r){return new nn(e,t,!0,!r,!1,!1,!1,!1,!1)}static clicks(e,t,r){return new nn(e,t,!1,!1,!1,!1,r>1,!1,!1)}static move(e,t,r,i){return new nn(e,t,!1,!1,r,!1,!1,!1,i)}}class ar extends Mt{constructor(e,t,r,i,s=[]){super(),this._parentTypes=[],this.type=i,this.element=e,this.idHashed=r,this.set_parentTypes(s),this.handle_mouse_state=t,pg.wrapper_add(this)}get boundingRect(){const e=De.boundingRectFor(this.element);return(e==null?void 0:e.originMultipliedBy(1/Qe.scale_factor))??De.zero}handle_event(e,t){const r=t(e,this.element);return this.handle_mouse_state(r)}set_parentTypes(e){this._parentTypes=e}isHit(e){const t=nn.hit(e);return this.handle_mouse_state(t)}get parentTypes(){const e=this._parentTypes;return e&&e.length>0?e:ar.parentTypes_for(this.type)}static parentTypes_for(e){switch(e){case ht.thumb:return[ht.paging];case ht.widget:case ht.app:return[];case ht.tools:case ht.title:case ht.rotate:return[ht.graph];case ht.drag:case ht.paging:case ht.reveal:return[ht.rotate];case ht.graph:case ht.details:case ht.banners:return[ht.app]}return[ht.banners]}}const kg=class zo extends xi{constructor(e,t,r,i=!1){super(st.db.dbType,e,i),this.isBidirectional=r,this.stateIndex=zo.nextIndex,this.kind=t,zo.nextIndex+=1}get description(){return this.kind.unCamelCase().lastWord()}log(e,t){ie.log_maybe(e,t+I.space+this.description)}static get contains(){return this.predicate_forKind(tt.contains)}static get explains(){return this.predicate_forKind(tt.explains)}static get requires(){return this.predicate_forKind(tt.requires)}static get supports(){return this.predicate_forKind(tt.supports)}static get isRelated(){return this.predicate_forKind(tt.isRelated)}static get appreciates(){return this.predicate_forKind(tt.appreciates)}static predicate_forKind(e){return se(Fe).predicate_forKind(e)??null}static predicate_fromJSON(e){const t=JSON.parse(e);return new zo(t.id,t.kind,t.isBidirectional,!0)}async persist(){this.awaitingCreation||(this.updateModifyDate(),this.already_persisted?await st.db.predicate_persistentUpdate(this):st.db.isPersistent&&await st.db.predicate_remember_persistentCreate(this))}};kg.nextIndex=0;let Xt=kg;class cf{constructor(){this.clusters_center=G.zero,this.outside_arc_radius=0,this.inside_arc_radius=0,this.label_text_angle=0,this.arc_rect=De.zero,this.fork_backoff=0,this.fork_radius=0,this.start_angle=0,this.fork_angle=0,this.cap_radius=0,this.end_angle=0;const e=I.paging_arc_thickness,t=se(yn);this.clusters_center=G.square(t),this.inside_arc_radius=t-e,this.cap_radius=I.ring_rotation_thickness/6,this.outside_arc_radius=t}get nadir_offset(){return this.arc_straddles_nadir&&!this.arc_straddles_zero?$e.half:0}get center_angle(){return(this.end_angle+this.start_angle)/2-this.nadir_offset}get fork_slantsForward(){return new $e(this.fork_angle).angle_slantsForward}get arc_straddles_nadir(){return this.arc_straddles($e.three_quarters)}get straddles_zero(){return this.end_angle.straddles_zero(this.start_angle)}get fork_orientsDown(){return new $e(this.fork_angle).angle_orientsDown}get fork_pointsRight(){return new $e(this.fork_angle).angle_pointsRight}get angles(){return[this.start_angle,this.end_angle]}get spread_angle(){return this.end_angle-this.start_angle}get arc_straddles_zero(){return this.arc_straddles(0)}get arc_origin(){return this.arc_rect.origin}get arc_center(){return this.arc_rect.center}get computed_arc_rect(){let e=G.zero,t=G.zero;const r=this.radial_forAngle(this.end_angle),i=this.radial_forAngle(this.start_angle),s=i.x<r.x,o=i.y<r.y;return e.x=(s?i.x:r.x)-this.cap_radius,e.y=(o?i.y:r.y)-this.cap_radius,t.x=(s?r.x:i.x)+this.cap_radius,t.y=(o?r.y:i.y)+this.cap_radius,De.createExtentRect(e,t)}arc_straddles(e){return this.start_angle.angle_normalized()>e&&this.end_angle.angle_normalized()<e}radial_forAngle(e){const t=this.inside_arc_radius+this.cap_radius;return G.fromPolar(t,e)}update_fork_angle(e){const t=I.ring_rotation_thickness*.6;this.fork_backoff=this.fork_adjustment(t,this.inside_arc_radius),this.fork_radius=t-this.fork_backoff,this.fork_angle=e}fork_adjustment(e,t){const r=e/t/2,i=Math.asin(r)*2;return t*(1-Math.cos(i))/Math.sqrt(1.5)}finalize_angles(){if(!this.fork_pointsRight){const e=this.start_angle;this.start_angle=this.end_angle,this.end_angle=e}this.arc_rect=this.computed_arc_rect}get svgPathFor_arc(){const[e,t]=this.angles;return[this.svgPathFor_start(e,this.outside_arc_radius),this.svgPathFor_arcEdge(t,this.outside_arc_radius,!1),this.svgPathFor_cap(t,!1),this.svgPathFor_arcEdge(e,this.inside_arc_radius,!0),this.svgPathFor_cap(e,!0)].join(I.space)}svgPathFor_start(e,t){return ze.startOutAt(this.clusters_center,t,e)}svgPathFor_arcEdge(e,t,r){const i=r?0:1;return ze.arc_partial(this.clusters_center,t,0,i,e)}svgPathFor_cap(e,t){const r=this.radial_forAngle(e),i=this.clusters_center.offsetBy(r),s=t?e:(e+Math.PI).angle_normalized();return ze.arc_partial(i,this.cap_radius,0,1,s)}svgPathFor_tinyDot(e,t){const r=this.clusters_center.offsetBy(G.fromPolar(e,t));return ze.circle(r,5)}get svgPathFor_forkRadial(){const e=this.inside_arc_radius-I.paging_arc_thickness-4;return ze.line_atAngle(this.clusters_center,e,this.center_angle)}get svgPathFor_forkArc(){const e=-this.fork_angle,t=this.fork_radius,r=this.fork_slantsForward,i=t*(r?-1:1),s=this.inside_arc_radius-t-this.fork_backoff,o=new G(s,i).rotate_by(e);return ze.arc(o.offsetBy(this.clusters_center),t,1,e+(r?$e.quarter:0),e-(r?0:$e.quarter))}}class Mv{get thing_lastGrabbed(){var e;return((e=this.ancestry_lastGrabbed)==null?void 0:e.thing)||null}get areInvisible(){const e=se(At)??[];for(const t of e)if(!t.isVisible)return!0;return!1}get ancestry_lastGrabbed(){var t;const e=se(At)??[];if(e.length>0){const r=e.slice(-1)[0],i=(t=r==null?void 0:r.relationship)==null?void 0:t.idHashed;if(i&&se(Fe).relationship_forHID(i))return r}return null}latestAncestryGrabbed(e){const t=se(At)??[];return t.length>0?e?t[0]:t.slice(-1)[0]:se(Fe).rootAncestry}}class ec extends xi{constructor(e,t,r,i=!1){super(e,t,i),this.kind=r}static access_fromJSON(e){const t=JSON.parse(e);return new ec(t.dbType,t.id,t.kind,!0)}}class Ni extends Xs{constructor(e,t,r=I.title_default,i=I.thing_color_default,s=I.empty,o=!1){super(st.db.dbType,e,t,o),this.selectionRange=new au(0,0),this.bulkRootID=I.empty,this.needsBulkFetch=!1,this.isEditing=!1,this.isGrabbed=!1,this.selectionRange=new au(0,r.length),this.page_states=new Iv(this.id),this.title=r,this.color=i,this.type=s}get parentIDs(){return this.parents.map(e=>e.id)}get parents(){return this.parents_forKind(tt.contains)}get traits(){return se(Fe).traits_forOwnerHID(this.idHashed)??[]}get parentAncestries(){return this.parentAncestries_for(Xt.contains)}get fields(){return{title:this.title,color:this.color,type:this.type}}get relatedRelationships(){return this.relationships_forParents_ofKind(tt.isRelated,!1)}get quest(){var e;return((e=se(Fe).trait_forType_ownerHID(Ai.quest,this.idHashed))==null?void 0:e.text)??null}get consequence(){var e;return((e=se(Fe).trait_forType_ownerHID(Ai.consequence,this.idHashed))==null?void 0:e.text)??null}get idBridging(){return this.isBulkAlias?this.bulkRootID:this.id}get description(){return this.id+' "'+this.title+'"'}get breadcrumb_title(){return this.title.clipWithEllipsisAt(15)}get titleWidth(){return we.getWidthOf(this.title)}get isRoot(){return this.type==Ft.root}get isBulkAlias(){return this.type==Ft.bulk}get isAcrossBulk(){return this.baseID!=se(Fe).db.baseID}get hasMultipleParents(){return this.parentAncestries.length>1}get hasParents(){return this.hasParents_forKind(tt.contains)}get isFocus(){var e;return(((e=se(lt).thing)==null?void 0:e.id)??I.empty)==this.id}get hasRelated(){return this.relatedRelationships.length>0}get hasNoData(){return!this.title&&!this.color&&!this.type}static thing_fromJSON(e){const t=JSON.parse(e);return new Ni(t.baseID,t.id,t.title,t.color,t.type,!0)}get ancestries(){return we.uniquely_concatenateArrays(this.uniqueAncestries_for(Xt.contains),this.uniqueAncestries_for(Xt.isRelated))}get parents_ofAllKinds(){let e=[];for(const t of se(Fe).predicates){const r=this.parents_forKind(t.kind);e=we.uniquely_concatenateArrays(e,r)}return e}get thing_isBulk_expanded(){var e;if(this.isBulkAlias){const t=se(Gr);for(const r of t)if(this.id==((e=r.thing)==null?void 0:e.id))return!0}return!1}get oneAncestry_derived(){var t;let e=null;if(this.isRoot)e=se(Fe).rootAncestry;else{const r=this.relationships_forParents_ofKind(tt.contains,!0);if(r&&r.length>0){const i=r[0],s=(t=i.parent)==null?void 0:t.oneAncestry;e=(s==null?void 0:s.uniquelyAppendID(i.id))??null}}return e}debugLog(e){this.log(yt.things,e)}log(e,t){ie.log_maybe(e,t+I.space+this.description)}hasParents_forKind(e){return this.parents_forKind(e).length>0}setTraitText_forType(e,t){se(Fe).trait_setText_forType_ownerHID(e,t,this.id)}isInDifferentBulkThan(e){return super.isInDifferentBulkThan(e)||e.isBulkAlias&&!this.isBulkAlias&&this.baseID!=e.title}async persist(){this.awaitingCreation||(this.updateModifyDate(),this.already_persisted?await st.db.thing_persistentUpdate(this):st.db.isPersistent&&await st.db.thing_remember_persistentCreate(this))}signal_color_change(){const e=se(xl)+1;xl.set(e),Pn.set(`${this.id}${I.generic_separator}${e}`)}crumbWidth(e){const t=this.titleWidth+10;switch(e){case 0:return t;case 1:return t+11;default:return t+18}}parents_forKind(e){let t=[];if(!this.isRoot){const r=this.relationships_forParents_ofKind(e,!0);for(const i of r){const s=i.parent;s&&t.push(s)}}return t}oneAncestries_rebuildForSubtree(){const e=this.oneAncestry_derived;if(e){const t=e.predicate;t&&!t.isBidirectional&&this.oneAncestry!=e&&(se(Fe).ancestry_forget(this.oneAncestry),this.oneAncestry=e),e.children.map(r=>r.oneAncestries_rebuildForSubtree())}}relationships_inBothDirections_forKind(e){const t=this.relationships_forParents_ofKind(e,!1),r=this.relationships_forParents_ofKind(e,!0);return we.uniquely_concatenateArrays(r,t)}relationships_forParents_ofKind(e,t){const r=this.idBridging;return(r||r==I.empty)&&r!=I.unknown?se(Fe).relationships_forPredicateThingIsChild(e,r,t):[]}parentRelationships_for(e){let t=[];return e.isBidirectional?t=this.relationships_inBothDirections_forKind(e.kind):t=this.relationships_forParents_ofKind(e.kind,!0),t}uniqueAncestries_for(e){if(e){let t=[];if(e.isBidirectional)t=this.parentAncestries_for(e);else{let r=this.parents_forKind(e.kind)??[];for(const i of r){const s=i.isRoot?[se(Fe).rootAncestry]:i.parentAncestries_for(e);t=we.concatenateArrays(t,s)}}return we.strip_thingDuplicates_from(we.strip_falsies(t))}return[]}parentAncestries_for(e,t=[]){let r=[];if(!this.isRoot&&e){let i=function(o){o&&r.push(o)};const s=this.parentRelationships_for(e);for(const o of s)if(e.isBidirectional){const a=o.child;a&&a.id!=this.id&&i(se(Fe).ancestry_remember_createUnique(o.id,e.id))}else{const a=o.parent;if(a&&!t.includes(a.id)){const l=o.id,u=a.parentAncestries_for(e,we.uniquely_concatenateArrays(t,[a.id]))??[];u.length==0?i(se(Fe).rootAncestry.uniquelyAppendID(l)):u.map(h=>i(h.uniquelyAppendID(l)))}}r=we.strip_hidDuplicates(r)}return we.sort_byTitleTop(r).reverse()}}class tc extends Xs{constructor(e,t,r,i,s=I.empty,o=!1){super(st.db.dbType,e,t,o),this.type=Ai.generic,this.ownerID=I.empty,this.text=I.empty,this.ownerID=r,this.type=i,this.text=s}get owner(){return se(Fe).thing_forHID(this.ownerID.hash())}get hasNoData(){return!this.ownerID&&!this.type&&!this.type}get fields(){return{type:this.type,ownerID:[this.ownerID],text:this.text}}static trait_fromJSON(e){const t=JSON.parse(e);return new tc(t.baseID,t.id,t.ownerID,t.type,t.text,!0)}async persist(){this.awaitingCreation||(this.updateModifyDate(),this.already_persisted?await st.db.trait_persistentUpdate(this):st.db.isPersistent&&await st.db.trait_remember_persistentCreate(this))}}class nc extends xi{constructor(e,t,r,i,s,o=!1){super(e,t,o),this.name=r,this.email=i,this.phone=s}static user_fromJSON(e){const t=JSON.parse(e);return new nc(t.dbType,t.id,t.name,t.email,t.phone,!0)}}class xv{constructor(){this.initialTouch=null,this.interval=null}setup(){Tn.subscribe(e=>{this.handle_alteration_state(e)}),Ur.subscribe(e=>{this.subscribeTo_events()}),this.subscribeTo_events()}update_event_listener(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,{passive:!1})}clear_event_subscriptions(){window.removeEventListener("mouseup",this.handle_mouse_up),window.removeEventListener("mousemove",this.handle_mouse_move),window.removeEventListener("touchend",this.handle_touch_end),window.removeEventListener("touchmove",this.handle_touch_move),window.removeEventListener("touchstart",this.handle_touch_start)}subscribeTo_events(){this.clear_event_subscriptions(),this.update_event_listener("wheel",this.handle_wheel),this.update_event_listener("keydown",this.handle_zoom),this.update_event_listener("resize",this.handle_resize),this.update_event_listener("orientationchange",this.handle_orientation_change),ae.device_isMobile?(ie.log_action("  mobile subscribe GRAPH"),window.addEventListener("touchend",this.handle_touch_end,{passive:!1}),window.addEventListener("touchmove",this.handle_touch_move,{passive:!1}),window.addEventListener("touchstart",this.handle_touch_start,{passive:!1})):(window.addEventListener("mouseup",this.handle_mouse_up,{passive:!1}),window.addEventListener("mousemove",this.handle_mouse_move,{passive:!1}))}handle_zoom(e){const t=e,r=t.key;if(t.metaKey&&["+","=","-","0"].includes(r)){switch(t.preventDefault(),t.stopPropagation(),r){case"0":Qe.applyScale(1);break;case"-":Qe.zoomBy(I.zoom_out_ratio);break;default:Qe.zoomBy(I.zoom_in_ratio);break}Qe.renormalize_user_graph_offset(),Oe.signal_rebuildGraph_fromFocus()}}handle_mouse_up(e){e.preventDefault(),e.stopPropagation(),Ts.set(se(Ts)+1)}handle_mouse_move(e){e.preventDefault(),e.stopPropagation();const t=new G(e.clientX,e.clientY);O_.set(t),ya.set(t.dividedBy(Qe.scale_factor))}handle_wheel(e){if(e.preventDefault(),e.stopPropagation(),!ae.device_isMobile){const t=e,r=se(jr),i=new G(-t.deltaX,-t.deltaY);r&&ae.allow_HorizontalScrolling&&i.magnitude>1&&(ie.log_action(" wheel GRAPH"),Qe.user_graph_offset_setTo(r.offsetBy(i)))}}handle_alteration_state(e){if(this.interval&&(clearInterval(this.interval),this.interval=null),e){let t=!0;this.interval=setInterval(()=>{Oe.signal_altering(t?e:null),t=!t},500)}else Oe.signal_altering(null)}handle_resize(e){const t=ae.device_isMobile;ie.log_action(` resize [is${t?"":" not"} mobile] STATE`),Ko.set(se(Ko)+1),Ur.set(t),Qe.restore_state()}handle_orientation_change(e){const t=ae.device_isMobile;ie.log_action(` orientation change [is${t?"":" not"} mobile] STATE`),Ur.set(t),Qe.restore_state()}handle_touch_start(e){if(e.touches.length==2){const t=e.touches[0];this.initialTouch=new G(t.clientX,t.clientY),ie.log_action(" two-finger touches GRAPH")}}handle_touch_move(e){if(e.touches.length==2&&(e.preventDefault(),e.stopPropagation(),this.initialTouch)){const t=e.touches[0],r=t.clientX-this.initialTouch.x,i=t.clientY-this.initialTouch.y;Qe.user_graph_offset_setTo(new G(r,i)),ie.log_action(" two-finger touch move GRAPH")}}handle_touch_end(e){this.initialTouch=null}}let Lv=new xv;class zv{constructor(){this.rotation_state_byName={},this.element_state_byName={},this.mouse_state_byName={},this.mouse_timer_byName={},this.segment_map_byName={}}reset_paging(){this.rotation_states.map(e=>e.reset())}segment_map_forName(e){return this.segment_map_byName[e]}element_state_forName(e){return this.element_state_byName[e]}get rotation_states(){return Object.values(this.rotation_state_byName)}set_segment_map_forName(e,t){return this.segment_map_byName[t]=e}get isAny_paging_arc_active(){return this.rotation_states.filter(e=>e.isActive).length>0}get isAny_paging_arc_hovering(){return this.rotation_states.filter(e=>e.isHovering).length>0}name_from(e,t,r){return`${t}-${r}-id:${e.id}`}rotation_state_forName(e){let t=this.rotation_state_byName[e];return t||(t=new sa,this.rotation_state_byName[e]=t),t}mouse_state_forName(e){let t=this.mouse_state_byName[e];return t||(t=nn.empty(),this.mouse_state_byName[e]=t),t}mouse_timer_forName(e){let t=this.mouse_timer_byName[e];return t||(t=new uv,this.mouse_timer_byName[e]=t),t}element_state_for(e,t,r){const i=e??new Mt,s=this.name_from(i,t,r);let o=this.element_state_forName(s);return o||(o=new bg(i,t,r),this.element_state_byName[s]=o),o}}const pt=new zv;class Fv{constructor(){this.scale_factor=1,this.scroll=this.windowScroll}get windowScroll(){return new G(window.scrollX,window.scrollY)}get center_ofGraphSize(){return se(cn).size.asPoint.dividedInHalf}renormalize_user_graph_offset(){this.user_graph_offset_setTo(this.persisted_user_offset)}get mouse_distance_fromGraphCenter(){var e;return((e=this.mouse_vector_ofOffset_fromGraphCenter())==null?void 0:e.magnitude)??0}get mouse_angle_fromGraphCenter(){var e;return((e=this.mouse_vector_ofOffset_fromGraphCenter())==null?void 0:e.angle)??null}get persisted_user_offset(){const e=nt.read_key(it.user_offset)??{x:0,y:0};return new G(e.x,e.y)}get windowSize(){const e=this.scale_factor;return new Xe(window.innerWidth/e,window.innerHeight/e)}restore_state(){this.graphRect_update(),this.applyScale(nt.read_key(it.scale)??1),this.renormalize_user_graph_offset()}mouse_vector_ofOffset_fromGraphCenter(e=G.zero){const t=se(ya);if(t){const i=se(Ll).offsetBy(e).vector_to(t);return ie.log_hover(`offset  ${se(jr).description}  ${i.description}`),i}return null}user_graph_offset_setTo(e){let t=!1;const r=se(jr);r&&r.vector_to(e).magnitude>.001&&(nt.write_key(it.user_offset,e),t=!0);const i=se(cn).center.offsetBy(e);return Ll.set(i),jr.set(e),ie.log_mouse(`USER ====> ${e.description}  ${i.description}`),t}graphRect_update(){const e=se(tr)?I.width_details:0,t=new G(e,69),r=this.windowSize.reducedBy(t),i=new De(t,r);ie.log_mouse(`GRAPH ====> ${i.description}`),cn.set(i)}zoomBy(e){const t=document.documentElement,i=(parseFloat(getComputedStyle(t).getPropertyValue("zoom"))||1)*e;return this.applyScale(i),this.windowSize.width}applyScale(e){this.scale_factor=e,nt.write_key(it.scale,e);const t=document.documentElement;t.style.setProperty("zoom",e.toString()),t.style.transform="scale(var(zoom))",t.style.height=`${100/e}%`,t.style.width=`${100/e}%`,this.graphRect_update()}}let Qe=new Fv;class Bv{constructor(){this.allow_GraphEditing=!0,this.allow_TitleEditing=!0,this.allow_HorizontalScrolling=!0,this.isEditing_text=!1,this.mouse_responder_number=0,this.rebuild_needed_byType={},this.queryStradial=new URLSearchParams(window.location.search)}startup(){ie.queryStradial_apply(),this.setup_defaults(),Qe.restore_state(),ln.restore_state(),nt.restore_defaults(),st.restore_db(),this.queryStradial_apply(),ln.queryStradial_apply(),Lv.setup()}setup_defaults(){Ko.set(0),xl.set(0),Ts.set(0),Pn.set(null),Go.set(jn.start),Ur.set(this.device_isMobile),this.ring_resizing_state=new Dv,this.ring_rotation_state=new sa,this.cluster_paging_state=new sa}queryStradial_apply(){var i;const e=this.queryStradial,t=e.get("disable"),r=((i=e.get("erase"))==null?void 0:i.split(I.comma))??[];if(t){const s=t.split(",");for(const o of s)switch(o){case"editGraph":this.allow_GraphEditing=!1;break;case"editTitles":this.allow_TitleEditing=!1;break;case"horizontalScrolling":this.allow_HorizontalScrolling=!1;break}}for(const s of r)switch(s){case"data":st.eraseDB=!0,nt.writeDB_key(it.focus,null),nt.writeDB_key(it.expanded,null);break;case"settings":nt.reset(),Gr.set([]),lt.set(this.hierarchy.rootAncestry),At.set([this.hierarchy.rootAncestry]);break}}get showing_radial(){return se(vr)==kr.radial}get hierarchy(){return se(Fe)}get isAny_rotation_active(){return pt.isAny_paging_arc_active||this.cluster_paging_state.isActive||this.ring_rotation_state.isActive}get next_mouse_responder_number(){return this.mouse_responder_number+=1,this.mouse_responder_number}get isServerLocal(){const e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"||e==="0.0.0.0"}get siteTitle(){const e=st.db.dbType,t=st.db.baseID,r=this.isServerLocal?"local":"remote",i=e?e+", ":I.empty,s=t?t+", ":I.empty;return`Seriously (${r}, ${i}${s}${we.browserType}, α)`}get device_isMobile(){const e=navigator.userAgent;return!!(/android/i.test(e)||/iPhone|iPad|iPod/i.test(e)||/iPad|Android|Touch/i.test(e)&&!window.MSStream)}open_tabFor(e){var t;(t=window.open(e,"help-webseriously"))==null||t.focus()}require_rebuild_forType(e){this.rebuild_needed_byType[e]=!0}showHelp(){this.open_tabFor(this.isServerLocal?I.local_help_url:I.remote_help_url)}readOnce_rebuild_needed_forType(e){const t=this.rebuild_needed_byType[e];return this.rebuild_needed_byType[e]=!1,t}}let ae=new Bv;function Uv(n){let e,t;const r=n[22].default,i=da(r,n,n[21],null);return{c(){e=W("div"),i&&i.c(),T(e,"class","mouse-responder"),T(e,"id",n[0]),T(e,"style",n[2])},m(s,o){B(s,e,o),i&&i.m(e,null),n[23](e),t=!0},p(s,o){i&&i.p&&(!t||o[0]&2097152)&&pa(i,r,s,s[21],t?_a(r,s[21],o,null):ga(s[21]),null),(!t||o[0]&1)&&T(e,"id",s[0]),(!t||o[0]&4)&&T(e,"style",s[2])},i(s){t||(P(i,s),t=!0)},o(s){V(i,s),t=!1},d(s){s&&F(e),i&&i.d(s),n[23](null)}}}function jv(n,e,t){let r,i;$(n,zn,ee=>t(24,r=ee)),$(n,O_,ee=>t(20,i=ee));let{$$slots:s={},$$scope:o}=e,{isHit_closure:a=null}=e,{mouse_state_closure:l=Handle_Result}=e,{height:u=I.default_buttonSize}=e,{width:h=I.default_buttonSize}=e,{origin:f=null}=e,{center:d=null}=e,{detect_doubleClick:p=!1}=e,{detect_longClick:g=!1}=e,{detect_mouseDown:b=!0}=e,{detect_mouseUp:A=!0}=e,{position:S="absolute"}=e,{zindex:v=Ee.dots}=e,{font_size:x="0.9em"}=e,{cursor:E="pointer"}=e,{align_left:L=!0}=e,{name:z="generic"}=e;const k=pt.mouse_state_forName(z),y=pt.mouse_timer_forName(z),w=ae.next_mouse_responder_number;let D=!1,N=I.empty,M;Zt(()=>{if(ge(),M)return M.addEventListener("pointerup",j),M.addEventListener("pointerdown",Z),()=>{M.removeEventListener("pointerup",j),M.removeEventListener("pointerdown",Z)}});function O(){t(18,k.clicks=0,k),y.reset()}function H(ee,fe=!1,Ve=!1){const ye=k.copy;return ye.isUp=!ee&&!fe&&!Ve,ye.element=M,ye.isDouble=fe,ye.isLong=Ve,ye.isHover=!1,ye.isDown=ee,t(19,D=ee),ye.event=event,ye}function j(ee){A&&(O(),l(nn.up(ee,M)),ie.log_action(` up ${w} RESPONDER`))}function Z(ee){b&&k.clicks==0&&l(H(!0)),t(18,k.clicks+=1,k),p&&y.setTimeout(lu.double,()=>{k.clicks==2&&(O(),l(H(!1,!0,!1)))}),g&&y.setTimeout(lu.long,()=>{O(),l(H(!1,!1,!0))})}function ge(){var ee,fe;if(t(2,N=`
			width: ${h}px;
			z-index: ${v};
			height: ${u}px;
			position: ${S};
			font-size: ${x};
			font-family: ${r};
			`.removeWhiteSpace()),E&&t(2,N=`${N} cursor: ${E};`),f||d){const Ve=(ee=f==null?void 0:f.x)!==null&&ee!==void 0?ee:(d==null?void 0:d.x)-h/2,ye=(fe=f==null?void 0:f.y)!==null&&fe!==void 0?fe:(d==null?void 0:d.y)-u/2;t(2,N=`${N} ${L?"left: ":"right: "}${Ve}px; top: ${ye}px;`)}}function le(ee){ut[ee?"unshift":"push"](()=>{M=ee,t(1,M)})}return n.$$set=ee=>{"isHit_closure"in ee&&t(3,a=ee.isHit_closure),"mouse_state_closure"in ee&&t(4,l=ee.mouse_state_closure),"height"in ee&&t(5,u=ee.height),"width"in ee&&t(6,h=ee.width),"origin"in ee&&t(7,f=ee.origin),"center"in ee&&t(8,d=ee.center),"detect_doubleClick"in ee&&t(9,p=ee.detect_doubleClick),"detect_longClick"in ee&&t(10,g=ee.detect_longClick),"detect_mouseDown"in ee&&t(11,b=ee.detect_mouseDown),"detect_mouseUp"in ee&&t(12,A=ee.detect_mouseUp),"position"in ee&&t(13,S=ee.position),"zindex"in ee&&t(14,v=ee.zindex),"font_size"in ee&&t(15,x=ee.font_size),"cursor"in ee&&t(16,E=ee.cursor),"align_left"in ee&&t(17,L=ee.align_left),"name"in ee&&t(0,z=ee.name),"$$scope"in ee&&t(21,o=ee.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&256&&ge(),n.$$.dirty[0]&1835034){const ee=i;if(M&&ee){let fe=!1;a?fe=a():fe=De.rect_forElement_containsPoint(M,ee),k.isHover!=fe?(t(18,k.isHover=fe,k),t(18,k.isOut=!fe,k),l(nn.hover(null,M,fe))):l(nn.move(null,M,D,fe))}}},[z,M,N,a,l,u,h,f,d,p,g,b,A,S,v,x,E,L,k,D,i,o,s,le]}class lr extends Se{constructor(e){super(),Pe(this,e,jv,Uv,ce,{isHit_closure:3,mouse_state_closure:4,height:5,width:6,origin:7,center:8,detect_doubleClick:9,detect_longClick:10,detect_mouseDown:11,detect_mouseUp:12,position:13,zindex:14,font_size:15,cursor:16,align_left:17,name:0},null,[-1,-1])}}function qv(n){let e,t,r,i,s,o,a,l,u=n[1].title+"",h;return{c(){e=Ke("svg"),t=Ke("path"),a=J(),l=W("div"),h=at(u),T(t,"class","segment-path"),T(t,"d",r=n[1].path),T(t,"stroke-width","0.3px"),T(t,"stroke",n[3]),T(t,"id",i=`${n[2]}`),T(t,"fill",n[0]),T(e,"id",s=`${n[2]}`),T(e,"class","segment-svg"),T(e,"viewBox",o=n[1].viewBox),C(e,"height",n[6].height+"px"),C(e,"width",n[6].width+"px"),C(e,"position","absolute"),C(e,"left","0px"),T(l,"class","title"),C(l,"left",n[1].title_origin.x+"px"),C(l,"top",n[1].title_origin.y+"px"),C(l,"color",n[4]),C(l,"position","absolute")},m(f,d){B(f,e,d),K(e,t),B(f,a,d),B(f,l,d),K(l,h)},p(f,d){d&2&&r!==(r=f[1].path)&&T(t,"d",r),d&8&&T(t,"stroke",f[3]),d&4&&i!==(i=`${f[2]}`)&&T(t,"id",i),d&1&&T(t,"fill",f[0]),d&4&&s!==(s=`${f[2]}`)&&T(e,"id",s),d&2&&o!==(o=f[1].viewBox)&&T(e,"viewBox",o),d&2&&u!==(u=f[1].title+"")&&Dt(h,u),d&2&&C(l,"left",f[1].title_origin.x+"px"),d&2&&C(l,"top",f[1].title_origin.y+"px"),d&16&&C(l,"color",f[4])},d(f){f&&(F(e),F(a),F(l))}}}function Hv(n){let e,t;return e=new lr({props:{cursor:"pointer",width:n[6].width,name:n[5],height:n[6].height,zindex:Ee.frontmost,origin:n[1].origin,mouse_state_closure:n[7],$$slots:{default:[qv]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,[i]){const s={};i&2&&(s.origin=r[1].origin),i&2079&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Gv(n,e,t){let{hit_closure:r=(g,b)=>{}}=e,{fill:i=I.color_background}=e,{segment_map:s}=e,{name:o=s.title}=e,{stroke:a=I.color_default}=e;const l=`${o}-segment`;let u=I.color_default,h=s.size,f=!1;d();function d(){t(4,u=f?I.color_background:I.color_default),t(0,i=f?I.color_default:s.isSelected?we.opacitize("skyblue",.6):I.color_background),ie.log_segments(`${o} ${s.isSelected?"selected":""} ${i}`)}function p(g){var b,A;g.isHover?f=!g.isOut:g.isUp&&r(o,(A=(b=g.event)===null||b===void 0?void 0:b.isShift)!==null&&A!==void 0?A:!1),d()}return n.$$set=g=>{"hit_closure"in g&&t(8,r=g.hit_closure),"fill"in g&&t(0,i=g.fill),"segment_map"in g&&t(1,s=g.segment_map),"name"in g&&t(2,o=g.name),"stroke"in g&&t(3,a=g.stroke)},[i,s,o,a,u,l,h,p,r]}class Kv extends Se{constructor(e){super(),Pe(this,e,Gv,Hv,ce,{hit_closure:8,fill:0,segment_map:1,name:2,stroke:3})}}function hf(n,e,t){const r=n.slice();return r[17]=e[t],r}function ff(n){let e,t;return e=new Kv({props:{fill:n[0],stroke:n[1],segment_map:n[17],hit_closure:n[7]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.fill=r[0]),i&2&&(s.stroke=r[1]),i&32&&(s.segment_map=r[17]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Wv(n){let e,t,r=fn(n[5]),i=[];for(let o=0;o<r.length;o+=1)i[o]=ff(hf(n,r,o));const s=o=>V(i[o],1,1,()=>{i[o]=null});return{c(){e=W("div");for(let o=0;o<i.length;o+=1)i[o].c();T(e,"class","segmented"),T(e,"id",n[4]),C(e,"width",n[6]+"px"),C(e,"top",n[3].y+"px"),C(e,"left",n[3].x+"px"),C(e,"position","absolute"),C(e,"height",n[2]+"px")},m(o,a){B(o,e,a);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);t=!0},p(o,[a]){if(a&163){r=fn(o[5]);let l;for(l=0;l<r.length;l+=1){const u=hf(o,r,l);i[l]?(i[l].p(u,a),P(i[l],1)):(i[l]=ff(u),i[l].c(),P(i[l],1),i[l].m(e,null))}for(de(),l=r.length;l<i.length;l+=1)s(l);_e()}(!t||a&16)&&T(e,"id",o[4]),(!t||a&64)&&C(e,"width",o[6]+"px"),(!t||a&8)&&C(e,"top",o[3].y+"px"),(!t||a&8)&&C(e,"left",o[3].x+"px"),(!t||a&4)&&C(e,"height",o[2]+"px")},i(o){if(!t){for(let a=0;a<r.length;a+=1)P(i[a]);t=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)V(i[a]);t=!1},d(o){o&&F(e),Jr(i,o)}}}function Xv(n,e,t){let{selection_closure:r=Handle_Result}=e,{selected:i=[]}=e,{titles:s=[]}=e,{fill:o=I.color_background}=e,{stroke:a=I.color_default}=e,{allow_multiple:l=!1}=e,{height:u=I.row_height}=e,{font_size:h="0.95em"}=e,{origin:f=G.zero}=e,{name:d=I.empty}=e,p=[],g=u/2;v();function b(E){return i.includes(E)}function A(E){return s[s.indexOf(E).increment(!0,s.length)]}function S(){t(6,g=u/2),t(5,p=[])}function v(){const E=s.length-1;let L=0,z=0;S();for(const k of s){const y=Vv.grab_segment_map(d,k,h,b(k),L,E,z,u);p.push(y),z+=y.width,L+=1}t(6,g=z)}function x(E,L){const z=!b(E);l?z?i.push(E):t(8,i=i.filter(k=>k!=E)):t(8,i=z?[E]:[A(E)]),r(i)}return n.$$set=E=>{"selection_closure"in E&&t(9,r=E.selection_closure),"selected"in E&&t(8,i=E.selected),"titles"in E&&t(10,s=E.titles),"fill"in E&&t(0,o=E.fill),"stroke"in E&&t(1,a=E.stroke),"allow_multiple"in E&&t(11,l=E.allow_multiple),"height"in E&&t(2,u=E.height),"font_size"in E&&t(12,h=E.font_size),"origin"in E&&t(3,f=E.origin),"name"in E&&t(4,d=E.name)},[o,a,u,f,d,p,g,x,i,r,s,l,h]}class Ys extends Se{constructor(e){super(),Pe(this,e,Xv,Wv,ce,{selection_closure:9,selected:8,titles:10,fill:0,stroke:1,allow_multiple:11,height:2,font_size:12,origin:3,name:4})}}function df(n){let e,t;return{c(){e=W("div"),t=at(n[0]),C(e,"padding","0px 5px"),C(e,"left",n[3]+"px"),C(e,"top",n[2]-5.3+"px"),C(e,"position","absolute"),C(e,"font-size",Tg+"em"),C(e,"z-index",Ee.frontmost),C(e,"background-color",I.color_background)},m(r,i){B(r,e,i),K(e,t)},p(r,i){i&1&&Dt(t,r[0]),i&4&&C(e,"top",r[2]-5.3+"px")},d(r){r&&F(e)}}}function Yv(n){let e,t,r,i=!!n[0]&&df(n);return{c(){e=W("div"),t=J(),i&&i.c(),r=Te(),T(e,"class","horizontal-line"),C(e,"height","1px"),C(e,"top",n[2]+"px"),C(e,"width",n[1]+"px"),C(e,"position","absolute"),C(e,"z-index",Ee.details),C(e,"background-color","lightgray")},m(s,o){B(s,e,o),B(s,t,o),i&&i.m(s,o),B(s,r,o)},p(s,[o]){o&4&&C(e,"top",s[2]+"px"),o&2&&C(e,"width",s[1]+"px"),s[0]?i?i.p(s,o):(i=df(s),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},i:ue,o:ue,d(s){s&&(F(e),F(t),F(r)),i&&i.d(s)}}}const Tg=.5;function Qv(n,e,t){let{title:r=null}=e,{width:i=I.width_details}=e,{top:s=71}=e;const o=(i-12-we.getWidth_ofString_withSize(r??I.empty,`${I.font_size*Tg}px`))/2;return n.$$set=a=>{"title"in a&&t(0,r=a.title),"width"in a&&t(1,i=a.width),"top"in a&&t(2,s=a.top)},[r,i,s,o]}class Qs extends Se{constructor(e){super(),Pe(this,e,Qv,Yv,ce,{title:0,width:1,top:2})}}function Jv(n,e,t){let{top:r=0}=e;return n.$$set=i=>{"top"in i&&t(0,r=i.top)},[r]}class Zv extends Se{constructor(e){super(),Pe(this,e,Jv,null,ce,{top:0})}}function $v(n){let e,t,r;const i=n[16].default,s=da(i,n,n[17],null);return{c(){e=W("button"),s&&s.c(),T(e,"class","button"),T(e,"id",t="button-for-"+n[4]),T(e,"style",n[5])},m(o,a){B(o,e,a),s&&s.m(e,null),r=!0},p(o,a){s&&s.p&&(!r||a&131072)&&pa(s,i,o,o[17],r?_a(i,o[17],a,null):ga(o[17]),null),(!r||a&16&&t!==(t="button-for-"+o[4]))&&T(e,"id",t),(!r||a&32)&&T(e,"style",o[5])},i(o){r||(P(s,o),r=!0)},o(o){V(s,o),r=!1},d(o){o&&F(e),s&&s.d(o)}}}function ek(n){let e,t;return e=new lr({props:{name:n[4],width:n[1],height:n[0],zindex:n[2],center:n[3],mouse_state_closure:n[6],$$slots:{default:[$v]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,[i]){const s={};i&16&&(s.name=r[4]),i&2&&(s.width=r[1]),i&1&&(s.height=r[0]),i&4&&(s.zindex=r[2]),i&8&&(s.center=r[3]),i&131120&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function tk(n,e,t){let r;$(n,zn,y=>t(19,r=y));let{$$slots:i={},$$scope:s}=e,{background_color:o=I.color_background}=e,{closure:a=Handle_Result}=e,{border_color:l=I.color_default}=e,{height:u=I.default_buttonSize}=e,{width:h=I.default_buttonSize}=e,{element_state:f}=e,{padding:d="0px 6px 1px 6px"}=e,{color:p=I.color_default}=e,{position:g="absolute"}=e,{zindex:b=Ee.dots}=e,{border_thickness:A=1}=e,{center:S=G.zero}=e,{style:v=I.empty}=e,{name:x=I.empty}=e,E=I.empty,L=v;z();function z(){t(8,p=f.stroke),t(7,o=f.fill),v.length==0&&(E=A==0?"none":`${A}px solid ${l}`,t(5,L=`
				left:0px;
				color:${p};
				width:${h}px;
				border:${E};
				z-index:${b};
				padding:${d};
				height:${u}px;
				position:${g};
				border-radius:${u/2}px;
				cursor:${f.cursor};
				font-family:${r};
				background-color:${o};
			`.removeWhiteSpace()))}function k(y){a(y),y.isHover&&z()}return n.$$set=y=>{"background_color"in y&&t(7,o=y.background_color),"closure"in y&&t(9,a=y.closure),"border_color"in y&&t(10,l=y.border_color),"height"in y&&t(0,u=y.height),"width"in y&&t(1,h=y.width),"element_state"in y&&t(11,f=y.element_state),"padding"in y&&t(12,d=y.padding),"color"in y&&t(8,p=y.color),"position"in y&&t(13,g=y.position),"zindex"in y&&t(2,b=y.zindex),"border_thickness"in y&&t(14,A=y.border_thickness),"center"in y&&t(3,S=y.center),"style"in y&&t(15,v=y.style),"name"in y&&t(4,x=y.name),"$$scope"in y&&t(17,s=y.$$scope)},[u,h,b,S,x,L,k,o,p,a,l,f,d,g,A,v,i,s]}class Rn extends Se{constructor(e){super(),Pe(this,e,tk,ek,ce,{background_color:7,closure:9,border_color:10,height:0,width:1,element_state:11,padding:12,color:8,position:13,zindex:2,border_thickness:14,center:3,style:15,name:4})}}function _f(n,e,t){const r=n.slice();return r[2]=e[t][0],r[3]=e[t][1],r}function pf(n){let e,t,r=fn(n[1]),i=[];for(let s=0;s<r.length;s+=1)i[s]=gf(_f(n,r,s));return{c(){e=W("div"),t=W("table");for(let s=0;s<i.length;s+=1)i[s].c();C(t,"width",I.width_details+"px"),C(t,"left","12px"),C(t,"color","black"),T(e,"class","ancestry-info"),C(e,"left","10px"),C(e,"top",n[0]+"px"),C(e,"position","absolute"),C(e,"z-index",Ee.details)},m(s,o){B(s,e,o),K(e,t);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(t,null)},p(s,o){if(o&2){r=fn(s[1]);let a;for(a=0;a<r.length;a+=1){const l=_f(s,r,a);i[a]?i[a].p(l,o):(i[a]=gf(l),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=r.length}o&1&&C(e,"top",s[0]+"px")},d(s){s&&F(e),Jr(i,s)}}}function gf(n){let e,t,r=n[2]+"",i,s,o,a,l=n[3]+"",u,h;return{c(){e=W("tr"),t=W("td"),i=at(r),s=at(":"),o=J(),a=W("td"),u=at(l),h=J(),T(t,"class","first svelte-v7g0mp"),T(a,"class","second svelte-v7g0mp")},m(f,d){B(f,e,d),K(e,t),K(t,i),K(t,s),K(e,o),K(e,a),K(a,u),K(e,h)},p(f,d){d&2&&r!==(r=f[2]+"")&&Dt(i,r),d&2&&l!==(l=f[3]+"")&&Dt(u,l)},d(f){f&&F(e)}}}function nk(n){let e,t=n[1]&&pf(n);return{c(){t&&t.c(),e=Te()},m(r,i){t&&t.m(r,i),B(r,e,i)},p(r,[i]){r[1]?t?t.p(r,i):(t=pf(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ue,o:ue,d(r){r&&F(e),t&&t.d(r)}}}function rk(n,e,t){let{top:r=0}=e,{array:i}=e;return n.$$set=s=>{"top"in s&&t(0,r=s.top),"array"in s&&t(1,i=s.array)},[r,i]}class Eg extends Se{constructor(e){super(),Pe(this,e,rk,nk,ce,{top:0,array:1})}}function ik(n){let e,t;return{c(){e=W("span"),t=at("import"),T(e,"style",n[5])},m(r,i){B(r,e,i),K(e,t)},p:ue,d(r){r&&F(e)}}}function sk(n){let e,t;return{c(){e=W("span"),t=at("export"),T(e,"style",n[5])},m(r,i){B(r,e,i),K(e,t)},p:ue,d(r){r&&F(e)}}}function mf(n){let e,t,r,i,s,o,a,l,u,h;return t=new Ys({props:{name:"db",selected:[n[4]],origin:new G(4,n[0]),selection_closure:n[6],titles:[bt.local,bt.firebase,bt.airtable,bt.test]}}),s=new Eg({props:{top:n[0]+20,array:n[2]}}),a=new Rn({props:{name:"import",width:"42",zindex:"ZIndex.frontmost",center:new G(74,120),height:I.default_buttonSize-4,element_state:n[1][Vn.import],closure:n[11],$$slots:{default:[ik]},$$scope:{ctx:n}}}),u=new Rn({props:{name:"export",width:"42",zindex:"ZIndex.frontmost",center:new G(122,120),height:I.default_buttonSize-4,element_state:n[1][Vn.export],closure:n[12],$$slots:{default:[sk]},$$scope:{ctx:n}}}),{c(){e=W("div"),Q(t.$$.fragment),r=J(),i=W("div"),Q(s.$$.fragment),o=J(),Q(a.$$.fragment),l=J(),Q(u.$$.fragment),T(i,"class","data-information"),C(i,"font-size","0.8em"),C(i,"width",I.width_details+"px"),T(e,"class","storage-information"),C(e,"height","40px"),C(e,"padding","5px")},m(f,d){B(f,e,d),X(t,e,null),K(e,r),K(e,i),X(s,i,null),K(e,o),X(a,e,null),K(e,l),X(u,e,null),h=!0},p(f,d){const p={};d&16&&(p.selected=[f[4]]),d&1&&(p.origin=new G(4,f[0])),t.$set(p);const g={};d&1&&(g.top=f[0]+20),d&4&&(g.array=f[2]),s.$set(g);const b={};d&2&&(b.element_state=f[1][Vn.import]),d&32768&&(b.$$scope={dirty:d,ctx:f}),a.$set(b);const A={};d&2&&(A.element_state=f[1][Vn.export]),d&32768&&(A.$$scope={dirty:d,ctx:f}),u.$set(A)},i(f){h||(P(t.$$.fragment,f),P(s.$$.fragment,f),P(a.$$.fragment,f),P(u.$$.fragment,f),h=!0)},o(f){V(t.$$.fragment,f),V(s.$$.fragment,f),V(a.$$.fragment,f),V(u.$$.fragment,f),h=!1},d(f){f&&F(e),Y(t),Y(s),Y(a),Y(u)}}}function ok(n){let e=(n[4],n[3]),t,r,i=mf(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&24&&ce(e,e=(s[4],s[3]))?(de(),V(i,1,1,ue),_e(),i=mf(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function ak(n,e,t){let r,i,s,o,a;$(n,Fe,v=>t(8,r=v)),$(n,Oo,v=>t(9,i=v)),$(n,D_,v=>t(10,s=v)),$(n,zn,v=>t(13,o=v)),$(n,di,v=>t(4,a=v));let{top:l=28}=e;const u=`font-family: ${o}; font-size:0.85em; left: 5px; top: -2px; position: absolute;`;let h={},f=[],d=0;g();function p(v){const x=v[0];st.db_change_toType(x)}function g(){const v=[Vn.export,Vn.import];for(const x of v){const E=pt.element_state_for(null,dn.storage,x);E.set_forHovering("black","pointer"),E.color_background=I.color_background,t(1,h[x]=E,h)}}function b(v,x){if(v.isHover)t(1,h[x].isOut=v.isOut,h);else if(v.isUp){const E=r;switch(x){case Vn.export:E.save_toFile();break;case Vn.import:E.select_file_toUpload(v.event.shiftKey);break}}}const A=v=>b(v,Vn.import),S=v=>b(v,Vn.export);return n.$$set=v=>{"top"in v&&t(0,l=v.top)},n.$$.update=()=>{if(n.$$.dirty&1800){const v=r;if(v){const x={};i?x["fetch took"]=i:x.data="stored locally",x.things=v.things.length,x.relationships=v.relationships.length,t(2,f=Object.entries(x)),t(3,d+=1)}}},[l,h,f,d,a,u,p,b,r,i,s,A,S]}class lk extends Se{constructor(e){super(),Pe(this,e,ak,ok,ce,{top:0})}}function uk(n){let e;return{c(){e=W("div"),T(e,"class","circle svelte-6rqz6k"),C(e,"width",n[6]+"px"),C(e,"height",n[6]+"px"),C(e,"z-index",n[0]),C(e,"top",n[3].y-n[2]+"px"),C(e,"left",n[3].x-n[2]+"px"),C(e,"border",n[1]+"px solid "+n[4]),C(e,"background-color",n[5])},m(t,r){B(t,e,r)},p(t,[r]){r&64&&C(e,"width",t[6]+"px"),r&64&&C(e,"height",t[6]+"px"),r&1&&C(e,"z-index",t[0]),r&12&&C(e,"top",t[3].y-t[2]+"px"),r&12&&C(e,"left",t[3].x-t[2]+"px"),r&18&&C(e,"border",t[1]+"px solid "+t[4]),r&32&&C(e,"background-color",t[5])},i:ue,o:ue,d(t){t&&F(e)}}}function ck(n,e,t){let{color_background:r=ie.lines?"transparent":I.color_background}=e,{zindex:i=Ee.dots}=e,{opacity:s=0}=e,{thickness:o}=e,{radius:a}=e,{center:l}=e,{color:u}=e,h="transparent",f=0;return n.$$set=d=>{"color_background"in d&&t(7,r=d.color_background),"zindex"in d&&t(0,i=d.zindex),"opacity"in d&&t(8,s=d.opacity),"thickness"in d&&t(1,o=d.thickness),"radius"in d&&t(2,a=d.radius),"center"in d&&t(3,l=d.center),"color"in d&&t(4,u=d.color)},n.$$.update=()=>{n.$$.dirty&388&&(t(6,f=a*2),t(5,h=we.opacitize(r,s)))},[i,o,a,l,u,h,f,r,s]}class hk extends Se{constructor(e){super(),Pe(this,e,ck,uk,ce,{color_background:7,zindex:0,opacity:8,thickness:1,radius:2,center:3,color:4})}}var fk={value:()=>{}};function Ag(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new Fo(t)}function Fo(n){this._=n}function dk(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}Fo.prototype=Ag.prototype={constructor:Fo,on:function(n,e){var t=this._,r=dk(n+"",t),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(n=r[s]).type)&&(i=_k(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(n=r[s]).type)t[i]=yf(t[i],n.name,e);else if(e==null)for(i in t)t[i]=yf(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new Fo(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,s;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)}};function _k(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function yf(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=fk,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var uu="http://www.w3.org/1999/xhtml";const bf={svg:"http://www.w3.org/2000/svg",xhtml:uu,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ha(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),bf.hasOwnProperty(e)?{space:bf[e],local:n}:n}function pk(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===uu&&e.documentElement.namespaceURI===uu?e.createElement(n):e.createElementNS(t,n)}}function gk(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Ig(n){var e=Ha(n);return(e.local?gk:pk)(e)}function mk(){}function rc(n){return n==null?mk:function(){return this.querySelector(n)}}function yk(n){typeof n!="function"&&(n=rc(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=n.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new vn(r,this._parents)}function bk(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function wk(){return[]}function Cg(n){return n==null?wk:function(){return this.querySelectorAll(n)}}function vk(n){return function(){return bk(n.apply(this,arguments))}}function kk(n){typeof n=="function"?n=vk(n):n=Cg(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(r.push(n.call(l,l.__data__,u,o)),i.push(l));return new vn(r,i)}function Rg(n){return function(){return this.matches(n)}}function Pg(n){return function(e){return e.matches(n)}}var Tk=Array.prototype.find;function Ek(n){return function(){return Tk.call(this.children,n)}}function Ak(){return this.firstElementChild}function Ik(n){return this.select(n==null?Ak:Ek(typeof n=="function"?n:Pg(n)))}var Ck=Array.prototype.filter;function Rk(){return Array.from(this.children)}function Pk(n){return function(){return Ck.call(this.children,n)}}function Sk(n){return this.selectAll(n==null?Rk:Pk(typeof n=="function"?n:Pg(n)))}function Dk(n){typeof n!="function"&&(n=Rg(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&a.push(l);return new vn(r,this._parents)}function Sg(n){return new Array(n.length)}function Ok(){return new vn(this._enter||this._groups.map(Sg),this._parents)}function oa(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}oa.prototype={constructor:oa,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Nk(n){return function(){return n}}function Vk(n,e,t,r,i,s){for(var o=0,a,l=e.length,u=s.length;o<u;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new oa(n,s[o]);for(;o<l;++o)(a=e[o])&&(i[o]=a)}function Mk(n,e,t,r,i,s,o){var a,l,u=new Map,h=e.length,f=s.length,d=new Array(h),p;for(a=0;a<h;++a)(l=e[a])&&(d[a]=p=o.call(l,l.__data__,a,e)+"",u.has(p)?i[a]=l:u.set(p,l));for(a=0;a<f;++a)p=o.call(n,s[a],a,s)+"",(l=u.get(p))?(r[a]=l,l.__data__=s[a],u.delete(p)):t[a]=new oa(n,s[a]);for(a=0;a<h;++a)(l=e[a])&&u.get(d[a])===l&&(i[a]=l)}function xk(n){return n.__data__}function Lk(n,e){if(!arguments.length)return Array.from(this,xk);var t=e?Mk:Vk,r=this._parents,i=this._groups;typeof n!="function"&&(n=Nk(n));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],f=i[u],d=f.length,p=zk(n.call(h,h&&h.__data__,u,r)),g=p.length,b=a[u]=new Array(g),A=o[u]=new Array(g),S=l[u]=new Array(d);t(h,f,b,A,S,p,e);for(var v=0,x=0,E,L;v<g;++v)if(E=b[v]){for(v>=x&&(x=v+1);!(L=A[x])&&++x<g;);E._next=L||null}}return o=new vn(o,r),o._enter=a,o._exit=l,o}function zk(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function Fk(){return new vn(this._exit||this._groups.map(Sg),this._parents)}function Bk(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function Uk(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u=t[l],h=r[l],f=u.length,d=a[l]=new Array(f),p,g=0;g<f;++g)(p=u[g]||h[g])&&(d[g]=p);for(;l<i;++l)a[l]=t[l];return new vn(a,this._parents)}function jk(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function qk(n){n||(n=Hk);function e(f,d){return f&&d?n(f.__data__,d.__data__):!f-!d}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,l=i[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(e)}return new vn(i,this._parents).order()}function Hk(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function Gk(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function Kk(){return Array.from(this)}function Wk(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function Xk(){let n=0;for(const e of this)++n;return n}function Yk(){return!this.node()}function Qk(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function Jk(n){return function(){this.removeAttribute(n)}}function Zk(n){return function(){this.removeAttributeNS(n.space,n.local)}}function $k(n,e){return function(){this.setAttribute(n,e)}}function e2(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function t2(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function n2(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function r2(n,e){var t=Ha(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?Zk:Jk:typeof e=="function"?t.local?n2:t2:t.local?e2:$k)(t,e))}function Dg(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function i2(n){return function(){this.style.removeProperty(n)}}function s2(n,e,t){return function(){this.style.setProperty(n,e,t)}}function o2(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function a2(n,e,t){return arguments.length>1?this.each((e==null?i2:typeof e=="function"?o2:s2)(n,e,t??"")):Vi(this.node(),n)}function Vi(n,e){return n.style.getPropertyValue(e)||Dg(n).getComputedStyle(n,null).getPropertyValue(e)}function l2(n){return function(){delete this[n]}}function u2(n,e){return function(){this[n]=e}}function c2(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function h2(n,e){return arguments.length>1?this.each((e==null?l2:typeof e=="function"?c2:u2)(n,e)):this.node()[n]}function Og(n){return n.trim().split(/^|\s+/)}function ic(n){return n.classList||new Ng(n)}function Ng(n){this._node=n,this._names=Og(n.getAttribute("class")||"")}Ng.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Vg(n,e){for(var t=ic(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function Mg(n,e){for(var t=ic(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function f2(n){return function(){Vg(this,n)}}function d2(n){return function(){Mg(this,n)}}function _2(n,e){return function(){(e.apply(this,arguments)?Vg:Mg)(this,n)}}function p2(n,e){var t=Og(n+"");if(arguments.length<2){for(var r=ic(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?_2:e?f2:d2)(t,e))}function g2(){this.textContent=""}function m2(n){return function(){this.textContent=n}}function y2(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function b2(n){return arguments.length?this.each(n==null?g2:(typeof n=="function"?y2:m2)(n)):this.node().textContent}function w2(){this.innerHTML=""}function v2(n){return function(){this.innerHTML=n}}function k2(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function T2(n){return arguments.length?this.each(n==null?w2:(typeof n=="function"?k2:v2)(n)):this.node().innerHTML}function E2(){this.nextSibling&&this.parentNode.appendChild(this)}function A2(){return this.each(E2)}function I2(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function C2(){return this.each(I2)}function R2(n){var e=typeof n=="function"?n:Ig(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function P2(){return null}function S2(n,e){var t=typeof n=="function"?n:Ig(n),r=e==null?P2:typeof e=="function"?e:rc(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function D2(){var n=this.parentNode;n&&n.removeChild(this)}function O2(){return this.each(D2)}function N2(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function V2(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function M2(n){return this.select(n?V2:N2)}function x2(n){return arguments.length?this.property("__data__",n):this.node().__data__}function L2(n){return function(e){n.call(this,e,this.__data__)}}function z2(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function F2(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function B2(n,e,t){return function(){var r=this.__on,i,s=L2(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function U2(n,e,t){var r=z2(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(i=0,h=a[l];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(a=e?B2:F2,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function xg(n,e,t){var r=Dg(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function j2(n,e){return function(){return xg(this,n,e)}}function q2(n,e){return function(){return xg(this,n,e.apply(this,arguments))}}function H2(n,e){return this.each((typeof e=="function"?q2:j2)(n,e))}function*G2(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Lg=[null];function vn(n,e){this._groups=n,this._parents=e}function Js(){return new vn([[document.documentElement]],Lg)}function K2(){return this}vn.prototype=Js.prototype={constructor:vn,select:yk,selectAll:kk,selectChild:Ik,selectChildren:Sk,filter:Dk,data:Lk,enter:Ok,exit:Fk,join:Bk,merge:Uk,selection:K2,order:jk,sort:qk,call:Gk,nodes:Kk,node:Wk,size:Xk,empty:Yk,each:Qk,attr:r2,style:a2,property:h2,classed:p2,text:b2,html:T2,raise:A2,lower:C2,append:R2,insert:S2,remove:O2,clone:M2,datum:x2,on:U2,dispatch:H2,[Symbol.iterator]:G2};function wf(n){return typeof n=="string"?new vn([[document.querySelector(n)]],[document.documentElement]):new vn([[n]],Lg)}function sc(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function zg(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function Zs(){}var Ms=.7,aa=1/Ms,ki="\\s*([+-]?\\d+)\\s*",xs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",W2=/^#([0-9a-f]{3,8})$/,X2=new RegExp(`^rgb\\(${ki},${ki},${ki}\\)$`),Y2=new RegExp(`^rgb\\(${Gn},${Gn},${Gn}\\)$`),Q2=new RegExp(`^rgba\\(${ki},${ki},${ki},${xs}\\)$`),J2=new RegExp(`^rgba\\(${Gn},${Gn},${Gn},${xs}\\)$`),Z2=new RegExp(`^hsl\\(${xs},${Gn},${Gn}\\)$`),$2=new RegExp(`^hsla\\(${xs},${Gn},${Gn},${xs}\\)$`),vf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sc(Zs,Ls,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:kf,formatHex:kf,formatHex8:eT,formatHsl:tT,formatRgb:Tf,toString:Tf});function kf(){return this.rgb().formatHex()}function eT(){return this.rgb().formatHex8()}function tT(){return Fg(this).formatHsl()}function Tf(){return this.rgb().formatRgb()}function Ls(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=W2.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?Ef(e):t===3?new un(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Eo(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Eo(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=X2.exec(n))?new un(e[1],e[2],e[3],1):(e=Y2.exec(n))?new un(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Q2.exec(n))?Eo(e[1],e[2],e[3],e[4]):(e=J2.exec(n))?Eo(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Z2.exec(n))?Cf(e[1],e[2]/100,e[3]/100,1):(e=$2.exec(n))?Cf(e[1],e[2]/100,e[3]/100,e[4]):vf.hasOwnProperty(n)?Ef(vf[n]):n==="transparent"?new un(NaN,NaN,NaN,0):null}function Ef(n){return new un(n>>16&255,n>>8&255,n&255,1)}function Eo(n,e,t,r){return r<=0&&(n=e=t=NaN),new un(n,e,t,r)}function nT(n){return n instanceof Zs||(n=Ls(n)),n?(n=n.rgb(),new un(n.r,n.g,n.b,n.opacity)):new un}function cu(n,e,t,r){return arguments.length===1?nT(n):new un(n,e,t,r??1)}function un(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}sc(un,cu,zg(Zs,{brighter(n){return n=n==null?aa:Math.pow(aa,n),new un(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Ms:Math.pow(Ms,n),new un(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new un(Hr(this.r),Hr(this.g),Hr(this.b),la(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Af,formatHex:Af,formatHex8:rT,formatRgb:If,toString:If}));function Af(){return`#${Fr(this.r)}${Fr(this.g)}${Fr(this.b)}`}function rT(){return`#${Fr(this.r)}${Fr(this.g)}${Fr(this.b)}${Fr((isNaN(this.opacity)?1:this.opacity)*255)}`}function If(){const n=la(this.opacity);return`${n===1?"rgb(":"rgba("}${Hr(this.r)}, ${Hr(this.g)}, ${Hr(this.b)}${n===1?")":`, ${n})`}`}function la(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Hr(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Fr(n){return n=Hr(n),(n<16?"0":"")+n.toString(16)}function Cf(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Mn(n,e,t,r)}function Fg(n){if(n instanceof Mn)return new Mn(n.h,n.s,n.l,n.opacity);if(n instanceof Zs||(n=Ls(n)),!n)return new Mn;if(n instanceof Mn)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,a=s-i,l=(s+i)/2;return a?(e===s?o=(t-r)/a+(t<r)*6:t===s?o=(r-e)/a+2:o=(e-t)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Mn(o,a,l,n.opacity)}function iT(n,e,t,r){return arguments.length===1?Fg(n):new Mn(n,e,t,r??1)}function Mn(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}sc(Mn,iT,zg(Zs,{brighter(n){return n=n==null?aa:Math.pow(aa,n),new Mn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Ms:Math.pow(Ms,n),new Mn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new un(Il(n>=240?n-240:n+120,i,r),Il(n,i,r),Il(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Mn(Rf(this.h),Ao(this.s),Ao(this.l),la(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=la(this.opacity);return`${n===1?"hsl(":"hsla("}${Rf(this.h)}, ${Ao(this.s)*100}%, ${Ao(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Rf(n){return n=(n||0)%360,n<0?n+360:n}function Ao(n){return Math.max(0,Math.min(1,n||0))}function Il(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const Bg=n=>()=>n;function sT(n,e){return function(t){return n+t*e}}function oT(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function aT(n){return(n=+n)==1?Ug:function(e,t){return t-e?oT(e,t,n):Bg(isNaN(e)?t:e)}}function Ug(n,e){var t=e-n;return t?sT(n,t):Bg(isNaN(n)?e:n)}const Pf=function n(e){var t=aT(e);function r(i,s){var o=t((i=cu(i)).r,(s=cu(s)).r),a=t(i.g,s.g),l=t(i.b,s.b),u=Ug(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=a(h),i.b=l(h),i.opacity=u(h),i+""}}return r.gamma=n,r}(1);function dr(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var hu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Cl=new RegExp(hu.source,"g");function lT(n){return function(){return n}}function uT(n){return function(e){return n(e)+""}}function cT(n,e){var t=hu.lastIndex=Cl.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(n=n+"",e=e+"";(r=hu.exec(n))&&(i=Cl.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:dr(r,i)})),t=Cl.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?uT(l[0].x):lT(e):(e=l.length,function(u){for(var h=0,f;h<e;++h)a[(f=l[h]).i]=f.x(u);return a.join("")})}var Sf=180/Math.PI,fu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function jg(n,e,t,r,i,s){var o,a,l;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(l=n*t+e*r)&&(t-=n*l,r-=e*l),(a=Math.sqrt(t*t+r*r))&&(t/=a,r/=a,l/=a),n*r<e*t&&(n=-n,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,n)*Sf,skewX:Math.atan(l)*Sf,scaleX:o,scaleY:a}}var Io;function hT(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?fu:jg(e.a,e.b,e.c,e.d,e.e,e.f)}function fT(n){return n==null||(Io||(Io=document.createElementNS("http://www.w3.org/2000/svg","g")),Io.setAttribute("transform",n),!(n=Io.transform.baseVal.consolidate()))?fu:(n=n.matrix,jg(n.a,n.b,n.c,n.d,n.e,n.f))}function qg(n,e,t,r){function i(u){return u.length?u.pop()+" ":""}function s(u,h,f,d,p,g){if(u!==f||h!==d){var b=p.push("translate(",null,e,null,t);g.push({i:b-4,x:dr(u,f)},{i:b-2,x:dr(h,d)})}else(f||d)&&p.push("translate("+f+e+d+t)}function o(u,h,f,d){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),d.push({i:f.push(i(f)+"rotate(",null,r)-2,x:dr(u,h)})):h&&f.push(i(f)+"rotate("+h+r)}function a(u,h,f,d){u!==h?d.push({i:f.push(i(f)+"skewX(",null,r)-2,x:dr(u,h)}):h&&f.push(i(f)+"skewX("+h+r)}function l(u,h,f,d,p,g){if(u!==f||h!==d){var b=p.push(i(p)+"scale(",null,",",null,")");g.push({i:b-4,x:dr(u,f)},{i:b-2,x:dr(h,d)})}else(f!==1||d!==1)&&p.push(i(p)+"scale("+f+","+d+")")}return function(u,h){var f=[],d=[];return u=n(u),h=n(h),s(u.translateX,u.translateY,h.translateX,h.translateY,f,d),o(u.rotate,h.rotate,f,d),a(u.skewX,h.skewX,f,d),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,f,d),u=h=null,function(p){for(var g=-1,b=d.length,A;++g<b;)f[(A=d[g]).i]=A.x(p);return f.join("")}}}var dT=qg(hT,"px, ","px)","deg)"),_T=qg(fT,", ",")",")"),Mi=0,hs=0,ss=0,Hg=1e3,ua,fs,ca=0,Qr=0,Ga=0,zs=typeof performance=="object"&&performance.now?performance:Date,Gg=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function oc(){return Qr||(Gg(pT),Qr=zs.now()+Ga)}function pT(){Qr=0}function ha(){this._call=this._time=this._next=null}ha.prototype=Kg.prototype={constructor:ha,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?oc():+t)+(e==null?0:+e),!this._next&&fs!==this&&(fs?fs._next=this:ua=this,fs=this),this._call=n,this._time=t,du()},stop:function(){this._call&&(this._call=null,this._time=1/0,du())}};function Kg(n,e,t){var r=new ha;return r.restart(n,e,t),r}function gT(){oc(),++Mi;for(var n=ua,e;n;)(e=Qr-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Mi}function Df(){Qr=(ca=zs.now())+Ga,Mi=hs=0;try{gT()}finally{Mi=0,yT(),Qr=0}}function mT(){var n=zs.now(),e=n-ca;e>Hg&&(Ga-=e,ca=n)}function yT(){for(var n,e=ua,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:ua=t);fs=n,du(r)}function du(n){if(!Mi){hs&&(hs=clearTimeout(hs));var e=n-Qr;e>24?(n<1/0&&(hs=setTimeout(Df,n-zs.now()-Ga)),ss&&(ss=clearInterval(ss))):(ss||(ca=zs.now(),ss=setInterval(mT,Hg)),Mi=1,Gg(Df))}}function Of(n,e,t){var r=new ha;return e=e==null?0:+e,r.restart(i=>{r.stop(),n(i+e)},e,t),r}var bT=Ag("start","end","cancel","interrupt"),wT=[],Wg=0,Nf=1,_u=2,Bo=3,Vf=4,pu=5,Uo=6;function Ka(n,e,t,r,i,s){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;vT(n,t,{name:e,index:r,group:i,on:bT,tween:wT,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Wg})}function ac(n,e){var t=Fn(n,e);if(t.state>Wg)throw new Error("too late; already scheduled");return t}function Xn(n,e){var t=Fn(n,e);if(t.state>Bo)throw new Error("too late; already running");return t}function Fn(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function vT(n,e,t){var r=n.__transition,i;r[e]=t,t.timer=Kg(s,0,t.time);function s(u){t.state=Nf,t.timer.restart(o,t.delay,t.time),t.delay<=u&&o(u-t.delay)}function o(u){var h,f,d,p;if(t.state!==Nf)return l();for(h in r)if(p=r[h],p.name===t.name){if(p.state===Bo)return Of(o);p.state===Vf?(p.state=Uo,p.timer.stop(),p.on.call("interrupt",n,n.__data__,p.index,p.group),delete r[h]):+h<e&&(p.state=Uo,p.timer.stop(),p.on.call("cancel",n,n.__data__,p.index,p.group),delete r[h])}if(Of(function(){t.state===Bo&&(t.state=Vf,t.timer.restart(a,t.delay,t.time),a(u))}),t.state=_u,t.on.call("start",n,n.__data__,t.index,t.group),t.state===_u){for(t.state=Bo,i=new Array(d=t.tween.length),h=0,f=-1;h<d;++h)(p=t.tween[h].value.call(n,n.__data__,t.index,t.group))&&(i[++f]=p);i.length=f+1}}function a(u){for(var h=u<t.duration?t.ease.call(null,u/t.duration):(t.timer.restart(l),t.state=pu,1),f=-1,d=i.length;++f<d;)i[f].call(n,h);t.state===pu&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=Uo,t.timer.stop(),delete r[e];for(var u in r)return;delete n.__transition}}function kT(n,e){var t=n.__transition,r,i,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((r=t[o]).name!==e){s=!1;continue}i=r.state>_u&&r.state<pu,r.state=Uo,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[o]}s&&delete n.__transition}}function TT(n){return this.each(function(){kT(this,n)})}function ET(n,e){var t,r;return function(){var i=Xn(this,n),s=i.tween;if(s!==t){r=t=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function AT(n,e,t){var r,i;if(typeof t!="function")throw new Error;return function(){var s=Xn(this,n),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:t},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function IT(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=Fn(this.node(),t).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===n)return o.value;return null}return this.each((e==null?ET:AT)(t,n,e))}function lc(n,e,t){var r=n._id;return n.each(function(){var i=Xn(this,r);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return Fn(i,r).value[e]}}function Xg(n,e){var t;return(typeof e=="number"?dr:e instanceof Ls?Pf:(t=Ls(e))?(e=t,Pf):cT)(n,e)}function CT(n){return function(){this.removeAttribute(n)}}function RT(n){return function(){this.removeAttributeNS(n.space,n.local)}}function PT(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttribute(n);return o===i?null:o===r?s:s=e(r=o,t)}}function ST(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttributeNS(n.space,n.local);return o===i?null:o===r?s:s=e(r=o,t)}}function DT(n,e,t){var r,i,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a)))}}function OT(n,e,t){var r,i,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a)))}}function NT(n,e){var t=Ha(n),r=t==="transform"?_T:Xg;return this.attrTween(n,typeof e=="function"?(t.local?OT:DT)(t,r,lc(this,"attr."+n,e)):e==null?(t.local?RT:CT)(t):(t.local?ST:PT)(t,r,e))}function VT(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function MT(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function xT(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&MT(n,s)),t}return i._value=e,i}function LT(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&VT(n,s)),t}return i._value=e,i}function zT(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=Ha(n);return this.tween(t,(r.local?xT:LT)(r,e))}function FT(n,e){return function(){ac(this,n).delay=+e.apply(this,arguments)}}function BT(n,e){return e=+e,function(){ac(this,n).delay=e}}function UT(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?FT:BT)(e,n)):Fn(this.node(),e).delay}function jT(n,e){return function(){Xn(this,n).duration=+e.apply(this,arguments)}}function qT(n,e){return e=+e,function(){Xn(this,n).duration=e}}function HT(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?jT:qT)(e,n)):Fn(this.node(),e).duration}function GT(n,e){if(typeof e!="function")throw new Error;return function(){Xn(this,n).ease=e}}function KT(n){var e=this._id;return arguments.length?this.each(GT(e,n)):Fn(this.node(),e).ease}function WT(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Xn(this,n).ease=t}}function XT(n){if(typeof n!="function")throw new Error;return this.each(WT(this._id,n))}function YT(n){typeof n!="function"&&(n=Rg(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&a.push(l);return new or(r,this._parents,this._name,this._id)}function QT(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,i=t.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=e[a],u=t[a],h=l.length,f=o[a]=new Array(h),d,p=0;p<h;++p)(d=l[p]||u[p])&&(f[p]=d);for(;a<r;++a)o[a]=e[a];return new or(o,this._parents,this._name,this._id)}function JT(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function ZT(n,e,t){var r,i,s=JT(e)?ac:Xn;return function(){var o=s(this,n),a=o.on;a!==r&&(i=(r=a).copy()).on(e,t),o.on=i}}function $T(n,e){var t=this._id;return arguments.length<2?Fn(this.node(),t).on.on(n):this.each(ZT(t,n,e))}function eE(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function tE(){return this.on("end.remove",eE(this._id))}function nE(n){var e=this._name,t=this._id;typeof n!="function"&&(n=rc(n));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],l=a.length,u=s[o]=new Array(l),h,f,d=0;d<l;++d)(h=a[d])&&(f=n.call(h,h.__data__,d,a))&&("__data__"in h&&(f.__data__=h.__data__),u[d]=f,Ka(u[d],e,t,d,u,Fn(h,t)));return new or(s,this._parents,e,t)}function rE(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Cg(n));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l=r[a],u=l.length,h,f=0;f<u;++f)if(h=l[f]){for(var d=n.call(h,h.__data__,f,l),p,g=Fn(h,t),b=0,A=d.length;b<A;++b)(p=d[b])&&Ka(p,e,t,b,d,g);s.push(d),o.push(h)}return new or(s,o,e,t)}var iE=Js.prototype.constructor;function sE(){return new iE(this._groups,this._parents)}function oE(n,e){var t,r,i;return function(){var s=Vi(this,n),o=(this.style.removeProperty(n),Vi(this,n));return s===o?null:s===t&&o===r?i:i=e(t=s,r=o)}}function Yg(n){return function(){this.style.removeProperty(n)}}function aE(n,e,t){var r,i=t+"",s;return function(){var o=Vi(this,n);return o===i?null:o===r?s:s=e(r=o,t)}}function lE(n,e,t){var r,i,s;return function(){var o=Vi(this,n),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),Vi(this,n))),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}function uE(n,e){var t,r,i,s="style."+e,o="end."+s,a;return function(){var l=Xn(this,n),u=l.on,h=l.value[s]==null?a||(a=Yg(e)):void 0;(u!==t||i!==h)&&(r=(t=u).copy()).on(o,i=h),l.on=r}}function cE(n,e,t){var r=(n+="")=="transform"?dT:Xg;return e==null?this.styleTween(n,oE(n,r)).on("end.style."+n,Yg(n)):typeof e=="function"?this.styleTween(n,lE(n,r,lc(this,"style."+n,e))).each(uE(this._id,n)):this.styleTween(n,aE(n,r,e),t).on("end.style."+n,null)}function hE(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function fE(n,e,t){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&hE(n,o,t)),r}return s._value=e,s}function dE(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,fE(n,e,t??""))}function _E(n){return function(){this.textContent=n}}function pE(n){return function(){var e=n(this);this.textContent=e??""}}function gE(n){return this.tween("text",typeof n=="function"?pE(lc(this,"text",n)):_E(n==null?"":n+""))}function mE(n){return function(e){this.textContent=n.call(this,e)}}function yE(n){var e,t;function r(){var i=n.apply(this,arguments);return i!==t&&(e=(t=i)&&mE(i)),e}return r._value=n,r}function bE(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,yE(n))}function wE(){for(var n=this._name,e=this._id,t=Qg(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=Fn(l,e);Ka(l,n,t,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new or(r,this._parents,n,t)}function vE(){var n,e,t=this,r=t._id,i=t.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--i===0&&s()}};t.each(function(){var u=Xn(this,r),h=u.on;h!==n&&(e=(n=h).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),i===0&&s()})}var kE=0;function or(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function Qg(){return++kE}var Jn=Js.prototype;or.prototype={constructor:or,select:nE,selectAll:rE,selectChild:Jn.selectChild,selectChildren:Jn.selectChildren,filter:YT,merge:QT,selection:sE,transition:wE,call:Jn.call,nodes:Jn.nodes,node:Jn.node,size:Jn.size,empty:Jn.empty,each:Jn.each,on:$T,attr:NT,attrTween:zT,style:cE,styleTween:dE,text:gE,textTween:bE,remove:tE,tween:IT,delay:UT,duration:HT,ease:KT,easeVarying:XT,end:vE,[Symbol.iterator]:Jn[Symbol.iterator]};function TE(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var EE={time:null,delay:0,duration:250,ease:TE};function AE(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function IE(n){var e,t;n instanceof or?(e=n._id,n=n._name):(e=Qg(),(t=EE).time=oc(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&Ka(l,n,e,u,o,t||AE(l,e));return new or(r,this._parents,n,e)}Js.prototype.interrupt=TT;Js.prototype.transition=IE;function ds(n,e,t){this.k=n,this.x=e,this.y=t}ds.prototype={constructor:ds,scale:function(n){return n===1?this:new ds(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new ds(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ds.prototype;function CE(n){let e,t,r,i;return{c(){e=Ke("svg"),T(e,"class",n[2]),T(e,"width",t=n[4]+"px"),T(e,"height",r=n[3]+"px"),T(e,"viewBox",i="0 0 "+n[4]+" "+n[3]),C(e,"top",n[6]+"px"),C(e,"left",n[5]+"px"),C(e,"z-index",n[1]),C(e,"position",n[0]),C(e,"shape-rendering","geometricPrecision")},m(s,o){B(s,e,o),n[11](e)},p(s,[o]){o&4&&T(e,"class",s[2]),o&16&&t!==(t=s[4]+"px")&&T(e,"width",t),o&8&&r!==(r=s[3]+"px")&&T(e,"height",r),o&24&&i!==(i="0 0 "+s[4]+" "+s[3])&&T(e,"viewBox",i),o&64&&C(e,"top",s[6]+"px"),o&32&&C(e,"left",s[5]+"px"),o&2&&C(e,"z-index",s[1]),o&1&&C(e,"position",s[0])},i:ue,o:ue,d(s){s&&F(e),n[11](null)}}}function RE(n,e,t){let{position:r="absolute"}=e,{zIndex:i=Ee.dots}=e,{svgPath:s=I.empty}=e,{stroke:o=I.color_default}=e,{name:a="SVGD3"}=e,{fill:l="none"}=e,{height:u=10}=e,{width:h=10}=e,{x:f=0}=e,{y:d=0}=e,p;Zt(()=>{wf(p).append("path").attr("fill",l).attr("d",s).attr("stroke",o).attr("stroke-width",1).attr("shape-rendering","geometricPrecision")});function g(b){ut[b?"unshift":"push"](()=>{p=b,t(7,p),t(10,l),t(8,s),t(9,o)})}return n.$$set=b=>{"position"in b&&t(0,r=b.position),"zIndex"in b&&t(1,i=b.zIndex),"svgPath"in b&&t(8,s=b.svgPath),"stroke"in b&&t(9,o=b.stroke),"name"in b&&t(2,a=b.name),"fill"in b&&t(10,l=b.fill),"height"in b&&t(3,u=b.height),"width"in b&&t(4,h=b.width),"x"in b&&t(5,f=b.x),"y"in b&&t(6,d=b.y)},n.$$.update=()=>{n.$$.dirty&1920&&l&&(wf(p).select("path").attr("fill",l).attr("d",s).attr("stroke",o).attr("stroke-width",1).attr("shape-rendering","geometricPrecision"),t(7,p),t(10,l),t(8,s),t(9,o))},[r,i,a,u,h,f,d,p,s,o,l,g]}class Ln extends Se{constructor(e){super(),Pe(this,e,RE,CE,ce,{position:0,zIndex:1,svgPath:8,stroke:9,name:2,fill:10,height:3,width:4,x:5,y:6})}}function Mf(n){let e,t;return e=new Ln({props:{name:"triangleInside",svgPath:n[1],stroke:n[7],fill:n[7],height:n[5],width:n[5]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&2&&(s.svgPath=r[1]),i&128&&(s.stroke=r[7]),i&128&&(s.fill=r[7]),i&32&&(s.height=r[5]),i&32&&(s.width=r[5]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function PE(n){let e,t,r,i;e=new Ln({props:{name:"triangle",svgPath:n[8],stroke:n[3],fill:n[6],height:n[5],width:n[5]}});let s=n[1]&&Mf(n);const o=n[14].default,a=da(o,n,n[15],null);return{c(){Q(e.$$.fragment),t=J(),s&&s.c(),r=J(),a&&a.c()},m(l,u){X(e,l,u),B(l,t,u),s&&s.m(l,u),B(l,r,u),a&&a.m(l,u),i=!0},p(l,u){const h={};u&256&&(h.svgPath=l[8]),u&8&&(h.stroke=l[3]),u&64&&(h.fill=l[6]),u&32&&(h.height=l[5]),u&32&&(h.width=l[5]),e.$set(h),l[1]?s?(s.p(l,u),u&2&&P(s,1)):(s=Mf(l),s.c(),P(s,1),s.m(r.parentNode,r)):s&&(de(),V(s,1,1,()=>{s=null}),_e()),a&&a.p&&(!i||u&32768)&&pa(a,o,l,l[15],i?_a(o,l[15],u,null):ga(l[15]),null)},i(l){i||(P(e.$$.fragment,l),P(s),P(a,l),i=!0)},o(l){V(e.$$.fragment,l),V(s),V(a,l),i=!1},d(l){l&&(F(t),F(r)),Y(e,l),s&&s.d(l),a&&a.d(l)}}}function SE(n){let e,t;return e=new Rn({props:{element_state:n[0],border_thickness:"0",closure:n[9],center:n[4],height:n[5],width:n[5],name:n[2],$$slots:{default:[PE]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,[i]){const s={};i&1&&(s.element_state=r[0]),i&16&&(s.center=r[4]),i&32&&(s.height=r[5]),i&32&&(s.width=r[5]),i&4&&(s.name=r[2]),i&33258&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function DE(n,e,t){let r;$(n,At,E=>t(13,r=E));let{$$slots:i={},$$scope:s}=e,{handle_mouse_state:o=Handle_Result}=e,{hover_closure:a=Handle_Result}=e,{element_state:l=bg.none}=e,{extraPath:u=null}=e,{name:h=I.empty}=e,{strokeColor:f}=e,{center:d}=e,{angle:p}=e,{size:g}=e,b=I.color_background,A=I.color_background,S=ze.fat_polygon(g,p);function v(E){a&&t(6,[b,A]=a(E),b,t(7,A))}function x(E){E.isHover?v(!E.isOut):o(E)}return n.$$set=E=>{"handle_mouse_state"in E&&t(10,o=E.handle_mouse_state),"hover_closure"in E&&t(11,a=E.hover_closure),"element_state"in E&&t(0,l=E.element_state),"extraPath"in E&&t(1,u=E.extraPath),"name"in E&&t(2,h=E.name),"strokeColor"in E&&t(3,f=E.strokeColor),"center"in E&&t(4,d=E.center),"angle"in E&&t(12,p=E.angle),"size"in E&&t(5,g=E.size),"$$scope"in E&&t(15,s=E.$$scope)},n.$$.update=()=>{n.$$.dirty&4128&&(t(8,S=ze.fat_polygon(g,p)),v(!1)),n.$$.dirty&8192&&v(!1)},[l,u,h,f,d,g,b,A,S,x,o,a,p,r,i,s]}class gi extends Se{constructor(e){super(),Pe(this,e,DE,SE,ce,{handle_mouse_state:10,hover_closure:11,element_state:0,extraPath:1,name:2,strokeColor:3,center:4,angle:12,size:5})}}function xf(n){let e,t;return e=new lr({props:{width:n[10],height:n[10],center:n[0],name:n[3].name,mouse_state_closure:n[14],$$slots:{default:[NE]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.center=r[0]),i&8&&(s.name=r[3].name),i&134218238&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Lf(n){let e,t;return e=new Ln({props:{name:"reveal-svg",fill:ie.lines?"transparent":n[3].fill,svgPath:n[6],stroke:n[1].thing.color,height:n[10],width:n[10]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&8&&(s.fill=ie.lines?"transparent":r[3].fill),i&64&&(s.svgPath=r[6]),i&2&&(s.stroke=r[1].thing.color),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function OE(n){let e,t,r,i=n[7]&&zf(n),s=!n[1].isExpanded&&n[1].hasChildRelationships&&Ff(n);return{c(){i&&i.c(),e=J(),s&&s.c(),t=Te()},m(o,a){i&&i.m(o,a),B(o,e,a),s&&s.m(o,a),B(o,t,a),r=!0},p(o,a){o[7]?i?(i.p(o,a),a&128&&P(i,1)):(i=zf(o),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(de(),V(i,1,1,()=>{i=null}),_e()),!o[1].isExpanded&&o[1].hasChildRelationships?s?(s.p(o,a),a&2&&P(s,1)):(s=Ff(o),s.c(),P(s,1),s.m(t.parentNode,t)):s&&(de(),V(s,1,1,()=>{s=null}),_e())},i(o){r||(P(i),P(s),r=!0)},o(o){V(i),V(s),r=!1},d(o){o&&(F(e),F(t)),i&&i.d(o),s&&s.d(o)}}}function zf(n){let e,t,r;return t=new Ln({props:{name:"inside-svg",stroke:n[3].stroke,fill:n[3].stroke,svgPath:n[5],height:n[10],width:n[10]}}),{c(){e=W("div"),Q(t.$$.fragment),T(e,"class","reveal-inside"),C(e,"left",n[8]+"px"),C(e,"top",n[8]+"px"),C(e,"position","absolute"),C(e,"height",n[10]+"px"),C(e,"width",n[10]+"px")},m(i,s){B(i,e,s),X(t,e,null),r=!0},p(i,s){const o={};s&8&&(o.stroke=i[3].stroke),s&8&&(o.fill=i[3].stroke),s&32&&(o.svgPath=i[5]),t.$set(o),(!r||s&256)&&C(e,"left",i[8]+"px"),(!r||s&256)&&C(e,"top",i[8]+"px")},i(i){r||(P(t.$$.fragment,i),r=!0)},o(i){V(t.$$.fragment,i),r=!1},d(i){i&&F(e),Y(t)}}}function Ff(n){let e,t,r;return t=new Ln({props:{name:"tiny-dots-svg",svgPath:ze.tinyDots_circular(n[11],n[13]),stroke:n[1].thing.color,fill:n[1].thing.color,height:n[11],width:n[11]}}),{c(){e=W("div"),Q(t.$$.fragment),T(e,"class","outside-tiny-dots"),C(e,"left",n[12]+.65+"px"),C(e,"top",n[12]-.28+"px"),C(e,"height",n[11]+"px"),C(e,"width",n[11]+"px"),C(e,"position","absolute")},m(i,s){B(i,e,s),X(t,e,null),r=!0},p(i,s){const o={};s&2&&(o.stroke=i[1].thing.color),s&2&&(o.fill=i[1].thing.color),t.$set(o)},i(i){r||(P(t.$$.fragment,i),r=!0)},o(i){V(t.$$.fragment,i),r=!1},d(i){i&&F(e),Y(t)}}}function NE(n){let e,t=n[6],r,i,s,o,a=Lf(n),l=ln.tiny_dots&&OE(n);return{c(){e=W("button"),a.c(),r=J(),l&&l.c(),T(e,"class","dot svelte-1g7phol"),C(e,"width",n[10]+"px"),C(e,"height",n[10]+"px"),C(e,"z-index",n[2])},m(u,h){B(u,e,h),a.m(e,null),K(e,r),l&&l.m(e,null),n[20](e),i=!0,s||(o=ke(e,"contextmenu",ME),s=!0)},p(u,h){h&64&&ce(t,t=u[6])?(de(),V(a,1,1,ue),_e(),a=Lf(u),a.c(),P(a,1),a.m(e,r)):a.p(u,h),ln.tiny_dots&&l.p(u,h),(!i||h&4)&&C(e,"z-index",u[2])},i(u){i||(P(a),P(l),i=!0)},o(u){V(a),V(l),i=!1},d(u){u&&F(e),a.d(u),l&&l.d(),n[20](null),s=!1,o()}}}function Bf(n){let e,t,r=n[3]&&xf(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[3]?r?(r.p(i,s),s&8&&P(r,1)):(r=xf(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function VE(n){let e=n[9],t,r,i=Bf(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&512&&ce(e,e=s[9])?(de(),V(i,1,1,ue),_e(),i=Bf(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function ME(n){n.preventDefault()}function xE(n){return!1}function LE(n,e,t){let r,i,s,o,a,l;$(n,Fe,O=>t(22,r=O)),$(n,vr,O=>t(23,i=O)),$(n,_t,O=>t(17,s=O)),$(n,Tn,O=>t(24,o=O)),$(n,At,O=>t(18,a=O)),$(n,Gr,O=>t(19,l=O));let{center:u}=e,{ancestry:h}=e,{name:f=I.empty}=e,{zindex:d=Ee.dots}=e,{hover_isReversed:p=!1}=e;const g=pt.element_state_forName(f);let b=I.dot_size,A=b*1.8,S=b*-.4+.01,v=h.childRelationships.length,x=ze.circle_atOffset(16,6),E=I.empty,L=!1,z=0,k=null,y=0;Zt(()=>{D(),w(!1)});function w(O){const H=p?!O:O;g&&g.isOut==H&&(t(3,g.isOut=!H,g),t(9,y+=1))}function D(){const O=h.thing;t(7,L=h.toolsGrabbed||O.isBulkAlias),t(8,z=L?0:-1),!h.showsReveal||h.toolsGrabbed?t(6,E=ze.circle_atOffset(b,b-1)):t(6,E=ze.fat_polygon(b,h.svgAngleOf_reveal)),h.toolsGrabbed?t(5,x=ze.x_cross(b,1.5)):L&&t(5,x=ze.circle_atOffset(b,3))}function N(O){if(O.isHover)w(!O.isOut);else if(O.isUp){if(h.toolsGrabbed)It(Tn,o=null,o),It(_t,s=null,s),Oe.signal_relayoutWidgets_fromFocus();else if(h.hasChildRelationships||h.thing.isBulkAlias){const H=h.isParental!=h.isExpanded||i==kr.radial;r.ancestry_rebuild_persistentMoveRight(h,H,!1,!1,!1,!0)}}}function M(O){ut[O?"unshift":"push"](()=>{k=O,t(4,k)})}return n.$$set=O=>{"center"in O&&t(0,u=O.center),"ancestry"in O&&t(1,h=O.ancestry),"name"in O&&t(15,f=O.name),"zindex"in O&&t(2,d=O.zindex),"hover_isReversed"in O&&t(16,p=O.hover_isReversed)},n.$$.update=()=>{n.$$.dirty&131098&&k&&!h.ancestry_hasEqualID(s)&&(new ar(k,xE,h.idHashed,ht.reveal),g.set_forHovering(h.thing.color,"pointer")),n.$$.dirty&524288&&D(),n.$$.dirty&262146&&(a||h.thing)&&D()},[u,h,d,g,k,x,E,L,z,y,b,A,S,v,N,f,p,s,a,l,M]}class Jg extends Se{constructor(e){super(),Pe(this,e,LE,VE,ce,{center:0,ancestry:1,name:15,zindex:2,hover_isReversed:16})}}function zE(n){let e,t,r,i,s,o,a,l,u,h,f,d,p,g;return{c(){e=W("div"),t=Ke("svg"),r=Ke("path"),s=J(),o=Ke("svg"),a=Ke("line"),h=Ke("line"),f=Ke("line"),d=Ke("line"),T(r,"class","trash-path"),T(r,"d","M 14.5 3 C 14.5 3.552 14.052 4 13.5 4 L 13 4 L 13 13 C 13 14.105 12.105 15 11 15 L 5 15 C 3.895 15 3 14.105 3 13 L 3 4 L 2.5 4 C 1.948 4 1.5 3.552 1.5 3 L 1.5 2 C 1.5 1.448 1.948 1 2.5 1 L 6 1 C 6 0.448 6.448 0 7 0 L 9 0 C 9.552 0 10 0.448 10 1 L 13.5 1 C 14.052 1 14.5 1.448 14.5 2 L 14.5 3 Z"),T(r,"transform","matrix(1, 0, 0, 1, 0, 4.440892098500626e-16)"),T(t,"class","trash-svg svelte-1mqhzjj"),T(t,"width",I.default_buttonSize),T(t,"height",I.default_buttonSize),T(t,"fill",i=n[1]?n[2]:n[0]),T(t,"stroke",n[2]),T(t,"viewBox",n[4]),T(a,"x1",l=n[1]?0:3),T(a,"y1","4"),T(a,"x2",u=n[1]?15:13),T(a,"y2","4"),T(h,"x1",Uf),T(h,"y1",n[3]),T(h,"x2",Uf),T(h,"y2",Rl),T(f,"x1",jf),T(f,"y1",n[3]),T(f,"x2",jf),T(f,"y2",Rl),T(d,"x1","8"),T(d,"y1",n[3]),T(d,"x2","8"),T(d,"y2",Rl),T(o,"class","trash-lines-svg svelte-1mqhzjj"),T(o,"width",I.default_buttonSize),T(o,"height",I.default_buttonSize),T(o,"fill",p=n[1]?n[0]:n[2]),T(o,"stroke",g=n[1]?n[0]:n[2]),T(o,"viewBox",n[4]),T(e,"class","trash-container svelte-1mqhzjj")},m(b,A){B(b,e,A),K(e,t),K(t,r),K(e,s),K(e,o),K(o,a),K(o,h),K(o,f),K(o,d)},p(b,[A]){A&7&&i!==(i=b[1]?b[2]:b[0])&&T(t,"fill",i),A&4&&T(t,"stroke",b[2]),A&2&&l!==(l=b[1]?0:3)&&T(a,"x1",l),A&2&&u!==(u=b[1]?15:13)&&T(a,"x2",u),A&8&&T(h,"y1",b[3]),A&8&&T(f,"y1",b[3]),A&8&&T(d,"y1",b[3]),A&7&&p!==(p=b[1]?b[0]:b[2])&&T(o,"fill",p),A&7&&g!==(g=b[1]?b[0]:b[2])&&T(o,"stroke",g)},i:ue,o:ue,d(b){b&&F(e)}}}const Rl=12.5,Uf=5.6,jf=10.4;function FE(n,e,t){let{fill:r=I.color_background}=e,{invert:i=!1}=e,{color:s=black}=e;const o=`0 -0.5 ${I.default_buttonSize} ${I.default_buttonSize}`;let a=6;return n.$$set=l=>{"fill"in l&&t(0,r=l.fill),"invert"in l&&t(1,i=l.invert),"color"in l&&t(2,s=l.color)},n.$$.update=()=>{n.$$.dirty&2&&t(3,a=i?7:6)},[r,i,s,a,o]}class BE extends Se{constructor(e){super(),Pe(this,e,FE,zE,ce,{fill:0,invert:1,color:2})}}function qf(n){let e,t,r,i,s,o;t=new hk({props:{color_background:we.opacitize(I.color_background,.95),center:n[11](te.editingTools),radius:n[9],zindex:Ee.dots,color:n[0],opacity:"0.85",thickness:"1"}});const a=[jE,UE],l=[];function u(h,f){return h[6]?0:1}return i=u(n),s=l[i]=a[i](n),{c(){e=W("div"),Q(t.$$.fragment),r=J(),s.c(),T(e,"class","editing-tools"),C(e,"position","absolute"),C(e,"z-index",Ee.tools)},m(h,f){B(h,e,f),X(t,e,null),K(e,r),l[i].m(e,null),o=!0},p(h,f){const d={};f[0]&1&&(d.color=h[0]),t.$set(d);let p=i;i=u(h),i===p?l[i].p(h,f):(de(),V(l[p],1,1,()=>{l[p]=null}),_e(),s=l[i],s?s.p(h,f):(s=l[i]=a[i](h),s.c()),P(s,1),s.m(e,null))},i(h){o||(P(t.$$.fragment,h),P(s),o=!0)},o(h){V(t.$$.fragment,h),V(s),o=!1},d(h){h&&F(e),Y(t),l[i].d()}}}function UE(n){let e,t,r,i,s,o,a,l,u,h,f,d,p,g,b,A,S;return e=new Rn({props:{closure:n[25],element_state:n[3][te.more],height:I.default_buttonSize,zindex:Ee.tool_buttons,center:n[11](te.more),color:"transparent",border_thickness:"0",name:"more",width:"18",$$slots:{default:[qE]},$$scope:{ctx:n}}}),r=new Jg({props:{name:n[3][te.dismiss].name,ancestry:n[2],center:n[11](te.dismiss),zindex:Ee.tool_buttons,hover_isReversed:"true"}}),s=new gi({props:{strokeColor:n[12](te.next)?I.color_disabled:n[5],hover_closure:n[26],handle_mouse_state:n[27],extraPath:ze.circle_atOffset(n[8],4),center:n[11](te.next),angle:rn.up,size:n[8],name:"next"}}),a=new gi({props:{strokeColor:n[12](te.delete_parent)?I.color_disabled:n[5],hover_closure:n[28],handle_mouse_state:n[29],extraPath:ze.dash(n[8],4),center:n[11](te.delete_parent),angle:rn.left,name:"delete_parent",size:n[8]}}),u=new gi({props:{hover_closure:n[30],handle_mouse_state:n[31],strokeColor:n[12](te.add_parent)?I.color_disabled:n[0],extraPath:ze.t_cross(n[8],3),center:n[11](te.add_parent),angle:rn.left,size:n[8],name:"add_parent"}}),f=new gi({props:{hover_closure:n[32],handle_mouse_state:n[33],extraPath:ze.t_cross(n[8],3),center:n[11](te.create),angle:rn.right,strokeColor:n[0],size:n[8],name:"add"}}),g=new BE({props:{color:n[0],invert:n[4][te.delete]}}),{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment),i=J(),Q(s.$$.fragment),o=J(),Q(a.$$.fragment),l=J(),Q(u.$$.fragment),h=J(),Q(f.$$.fragment),d=J(),p=W("button"),Q(g.$$.fragment),T(p,"id","delete"),C(p,"left",n[11](te.delete).x+"px"),C(p,"top",n[11](te.delete).y+"px"),C(p,"z-index",Ee.dots),C(p,"background","none"),C(p,"cursor","pointer"),C(p,"border","none"),T(p,"class","svelte-c95x57")},m(v,x){X(e,v,x),B(v,t,x),X(r,v,x),B(v,i,x),X(s,v,x),B(v,o,x),X(a,v,x),B(v,l,x),X(u,v,x),B(v,h,x),X(f,v,x),B(v,d,x),B(v,p,x),X(g,p,null),b=!0,A||(S=[ke(p,"blur",we.ignore),ke(p,"focus",we.ignore),ke(p,"click",n[13]),ke(p,"mouseout",n[34]),ke(p,"mouseover",n[35])],A=!0)},p(v,x){const E={};x[0]&8&&(E.element_state=v[3][te.more]),x[0]&17|x[1]&2097152&&(E.$$scope={dirty:x,ctx:v}),e.$set(E);const L={};x[0]&8&&(L.name=v[3][te.dismiss].name),x[0]&4&&(L.ancestry=v[2]),r.$set(L);const z={};x[0]&32&&(z.strokeColor=v[12](te.next)?I.color_disabled:v[5]),s.$set(z);const k={};x[0]&32&&(k.strokeColor=v[12](te.delete_parent)?I.color_disabled:v[5]),a.$set(k);const y={};x[0]&1&&(y.strokeColor=v[12](te.add_parent)?I.color_disabled:v[0]),u.$set(y);const w={};x[0]&1&&(w.strokeColor=v[0]),f.$set(w);const D={};x[0]&1&&(D.color=v[0]),x[0]&16&&(D.invert=v[4][te.delete]),g.$set(D)},i(v){b||(P(e.$$.fragment,v),P(r.$$.fragment,v),P(s.$$.fragment,v),P(a.$$.fragment,v),P(u.$$.fragment,v),P(f.$$.fragment,v),P(g.$$.fragment,v),b=!0)},o(v){V(e.$$.fragment,v),V(r.$$.fragment,v),V(s.$$.fragment,v),V(a.$$.fragment,v),V(u.$$.fragment,v),V(f.$$.fragment,v),V(g.$$.fragment,v),b=!1},d(v){v&&(F(t),F(i),F(o),F(l),F(h),F(d),F(p)),Y(e,v),Y(r,v),Y(s,v),Y(a,v),Y(u,v),Y(f,v),Y(g),A=!1,sn(S)}}}function jE(n){let e,t,r,i,s,o,a,l,u=n[4][te.delete_confirm]&&Hf(n),h=n[4][te.delete_cancel]&&Gf(n);return r=new Rn({props:{closure:n[23],element_state:n[3][te.delete_confirm],center:n[11](te.delete_confirm),height:I.editingTools_diameter/2,width:I.editingTools_diameter,background_color:"transparent",zindex:Ee.dots,color:"transparent",border_thickness:"0",name:"delete",$$slots:{default:[HE]},$$scope:{ctx:n}}}),s=new Rn({props:{closure:n[24],element_state:n[3][te.delete_cancel],height:I.editingTools_diameter/2,center:n[11](te.delete_cancel),width:I.editingTools_diameter,background_color:"transparent",zindex:Ee.dots,color:"transparent",border_thickness:"0",name:"cancel",$$slots:{default:[GE]},$$scope:{ctx:n}}}),{c(){u&&u.c(),e=J(),h&&h.c(),t=J(),Q(r.$$.fragment),i=J(),Q(s.$$.fragment),o=J(),a=W("div"),T(a,"class","horizontal-line"),C(a,"left",n[11](te.editingTools).x-n[9]+"px"),C(a,"top",n[11](te.editingTools).y+.5+"px"),C(a,"width",I.editingTools_diameter+1+"px"),C(a,"z-index",Ee.tool_buttons),C(a,"background-color",n[0]),C(a,"position","absolute"),C(a,"height","1px")},m(f,d){u&&u.m(f,d),B(f,e,d),h&&h.m(f,d),B(f,t,d),X(r,f,d),B(f,i,d),X(s,f,d),B(f,o,d),B(f,a,d),l=!0},p(f,d){f[4][te.delete_confirm]?u?u.p(f,d):(u=Hf(f),u.c(),u.m(e.parentNode,e)):u&&(u.d(1),u=null),f[4][te.delete_cancel]?h?h.p(f,d):(h=Gf(f),h.c(),h.m(t.parentNode,t)):h&&(h.d(1),h=null);const p={};d[0]&8&&(p.element_state=f[3][te.delete_confirm]),d[0]&18|d[1]&2097152&&(p.$$scope={dirty:d,ctx:f}),r.$set(p);const g={};d[0]&8&&(g.element_state=f[3][te.delete_cancel]),d[0]&18|d[1]&2097152&&(g.$$scope={dirty:d,ctx:f}),s.$set(g),(!l||d[0]&1)&&C(a,"background-color",f[0])},i(f){l||(P(r.$$.fragment,f),P(s.$$.fragment,f),l=!0)},o(f){V(r.$$.fragment,f),V(s.$$.fragment,f),l=!1},d(f){f&&(F(e),F(t),F(i),F(o),F(a)),u&&u.d(f),h&&h.d(f),Y(r,f),Y(s,f)}}}function qE(n){let e,t,r,i,s,o,a;return{c(){e=Ke("svg"),t=Ke("path"),i=J(),s=Ke("svg"),o=Ke("path"),T(t,"class","more-path"),T(t,"d",ze.oval(18,!0)),T(e,"width","18"),T(e,"stroke",n[0]),T(e,"class","more-svg svelte-c95x57"),T(e,"viewBox","0 1 18 16"),T(e,"height",I.default_buttonSize),T(e,"fill",r=n[4][te.more]?n[0]:"transparent"),T(o,"class","ellipses-path"),T(o,"d",ze.ellipses(7,1)),T(s,"height","10"),T(s,"class","ellipses-svg svelte-c95x57"),T(s,"viewBox","-0.5 -2 14 10"),T(s,"width",I.default_buttonSize),T(s,"fill",a=n[4][te.more]?I.color_background:n[0])},m(l,u){B(l,e,u),K(e,t),B(l,i,u),B(l,s,u),K(s,o)},p(l,u){u[0]&1&&T(e,"stroke",l[0]),u[0]&17&&r!==(r=l[4][te.more]?l[0]:"transparent")&&T(e,"fill",r),u[0]&17&&a!==(a=l[4][te.more]?I.color_background:l[0])&&T(s,"fill",a)},d(l){l&&(F(e),F(i),F(s))}}}function Hf(n){let e,t,r;return{c(){e=Ke("svg"),t=Ke("path"),T(t,"class","delete-confirm-path"),T(t,"d",ze.half_circle(I.editingTools_diameter,rn.up)),T(e,"class","delete-confirm svelte-c95x57"),C(e,"left",n[11](te.confirmation).x+"px"),C(e,"top",n[11](te.confirmation).y+"px"),C(e,"z-index",Ee.dots),T(e,"height",I.editingTools_diameter),T(e,"width",I.editingTools_diameter),T(e,"viewBox",n[10]),T(e,"stroke","transparent"),T(e,"fill",r=n[1].color)},m(i,s){B(i,e,s),K(e,t)},p(i,s){s[0]&2&&r!==(r=i[1].color)&&T(e,"fill",r)},d(i){i&&F(e)}}}function Gf(n){let e,t,r;return{c(){e=Ke("svg"),t=Ke("path"),T(t,"class","delete-cancel-path"),T(t,"d",ze.half_circle(I.editingTools_diameter,rn.down)),T(e,"class","delete-cancel svelte-c95x57"),C(e,"left",n[11](te.confirmation).x+"px"),C(e,"top",n[11](te.confirmation).y+"px"),C(e,"z-index",Ee.dots),T(e,"height",I.editingTools_diameter),T(e,"width",I.editingTools_diameter),T(e,"viewBox",n[10]),T(e,"stroke","transparent"),T(e,"fill",r=n[1].color)},m(i,s){B(i,e,s),K(e,t)},p(i,s){s[0]&2&&r!==(r=i[1].color)&&T(e,"fill",r)},d(i){i&&F(e)}}}function Kf(n){let e,t;return{c(){e=W("div"),t=at("delete"),C(e,"color",n[4][te.delete_confirm]?"white":n[1].color),C(e,"z-index",Ee.frontmost),C(e,"position","absolute"),C(e,"left","13px"),C(e,"top","11px")},m(r,i){B(r,e,i),K(e,t)},p(r,i){i[0]&18&&C(e,"color",r[4][te.delete_confirm]?"white":r[1].color)},d(r){r&&F(e)}}}function HE(n){let e=n[4][te.delete_confirm],t,r=Kf(n);return{c(){r.c(),t=Te()},m(i,s){r.m(i,s),B(i,t,s)},p(i,s){s[0]&16&&ce(e,e=i[4][te.delete_confirm])?(r.d(1),r=Kf(i),r.c(),r.m(t.parentNode,t)):r.p(i,s)},d(i){i&&F(t),r.d(i)}}}function Wf(n){let e,t;return{c(){e=W("div"),t=at("cancel"),C(e,"top","4px"),C(e,"left","13px"),C(e,"position","absolute"),C(e,"z-index",Ee.frontmost),C(e,"color",n[4][te.delete_cancel]?"white":n[1].color)},m(r,i){B(r,e,i),K(e,t)},p(r,i){i[0]&18&&C(e,"color",r[4][te.delete_cancel]?"white":r[1].color)},d(r){r&&F(e)}}}function GE(n){let e=n[4][te.delete_cancel],t,r=Wf(n);return{c(){r.c(),t=Te()},m(i,s){r.m(i,s),B(i,t,s)},p(i,s){s[0]&16&&ce(e,e=i[4][te.delete_cancel])?(r.d(1),r=Wf(i),r.c(),r.m(t.parentNode,t)):r.p(i,s)},d(i){i&&F(t),r.d(i)}}}function Xf(n){let e,t,r=!!n[2]&&qf(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[2]?r?(r.p(i,s),s[0]&4&&P(r,1)):(r=qf(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function KE(n){let e=n[7],t,r,i=Xf(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o[0]&128&&ce(e,e=s[7])?(de(),V(i,1,1,ue),_e(),i=Xf(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function WE(n,e,t){let r,i,s,o;$(n,Fe,pe=>t(40,r=pe)),$(n,_t,pe=>t(2,i=pe)),$(n,cn,pe=>t(22,s=pe)),$(n,Tn,pe=>t(41,o=pe));var a=this&&this.__awaiter||function(pe,We,ft,He){function me(Rt){return Rt instanceof ft?Rt:new ft(function(Pr){Pr(Rt)})}return new(ft||(ft=Promise))(function(Rt,Pr){function Ui(gt){try{Sr(He.next(gt))}catch(Pt){Pr(Pt)}}function ji(gt){try{Sr(He.throw(gt))}catch(Pt){Pr(Pt)}}function Sr(gt){gt.done?Rt(gt.value):me(gt.value).then(Ui,ji)}Sr((He=He.apply(pe,We||[])).next())})},l,u,h;let{top:f=0}=e;const d=I.dot_size*1.4,p=I.editingTools_diameter/2,g=[te.add_parent,te.delete_parent],b=[te.next,te.delete_parent],A=`0 0 ${I.editingTools_diameter} ${I.editingTools_diameter}`;let S={},v={},x={},E=I.empty,L=0,z=!1,k=new De,y=I.empty,w=0,D=0,N,M;function O(pe){var We;return(We=x[pe])!==null&&We!==void 0?We:G.zero}function H(pe,We){return x[pe]=We}function j(pe){return pe==te.add_parent?pr.adding:pr.deleting}ie.log_tools("mount tools"),setTimeout(()=>{Ae()},20),Zt(()=>{const pe=Oe.handle_relayoutWidgets(2,We=>{Ae(!0)});return()=>{pe.disconnect()}});function Z(pe){return g.includes(pe)&&(o==null?void 0:o.type)==j(pe)}function ge(pe){return(N.isFocus||M.isBulkAlias)&&pe==te.add_parent||L<2&&b.includes(pe)}function le(){if(N){ie.log_tools("element states");const pe=[te.delete_cancel,te.add_parent,te.delete_parent,te.delete_cancel,te.delete_confirm,te.dismiss,te.create,te.next,te.more];for(const We of pe){const ft=We==te.dismiss,He=pt.element_state_for(N,dn.tool,We);He.color_background=ft?I.color_background:"transparent",He.set_forHovering(y,"pointer"),He.hoverIgnore=!ft,t(3,S[We]=He,S)}}}function ee(pe){return a(this,void 0,void 0,function*(){ge(te.delete)||t(6,z=!0)})}function fe(){var pe,We;if(N){const ft=N.showsReveal,He=(We=(pe=N.widget_map)===null||pe===void 0?void 0:pe.points_right)!==null&&We!==void 0?We:!0;return ae.showing_radial?He?w+23:-6:ft?w+25:w+17}return 0}function Ve(pe,We){const ft=ge(pe),He=ft&&b.includes(pe);if(ft||We==Z(pe)){const me=He?I.color_disabled:ft||We?E:y;return[I.color_background,me]}return[y,I.color_background]}function ye(pe,We){return a(this,void 0,void 0,function*(){if(pe.isHover){const ft=S[We],He=pe.isOut;t(4,v[We]=!He,v),ft.isOut=He}else if(pe.isUp||pe.isLong){switch(We){case te.delete_cancel:t(6,z=!1);break;default:ge(We)||(yield r.handle_tool_clicked(We,pe));break}Ae()}})}function Ae(pe=!1){var We;let ft=(We=N==null?void 0:N.titleRect)===null||We===void 0?void 0:We.atZero;if(ft&&ft.size.width!=0){ie.log_origins(`setC all tools ${ft.description}`);const He=ft.centerLeft.offsetByXY(fe(),(1-Qe.scale_factor)*9);He.x-d,H(te.confirmation,He.offsetEquallyBy(1-p)),H(te.delete_parent,He.offsetByXY(2-d,d-5)),H(te.delete_cancel,He.offsetByXY(19-d,d-1)),H(te.delete_confirm,He.offsetByXY(20-d,3-d)),H(te.create,He.offsetByXY(1+d,8-d)),H(te.add_parent,He.offsetByXY(2-d,8-d)),H(te.more,He.offsetByXY(.9,d+3.5)),H(te.next,He.offsetByXY(2,-d-2)),H(te.delete,He.offsetByXY(5.5,3)),H(te.dismiss,He.offsetByXY(1,1)),H(te.editingTools,He),t(7,D+=1)}else pe&&t(7,D+=1)}const Be=pe=>ye(pe,te.delete_confirm),be=pe=>ye(pe,te.delete_cancel),et=pe=>ye(pe,te.more),rt=pe=>Ve(te.next,pe),vt=pe=>ye(pe,te.next),Ht=pe=>Ve(te.delete_parent,pe),kn=pe=>ye(pe,te.delete_parent),$t=pe=>Ve(te.add_parent,pe),Sn=pe=>ye(pe,te.add_parent),Dn=pe=>Ve(te.create,pe),On=pe=>ye(pe,te.create),oe=()=>{t(4,v[te.delete]=!1,v)},kt=()=>{t(4,v[te.delete]=!0,v)};return n.$$set=pe=>{"top"in pe&&t(16,f=pe.top)},n.$$.update=()=>{if(n.$$.dirty[0]&5242880&&k!=s&&(t(20,k=s),Ae()),n.$$.dirty[0]&3014663&&(!N||!N.ancestry_hasEqualID(i))&&(t(21,N=i),N)){t(1,M=N.thing),t(0,y=t(17,l=M==null?void 0:M.color)!==null&&l!==void 0?l:I.empty),w=t(18,u=M==null?void 0:M.titleWidth)!==null&&u!==void 0?u:0;const pe=(t(19,h=M==null?void 0:M.parents.length)!==null&&h!==void 0?h:0)==1;L=N.visibleParentAncestries(0).length,t(5,E=pe||N.isFocus?I.color_disabled:y),le(),Ae(!0)}},[y,M,i,S,v,E,z,D,d,p,A,O,ge,ee,Ve,ye,f,l,u,h,k,N,s,Be,be,et,rt,vt,Ht,kn,$t,Sn,Dn,On,oe,kt]}class XE extends Se{constructor(e){super(),Pe(this,e,WE,KE,ce,{top:16},null,[-1,-1])}}function YE(n){let e,t,r,i,s,o,a,l;return{c(){e=W("div"),t=W("textarea"),i=J(),s=W("div"),o=at(n[2]),T(t,"id",n[2]),T(t,"type","text"),T(t,"name","text"),T(t,"wrap","soft"),T(t,"class","text svelte-c5jdrq"),T(t,"style",r="resize: none; padding: 6px; "+Yf+"; color: "+n[0]+"; width: "+n[1]+"px; height: "+n[3]+"px; overflow-x: hidden; vertical-align: top; white-space: normal; z-index: "+Ee.text+"; overflow-wrap: break-word; "+I.prevent_selection_style+"; font-family: "+n[8]+"; border-radius: "+I.row_height/2+"px;"),C(s,"top","-8px"),C(s,"color","gray"),C(s,"font-size","0.9em"),C(s,"padding","0px 3px"),C(s,"position","absolute"),C(s,"left",n[9]+"px"),C(s,"background-color",I.color_background),T(e,"class",n[2]),C(e,"top",n[5]+"px"),C(e,"left",n[4]+"px"),C(e,"position","absolute")},m(u,h){B(u,e,h),K(e,t),n[16](t),jo(t,n[7]),K(e,i),K(e,s),K(s,o),a||(l=[ke(t,"blur",n[13]),ke(t,"input",n[17]),ke(t,"focus",n[10]),ke(t,"keyup",n[11]),ke(t,"keydown",n[12])],a=!0)},p(u,[h]){h&4&&T(t,"id",u[2]),h&267&&r!==(r="resize: none; padding: 6px; "+Yf+"; color: "+u[0]+"; width: "+u[1]+"px; height: "+u[3]+"px; overflow-x: hidden; vertical-align: top; white-space: normal; z-index: "+Ee.text+"; overflow-wrap: break-word; "+I.prevent_selection_style+"; font-family: "+u[8]+"; border-radius: "+I.row_height/2+"px;")&&T(t,"style",r),h&128&&jo(t,u[7]),h&4&&Dt(o,u[2]),h&4&&T(e,"class",u[2]),h&32&&C(e,"top",u[5]+"px"),h&16&&C(e,"left",u[4]+"px")},i:ue,o:ue,d(u){u&&F(e),n[16](null),a=!1,sn(l)}}}let Yf="cursor: text";function QE(n,e,t){let r;$(n,zn,z=>t(8,r=z));let{handle_textChange:i=(z,k)=>{}}=e,{color:s=I.thing_color_default}=e,{width:o=I.width_details-40}=e,{original_text:a=I.empty}=e,{label:l=I.empty}=e,{height:u=200}=e,{left:h=0}=e,{top:f=0}=e,d=null,p=a,g=(I.width_details-28-we.getWidthOf(l)*.7)/2;function b(z){ae.isEditing_text=!0}function A(z){x(!1,z)}function S(z){x(!0,z)}function v(z){i(l,null),ae.isEditing_text=!1}function x(z,k){const y=k.key=="Enter"&&!k.shiftKey;if(z&&y)k.preventDefault(),d.blur(),t(6,d.value=p,d);else if(!z&&!y){const w=d.value;(w||w==I.empty)&&(t(7,p=w),i(l,w))}}function E(z){ut[z?"unshift":"push"](()=>{d=z,t(6,d)})}function L(){p=this.value,t(7,p)}return n.$$set=z=>{"handle_textChange"in z&&t(14,i=z.handle_textChange),"color"in z&&t(0,s=z.color),"width"in z&&t(1,o=z.width),"original_text"in z&&t(15,a=z.original_text),"label"in z&&t(2,l=z.label),"height"in z&&t(3,u=z.height),"left"in z&&t(4,h=z.left),"top"in z&&t(5,f=z.top)},[s,o,l,u,h,f,d,p,r,g,b,A,S,v,i,a,E,L]}class Qf extends Se{constructor(e){super(),Pe(this,e,QE,YE,ce,{handle_textChange:14,color:0,width:1,original_text:15,label:2,height:3,left:4,top:5})}}var JE={grad:.9,turn:360,rad:360/(2*Math.PI)},Zn=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},Vt=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t+0},En=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n>e?n:e},Zg=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},Jf=function(n){return{r:En(n.r,0,255),g:En(n.g,0,255),b:En(n.b,0,255),a:En(n.a)}},Pl=function(n){return{r:Vt(n.r),g:Vt(n.g),b:Vt(n.b),a:Vt(n.a,3)}},ZE=/^#([0-9a-f]{3,8})$/i,Co=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},$g=function(n){var e=n.r,t=n.g,r=n.b,i=n.a,s=Math.max(e,t,r),o=s-Math.min(e,t,r),a=o?s===e?(t-r)/o:s===t?2+(r-e)/o:4+(e-t)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},em=function(n){var e=n.h,t=n.s,r=n.v,i=n.a;e=e/360*6,t/=100,r/=100;var s=Math.floor(e),o=r*(1-t),a=r*(1-(e-s)*t),l=r*(1-(1-e+s)*t),u=s%6;return{r:255*[r,a,o,o,l,r][u],g:255*[l,r,r,a,o,o][u],b:255*[o,o,l,r,r,a][u],a:i}},Zf=function(n){return{h:Zg(n.h),s:En(n.s,0,100),l:En(n.l,0,100),a:En(n.a)}},$f=function(n){return{h:Vt(n.h),s:Vt(n.s),l:Vt(n.l),a:Vt(n.a,3)}},ed=function(n){return em((t=(e=n).s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}));var e,t,r},bs=function(n){return{h:(e=$g(n)).h,s:(i=(200-(t=e.s))*(r=e.v)/100)>0&&i<200?t*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,r,i},$E=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,eA=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tA=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,nA=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,td={string:[[function(n){var e=ZE.exec(n);return e?(n=e[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?Vt(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?Vt(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var e=tA.exec(n)||nA.exec(n);return e?e[2]!==e[4]||e[4]!==e[6]?null:Jf({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(n){var e=$E.exec(n)||eA.exec(n);if(!e)return null;var t,r,i=Zf({h:(t=e[1],r=e[2],r===void 0&&(r="deg"),Number(t)*(JE[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return ed(i)},"hsl"]],object:[[function(n){var e=n.r,t=n.g,r=n.b,i=n.a,s=i===void 0?1:i;return Zn(e)&&Zn(t)&&Zn(r)?Jf({r:Number(e),g:Number(t),b:Number(r),a:Number(s)}):null},"rgb"],[function(n){var e=n.h,t=n.s,r=n.l,i=n.a,s=i===void 0?1:i;if(!Zn(e)||!Zn(t)||!Zn(r))return null;var o=Zf({h:Number(e),s:Number(t),l:Number(r),a:Number(s)});return ed(o)},"hsl"],[function(n){var e=n.h,t=n.s,r=n.v,i=n.a,s=i===void 0?1:i;if(!Zn(e)||!Zn(t)||!Zn(r))return null;var o=function(a){return{h:Zg(a.h),s:En(a.s,0,100),v:En(a.v,0,100),a:En(a.a)}}({h:Number(e),s:Number(t),v:Number(r),a:Number(s)});return em(o)},"hsv"]]},nd=function(n,e){for(var t=0;t<e.length;t++){var r=e[t][0](n);if(r)return[r,e[t][1]]}return[null,void 0]},rA=function(n){return typeof n=="string"?nd(n.trim(),td.string):typeof n=="object"&&n!==null?nd(n,td.object):[null,void 0]},Sl=function(n,e){var t=bs(n);return{h:t.h,s:En(t.s+100*e,0,100),l:t.l,a:t.a}},Dl=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},rd=function(n,e){var t=bs(n);return{h:t.h,s:t.s,l:En(t.l+100*e,0,100),a:t.a}},id=function(){function n(e){this.parsed=rA(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return Vt(Dl(this.rgba),2)},n.prototype.isDark=function(){return Dl(this.rgba)<.5},n.prototype.isLight=function(){return Dl(this.rgba)>=.5},n.prototype.toHex=function(){return e=Pl(this.rgba),t=e.r,r=e.g,i=e.b,o=(s=e.a)<1?Co(Vt(255*s)):"","#"+Co(t)+Co(r)+Co(i)+o;var e,t,r,i,s,o},n.prototype.toRgb=function(){return Pl(this.rgba)},n.prototype.toRgbString=function(){return e=Pl(this.rgba),t=e.r,r=e.g,i=e.b,(s=e.a)<1?"rgba("+t+", "+r+", "+i+", "+s+")":"rgb("+t+", "+r+", "+i+")";var e,t,r,i,s},n.prototype.toHsl=function(){return $f(bs(this.rgba))},n.prototype.toHslString=function(){return e=$f(bs(this.rgba)),t=e.h,r=e.s,i=e.l,(s=e.a)<1?"hsla("+t+", "+r+"%, "+i+"%, "+s+")":"hsl("+t+", "+r+"%, "+i+"%)";var e,t,r,i,s},n.prototype.toHsv=function(){return e=$g(this.rgba),{h:Vt(e.h),s:Vt(e.s),v:Vt(e.v),a:Vt(e.a,3)};var e},n.prototype.invert=function(){return pn({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},n.prototype.saturate=function(e){return e===void 0&&(e=.1),pn(Sl(this.rgba,e))},n.prototype.desaturate=function(e){return e===void 0&&(e=.1),pn(Sl(this.rgba,-e))},n.prototype.grayscale=function(){return pn(Sl(this.rgba,-1))},n.prototype.lighten=function(e){return e===void 0&&(e=.1),pn(rd(this.rgba,e))},n.prototype.darken=function(e){return e===void 0&&(e=.1),pn(rd(this.rgba,-e))},n.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},n.prototype.alpha=function(e){return typeof e=="number"?pn({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Vt(this.rgba.a,3);var t},n.prototype.hue=function(e){var t=bs(this.rgba);return typeof e=="number"?pn({h:e,s:t.s,l:t.l,a:t.a}):Vt(t.h)},n.prototype.isEqual=function(e){return this.toHex()===pn(e).toHex()},n}(),pn=function(n){return n instanceof id?n:new id(n)};function sd(n){let e;return{c(){e=W("input"),T(e,"type","hidden"),T(e,"name",n[3]),e.value=n[0]},m(t,r){B(t,e,r)},p(t,r){r&8&&T(e,"name",t[3]),r&1&&(e.value=t[0])},d(t){t&&F(e)}}}function iA(n){let e,t,r,i,s,o,a,l,u,h=n[3]&&sd(n);return{c(){e=W("div"),t=W("div"),r=J(),i=W("div"),o=J(),h&&h.c(),a=Te(),T(t,"class","track svelte-w4j1dz"),T(i,"class","thumb svelte-w4j1dz"),T(e,"class","slider svelte-w4j1dz"),T(e,"role","slider"),T(e,"aria-orientation",n[4]),T(e,"aria-valuemax",n[11]),T(e,"aria-valuemin",n[10]),T(e,"aria-valuenow",n[0]),T(e,"aria-valuetext",s=n[2](n[0])),T(e,"aria-label",n[7]),T(e,"aria-labelledby",n[8]),T(e,"aria-controls",n[9]),T(e,"tabindex","0"),Ti(e,"reverse",n[5]),C(e,"--position",n[12])},m(f,d){B(f,e,d),K(e,t),K(e,r),K(e,i),n[22](e),B(f,o,d),h&&h.m(f,d),B(f,a,d),l||(u=[ke(window,"mousemove",n[15]),ke(window,"mouseup",n[16]),ke(e,"keydown",n[13]),ke(e,"mousedown",Lm(function(){xr(n[6]?void 0:n[14])&&(n[6]?void 0:n[14]).apply(this,arguments)})),ke(e,"touchstart",er(function(){xr(n[6]?void 0:n[17])&&(n[6]?void 0:n[17]).apply(this,arguments)}),{passive:!1}),ke(e,"touchmove",er(function(){xr(n[6]?void 0:n[17])&&(n[6]?void 0:n[17]).apply(this,arguments)}),{passive:!1}),ke(e,"touchend",er(function(){xr(n[6]?void 0:n[17])&&(n[6]?void 0:n[17]).apply(this,arguments)}),{passive:!1})],l=!0)},p(f,[d]){n=f,d&16&&T(e,"aria-orientation",n[4]),d&2048&&T(e,"aria-valuemax",n[11]),d&1024&&T(e,"aria-valuemin",n[10]),d&1&&T(e,"aria-valuenow",n[0]),d&5&&s!==(s=n[2](n[0]))&&T(e,"aria-valuetext",s),d&128&&T(e,"aria-label",n[7]),d&256&&T(e,"aria-labelledby",n[8]),d&512&&T(e,"aria-controls",n[9]),d&32&&Ti(e,"reverse",n[5]),d&4096&&C(e,"--position",n[12]),n[3]?h?h.p(n,d):(h=sd(n),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i:ue,o:ue,d(f){f&&(F(e),F(o),F(a)),n[22](null),h&&h.d(f),l=!1,sn(u)}}}function sA(n,e,t){let r,i,s,o,{min:a=0}=e,{max:l=100}=e,{step:u=1}=e,{value:h=50}=e,{ariaValueText:f=j=>j.toString()}=e,{name:d=void 0}=e,{direction:p="horizontal"}=e,{reverse:g=!1}=e,{keyboardOnly:b=!1}=e,{slider:A=void 0}=e,{ariaLabel:S=void 0}=e,{ariaLabelledBy:v=void 0}=e,{ariaControls:x=void 0}=e,{isDragging:E=!1}=e;const L=Fs();function z(j){const Z=1/s,ge=Math.round(j*Z)/Z;return Math.max(r,Math.min(i,ge))}function k(j){const Z=j.shiftKey?s*10:s;j.key==="ArrowUp"||j.key==="ArrowRight"?(t(0,h+=Z),j.preventDefault()):j.key==="ArrowDown"||j.key==="ArrowLeft"?(t(0,h-=Z),j.preventDefault()):j.key==="Home"?(t(0,h=r),j.preventDefault()):j.key==="End"?(t(0,h=i),j.preventDefault()):j.key==="PageUp"?(t(0,h+=s*10),j.preventDefault()):j.key==="PageDown"&&(t(0,h-=s*10),j.preventDefault()),t(0,h=z(h)),L("input",h)}const y={horizontal:{clientSize:"clientWidth",offset:"left",client:"clientX"},vertical:{clientSize:"clientHeight",offset:"top",client:"clientY"}};function w(j){const Z=(A==null?void 0:A[y[p].clientSize])||120,ge=(A==null?void 0:A.getBoundingClientRect()[y[p].offset])||0;let le=j[y[p].client]-ge;p==="vertical"&&(le=-1*le+Z),g?t(0,h=i-le/Z*(i-r)):t(0,h=le/Z*(i-r)+r),t(0,h=z(h)),L("input",h)}function D(j){w(j),t(18,E=!0)}function N(j){E&&w(j)}function M(){t(18,E=!1)}function O(j){w({clientX:j.changedTouches[0].clientX,clientY:j.changedTouches[0].clientY})}function H(j){ut[j?"unshift":"push"](()=>{A=j,t(1,A)})}return n.$$set=j=>{"min"in j&&t(19,a=j.min),"max"in j&&t(20,l=j.max),"step"in j&&t(21,u=j.step),"value"in j&&t(0,h=j.value),"ariaValueText"in j&&t(2,f=j.ariaValueText),"name"in j&&t(3,d=j.name),"direction"in j&&t(4,p=j.direction),"reverse"in j&&t(5,g=j.reverse),"keyboardOnly"in j&&t(6,b=j.keyboardOnly),"slider"in j&&t(1,A=j.slider),"ariaLabel"in j&&t(7,S=j.ariaLabel),"ariaLabelledBy"in j&&t(8,v=j.ariaLabelledBy),"ariaControls"in j&&t(9,x=j.ariaControls),"isDragging"in j&&t(18,E=j.isDragging)},n.$$.update=()=>{n.$$.dirty&524288&&t(10,r=typeof a=="string"?parseFloat(a):a),n.$$.dirty&1048576&&t(11,i=typeof l=="string"?parseFloat(l):l),n.$$.dirty&2097152&&(s=typeof u=="string"?parseFloat(u):u),n.$$.dirty&3073&&t(12,o=((h-r)/(i-r)*1).toFixed(4))},[h,A,f,d,p,g,b,S,v,x,r,i,o,k,D,N,M,O,E,a,l,u,H]}class fa extends Se{constructor(e){super(),Pe(this,e,sA,iA,ce,{min:19,max:20,step:21,value:0,ariaValueText:2,name:3,direction:4,reverse:5,keyboardOnly:6,slider:1,ariaLabel:7,ariaLabelledBy:8,ariaControls:9,isDragging:18})}}function oA(n){let e,t,r,i,s,o,a,l,u,h,f,d,p;var g=n[2].pickerIndicator;function b(E,L){return{props:{pos:E[7],isDark:E[3]}}}g&&(t=Cn(g,b(n)));function A(E){n[14](E)}let S={keyboardOnly:!0,ariaValueText:aA,ariaLabel:n[4].label.s};n[0]!==void 0&&(S.value=n[0]),s=new fa({props:S}),ut.push(()=>wr(s,"value",A));function v(E){n[15](E)}let x={keyboardOnly:!0,ariaValueText:lA,direction:"vertical",ariaLabel:n[4].label.v};return n[1]!==void 0&&(x.value=n[1]),u=new fa({props:x}),ut.push(()=>wr(u,"value",v)),{c(){e=W("div"),t&&Q(t.$$.fragment),r=J(),i=W("div"),Q(s.$$.fragment),a=J(),l=W("div"),Q(u.$$.fragment),T(i,"class","s svelte-1x9tz9y"),C(i,"--pos-y",n[7].y),T(l,"class","v svelte-1x9tz9y"),C(l,"--pos-x",n[7].x),T(e,"class","picker svelte-1x9tz9y"),C(e,"--picker-color-bg",n[6])},m(E,L){B(E,e,L),t&&X(t,e,null),K(e,r),K(e,i),X(s,i,null),K(e,a),K(e,l),X(u,l,null),n[16](e),f=!0,d||(p=[ke(window,"mouseup",n[9]),ke(window,"mousedown",n[11]),ke(window,"mousemove",n[10]),ke(e,"mousedown",er(n[8])),ke(e,"touchstart",n[12],{passive:!1}),ke(e,"touchmove",er(n[12]),{passive:!1}),ke(e,"touchend",n[12],{passive:!1})],d=!0)},p(E,[L]){if(L&4&&g!==(g=E[2].pickerIndicator)){if(t){de();const y=t;V(y.$$.fragment,1,0,()=>{Y(y,1)}),_e()}g?(t=Cn(g,b(E)),Q(t.$$.fragment),P(t.$$.fragment,1),X(t,e,r)):t=null}else if(g){const y={};L&128&&(y.pos=E[7]),L&8&&(y.isDark=E[3]),t.$set(y)}const z={};L&16&&(z.ariaLabel=E[4].label.s),!o&&L&1&&(o=!0,z.value=E[0],vs(()=>o=!1)),s.$set(z),L&128&&C(i,"--pos-y",E[7].y);const k={};L&16&&(k.ariaLabel=E[4].label.v),!h&&L&2&&(h=!0,k.value=E[1],vs(()=>h=!1)),u.$set(k),L&128&&C(l,"--pos-x",E[7].x),L&64&&C(e,"--picker-color-bg",E[6])},i(E){f||(t&&P(t.$$.fragment,E),P(s.$$.fragment,E),P(u.$$.fragment,E),f=!0)},o(E){t&&V(t.$$.fragment,E),V(s.$$.fragment,E),V(u.$$.fragment,E),f=!1},d(E){E&&F(e),t&&Y(t),Y(s),Y(u),n[16](null),d=!1,sn(p)}}}function Ro(n,e,t){return Math.min(Math.max(e,n),t)}const aA=n=>`${n}%`,lA=n=>`${n}%`;function uA(n,e,t){const r=Fs();let{components:i}=e,{h:s}=e,{s:o}=e,{v:a}=e,{isDark:l}=e,{texts:u}=e,h,f=!1,d,p={x:100,y:0};function g(k){const{width:y,left:w,height:D,top:N}=h.getBoundingClientRect(),M={x:Ro(k.clientX-w,0,y),y:Ro(k.clientY-N,0,D)};t(0,o=Ro(M.x/y,0,1)*100),t(1,a=Ro((D-M.y)/D,0,1)*100)}function b(k){k.button===0&&(f=!0,g(k))}function A(){f=!1}function S(k){f&&g(k)}function v(k){k.target.isSameNode(h)}function x(k){k.preventDefault(),g(k.changedTouches[0])}function E(k){o=k,t(0,o)}function L(k){a=k,t(1,a)}function z(k){ut[k?"unshift":"push"](()=>{h=k,t(5,h)})}return n.$$set=k=>{"components"in k&&t(2,i=k.components),"h"in k&&t(13,s=k.h),"s"in k&&t(0,o=k.s),"v"in k&&t(1,a=k.v),"isDark"in k&&t(3,l=k.isDark),"texts"in k&&t(4,u=k.texts)},n.$$.update=()=>{n.$$.dirty&8192&&typeof s=="number"&&t(6,d=pn({h:s,s:100,v:100,a:1}).toHex()),n.$$.dirty&35&&typeof o=="number"&&typeof a=="number"&&h&&t(7,p={x:o,y:100-a}),n.$$.dirty&3&&r("input",{s:o,v:a})},[o,a,i,l,u,h,d,p,b,A,S,v,x,s,E,L,z]}class cA extends Se{constructor(e){super(),Pe(this,e,uA,oA,ce,{components:2,h:13,s:0,v:1,isDark:3,texts:4})}}function hA(n){let e;return{c(){e=W("div"),T(e,"class","picker-indicator svelte-i5mg2p"),Ti(e,"is-dark",n[1]),C(e,"--pos-x",n[0].x),C(e,"--pos-y",n[0].y)},m(t,r){B(t,e,r)},p(t,[r]){r&2&&Ti(e,"is-dark",t[1]),r&1&&C(e,"--pos-x",t[0].x),r&1&&C(e,"--pos-y",t[0].y)},i:ue,o:ue,d(t){t&&F(e)}}}function fA(n,e,t){let{pos:r}=e,{isDark:i}=e;return n.$$set=s=>{"pos"in s&&t(0,r=s.pos),"isDark"in s&&t(1,i=s.isDark)},[r,i]}class dA extends Se{constructor(e){super(),Pe(this,e,fA,hA,ce,{pos:0,isDark:1})}}function _A(n){let e,t,r,i,s,o,a,l,u,h;return{c(){e=W("input"),r=J(),i=W("input"),o=J(),a=W("input"),T(e,"aria-label",t=n[4].label.h),e.value=n[9],T(e,"type","number"),T(e,"min","0"),T(e,"max","360"),T(e,"class","svelte-qtukzs"),T(i,"aria-label",s=n[4].label.s),i.value=n[8],T(i,"type","number"),T(i,"min","0"),T(i,"max","100"),T(i,"class","svelte-qtukzs"),T(a,"aria-label",l=n[4].label.v),a.value=n[7],T(a,"type","number"),T(a,"min","0"),T(a,"max","100"),T(a,"class","svelte-qtukzs")},m(f,d){B(f,e,d),B(f,r,d),B(f,i,d),B(f,o,d),B(f,a,d),u||(h=[ke(e,"input",n[13]("h")),ke(i,"input",n[13]("s")),ke(a,"input",n[13]("v"))],u=!0)},p(f,d){d&16&&t!==(t=f[4].label.h)&&T(e,"aria-label",t),d&512&&e.value!==f[9]&&(e.value=f[9]),d&16&&s!==(s=f[4].label.s)&&T(i,"aria-label",s),d&256&&i.value!==f[8]&&(i.value=f[8]),d&16&&l!==(l=f[4].label.v)&&T(a,"aria-label",l),d&128&&a.value!==f[7]&&(a.value=f[7])},d(f){f&&(F(e),F(r),F(i),F(o),F(a)),u=!1,sn(h)}}}function pA(n){let e,t,r,i,s,o,a,l,u,h,f,d,p;return{c(){e=W("input"),i=J(),s=W("input"),l=J(),u=W("input"),T(e,"aria-label",t=n[4].label.r),e.value=r=n[0].r,T(e,"type","number"),T(e,"min","0"),T(e,"max","255"),T(e,"class","svelte-qtukzs"),T(s,"aria-label",o=n[4].label.g),s.value=a=n[0].g,T(s,"type","number"),T(s,"min","0"),T(s,"max","255"),T(s,"class","svelte-qtukzs"),T(u,"aria-label",h=n[4].label.b),u.value=f=n[0].b,T(u,"type","number"),T(u,"min","0"),T(u,"max","255"),T(u,"class","svelte-qtukzs")},m(g,b){B(g,e,b),B(g,i,b),B(g,s,b),B(g,l,b),B(g,u,b),d||(p=[ke(e,"input",n[12]("r")),ke(s,"input",n[12]("g")),ke(u,"input",n[12]("b"))],d=!0)},p(g,b){b&16&&t!==(t=g[4].label.r)&&T(e,"aria-label",t),b&1&&r!==(r=g[0].r)&&e.value!==r&&(e.value=r),b&16&&o!==(o=g[4].label.g)&&T(s,"aria-label",o),b&1&&a!==(a=g[0].g)&&s.value!==a&&(s.value=a),b&16&&h!==(h=g[4].label.b)&&T(u,"aria-label",h),b&1&&f!==(f=g[0].b)&&u.value!==f&&(u.value=f)},d(g){g&&(F(e),F(i),F(s),F(l),F(u)),d=!1,sn(p)}}}function gA(n){let e,t,r,i;return{c(){e=W("input"),T(e,"aria-label",t=n[4].label.hex),e.value=n[1],T(e,"class","svelte-qtukzs"),C(e,"flex",3)},m(s,o){B(s,e,o),r||(i=ke(e,"input",n[11]),r=!0)},p(s,o){o&16&&t!==(t=s[4].label.hex)&&T(e,"aria-label",t),o&2&&e.value!==s[1]&&(e.value=s[1])},d(s){s&&F(e),r=!1,i()}}}function od(n){let e,t,r,i;return{c(){e=W("input"),T(e,"aria-label",t=n[4].label.a),e.value=n[6],T(e,"type","number"),T(e,"min","0"),T(e,"max","1"),T(e,"step","0.01"),T(e,"class","svelte-qtukzs")},m(s,o){B(s,e,o),r||(i=ke(e,"input",function(){xr(n[5]==="hsv"?n[13]("a"):n[12]("a"))&&(n[5]==="hsv"?n[13]("a"):n[12]("a")).apply(this,arguments)}),r=!0)},p(s,o){n=s,o&16&&t!==(t=n[4].label.a)&&T(e,"aria-label",t),o&64&&e.value!==n[6]&&(e.value=n[6])},d(s){s&&F(e),r=!1,i()}}}function mA(n){let e,t=n[4].color[n[5]]+"",r;return{c(){e=W("div"),r=at(t),T(e,"class","button-like svelte-qtukzs")},m(i,s){B(i,e,s),K(e,r)},p(i,s){s&48&&t!==(t=i[4].color[i[5]]+"")&&Dt(r,t)},d(i){i&&F(e)}}}function yA(n){let e,t,r=n[4].color[n[5]]+"",i,s,o,a=n[4].changeTo+"",l,u,h,f,d;return{c(){e=W("button"),t=W("span"),i=at(r),s=J(),o=W("span"),l=at(a),u=J(),h=at(n[10]),T(t,"class","disappear svelte-qtukzs"),T(t,"aria-hidden","true"),T(o,"class","appear svelte-qtukzs"),T(e,"type","button"),T(e,"class","svelte-qtukzs")},m(p,g){B(p,e,g),K(e,t),K(t,i),K(e,s),K(e,o),K(o,l),K(o,u),K(o,h),f||(d=ke(e,"click",n[15]),f=!0)},p(p,g){g&48&&r!==(r=p[4].color[p[5]]+"")&&Dt(i,r),g&16&&a!==(a=p[4].changeTo+"")&&Dt(l,a),g&1024&&Dt(h,p[10])},d(p){p&&F(e),f=!1,d()}}}function bA(n){let e,t,r,i;function s(d,p){return d[5]==="hex"?gA:d[5]==="rgb"?pA:_A}let o=s(n),a=o(n),l=n[2]&&od(n);function u(d,p){return d[3].length>1?yA:mA}let h=u(n),f=h(n);return{c(){e=W("div"),t=W("div"),a.c(),r=J(),l&&l.c(),i=J(),f.c(),T(t,"class","input-container svelte-qtukzs"),T(e,"class","text-input svelte-qtukzs")},m(d,p){B(d,e,p),K(e,t),a.m(t,null),K(t,r),l&&l.m(t,null),K(e,i),f.m(e,null)},p(d,[p]){o===(o=s(d))&&a?a.p(d,p):(a.d(1),a=o(d),a&&(a.c(),a.m(t,r))),d[2]?l?l.p(d,p):(l=od(d),l.c(),l.m(t,null)):l&&(l.d(1),l=null),h===(h=u(d))&&f?f.p(d,p):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},i:ue,o:ue,d(d){d&&F(e),a.d(),l&&l.d(),f.d()}}}const wA=/^#?([A-F0-9]{6}|[A-F0-9]{8})$/i;function vA(n,e,t){let r,i,s,o,a;const l=Fs();let{isAlpha:u}=e,{rgb:h}=e,{hsv:f}=e,{hex:d}=e,{textInputModes:p}=e,{texts:g}=e,b=p[0]||"hex";function A(E){const L=E.target;wA.test(L.value)&&(t(1,d=L.value),l("input",{hex:d}))}function S(E){return function(L){t(0,h={...h,[E]:parseFloat(L.target.value)}),l("input",{rgb:h})}}function v(E){return function(L){t(14,f={...f,[E]:parseFloat(L.target.value)}),l("input",{hsv:f})}}const x=()=>t(5,b=r);return n.$$set=E=>{"isAlpha"in E&&t(2,u=E.isAlpha),"rgb"in E&&t(0,h=E.rgb),"hsv"in E&&t(14,f=E.hsv),"hex"in E&&t(1,d=E.hex),"textInputModes"in E&&t(3,p=E.textInputModes),"texts"in E&&t(4,g=E.texts)},n.$$.update=()=>{n.$$.dirty&40&&t(10,r=p[(p.indexOf(b)+1)%p.length]),n.$$.dirty&16384&&t(9,i=Math.round(f.h)),n.$$.dirty&16384&&t(8,s=Math.round(f.s)),n.$$.dirty&16384&&t(7,o=Math.round(f.v)),n.$$.dirty&16384&&t(6,a=f.a===void 0?1:Math.round(f.a*100)/100)},[h,d,u,p,g,b,a,o,s,i,r,A,S,v,f,x]}class kA extends Se{constructor(e){super(),Pe(this,e,vA,bA,ce,{isAlpha:2,rgb:0,hsv:14,hex:1,textInputModes:3,texts:4})}}function TA(n){let e,t,r,i,s,o,a,l,u,h,f;return{c(){e=W("label"),t=W("div"),r=W("input"),i=J(),s=W("div"),o=J(),a=W("div"),l=J(),u=at(n[2]),T(r,"type","color"),T(r,"name",n[3]),r.value=n[1],T(r,"aria-haspopup","dialog"),T(r,"class","svelte-lemcb1"),T(s,"class","alpha svelte-lemcb1"),T(a,"class","color svelte-lemcb1"),C(a,"background",n[1]),T(t,"class","container svelte-lemcb1"),T(e,"class","svelte-lemcb1")},m(d,p){B(d,e,p),K(e,t),K(t,r),K(t,i),K(t,s),K(t,o),K(t,a),K(e,l),K(e,u),n[5](e),h||(f=[ke(r,"click",er(Po)),ke(r,"mousedown",er(Po)),ke(e,"click",er(Po)),ke(e,"mousedown",er(Po))],h=!0)},p(d,[p]){p&8&&T(r,"name",d[3]),p&2&&(r.value=d[1]),p&2&&C(a,"background",d[1]),p&4&&Dt(u,d[2])},i:ue,o:ue,d(d){d&&F(e),n[5](null),h=!1,sn(f)}}}function Po(){}function EA(n,e,t){let{labelElement:r}=e,{hex:i}=e,{label:s}=e,{name:o=void 0}=e,{isOpen:a}=e;function l(u){ut[u?"unshift":"push"](()=>{r=u,t(0,r)})}return n.$$set=u=>{"labelElement"in u&&t(0,r=u.labelElement),"hex"in u&&t(1,i=u.hex),"label"in u&&t(2,s=u.label),"name"in u&&t(3,o=u.name),"isOpen"in u&&t(4,a=u.isOpen)},[r,i,s,o,a,l]}class AA extends Se{constructor(e){super(),Pe(this,e,EA,TA,ce,{labelElement:0,hex:1,label:2,name:3,isOpen:4})}}function IA(n){let e,t,r;const i=n[4].default,s=da(i,n,n[3],null);return{c(){e=W("div"),s&&s.c(),T(e,"class","wrapper svelte-h9ar9"),T(e,"role",t=n[2]?"dialog":void 0),T(e,"aria-label","color picker"),Ti(e,"is-open",n[1])},m(o,a){B(o,e,a),s&&s.m(e,null),n[5](e),r=!0},p(o,[a]){s&&s.p&&(!r||a&8)&&pa(s,i,o,o[3],r?_a(i,o[3],a,null):ga(o[3]),null),(!r||a&4&&t!==(t=o[2]?"dialog":void 0))&&T(e,"role",t),(!r||a&2)&&Ti(e,"is-open",o[1])},i(o){r||(P(s,o),r=!0)},o(o){V(s,o),r=!1},d(o){o&&F(e),s&&s.d(o),n[5](null)}}}function CA(n,e,t){let{$$slots:r={},$$scope:i}=e,{wrapper:s}=e,{isOpen:o}=e,{isDialog:a}=e;function l(u){ut[u?"unshift":"push"](()=>{s=u,t(0,s)})}return n.$$set=u=>{"wrapper"in u&&t(0,s=u.wrapper),"isOpen"in u&&t(1,o=u.isOpen),"isDialog"in u&&t(2,a=u.isDialog),"$$scope"in u&&t(3,i=u.$$scope)},[s,o,a,i,r,l]}class RA extends Se{constructor(e){super(),Pe(this,e,CA,IA,ce,{wrapper:0,isOpen:1,isDialog:2})}}const Ol={label:{h:"hue channel",s:"saturation channel",v:"brightness channel",r:"red channel",g:"green channel",b:"blue channel",a:"alpha channel",hex:"hex color",withoutColor:"without color"},color:{rgb:"rgb",hsv:"hsv",hex:"hex"},changeTo:"change to "},tm="a[href], area[href], input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]";function PA(n){return function(e){if(e.target===window)return;const t=e.target;if(!n.contains(t))return;const r=n.querySelectorAll(tm),i=r[0],s=r[r.length-1];function o(l){return l.code==="Tab"&&!l.shiftKey}function a(l){return l.code==="Tab"&&l.shiftKey}o(e)&&e.target===s?(e.preventDefault(),i.focus()):a(e)&&e.target===i&&(e.preventDefault(),s.focus())}}const SA=n=>{const e=n.querySelector(tm);e&&e.focus();const t=PA(n);return document.addEventListener("keydown",t),{destroy(){document.removeEventListener("keydown",t)}}};function DA(n){let e,t,r,i,s,o,a=n[1].label.withoutColor+"",l,u,h;return{c(){e=W("label"),t=W("div"),r=W("input"),i=J(),s=W("span"),o=J(),l=at(a),T(r,"type","checkbox"),T(r,"class","svelte-oskb5b"),T(s,"class","svelte-oskb5b"),T(t,"class","svelte-oskb5b"),T(e,"class","nullability-checkbox svelte-oskb5b")},m(f,d){B(f,e,d),K(e,t),K(t,r),r.checked=n[0],K(t,i),K(t,s),K(e,o),K(e,l),u||(h=ke(r,"change",n[2]),u=!0)},p(f,[d]){d&1&&(r.checked=f[0]),d&2&&a!==(a=f[1].label.withoutColor+"")&&Dt(l,a)},i:ue,o:ue,d(f){f&&F(e),u=!1,h()}}}function OA(n,e,t){let{isUndefined:r}=e,{texts:i}=e;function s(){r=this.checked,t(0,r)}return n.$$set=o=>{"isUndefined"in o&&t(0,r=o.isUndefined),"texts"in o&&t(1,i=o.texts)},[r,i,s]}class NA extends Se{constructor(e){super(),Pe(this,e,OA,DA,ce,{isUndefined:0,texts:1})}}function VA(n){let e;return{c(){e=W("input"),T(e,"type","hidden"),e.value=n[2],T(e,"name",n[6])},m(t,r){B(t,e,r)},p(t,r){r[0]&4&&(e.value=t[2]),r[0]&64&&T(e,"name",t[6])},i:ue,o:ue,d(t){t&&F(e)}}}function MA(n){let e,t,r,i;function s(l){n[38](l)}var o=n[25]().input;function a(l,u){let h={isOpen:!0,hex:l[2],label:l[5],name:l[6]};return l[23]!==void 0&&(h.labelElement=l[23]),{props:h}}return o&&(e=Cn(o,a(n)),ut.push(()=>wr(e,"labelElement",s))),{c(){e&&Q(e.$$.fragment),r=Te()},m(l,u){e&&X(e,l,u),B(l,r,u),i=!0},p(l,u){if(o!==(o=l[25]().input)){if(e){de();const h=e;V(h.$$.fragment,1,0,()=>{Y(h,1)}),_e()}o?(e=Cn(o,a(l)),ut.push(()=>wr(e,"labelElement",s)),Q(e.$$.fragment),P(e.$$.fragment,1),X(e,r.parentNode,r)):e=null}else if(o){const h={};u[0]&4&&(h.hex=l[2]),u[0]&32&&(h.label=l[5]),u[0]&64&&(h.name=l[6]),!t&&u[0]&8388608&&(t=!0,h.labelElement=l[23],vs(()=>t=!1)),e.$set(h)}},i(l){i||(e&&P(e.$$.fragment,l),i=!0)},o(l){e&&V(e.$$.fragment,l),i=!1},d(l){l&&F(r),e&&Y(e,l)}}}function ad(n){let e,t,r,i;function s(l){n[39](l)}var o=n[25]().nullabilityCheckbox;function a(l,u){let h={texts:l[26]()};return l[16]!==void 0&&(h.isUndefined=l[16]),{props:h}}return o&&(e=Cn(o,a(n)),ut.push(()=>wr(e,"isUndefined",s))),{c(){e&&Q(e.$$.fragment),r=Te()},m(l,u){e&&X(e,l,u),B(l,r,u),i=!0},p(l,u){if(o!==(o=l[25]().nullabilityCheckbox)){if(e){de();const h=e;V(h.$$.fragment,1,0,()=>{Y(h,1)}),_e()}o?(e=Cn(o,a(l)),ut.push(()=>wr(e,"isUndefined",s)),Q(e.$$.fragment),P(e.$$.fragment,1),X(e,r.parentNode,r)):e=null}else if(o){const h={};!t&&u[0]&65536&&(t=!0,h.isUndefined=l[16],vs(()=>t=!1)),e.$set(h)}},i(l){i||(e&&P(e.$$.fragment,l),i=!0)},o(l){e&&V(e.$$.fragment,l),i=!1},d(l){l&&F(r),e&&Y(e,l)}}}function ld(n){var i;let e,t,r;return t=new fa({props:{min:0,max:1,step:.01,value:((i=n[1])==null?void 0:i.a)??n[20].a,direction:n[12],reverse:n[12]==="vertical",ariaLabel:n[26]().label.a}}),t.$on("input",n[29]("a")),{c(){e=W("div"),Q(t.$$.fragment),T(e,"class","a svelte-tsvobk"),C(e,"--alphaless-color",(n[2]?n[2]:n[21]).substring(0,7))},m(s,o){B(s,e,o),X(t,e,null),r=!0},p(s,o){var l;const a={};o[0]&1048578&&(a.value=((l=s[1])==null?void 0:l.a)??s[20].a),o[0]&4096&&(a.direction=s[12]),o[0]&4096&&(a.reverse=s[12]==="vertical"),t.$set(a),o[0]&2097156&&C(e,"--alphaless-color",(s[2]?s[2]:s[21]).substring(0,7))},i(s){r||(P(t.$$.fragment,s),r=!0)},o(s){V(t.$$.fragment,s),r=!1},d(s){s&&F(e),Y(t)}}}function ud(n){let e,t,r;var i=n[25]().textInput;function s(o,a){return{props:{hex:o[2]??o[21],rgb:o[0]??o[19],hsv:o[1]??o[20],isAlpha:o[8],textInputModes:o[11],texts:o[26]()}}}return i&&(e=Cn(i,s(n)),e.$on("input",n[40])),{c(){e&&Q(e.$$.fragment),t=Te()},m(o,a){e&&X(e,o,a),B(o,t,a),r=!0},p(o,a){if(i!==(i=o[25]().textInput)){if(e){de();const l=e;V(l.$$.fragment,1,0,()=>{Y(l,1)}),_e()}i?(e=Cn(i,s(o)),e.$on("input",o[40]),Q(e.$$.fragment),P(e.$$.fragment,1),X(e,t.parentNode,t)):e=null}else if(i){const l={};a[0]&2097156&&(l.hex=o[2]??o[21]),a[0]&524289&&(l.rgb=o[0]??o[19]),a[0]&1048578&&(l.hsv=o[1]??o[20]),a[0]&256&&(l.isAlpha=o[8]),a[0]&2048&&(l.textInputModes=o[11]),e.$set(l)}},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&V(e.$$.fragment,o),r=!1},d(o){o&&F(t),e&&Y(e,o)}}}function xA(n){let e,t,r;var i=n[25]().a11yNotice;function s(o,a){return{props:{components:o[25](),a11yColors:o[13],hex:o[2]||"#00000000",a11yTexts:o[15],a11yLevel:o[14]}}}return i&&(e=Cn(i,s(n))),{c(){e&&Q(e.$$.fragment),t=Te()},m(o,a){e&&X(e,o,a),B(o,t,a),r=!0},p(o,a){if(i!==(i=o[25]().a11yNotice)){if(e){de();const l=e;V(l.$$.fragment,1,0,()=>{Y(l,1)}),_e()}i?(e=Cn(i,s(o)),Q(e.$$.fragment),P(e.$$.fragment,1),X(e,t.parentNode,t)):e=null}else if(i){const l={};a[0]&8192&&(l.a11yColors=o[13]),a[0]&4&&(l.hex=o[2]||"#00000000"),a[0]&32768&&(l.a11yTexts=o[15]),a[0]&16384&&(l.a11yLevel=o[14]),e.$set(l)}},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&V(e.$$.fragment,o),r=!1},d(o){o&&F(t),e&&Y(e,o)}}}function LA(n){var A,S,v,x;let e,t,r,i,s,o,a,l,u=n[25]().a11yNotice,h,f,d=n[7]&&ad(n);t=new cA({props:{components:n[25](),h:((A=n[1])==null?void 0:A.h)??n[20].h,s:((S=n[1])==null?void 0:S.s)??n[20].s,v:((v=n[1])==null?void 0:v.v)??n[20].v,isDark:n[4],texts:n[26]()}}),t.$on("input",n[30](["s","v"])),s=new fa({props:{min:0,max:360,step:1,value:((x=n[1])==null?void 0:x.h)??n[20].h,direction:n[12],reverse:n[12]==="vertical",ariaLabel:n[26]().label.h}}),s.$on("input",n[29]("h"));let p=n[8]&&ld(n),g=n[10]&&ud(n),b=u&&xA(n);return{c(){d&&d.c(),e=J(),Q(t.$$.fragment),r=J(),i=W("div"),Q(s.$$.fragment),o=J(),p&&p.c(),a=J(),g&&g.c(),l=J(),b&&b.c(),h=Te(),T(i,"class","h svelte-tsvobk")},m(E,L){d&&d.m(E,L),B(E,e,L),X(t,E,L),B(E,r,L),B(E,i,L),X(s,i,null),B(E,o,L),p&&p.m(E,L),B(E,a,L),g&&g.m(E,L),B(E,l,L),b&&b.m(E,L),B(E,h,L),f=!0},p(E,L){var y,w,D,N;E[7]?d?(d.p(E,L),L[0]&128&&P(d,1)):(d=ad(E),d.c(),P(d,1),d.m(e.parentNode,e)):d&&(de(),V(d,1,1,()=>{d=null}),_e());const z={};L[0]&1048578&&(z.h=((y=E[1])==null?void 0:y.h)??E[20].h),L[0]&1048578&&(z.s=((w=E[1])==null?void 0:w.s)??E[20].s),L[0]&1048578&&(z.v=((D=E[1])==null?void 0:D.v)??E[20].v),L[0]&16&&(z.isDark=E[4]),t.$set(z);const k={};L[0]&1048578&&(k.value=((N=E[1])==null?void 0:N.h)??E[20].h),L[0]&4096&&(k.direction=E[12]),L[0]&4096&&(k.reverse=E[12]==="vertical"),s.$set(k),E[8]?p?(p.p(E,L),L[0]&256&&P(p,1)):(p=ld(E),p.c(),P(p,1),p.m(a.parentNode,a)):p&&(de(),V(p,1,1,()=>{p=null}),_e()),E[10]?g?(g.p(E,L),L[0]&1024&&P(g,1)):(g=ud(E),g.c(),P(g,1),g.m(l.parentNode,l)):g&&(de(),V(g,1,1,()=>{g=null}),_e()),u&&b.p(E,L)},i(E){f||(P(d),P(t.$$.fragment,E),P(s.$$.fragment,E),P(p),P(g),P(b),f=!0)},o(E){V(d),V(t.$$.fragment,E),V(s.$$.fragment,E),V(p),V(g),V(b),f=!1},d(E){E&&(F(e),F(r),F(i),F(o),F(a),F(l),F(h)),d&&d.d(E),Y(t,E),Y(s),p&&p.d(E),g&&g.d(E),b&&b.d(E)}}}function zA(n){let e,t,r,i,s,o,a,l,u,h;qo(n[37]);const f=[MA,VA],d=[];function p(S,v){return S[9]?0:S[6]?1:-1}~(t=p(n))&&(r=d[t]=f[t](n));function g(S){n[41](S)}var b=n[25]().wrapper;function A(S,v){let x={isOpen:S[3],isDialog:S[9],$$slots:{default:[LA]},$$scope:{ctx:S}};return S[24]!==void 0&&(x.wrapper=S[24]),{props:x}}return b&&(s=Cn(b,A(n)),ut.push(()=>wr(s,"wrapper",g))),{c(){e=W("span"),r&&r.c(),i=J(),s&&Q(s.$$.fragment),T(e,"class",a="color-picker "+n[12]+" svelte-tsvobk")},m(S,v){B(S,e,v),~t&&d[t].m(e,null),K(e,i),s&&X(s,e,null),n[42](e),l=!0,u||(h=[ke(window,"mousedown",n[27]),ke(window,"keyup",n[28]),ke(window,"scroll",n[31]),ke(window,"resize",n[37])],u=!0)},p(S,v){let x=t;if(t=p(S),t===x?~t&&d[t].p(S,v):(r&&(de(),V(d[x],1,1,()=>{d[x]=null}),_e()),~t?(r=d[t],r?r.p(S,v):(r=d[t]=f[t](S),r.c()),P(r,1),r.m(e,i)):r=null),b!==(b=S[25]().wrapper)){if(s){de();const E=s;V(E.$$.fragment,1,0,()=>{Y(E,1)}),_e()}b?(s=Cn(b,A(S)),ut.push(()=>wr(s,"wrapper",g)),Q(s.$$.fragment),P(s.$$.fragment,1),X(s,e,null)):s=null}else if(b){const E={};v[0]&8&&(E.isOpen=S[3]),v[0]&512&&(E.isDialog=S[9]),v[0]&3800471|v[1]&131072&&(E.$$scope={dirty:v,ctx:S}),!o&&v[0]&16777216&&(o=!0,E.wrapper=S[24],vs(()=>o=!1)),s.$set(E)}(!l||v[0]&4096&&a!==(a="color-picker "+S[12]+" svelte-tsvobk"))&&T(e,"class",a)},i(S){l||(P(r),s&&P(s.$$.fragment,S),l=!0)},o(S){V(r),s&&V(s.$$.fragment,S),l=!1},d(S){S&&F(e),~t&&d[t].d(),s&&Y(s),n[42](null),u=!1,sn(h)}}}const li=12;function FA(n,e,t){const r=Fs();let{components:i={}}=e,{label:s="Choose a color"}=e,{name:o=void 0}=e,{nullable:a=!1}=e,{rgb:l=a?void 0:{r:255,g:0,b:0,a:1}}=e,{hsv:u=a?void 0:{h:0,s:100,v:100,a:1}}=e,{hex:h=a?void 0:"#ff0000"}=e,{color:f=void 0}=e,{isDark:d=!1}=e,{isAlpha:p=!0}=e,{isDialog:g=!0}=e,{isOpen:b=!g}=e,{position:A="fixed"}=e,{isTextInput:S=!0}=e,{textInputModes:v=["hex","rgb","hsv"]}=e,{sliderDirection:x="vertical"}=e,{disableCloseClickOutside:E=!1}=e,{a11yColors:L=[{bgHex:"#ffffff"}]}=e,{a11yLevel:z="AA"}=e,{texts:k=void 0}=e,{a11yTexts:y=void 0}=e,w={r:255,g:0,b:0,a:1},D={h:0,s:100,v:100,a:1},N="#ff0000",M=!1,O=M,H,j,Z,ge,le,ee;const fe={pickerIndicator:dA,textInput:kA,input:AA,nullabilityCheckbox:NA,wrapper:RA};function Ve(){return{...fe,...i}}function ye(){return{label:{...Ol.label,...k==null?void 0:k.label},color:{...Ol.color,...k==null?void 0:k.color},changeTo:(k==null?void 0:k.changeTo)??Ol.changeTo}}function Ae({target:oe}){g&&(j.contains(oe)||j.isSameNode(oe)?t(3,b=!b):b&&!Z.contains(oe)&&!E&&t(3,b=!1))}function Be({key:oe,target:kt}){if(g)oe==="Enter"&&j.contains(kt)?(t(3,b=!b),setTimeout(()=>{ge=SA(Z)})):oe==="Escape"&&b&&(t(3,b=!1),H.contains(kt)&&(j==null||j.focus(),ge==null||ge.destroy()));else return}function be(){if(M&&!O){O=!0,t(1,u=t(0,l=t(2,h=void 0))),r("input",{color:f,hsv:u,rgb:l,hex:h});return}else if(O&&!M){O=!1,t(1,u=D),t(0,l=w),t(2,h=N),r("input",{color:f,hsv:u,rgb:l,hex:h});return}if(!u&&!l&&!h){t(16,M=!0),O=!0,r("input",{color:void 0,hsv:u,rgb:l,hex:h});return}u&&l&&u.h===D.h&&u.s===D.s&&u.v===D.v&&u.a===D.a&&l.r===w.r&&l.g===w.g&&l.b===w.b&&l.a===w.a&&h===N||(t(16,M=!1),u&&u.a===void 0&&t(1,u.a=1,u),D.a===void 0&&t(20,D.a=1,D),l&&l.a===void 0&&t(0,l.a=1,l),w.a===void 0&&t(19,w.a=1,w),(h==null?void 0:h.substring(7))==="ff"&&t(2,h=h.substring(0,7)),(h==null?void 0:h.substring(7))==="ff"&&t(2,h=h.substring(0,7)),u&&(u.h!==D.h||u.s!==D.s||u.v!==D.v||u.a!==D.a||!l&&!h)?(t(32,f=pn(u)),t(0,l=f.toRgb()),t(2,h=f.toHex())):l&&(l.r!==w.r||l.g!==w.g||l.b!==w.b||l.a!==w.a||!u&&!h)?(t(32,f=pn(l)),t(2,h=f.toHex()),t(1,u=f.toHsv())):h&&(h!==N||!u&&!l)&&(t(32,f=pn(h)),t(0,l=f.toRgb()),t(1,u=f.toHsv())),f&&t(4,d=f.isDark()),h&&(t(20,D=Object.assign({},u)),t(19,w=Object.assign({},l)),t(21,N=h),O=M,r("input",{color:f,hsv:u,rgb:l,hex:h})))}function et(oe){return kt=>{u||t(1,u={...D}),t(1,u[oe]=kt.detail,u)}}function rt(oe){return kt=>{u||t(1,u={...D}),oe.forEach(pe=>{u&&t(1,u[pe]=kt.detail[pe],u)})}}async function vt(){if(await Um(),A!=="fixed"&&b&&g&&j&&Z){const oe=Z.getBoundingClientRect(),kt=j.getBoundingClientRect();(A==="responsive"||A==="responsive-y")&&(kt.top+oe.height+li>ee?t(24,Z.style.top=`-${oe.height+li}px`,Z):t(24,Z.style.top=`${kt.height+li}px`,Z)),(A==="responsive"||A==="responsive-x")&&(kt.left+oe.width+li>le?t(24,Z.style.left=`-${oe.width-kt.width+li}px`,Z):t(24,Z.style.left=`${li}px`,Z))}}function Ht(){t(17,le=window.innerWidth),t(18,ee=window.innerHeight)}function kn(oe){j=oe,t(23,j)}function $t(oe){M=oe,t(16,M)}const Sn=({detail:oe})=>{oe.hsv?t(1,u=oe.hsv):oe.rgb?t(0,l=oe.rgb):oe.hex&&t(2,h=oe.hex)};function Dn(oe){Z=oe,t(24,Z)}function On(oe){ut[oe?"unshift":"push"](()=>{H=oe,t(22,H)})}return n.$$set=oe=>{"components"in oe&&t(33,i=oe.components),"label"in oe&&t(5,s=oe.label),"name"in oe&&t(6,o=oe.name),"nullable"in oe&&t(7,a=oe.nullable),"rgb"in oe&&t(0,l=oe.rgb),"hsv"in oe&&t(1,u=oe.hsv),"hex"in oe&&t(2,h=oe.hex),"color"in oe&&t(32,f=oe.color),"isDark"in oe&&t(4,d=oe.isDark),"isAlpha"in oe&&t(8,p=oe.isAlpha),"isDialog"in oe&&t(9,g=oe.isDialog),"isOpen"in oe&&t(3,b=oe.isOpen),"position"in oe&&t(34,A=oe.position),"isTextInput"in oe&&t(10,S=oe.isTextInput),"textInputModes"in oe&&t(11,v=oe.textInputModes),"sliderDirection"in oe&&t(12,x=oe.sliderDirection),"disableCloseClickOutside"in oe&&t(35,E=oe.disableCloseClickOutside),"a11yColors"in oe&&t(13,L=oe.a11yColors),"a11yLevel"in oe&&t(14,z=oe.a11yLevel),"texts"in oe&&t(36,k=oe.texts),"a11yTexts"in oe&&t(15,y=oe.a11yTexts)},n.$$.update=()=>{n.$$.dirty[0]&7&&(u||l||h)&&be(),n.$$.dirty[0]&65536&&be(),n.$$.dirty[0]&393224&&vt()},[l,u,h,b,d,s,o,a,p,g,S,v,x,L,z,y,M,le,ee,w,D,N,H,j,Z,Ve,ye,Ae,Be,et,rt,vt,f,i,A,E,k,Ht,kn,$t,Sn,Dn,On]}class BA extends Se{constructor(e){super(),Pe(this,e,FA,zA,ce,{components:33,label:5,name:6,nullable:7,rgb:0,hsv:1,hex:2,color:32,isDark:4,isAlpha:8,isDialog:9,isOpen:3,position:34,isTextInput:10,textInputModes:11,sliderDirection:12,disableCloseClickOutside:35,a11yColors:13,a11yLevel:14,texts:36,a11yTexts:15},null,[-1,-1])}}function cd(n){let e=n[0].id,t,r,i=hd(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o&1&&ce(e,e=s[0].id)?(de(),V(i,1,1,ue),_e(),i=hd(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function hd(n){let e,t,r,i;return t=new BA({props:{label:"",hex:n[2]}}),t.$on("input",n[4]),{c(){e=W("div"),r=W("div"),Q(t.$$.fragment),C(r,"display","contents"),C(r,"--input-size",n[3]+"px"),C(r,"--picker-width",fd+"px"),C(r,"--picker-height",fd+"px"),C(r,"--slider-width",n[3]+"px"),C(r,"--picker-z-index",Ee.frontmost),C(r,"--picker-indicator-size",n[3]+"px"),T(e,"class","color svelte-fovlqs"),C(e,"top",n[1].y+"px"),C(e,"left",n[1].x+"px"),C(e,"position","absolute"),C(e,"z-index",Ee.frontmost)},m(s,o){B(s,e,o),K(e,r),X(t,r,null),i=!0},p(s,o){const a={};o&4&&(a.hex=s[2]),t.$set(a),(!i||o&2)&&C(e,"top",s[1].y+"px"),(!i||o&2)&&C(e,"left",s[1].x+"px")},i(s){i||(P(t.$$.fragment,s),i=!0)},o(s){V(t.$$.fragment,s),i=!1},d(s){s&&F(e),Y(t)}}}function UA(n){let e,t,r=!!n[0]&&cd(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&P(r,1)):(r=cd(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}const fd=122;function jA(n,e,t){let{origin:r=G.zero}=e,{thing:i}=e;const s=I.dot_size+1;let o=I.empty;Zt(()=>{i&&t(2,o=we.colorToHex(i.color))});function a(l){l.preventDefault();const u=l.detail.hex;i.color!=u&&(t(0,i.color=u,i),i.signal_color_change(),i.persist())}return n.$$set=l=>{"origin"in l&&t(1,r=l.origin),"thing"in l&&t(0,i=l.thing)},[i,r,o,s,a]}class qA extends Se{constructor(e){super(),Pe(this,e,jA,UA,ce,{origin:1,thing:0})}}function dd(n){let e,t,r,i,s,o=n[3].length!=0&&_d(n);r=new qA({props:{thing:n[1],origin:new G(73,147)}});let a=n[2].traits&&gd(n);return{c(){e=W("div"),o&&o.c(),t=J(),Q(r.$$.fragment),i=J(),a&&a.c(),T(e,"class","info"),C(e,"color","black"),C(e,"top",n[0]+"px"),C(e,"left",uc+"px"),C(e,"position","absolute"),C(e,"width",n[8]+"px")},m(l,u){B(l,e,u),o&&o.m(e,null),K(e,t),X(r,e,null),K(e,i),a&&a.m(e,null),s=!0},p(l,u){l[3].length!=0?o?(o.p(l,u),u[0]&8&&P(o,1)):(o=_d(l),o.c(),P(o,1),o.m(e,t)):o&&(de(),V(o,1,1,()=>{o=null}),_e());const h={};u[0]&2&&(h.thing=l[1]),r.$set(h),l[2].traits?a?(a.p(l,u),u[0]&4&&P(a,1)):(a=gd(l),a.c(),P(a,1),a.m(e,null)):a&&(de(),V(a,1,1,()=>{a=null}),_e()),(!s||u[0]&1)&&C(e,"top",l[0]+"px")},i(l){s||(P(o),P(r.$$.fragment,l),P(a),s=!0)},o(l){V(o),V(r.$$.fragment,l),V(a),s=!1},d(l){l&&F(e),o&&o.d(),Y(r),a&&a.d()}}}function _d(n){let e,t,r=n[4],i,s,o;e=new Ys({props:{name:"info-type",font_size:n[7],origin:new G(45,0),selected:[n[2].info_type],height:I.row_height*nm,selection_closure:n[10],titles:[Kr.focus,Kr.selection]}});let a=pd(n);return s=new Eg({props:{top:39,array:n[3]}}),{c(){Q(e.$$.fragment),t=J(),a.c(),i=J(),Q(s.$$.fragment)},m(l,u){X(e,l,u),B(l,t,u),a.m(l,u),B(l,i,u),X(s,l,u),o=!0},p(l,u){const h={};u[0]&4&&(h.selected=[l[2].info_type]),e.$set(h),u[0]&16&&ce(r,r=l[4])?(de(),V(a,1,1,ue),_e(),a=pd(l),a.c(),P(a,1),a.m(i.parentNode,i)):a.p(l,u);const f={};u[0]&8&&(f.array=l[3]),s.$set(f)},i(l){o||(P(e.$$.fragment,l),P(a),P(s.$$.fragment,l),o=!0)},o(l){V(e.$$.fragment,l),V(a),V(s.$$.fragment,l),o=!1},d(l){l&&(F(t),F(i)),Y(e,l),a.d(l),Y(s,l)}}}function pd(n){let e,t=n[4].clipWithEllipsisAt(30)+"",r,i,s,o;return s=new Qs({props:{top:"36",width:n[8]}}),{c(){e=W("div"),r=at(t),i=J(),Q(s.$$.fragment),C(e,"top","20px"),C(e,"position","absolute"),C(e,"text-align","center"),C(e,"width",n[8]+"px")},m(a,l){B(a,e,l),K(e,r),B(a,i,l),X(s,a,l),o=!0},p(a,l){(!o||l[0]&16)&&t!==(t=a[4].clipWithEllipsisAt(30)+"")&&Dt(r,t)},i(a){o||(P(s.$$.fragment,a),o=!0)},o(a){V(s.$$.fragment,a),o=!1},d(a){a&&(F(e),F(i)),Y(s,a)}}}function gd(n){let e,t,r,i,s,o;return r=new Qf({props:{color:"k.color_default",top:n[6],label:"consequence",width:n[9].width,height:n[9].height,original_text:n[1].consequence,handle_textChange:n[11]}}),s=new Qf({props:{color:"k.color_default",label:"quest",top:n[6]+90,original_text:n[1].quest,width:n[9].width,height:n[9].height,handle_textChange:n[11]}}),{c(){e=W("div"),t=J(),Q(r.$$.fragment),i=J(),Q(s.$$.fragment),T(e,"class","horizontal-line"),C(e,"top","20px"),C(e,"left",-uc+"px"),C(e,"position","absolute"),C(e,"width",I.width_details+"px"),C(e,"z-index",Ee.frontmost)},m(a,l){B(a,e,l),B(a,t,l),X(r,a,l),B(a,i,l),X(s,a,l),o=!0},p(a,l){const u={};l[0]&2&&(u.original_text=a[1].consequence),r.$set(u);const h={};l[0]&2&&(h.original_text=a[1].quest),s.$set(h)},i(a){o||(P(r.$$.fragment,a),P(s.$$.fragment,a),o=!0)},o(a){V(r.$$.fragment,a),V(s.$$.fragment,a),o=!1},d(a){a&&(F(e),F(t),F(i)),Y(r,a),Y(s,a)}}}function md(n){let e,t,r=!!n[1]&&dd(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[1]?r?(r.p(i,s),s[0]&2&&P(r,1)):(r=dd(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function HA(n){let e=n[5],t,r,i=md(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o[0]&32&&ce(e,e=s[5])?(de(),V(i,1,1,ue),_e(),i=md(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}const yd="info",uc=10,nm=.8;function GA(n,e,t){let r,i,s,o,a;$(n,Fe,H=>t(21,r=H)),$(n,At,H=>t(13,i=H)),$(n,lt,H=>t(14,s=H)),$(n,Pn,H=>t(15,o=H)),$(n,Ml,H=>t(16,a=H));var l=this&&this.__awaiter||function(H,j,Z,ge){function le(ee){return ee instanceof Z?ee:new Z(function(fe){fe(ee)})}return new(Z||(Z=Promise))(function(ee,fe){function Ve(Be){try{Ae(ge.next(Be))}catch(be){fe(be)}}function ye(Be){try{Ae(ge.throw(Be))}catch(be){fe(be)}}function Ae(Be){Be.done?ee(Be.value):le(Be.value).then(Ve,ye)}Ae((ge=ge.apply(H,j||[])).next())})},u;let{top:h=71}=e;const f=h+52,d=`${nm}em`,p=I.width_details-30,g=I.width_details-uc*2,b=new G(122,f-20),A=new Xe(p-58,I.default_buttonSize+4);De.createCenterRect(b,A);const S=pt.element_state_for(new Mt(yd),dn.info,yd);let v=s,x=(u=v==null?void 0:v.thing)!==null&&u!==void 0?u:null,E=new Xe(p-4,68);x==null||x.idHashed;let L=[];I.thing_color_default;let z=i,k=x==null?void 0:x.title,y=0;S.set_forHovering(I.color_default,"pointer"),Zt(()=>{const H=Oe.handle_rebuildGraph(1,j=>{t(5,y+=1)});return()=>{H.disconnect()}});function w(){return z=i,!!z&&(z.length>1||!s.isGrabbed)}function D(H){const j=H[0];nt.write_key(it.info_type,j),t(2,ln.info_type=j,ln),N()}function N(){ln.info_type==Kr.focus||!w()?t(12,v=s):(z=i,z&&z.length>0&&t(12,v=z[0])),M()}function M(){var H,j;if(t(1,x=v==null?void 0:v.thing),x){t(4,k=x.title),x.idHashed;const Z={depth:(v.depth-1).expressZero_asHyphen(),children:v.children.length.expressZero_asHyphen(),parents:x.parents.length.expressZero_asHyphen(),related:x.relatedRelationships.length.expressZero_asHyphen(),predicate:(j=(H=v.predicate)===null||H===void 0?void 0:H.description)!==null&&j!==void 0?j:"none",direction:v.isParental?"child":"parent",id:x.id.clipWithEllipsisAt(12),color:I.empty};t(3,L=Object.entries(Z)),t(5,y+=1)}}function O(H,j){if(x&&(j||j==I.empty))switch(H){case"quest":x.setTraitText_forType(j,Ai.quest);break;case"consequence":x.setTraitText_forType(j,Ai.consequence);break}else j||l(this,void 0,void 0,function*(){yield r.db.persistAll()})}return n.$$set=H=>{"top"in H&&t(0,h=H.top)},n.$$.update=()=>{if(n.$$.dirty[0]&90112&&N(),n.$$.dirty[0]&32802){const H=o;x&&x.id==H&&(x.color,t(5,y+=1))}n.$$.dirty[0]&4098&&x!=(v==null?void 0:v.thing)&&M()},[h,x,ln,L,k,y,f,d,g,E,D,O,v,i,s,o,a]}class KA extends Se{constructor(e){super(),Pe(this,e,GA,HA,ce,{top:0},null,[-1,-1])}}function WA(n){let e,t,r,i;return e=new Qs({props:{title:"storage",top:n[0][Ue.storage]-8}}),r=new lk({props:{top:n[0][Ue.storage]}}),{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment)},m(s,o){X(e,s,o),B(s,t,o),X(r,s,o),i=!0},p(s,o){const a={};o&1&&(a.top=s[0][Ue.storage]-8),e.$set(a);const l={};o&1&&(l.top=s[0][Ue.storage]),r.$set(l)},i(s){i||(P(e.$$.fragment,s),P(r.$$.fragment,s),i=!0)},o(s){V(e.$$.fragment,s),V(r.$$.fragment,s),i=!1},d(s){s&&F(t),Y(e,s),Y(r,s)}}}function XA(n){let e,t,r,i;return e=new Qs({props:{title:"tools",top:n[0][Ue.tools]-8}}),r=new XE({props:{top:n[0][Ue.tools]}}),{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment)},m(s,o){X(e,s,o),B(s,t,o),X(r,s,o),i=!0},p(s,o){const a={};o&1&&(a.top=s[0][Ue.tools]-8),e.$set(a);const l={};o&1&&(l.top=s[0][Ue.tools]),r.$set(l)},i(s){i||(P(e.$$.fragment,s),P(r.$$.fragment,s),i=!0)},o(s){V(e.$$.fragment,s),V(r.$$.fragment,s),i=!1},d(s){s&&F(t),Y(e,s),Y(r,s)}}}function YA(n){let e,t,r,i;return e=new Qs({props:{title:"recents",top:n[0][Ue.recents]-8}}),r=new Zv({props:{top:n[0][Ue.recents]}}),{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment)},m(s,o){X(e,s,o),B(s,t,o),X(r,s,o),i=!0},p(s,o){const a={};o&1&&(a.top=s[0][Ue.recents]-8),e.$set(a);const l={};o&1&&(l.top=s[0][Ue.recents]),r.$set(l)},i(s){i||(P(e.$$.fragment,s),P(r.$$.fragment,s),i=!0)},o(s){V(e.$$.fragment,s),V(r.$$.fragment,s),i=!1},d(s){s&&F(t),Y(e,s),Y(r,s)}}}function QA(n){let e,t,r,i;return e=new Qs({props:{title:"info",top:n[0][Ue.info]-7}}),r=new KA({props:{top:n[0][Ue.info]}}),{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment)},m(s,o){X(e,s,o),B(s,t,o),X(r,s,o),i=!0},p(s,o){const a={};o&1&&(a.top=s[0][Ue.info]-7),e.$set(a);const l={};o&1&&(l.top=s[0][Ue.info]),r.$set(l)},i(s){i||(P(e.$$.fragment,s),P(r.$$.fragment,s),i=!0)},o(s){V(e.$$.fragment,s),V(r.$$.fragment,s),i=!1},d(s){s&&F(t),Y(e,s),Y(r,s)}}}function bd(n){let e,t,r,i=n[6](Ue.storage),s,o,a=n[6](Ue.tools),l,u=n[6](Ue.recents),h,f=n[6](Ue.info),d;t=new Ys({props:{titles:n[4],allow_multiple:!0,name:"details-selector",origin:new G(6,7),selected:n[2],selection_closure:n[5]}});let p=i&&WA(n),g=a&&XA(n),b=u&&YA(n),A=f&&QA(n);return{c(){e=W("div"),Q(t.$$.fragment),r=J(),p&&p.c(),s=J(),o=W("div"),g&&g.c(),l=J(),b&&b.c(),h=J(),A&&A.c(),T(o,"class","further-details"),C(o,"font-size","0.8em"),C(o,"width",I.width_details+"px"),T(e,"class","details"),C(e,"left","0px"),C(e,"position","fixed"),C(e,"font-size","0.95em"),C(e,"background-color","#fff"),C(e,"z-index",Ee.details),C(e,"width",I.width_details+"px"),C(e,"top",n[3].origin.y+"px"),C(e,"height",n[3].size.height+"px")},m(S,v){B(S,e,v),X(t,e,null),K(e,r),p&&p.m(e,null),K(e,s),K(e,o),g&&g.m(o,null),K(o,l),b&&b.m(o,null),K(o,h),A&&A.m(o,null),d=!0},p(S,v){const x={};v&4&&(x.selected=S[2]),t.$set(x),i&&p.p(S,v),a&&g.p(S,v),u&&b.p(S,v),f&&A.p(S,v),(!d||v&8)&&C(e,"top",S[3].origin.y+"px"),(!d||v&8)&&C(e,"height",S[3].size.height+"px")},i(S){d||(P(t.$$.fragment,S),P(p),P(g),P(b),P(A),d=!0)},o(S){V(t.$$.fragment,S),V(p),V(g),V(b),V(A),d=!1},d(S){S&&F(e),Y(t),p&&p.d(),g&&g.d(),b&&b.d(),A&&A.d()}}}function JA(n){let e=n[1],t,r,i=bd(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&2&&ce(e,e=s[1])?(de(),V(i,1,1,ue),_e(),i=bd(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function ZA(n,e,t){let r,i;$(n,Ho,d=>t(2,r=d)),$(n,cn,d=>t(3,i=d));const s=[Ue[Ue.storage],Ue[Ue.tools],Ue[Ue.recents],Ue[Ue.info]],o=[100,40,100,0];let a=[0,0,0,0],l=0;h();function u(d){It(Ho,r=d,r),h(),t(1,l+=1)}function h(){let d=42,p=0,g=r;for(;p<=Ue.info;)t(0,a[p]=d,a),g.includes(Ue[p])&&(d+=o[p]),p+=1}function f(d){return r.includes(Ue[d])}return[a,l,r,i,s,u,f]}class $A extends Se{constructor(e){super(),Pe(this,e,ZA,JA,ce,{})}}function eI(n){let e;return{c(){e=at(n[1])},m(t,r){B(t,e,r)},p(t,r){r&2&&Dt(e,t[1])},d(t){t&&F(e)}}}function wd(n){let e,t;return e=new Rn({props:{name:n[5],style:n[4],width:n[2],center:n[0],closure:n[7],position:"absolute",element_state:n[3],$$slots:{default:[eI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&32&&(s.name=r[5]),i&16&&(s.style=r[4]),i&4&&(s.width=r[2]),i&1&&(s.center=r[0]),i&8&&(s.element_state=r[3]),i&4194306&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function tI(n){let e=n[6],t,r,i=wd(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&64&&ce(e,e=s[6])?(de(),V(i,1,1,ue),_e(),i=wd(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}const So="1px solid";function nI(n,e,t){let r,i,s;$(n,zn,w=>t(16,r=w)),$(n,lt,w=>t(17,i=w)),$(n,Pn,w=>t(12,s=w));var o;let{left:a=0}=e,{ancestry:l}=e,{center:u=G.zero}=e;const h=dn.crumb;let f=I.color_background,d=`${So} ${f}`,p=I.default_buttonSize,g=l.thing,b=g.title,A,S=I.empty,v=I.empty,x=I.empty,E=0,L=0;z();function z(){g&&(i.idThing==g.id?S=`background-color: ${we.opacitize(g.color,.85)}; color: ${I.color_background}`:S=`background-color: ${I.color_background}; color: ${g.color}`,f=l.isGrabbed?g.color:I.color_background,d=`${So} ${f}`,k()),t(6,E+=1)}function k(){t(4,v=`
			${S};
			cursor:pointer;
			border:${d};
			border-radius: 1em;
			padding:0px 6px 2px 6px;
			font: ${I.font_size}px ${r};
		`.removeWhiteSpace())}function y(w){if(st.db.hasData)if(w.isHover){w.isOut?d=`${So} ${f}`:d=`${So} ${g.color}`;const D=!l.isGrabbed&&l.hasChildRelationships?"pointer":I.cursor_default;A.set_forHovering(g.color,D),t(3,A.isOut=w.isOut,A),k(),t(6,E+=1)}else w.isUp&&(l.grabOnly(),l.becomeFocus()&&Oe.signal_rebuildGraph_fromFocus())}return n.$$set=w=>{"left"in w&&t(8,a=w.left),"ancestry"in w&&t(9,l=w.ancestry),"center"in w&&t(0,u=w.center)},n.$$.update=()=>{n.$$.dirty&3846&&(t(11,g=l==null?void 0:l.thing),t(1,b=t(10,o=g==null?void 0:g.breadcrumb_title)!==null&&o!==void 0?o:I.empty),t(5,x=`crumb (for ${b??"unknown"})`),t(2,L=we.getWidthOf(b)+15),t(0,u=new G(a+L/2,p-1)),t(3,A=pt.element_state_for(l,h,te.none)),z()),n.$$.dirty&6144&&g&&g.id==(s==null?void 0:s.split(I.generic_separator)[0])&&z()},[u,b,L,A,v,x,E,y,a,l,o,g,s]}class rI extends Se{constructor(e){super(),Pe(this,e,nI,tI,ce,{left:8,ancestry:9,center:0})}}function vd(n,e,t){const r=n.slice();return r[14]=e[t],r[16]=t,r}function iI(n){let e,t,r;return t=new Ln({props:{name:"dash",width:n[4],height:n[4],position:"absolute",stroke:n[14].color,svgPath:ze.dash(n[4],0)}}),{c(){e=W("div"),Q(t.$$.fragment),T(e,"class","crumb-separator"),C(e,"color","transparent"),C(e,"position","absolute"),C(e,"top",n[4]/2+1+"px"),C(e,"left",n[1][n[16]]-n[4]+"px")},m(i,s){B(i,e,s),X(t,e,null),r=!0},p(i,s){const o={};s&1&&(o.stroke=i[14].color),t.$set(o),(!r||s&2)&&C(e,"left",i[1][i[16]]-i[4]+"px")},i(i){r||(P(t.$$.fragment,i),r=!0)},o(i){V(t.$$.fragment,i),r=!1},d(i){i&&F(e),Y(t)}}}function kd(n){var s;let e,t,r,i=n[16]>0&&iI(n);return t=new rI({props:{left:n[1][n[16]],ancestry:(s=n[2])==null?void 0:s.stripBack(n[0].length-n[16]-1)}}),{c(){i&&i.c(),e=J(),Q(t.$$.fragment)},m(o,a){i&&i.m(o,a),B(o,e,a),X(t,o,a),r=!0},p(o,a){var u;o[16]>0&&i.p(o,a);const l={};a&2&&(l.left=o[1][o[16]]),a&5&&(l.ancestry=(u=o[2])==null?void 0:u.stripBack(o[0].length-o[16]-1)),t.$set(l)},i(o){r||(P(i),P(t.$$.fragment,o),r=!0)},o(o){V(i),V(t.$$.fragment,o),r=!1},d(o){o&&F(e),i&&i.d(o),Y(t,o)}}}function Td(n){let e,t,r=fn(n[0]),i=[];for(let o=0;o<r.length;o+=1)i[o]=kd(vd(n,r,o));const s=o=>V(i[o],1,1,()=>{i[o]=null});return{c(){for(let o=0;o<i.length;o+=1)i[o].c();e=Te()},m(o,a){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(o,a);B(o,e,a),t=!0},p(o,a){if(a&23){r=fn(o[0]);let l;for(l=0;l<r.length;l+=1){const u=vd(o,r,l);i[l]?(i[l].p(u,a),P(i[l],1)):(i[l]=kd(u),i[l].c(),P(i[l],1),i[l].m(e.parentNode,e))}for(de(),l=r.length;l<i.length;l+=1)s(l);_e()}},i(o){if(!t){for(let a=0;a<r.length;a+=1)P(i[a]);t=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)V(i[a]);t=!1},d(o){o&&F(e),Jr(i,o)}}}function sI(n){let e=n[3],t,r,i=Td(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&8&&ce(e,e=s[3])?(de(),V(i,1,1,ue),_e(),i=Td(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function oI(n,e,t){let r,i,s,o,a;$(n,At,S=>t(9,r=S)),$(n,cn,S=>t(10,i=S)),$(n,lt,S=>t(11,s=S)),$(n,Fe,S=>t(12,o=S)),$(n,Pn,S=>t(13,a=S));var l,u;let h=[],f=I.default_buttonSize,d=[],p,g=0,b=0,A=0;return Oe.handle_rebuildGraph(0,S=>{t(7,g+=1)}),n.$$.update=()=>{if(n.$$.dirty&8320&&a&&t(7,g+=1),n.$$.dirty&8167){const S=o,v=(t(5,l=s==null?void 0:s.title)!==null&&l!==void 0?l:I.empty)+i+(t(6,u=r==null?void 0:r.length)!==null&&u!==void 0?u:0);if((!p||v||h.length==0)&&(t(2,p=S.ancestry_forBreadcrumbs),p)){let x=[];const E=Qe.windowSize.width;let L=0;t(0,[h,x,d,L]=p.layout_breadcrumbs_within(E),h,(t(1,d),t(12,o),t(11,s),t(5,l),t(10,i),t(9,r),t(6,u),t(2,p),t(0,h),t(7,g),t(8,A),t(13,a))),t(8,A=d[0]),t(3,b=L*1e4+g*100+A),ie.log_crumbs(x)}}},[h,d,p,b,f,l,u,g,A,r,i,s,o,a]}class aI extends Se{constructor(e){super(),Pe(this,e,oI,sI,ce,{})}}function Ed(n){let e,t;return e=new gi({props:{handle_mouse_state:n[5],center:n[2].offsetByY(-n[3]),hover_closure:n[4],strokeColor:I.color_default,angle:rn.up,size:cc,name:"up"}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p:ue,i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Ad(n){let e,t;return e=new gi({props:{handle_mouse_state:n[5],center:n[2].offsetByY(n[3]),hover_closure:n[4],angle:rn.down,strokeColor:I.color_default,size:cc,name:"down"}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p:ue,i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Id(n){let e,t=n[0](!0),r,i=n[0](!1),s,o=t&&Ed(n),a=i&&Ad(n);return{c(){e=W("div"),o&&o.c(),r=J(),a&&a.c(),T(e,"class","directionals svelte-1un2gi9")},m(l,u){B(l,e,u),o&&o.m(e,null),K(e,r),a&&a.m(e,null),s=!0},p(l,u){u&1&&(t=l[0](!0)),t?o?(o.p(l,u),u&1&&P(o,1)):(o=Ed(l),o.c(),P(o,1),o.m(e,r)):o&&(de(),V(o,1,1,()=>{o=null}),_e()),u&1&&(i=l[0](!1)),i?a?(a.p(l,u),u&1&&P(a,1)):(a=Ad(l),a.c(),P(a,1),a.m(e,null)):a&&(de(),V(a,1,1,()=>{a=null}),_e())},i(l){s||(P(o),P(a),s=!0)},o(l){V(o),V(a),s=!1},d(l){l&&F(e),o&&o.d(),a&&a.d()}}}function lI(n){let e=n[1],t,r,i=Id(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&2&&ce(e,e=s[1])?(de(),V(i,1,1,ue),_e(),i=Id(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}const cc=20;function uI(n,e,t){let{display:r}=e,{hit:i}=e;const s=new G(26,27),o=cc/2-1;let a=0;function l(h){return[h?I.color_default:I.color_background,I.empty]}function u(h){const f=h.element;if(!h.isHover&&f&&(h.isUp||h.isLong)){const d=f.id=="up";i(d,h.isLong),t(1,a+=1)}}return n.$$set=h=>{"display"in h&&t(0,r=h.display),"hit"in h&&t(6,i=h.hit)},[r,a,s,o,l,u,i]}class cI extends Se{constructor(e){super(),Pe(this,e,uI,lI,ce,{display:0,hit:6})}}function hI(n){let e,t,r,i;return e=new Ln({props:{name:"close",fill:n[3],width:n[1],height:n[1],stroke:I.color_default,svgPath:ze.circle_atOffset(n[1],n[1]-2)}}),r=new Ln({props:{name:"closeInside",width:n[1],height:n[1],stroke:n[2],svgPath:ze.x_cross(n[1],n[1]/6)}}),{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment)},m(s,o){X(e,s,o),B(s,t,o),X(r,s,o),i=!0},p(s,o){const a={};o&8&&(a.fill=s[3]),o&2&&(a.width=s[1]),o&2&&(a.height=s[1]),o&2&&(a.svgPath=ze.circle_atOffset(s[1],s[1]-2)),e.$set(a);const l={};o&2&&(l.width=s[1]),o&2&&(l.height=s[1]),o&4&&(l.stroke=s[2]),o&2&&(l.svgPath=ze.x_cross(s[1],s[1]/6)),r.$set(l)},i(s){i||(P(e.$$.fragment,s),P(r.$$.fragment,s),i=!0)},o(s){V(e.$$.fragment,s),V(r.$$.fragment,s),i=!1},d(s){s&&F(t),Y(e,s),Y(r,s)}}}function fI(n){let e,t;return e=new lr({props:{name:n[0],width:n[1],height:n[1],align_left:!1,origin:new G(8,n[1]/2),mouse_state_closure:n[4],$$slots:{default:[hI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,[i]){const s={};i&1&&(s.name=r[0]),i&2&&(s.width=r[1]),i&2&&(s.height=r[1]),i&2&&(s.origin=new G(8,r[1]/2)),i&78&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function dI(n,e,t){let r;$(n,xn,u=>t(5,r=u));let{name:i="generic close"}=e,{size:s=20}=e,o=I.color_default,a=I.color_background;function l(u){if(u.isHover){const h=!u.isOut;t(3,a=h?I.color_default:I.color_background),t(2,o=h?I.color_background:I.color_default)}else u.isUp&&It(xn,r=null,r)}return n.$$set=u=>{"name"in u&&t(0,i=u.name),"size"in u&&t(1,s=u.size)},[i,s,o,a,l]}class _I extends Se{constructor(e){super(),Pe(this,e,dI,fI,ce,{name:0,size:1})}}function Cd(n,e,t){const r=n.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Rd(n){let e,t;return e=new cI({props:{hit:n[4],display:n[2]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p:ue,i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Pd(n){let e,t,r=n[11]+"",i,s,o,a=n[12][0]+"",l,u,h,f,d=n[12][1]+"",p,g;return{c(){e=W("tr"),t=W("td"),i=at(r),s=J(),o=W("td"),l=at(a),u=J(),h=W("td"),f=at("  "),p=at(d),g=J()},m(b,A){B(b,e,A),K(e,t),K(t,i),K(e,s),K(e,o),K(o,l),K(e,u),K(e,h),K(h,f),K(h,p),K(e,g)},p(b,A){A&2&&r!==(r=b[11]+"")&&Dt(i,r),A&2&&a!==(a=b[12][0]+"")&&Dt(l,a),A&2&&d!==(d=b[12][1]+"")&&Dt(p,d)},d(b){b&&F(e)}}}function Sd(n){let e,t=fn(n[1]),r=[];for(let i=0;i<t.length;i+=1)r[i]=Pd(Cd(n,t,i));return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=Te()},m(i,s){for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(i,s);B(i,e,s)},p(i,s){if(s&2){t=fn(i[1]);let o;for(o=0;o<t.length;o+=1){const a=Cd(i,t,o);r[o]?r[o].p(a,s):(r[o]=Pd(a),r[o].c(),r[o].m(e.parentNode,e))}for(;o<r.length;o+=1)r[o].d(1);r.length=t.length}},d(i){i&&F(e),Jr(r,i)}}}function pI(n){let e,t,r,i,s=n[1],o,a,l,u,h,f,d,p,g,b,A,S,v=n[1],x,E,L,z=Rd(n);h=new _I({props:{name:"builds-close",size:I.dot_size*1.5}});let k=Sd(n);return{c(){e=J(),t=W("div"),r=W("div"),i=W("div"),z.c(),o=J(),a=W("div"),l=at(n[0]),u=J(),Q(h.$$.fragment),f=J(),d=W("br"),p=J(),g=W("table"),b=W("tbody"),A=W("tr"),A.innerHTML='<th class="svelte-12hcc2k">Build</th> <th class="svelte-12hcc2k">Date</th> <th class="svelte-12hcc2k">Note</th>',S=J(),k.c(),T(a,"class","title svelte-12hcc2k"),T(i,"class","top-bar svelte-12hcc2k"),C(g,"width","100%"),T(r,"class","notes-modal-content svelte-12hcc2k"),T(t,"class","notes-modal-overlay svelte-12hcc2k")},m(y,w){B(y,e,w),B(y,t,w),K(t,r),K(r,i),z.m(i,null),K(i,o),K(i,a),K(a,l),K(r,u),X(h,r,null),K(r,f),K(r,d),K(r,p),K(r,g),K(g,b),K(b,A),K(b,S),k.m(b,null),x=!0,E||(L=ke(document,"keydown",n[3]),E=!0)},p(y,[w]){w&2&&ce(s,s=y[1])?(de(),V(z,1,1,ue),_e(),z=Rd(y),z.c(),P(z,1),z.m(i,o)):z.p(y,w),(!x||w&1)&&Dt(l,y[0]),w&2&&ce(v,v=y[1])?(k.d(1),k=Sd(y),k.c(),k.m(b,null)):k.p(y,w)},i(y){x||(P(z),P(h.$$.fragment,y),x=!0)},o(y){V(z),V(h.$$.fragment,y),x=!1},d(y){y&&(F(e),F(t)),z.d(y),Y(h),k.d(y),E=!1,L()}}}function gI(n,e,t){let r;$(n,xn,g=>t(6,r=g));const i=Object.entries(N_.notes).reverse(),s=i.length-1;let o=I.empty,a=0,l=[];h();function u(g){return d(g)?"block":"none"}function h(){const g=Math.min(s,a+10);t(1,l=i.slice(a,g));const b=a<10?" (10 most recent)":I.empty;t(0,o=`Seriously Build Notes${b}`)}function f(g){switch(g.key.toLowerCase()){case"escape":It(xn,r=null,r);break}}function d(g){return g?a>=0:s-a>0}function p(g,b){if(b)a=g?0:s-10;else{let A=a+10*(g?-1:1);if(A<0||s-A<1)return;a=A}h()}return[o,l,u,f,p]}class mI extends Se{constructor(e){super(),Pe(this,e,gI,pI,ce,{})}}function Dd(n){let e,t,r;return{c(){e=W("div"),t=J(),r=W("div"),C(e,"z-index",n[4]),C(e,"position","absolute"),C(e,"background-color",n[5]),C(e,"width",n[7].width+"px"),C(e,"top",n[8].center.y+"px"),C(e,"left",n[8].origin.x+"px"),C(e,"height",n[0]/10+"px"),C(r,"z-index",n[4]),C(r,"position","absolute"),C(r,"background-color",n[5]),C(r,"top",n[8].origin.y+"px"),C(r,"left",n[8].center.x+"px"),C(r,"height",n[7].height+"px"),C(r,"width",n[0]/10+"px")},m(i,s){B(i,e,s),B(i,t,s),B(i,r,s)},p(i,s){s&16&&C(e,"z-index",i[4]),s&32&&C(e,"background-color",i[5]),s&128&&C(e,"width",i[7].width+"px"),s&256&&C(e,"top",i[8].center.y+"px"),s&256&&C(e,"left",i[8].origin.x+"px"),s&1&&C(e,"height",i[0]/10+"px"),s&16&&C(r,"z-index",i[4]),s&32&&C(r,"background-color",i[5]),s&256&&C(r,"top",i[8].origin.y+"px"),s&256&&C(r,"left",i[8].center.x+"px"),s&128&&C(r,"height",i[7].height+"px"),s&1&&C(r,"width",i[0]/10+"px")},d(i){i&&(F(e),F(t),F(r))}}}function yI(n){let e,t,r,i=n[2]&&Dd(n);return{c(){e=W("div"),t=J(),i&&i.c(),r=Te(),T(e,"class","box"),T(e,"id",n[3]),C(e,"z-index",n[4]),C(e,"position","absolute"),C(e,"top",n[1].origin.y+"px"),C(e,"left",n[1].origin.x+"px"),C(e,"width",n[6].width+"px"),C(e,"height",n[6].height+"px"),C(e,"border",n[0]+"px solid "+n[5])},m(s,o){B(s,e,o),B(s,t,o),i&&i.m(s,o),B(s,r,o)},p(s,[o]){o&8&&T(e,"id",s[3]),o&16&&C(e,"z-index",s[4]),o&2&&C(e,"top",s[1].origin.y+"px"),o&2&&C(e,"left",s[1].origin.x+"px"),o&64&&C(e,"width",s[6].width+"px"),o&64&&C(e,"height",s[6].height+"px"),o&33&&C(e,"border",s[0]+"px solid "+s[5]),s[2]?i?i.p(s,o):(i=Dd(s),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},i:ue,o:ue,d(s){s&&(F(e),F(t),F(r)),i&&i.d(s)}}}function bI(n,e,t){let{line_thickness:r=1}=e,{rect:i=De.zero}=e,{cross:s=!1}=e,{name:o="box"}=e,{zindex:a=0}=e,{color:l}=e,u=i.size,h=u.multipliedBy(3),f=De.createCenterRect(i.center,h);return n.$$set=d=>{"line_thickness"in d&&t(0,r=d.line_thickness),"rect"in d&&t(1,i=d.rect),"cross"in d&&t(2,s=d.cross),"name"in d&&t(3,o=d.name),"zindex"in d&&t(4,a=d.zindex),"color"in d&&t(5,l=d.color)},n.$$.update=()=>{n.$$.dirty&194&&(t(6,u=i.size),t(7,h=u.multipliedBy(3)),t(8,f=De.createCenterRect(i.center,h)))},[r,i,s,o,a,l,u,h,f]}class hc extends Se{constructor(e){super(),Pe(this,e,bI,yI,ce,{line_thickness:0,rect:1,cross:2,name:3,zindex:4,color:5})}}function wI(n){let e,t;return e=new hc({props:{cross:!0,name:"graph",color:"green",zindex:Ee.common,rect:n[2]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.rect=r[2]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Od(n){let e,t;return e=new hc({props:{name:"tools",color:"purple",zindex:Ee.frontmost,rect:n[3].titleRect}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&8&&(s.rect=r[3].titleRect),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function vI(n){let e,t;return e=new lr({props:{name:"debug-cursor",origin:G.zero,zindex:Ee.common,width:Qe.windowSize.width,height:Qe.windowSize.height,mouse_state_closure:n[4],$$slots:{default:[kI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&515&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function kI(n){let e,t,r,i;e=new hc({props:{color:"red",cross:!0,name:"cursor",rect:n[0],zindex:Ee.common}});let s=!1;return{c(){Q(e.$$.fragment),t=J(),r=Te()},m(o,a){X(e,o,a),B(o,t,a),B(o,r,a),i=!0},p(o,a){const l={};a&1&&(l.rect=o[0]),e.$set(l)},i(o){i||(P(e.$$.fragment,o),P(s),i=!0)},o(o){V(e.$$.fragment,o),V(s),i=!1},d(o){o&&(F(t),F(r)),Y(e,o)}}}function TI(n){let e,t,r,i,s=ie.graph&&wI(n),o=ie.tools&&!!n[3]&&Od(n),a=ie.cursor&&vI(n);return{c(){s&&s.c(),e=J(),o&&o.c(),t=J(),a&&a.c(),r=Te()},m(l,u){s&&s.m(l,u),B(l,e,u),o&&o.m(l,u),B(l,t,u),a&&a.m(l,u),B(l,r,u),i=!0},p(l,[u]){ie.graph&&s.p(l,u),ie.tools&&l[3]?o?(o.p(l,u),u&8&&P(o,1)):(o=Od(l),o.c(),P(o,1),o.m(t.parentNode,t)):o&&(de(),V(o,1,1,()=>{o=null}),_e()),ie.cursor&&a.p(l,u)},i(l){i||(P(s),P(o),P(a),i=!0)},o(l){V(s),V(o),V(a),i=!1},d(l){l&&(F(e),F(t),F(r)),s&&s.d(l),o&&o.d(l),a&&a.d(l)}}}function EI(n,e,t){let r,i,s,o;$(n,ya,d=>t(6,r=d)),$(n,Ll,d=>t(7,i=d)),$(n,cn,d=>t(2,s=d)),$(n,_t,d=>t(3,o=d));let{size:a=16}=e,l=De.zero,u=new G(-39,-28),h=i.offsetBy(u);function f(d){d.isMove&&we.mouse_distance_fromGraphCenter}return n.$$set=d=>{"size"in d&&t(5,a=d.size)},n.$$.update=()=>{if(n.$$.dirty&128&&t(1,h=i.offsetBy(u)),n.$$.dirty&96){const d=r;if(d){const p=Xe.square(a),g=d.offsetBy(p.asPoint.negatedInHalf);t(0,l=new De(g,p))}}},[l,h,s,o,f,a,r,i]}class AI extends Se{constructor(e){super(),Pe(this,e,EI,TI,ce,{size:5})}}function Nd(n){let e,t,r=n[6],i,s,o,a=!n[5]&&Vd(n),l=Bd(n),u=n[1][Le.builds]&&Ud(n),h=n[1][Le.help]&&jd(n);return{c(){e=W("div"),a&&a.c(),t=J(),l.c(),i=J(),u&&u.c(),s=J(),h&&h.c(),T(e,"id","controls"),C(e,"top","7px"),C(e,"left","0px"),C(e,"position","absolute"),C(e,"z-index",Ee.frontmost),C(e,"height","`$"+(I.height_banner-2)+"px`")},m(f,d){B(f,e,d),a&&a.m(e,null),K(e,t),l.m(e,null),K(e,i),u&&u.m(e,null),K(e,s),h&&h.m(e,null),o=!0},p(f,d){f[5]?a&&(de(),V(a,1,1,()=>{a=null}),_e()):a?(a.p(f,d),d&32&&P(a,1)):(a=Vd(f),a.c(),P(a,1),a.m(e,t)),d&64&&ce(r,r=f[6])?(de(),V(l,1,1,ue),_e(),l=Bd(f),l.c(),P(l,1),l.m(e,i)):l.p(f,d),f[1][Le.builds]?u?(u.p(f,d),d&2&&P(u,1)):(u=Ud(f),u.c(),P(u,1),u.m(e,s)):u&&(de(),V(u,1,1,()=>{u=null}),_e()),f[1][Le.help]?h?(h.p(f,d),d&2&&P(h,1)):(h=jd(f),h.c(),P(h,1),h.m(e,null)):h&&(de(),V(h,1,1,()=>{h=null}),_e())},i(f){o||(P(a),P(l),P(u),P(h),o=!0)},o(f){V(a),V(l),V(u),V(h),o=!1},d(f){f&&F(e),a&&a.d(),l.d(f),u&&u.d(),h&&h.d()}}}function Vd(n){let e,t,r=n[4],i,s;e=new Rn({props:{name:"hamburger",border_thickness:"0",color:"transparent",center:new G(n[12][0],n[9]+3),element_state:n[0][Le.details],closure:n[16],$$slots:{default:[II]},$$scope:{ctx:n}}});let o=xd(n);return{c(){Q(e.$$.fragment),t=J(),o.c(),i=Te()},m(a,l){X(e,a,l),B(a,t,l),o.m(a,l),B(a,i,l),s=!0},p(a,l){const u={};l&1&&(u.element_state=a[0][Le.details]),l&536870912&&(u.$$scope={dirty:l,ctx:a}),e.$set(u),l&16&&ce(r,r=a[4])?(de(),V(o,1,1,ue),_e(),o=xd(a),o.c(),P(o,1),o.m(i.parentNode,i)):o.p(a,l)},i(a){s||(P(e.$$.fragment,a),P(o),s=!0)},o(a){V(e.$$.fragment,a),V(o),s=!1},d(a){a&&(F(t),F(i)),Y(e,a),o.d(a)}}}function II(n){let e,t;return{c(){e=W("img"),Mm(e.src,t="settings.svg")||T(e,"src",t),T(e,"alt","circular button"),T(e,"width",n[8]+"px"),T(e,"height",n[8]+"px")},m(r,i){B(r,e,i)},p:ue,d(r){r&&F(e)}}}function CI(n){let e=n[3],t,r,i=Md(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o&8&&ce(e,e=s[3])?(de(),V(i,1,1,ue),_e(),i=Md(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function Md(n){let e,t;return e=new Ys({props:{name:"tree",origin:G.x(114),selected:[n[3]],titles:[yi.children,yi.parents,yi.related],selection_closure:n[18]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&8&&(s.selected=[r[3]]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function xd(n){let e,t,r,i;e=new Ys({props:{name:"graph",origin:G.x(30),selected:[n[4]],titles:[kr.tree,kr.radial],selection_closure:n[17]}});let s=!ae.showing_radial&&ln.tree_types&&CI(n);return{c(){Q(e.$$.fragment),t=J(),s&&s.c(),r=Te()},m(o,a){X(e,o,a),B(o,t,a),s&&s.m(o,a),B(o,r,a),i=!0},p(o,a){const l={};a&16&&(l.selected=[o[4]]),e.$set(l),!ae.showing_radial&&ln.tree_types&&s.p(o,a)},i(o){i||(P(e.$$.fragment,o),P(s),i=!0)},o(o){V(e.$$.fragment,o),V(s),i=!1},d(o){o&&(F(t),F(r)),Y(e,o),s&&s.d(o)}}}function Ld(n){let e,t,r,i=n[1][Le.smaller]&&zd(n),s=n[1][Le.bigger]&&Fd(n);return{c(){i&&i.c(),e=J(),s&&s.c(),t=Te()},m(o,a){i&&i.m(o,a),B(o,e,a),s&&s.m(o,a),B(o,t,a),r=!0},p(o,a){o[1][Le.smaller]?i?(i.p(o,a),a&2&&P(i,1)):(i=zd(o),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(de(),V(i,1,1,()=>{i=null}),_e()),o[1][Le.bigger]?s?(s.p(o,a),a&2&&P(s,1)):(s=Fd(o),s.c(),P(s,1),s.m(t.parentNode,t)):s&&(de(),V(s,1,1,()=>{s=null}),_e())},i(o){r||(P(i),P(s),r=!0)},o(o){V(i),V(s),r=!1},d(o){o&&(F(e),F(t)),i&&i.d(o),s&&s.d(o)}}}function zd(n){let e,t;return e=new Rn({props:{width:n[11],height:n[11],name:Le.smaller,center:new G(n[2]-110,n[10]),element_state:n[0][Le.smaller],closure:n[19],$$slots:{default:[RI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.center=new G(r[2]-110,r[10])),i&1&&(s.element_state=r[0][Le.smaller]),i&536870912&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function RI(n){let e,t;return{c(){e=Ke("svg"),t=Ke("path"),T(t,"stroke","k.color_default"),T(t,"fill","transparent"),T(t,"id","shrink-path"),T(t,"d",ze.dash(n[11],2)),T(e,"id","shrink-svg")},m(r,i){B(r,e,i),K(e,t)},p:ue,d(r){r&&F(e)}}}function Fd(n){let e,t;return e=new Rn({props:{width:n[11],height:n[11],name:Le.bigger,center:new G(n[2]-140,n[10]),element_state:n[0][Le.bigger],closure:n[20],$$slots:{default:[PI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.center=new G(r[2]-140,r[10])),i&1&&(s.element_state=r[0][Le.bigger]),i&536870912&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function PI(n){let e,t;return{c(){e=Ke("svg"),t=Ke("path"),T(t,"stroke","k.color_default"),T(t,"fill","transparent"),T(t,"id","enlarge-path"),T(t,"d",ze.t_cross(n[11],2)),T(e,"id","enlarge-svg")},m(r,i){B(r,e,i),K(e,t)},p:ue,d(r){r&&F(e)}}}function Bd(n){let e,t,r=n[6]&&Ld(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[6]?r?(r.p(i,s),s&64&&P(r,1)):(r=Ld(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function Ud(n){let e,t;return e=new Rn({props:{name:Le.builds,width:"75",height:n[11],center:new G(n[2]-55,n[10]),element_state:n[0][Le.builds],closure:n[21],$$slots:{default:[SI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.center=new G(r[2]-55,r[10])),i&1&&(s.element_state=r[0][Le.builds]),i&536871040&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function SI(n){let e,t="build "+I.build_number,r;return{c(){e=W("span"),r=at(t),C(e,"font-family",n[7])},m(i,s){B(i,e,s),K(e,r)},p(i,s){s&128&&C(e,"font-family",i[7])},d(i){i&&F(e)}}}function jd(n){let e,t;return e=new Rn({props:{name:Le.help,width:n[11],height:n[11],center:new G(n[2],n[10]),element_state:n[0][Le.help],closure:n[22],$$slots:{default:[DI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.center=new G(r[2],r[10])),i&1&&(s.element_state=r[0][Le.help]),i&536870912&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function DI(n){let e;return{c(){e=W("span"),e.textContent="?",C(e,"top","2px"),C(e,"left","5.5px"),C(e,"position","absolute")},m(t,r){B(t,e,r)},p:ue,d(t){t&&F(e)}}}function OI(n){let e=Object.values(n[0]).length>0,t,r,i=e&&Nd(n);return{c(){i&&i.c(),t=Te()},m(s,o){i&&i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&1&&(e=Object.values(s[0]).length>0),e?i?(i.p(s,o),o&1&&P(i,1)):(i=Nd(s),i.c(),P(i,1),i.m(t.parentNode,t)):i&&(de(),V(i,1,1,()=>{i=null}),_e())},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i&&i.d(s)}}}function NI(n,e,t){let r,i,s,o,a,l,u;$(n,Ei,H=>t(3,r=H)),$(n,vr,H=>t(4,i=H)),$(n,tr,H=>t(23,s=H)),$(n,Ko,H=>t(15,o=H)),$(n,xn,H=>t(5,a=H)),$(n,Ur,H=>t(6,l=H)),$(n,zn,H=>t(7,u=H));const h=I.default_buttonSize,f=I.dot_size/2,d=f+3.5,p=h+4,g=[10,55,117];let b={},A={},S=Qe.windowSize.width-20;const v=[Le.details,Le.smaller,Le.bigger,Le.help,Le.builds];Zt(()=>{E()});function x(H){It(xn,a=a==H?null:H,a)}function E(){let H=Qe.windowSize.width+50;for(const j of v){H-=we.getWidthOf(j);const Z=pt.element_state_for(new Mt(j),dn.control,j);Z.set_forHovering(I.color_default,"pointer"),Z.hoverIgnore=j==Le.details,t(0,b[j]=Z,b),t(1,A[j]=H>0,A)}}function L(H,j){if(H.isHover)t(0,b[j].isOut=H.isOut,b);else if(H.isUp)switch(j){case Le.open:ae.showHelp();break;case Le.help:ae.showHelp();break;case Le.details:It(tr,s=!s,s);break;case Le.bigger:t(2,S=Qe.zoomBy(I.zoom_in_ratio)-20);break;case Le.smaller:t(2,S=Qe.zoomBy(I.zoom_out_ratio)-20);break;default:x(j);break}}function z(H,j){const Z=j[0];switch(H){case"graph":It(vr,i=Z,i);break;case"relations":It(Ei,r=Z,r);break}}const k=H=>L(H,Le.details),y=H=>z("graph",H),w=H=>z("relations",H),D=H=>L(H,Le.smaller),N=H=>L(H,Le.bigger),M=H=>L(H,Le.builds),O=H=>L(H,Le.help);return n.$$.update=()=>{n.$$.dirty&32768&&t(2,S=Qe.windowSize.width-20)},[b,A,S,r,i,a,l,u,h,f,d,p,g,L,z,o,k,y,w,D,N,M,O]}class VI extends Se{constructor(e){super(),Pe(this,e,NI,OI,ce,{})}}function MI(n){let e,t,r;return{c(){e=W("input"),C(e,"display","none"),T(e,"type","file"),e.multiple=n[1],T(e,"accept",n[0])},m(i,s){B(i,e,s),n[5](e),t||(r=[ke(e,"change",n[4]),ke(e,"cancel",n[3])],t=!0)},p(i,[s]){s&2&&(e.multiple=i[1]),s&1&&T(e,"accept",i[0])},i:ue,o:ue,d(i){i&&F(e),n[5](null),t=!1,sn(r)}}}function xI(n,e,t){let{accept:r=I.empty}=e,{multiple:i=I.empty}=e;const s=Fs();let o;Zt(()=>{l()});function a(){s("cancel")}function l(){o&&o.click()}function u(f){const d=f.target,p=d==null?void 0:d.files;p&&p.length>0?s("files_selected",p):a(),d.value=I.empty}function h(f){ut[f?"unshift":"push"](()=>{o=f,t(2,o)})}return n.$$set=f=>{"accept"in f&&t(0,r=f.accept),"multiple"in f&&t(1,i=f.multiple)},[r,i,o,a,u,h]}class LI extends Se{constructor(e){super(),Pe(this,e,xI,MI,ce,{accept:0,multiple:1})}}function zI(n){let e,t;return e=new LI({props:{accept:".json"}}),e.$on("cancel",n[0]),e.$on("files_selected",n[1]),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p:ue,i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function FI(n,e,t){let r;$(n,xn,o=>t(2,r=o));function i(){console.log("File selection was canceled."),It(xn,r=null,r)}function s(o){se(Fe).fetch_fromFile(o.detail[0]),It(xn,r=null,r)}return[i,s]}class BI extends Se{constructor(e){super(),Pe(this,e,FI,zI,ce,{})}}function qd(n){let e,t,r,i,s,o,a,l;return{c(){e=W("span"),t=at(n[1]),i=J(),s=W("input"),T(e,"class","ghost"),T(e,"style",r="left:-9999px; padding: "+n[11]+"; position: absolute; visibility: hidden; font-size: "+n[0]+"; font-family: "+n[9]+"; white-space: pre; /* Preserve whitespace to accurately measure the width */"),T(s,"type","text"),T(s,"name","title"),T(s,"class","title svelte-jjjszo"),T(s,"style",o="border: none; "+n[5]+"; outline: none; color: "+n[3]+"; white-space: pre; top: "+n[10]+"px; position: absolute; padding: "+n[11]+"; position: absolute; left: "+n[7]+"px; width: "+n[6]+"px; font-size: "+n[0]+"; z-index: "+Ee.text+"; "+I.prevent_selection_style+"; font-family: "+n[9]+"; outline-color: "+I.color_background+";")},m(u,h){B(u,e,h),K(e,t),n[34](e),B(u,i,h),B(u,s,h),n[35](s),jo(s,n[1]),a||(l=[ke(s,"blur",n[14]),ke(s,"input",n[16]),ke(s,"input",n[36]),ke(s,"cut",n[13]),ke(s,"paste",n[13]),ke(s,"mouseup",n[12]),ke(s,"keydown",n[17]),ke(s,"click",n[18]),ke(s,"mousedown",n[19]),ke(s,"dblclick",n[15])],a=!0)},p(u,h){h[0]&2&&Dt(t,u[1]),h[0]&513&&r!==(r="left:-9999px; padding: "+u[11]+"; position: absolute; visibility: hidden; font-size: "+u[0]+"; font-family: "+u[9]+"; white-space: pre; /* Preserve whitespace to accurately measure the width */")&&T(e,"style",r),h[0]&745&&o!==(o="border: none; "+u[5]+"; outline: none; color: "+u[3]+"; white-space: pre; top: "+u[10]+"px; position: absolute; padding: "+u[11]+"; position: absolute; left: "+u[7]+"px; width: "+u[6]+"px; font-size: "+u[0]+"; z-index: "+Ee.text+"; "+I.prevent_selection_style+"; font-family: "+u[9]+"; outline-color: "+I.color_background+";")&&T(s,"style",o),h[0]&2&&s.value!==u[1]&&jo(s,u[1])},d(u){u&&(F(e),F(i),F(s)),n[34](null),n[35](null),a=!1,sn(l)}}}function UI(n){let e=n[4],t,r=qd(n);return{c(){r.c(),t=Te()},m(i,s){r.m(i,s),B(i,t,s)},p(i,s){s[0]&16&&ce(e,e=i[4])?(r.d(1),r=qd(i),r.c(),r.m(t.parentNode,t)):r.p(i,s)},i:ue,o:ue,d(i){i&&F(t),r.d(i)}}}const jI=6.5;function qI(n){return!1}function HI(n){var e=n instanceof KeyboardEvent&&!n.altKey&&!n.shiftKey&&!n.code.startsWith("Cluster_Label");return e&&n.metaKey&&(e=!1),e}function GI(n,e,t){let r,i,s,o,a,l;$(n,mn,me=>t(31,r=me)),$(n,_t,me=>t(43,i=me)),$(n,Fe,me=>t(44,s=me)),$(n,At,me=>t(32,o=me)),$(n,Pn,me=>t(33,a=me)),$(n,zn,me=>t(9,l=me));var u,h,f,d,p,g,b;let{fontSize:A="1em"}=e,{forward:S=!0}=e,{ancestry:v}=e;const x=ae.showing_radial?.5:0;let E=(h=(u=le())===null||u===void 0?void 0:u.title)!==null&&h!==void 0?h:I.empty,L=`0.5px 0px 0px ${jI}px`,z=(d=(f=le())===null||f===void 0?void 0:f.color)!==null&&d!==void 0?d:I.empty,k,y=I.empty,w=I.empty,D,N=!1,M=0,O=0,H=null,j=null;function Z(){ye()}var ge=()=>y!=E;function le(){var me;return(me=v==null?void 0:v.thing)!==null&&me!==void 0?me:null}const ee=Symbol("_____REACTIVES_____"),fe=Symbol("_____PRIMITIVES_____");function Ve(){const me=r;return!!v&&!!me&&me.editing&&v.ancestry_hasEqualID(me.editing)}function ye(){clearTimeout(D)}function Ae(){j&&H&&(t(6,M=H.scrollWidth-5),t(2,j.style.width=`${M}px`,j))}function Be(){var me;const Rt=(me=le())===null||me===void 0?void 0:me.selectionRange;Rt&&j&&j.setSelectionRange(Rt.start,Rt.end)}function be(){if(j&&v){const me=j.selectionEnd,Rt=j.selectionStart;t(20,v.selectionRange=new au(Rt,me),v)}}const et=Symbol("_____HANDLERS_____");Zt(()=>{le()&&(t(6,M=le().titleWidth+6),t(7,O=ae.showing_radial?v.isFocus?-2:S?14:4:10));const me=Oe.handle_anySignal((Rt,Pr)=>{Ae()});return setTimeout(()=>{Ae()},100),()=>{me.disconnect()}});function rt(me){be(),v==null||v.signal_relayoutWidgets()}function vt(me){kt(),ie.log_edit(`BLUR ${E}`),Ae()}function Ht(me){ie.log_action(` double click '${le().title}' TITLE`),me.preventDefault(),oe(),ye()}function kn(me){const Rt=me.target.value;le()&&(Rt||Rt==I.empty)&&(le().title=t(1,E=Rt),Ml.set(null))}function $t(me){if(le()&&v&&v.isEditing&&HI(me))switch(ie.log_key(`TITLE  ${me.key}`),me.key){case"Tab":me.preventDefault(),kt(),s.ancestry_edit_persistentCreateChildOf(v.parentAncestry);break;case"Enter":me.preventDefault(),kt();break;default:Ml.set(le().id);break}}function Sn(me){v&&!v.isEditing&&(me.preventDefault(),v.isGrabbed?oe():(me.shiftKey?v.grab():v.grabOnly(),It(mn,r=null,r),Oe.signal_relayoutWidgets_fromFocus()))}function Dn(me){v&&!v.isEditing&&(me.preventDefault(),ye(),D=setTimeout(()=>{ye(),v.isEditable&&(i==v?It(_t,i=null,i):(v.grabOnly(),It(_t,i=v,i)),Oe.signal_rebuildGraph_fromFocus())},I.threshold_longClick))}const On=Symbol("_____EDIT_____");function oe(){v.isEditable&&(v==null||v.startEdit(),j==null||j.focus())}function kt(){pe(),v&&v.isEditing&&setTimeout(()=>{const me=r;me&&(me.stop(),Oe.signal_relayoutWidgets_fromFocus())},2)}function pe(){var me;v&&v.isEditing&&le()&&(t(30,N=!1),be(),j==null||j.blur(),ge()&&(st.db.thing_persistentUpdate(le()),t(4,y=(me=le())===null||me===void 0?void 0:me.title),v.signal_relayoutWidgets()))}function We(me){ut[me?"unshift":"push"](()=>{H=me,t(8,H)})}function ft(me){ut[me?"unshift":"push"](()=>{j=me,t(2,j)})}function He(){E=this.value,t(1,E)}return n.$$set=me=>{"fontSize"in me&&t(0,A=me.fontSize),"forward"in me&&t(21,S=me.forward),"ancestry"in me&&t(20,v=me.ancestry)},n.$$.update=()=>{n.$$.dirty[0]&1477443590|n.$$.dirty[1]&3&&v&&((t(27,g=o??[])===null||g===void 0?void 0:g.length)>0,v.isEditable&&(v&&(t(28,b=v.isStoppingEdit)!==null&&b!==void 0&&b)?(ie.log_edit(`STOPPING ${E}`),It(mn,r=null,r),j==null||j.blur()):N!=Ve()&&(N?(ie.log_edit(`STOP ${E}`),j==null||j.blur()):(j==null||j.focus(),ie.log_edit(`RANGE ${E}`),Be()),t(30,N=!N))),t(5,w=v.isEditing||v.isGrabbed?"cursor: text":ae.showing_radial?"cursor: pointer":v.isEditable?I.empty:"cursor: text")),n.$$.dirty[1]&1&&Ae(),n.$$.dirty[0]&537919492&&j&&!k&&t(29,k=new ar(j,qI,v.idHashed,ht.title)),n.$$.dirty[0]&67108864|n.$$.dirty[1]&4&&le()&&le().id==(a==null?void 0:a.split(I.generic_separator)[0])&&t(3,z=t(26,p=le())===null||p===void 0?void 0:p.color)},[A,E,j,z,y,w,M,O,H,l,x,L,Z,rt,vt,Ht,kn,$t,Sn,Dn,v,S,ee,fe,et,On,p,g,b,k,N,r,o,a,We,ft,He]}class rm extends Se{constructor(e){super(),Pe(this,e,GI,UI,ce,{fontSize:0,forward:21,ancestry:20,_____REACTIVES_____:22,_____PRIMITIVES_____:23,_____HANDLERS_____:24,_____EDIT_____:25},null,[-1,-1])}get _____REACTIVES_____(){return this.$$.ctx[22]}get _____PRIMITIVES_____(){return this.$$.ctx[23]}get _____HANDLERS_____(){return this.$$.ctx[24]}get _____EDIT_____(){return this.$$.ctx[25]}}function Hd(n){let e,t,r;return{c(){e=Ke("svg"),t=Ke("path"),T(t,"fill","white"),T(t,"stroke",n[4]),T(t,"class","radial-focus-path"),T(t,"d",r=ze.oblong(n[2],new Xe(n[0]-6,I.row_height))),T(e,"class","radial-focus-svg"),C(e,"top","-2.7px"),C(e,"left","-13px"),C(e,"height",n[5]+"px"),C(e,"position","absolute"),C(e,"width",n[0]+40+"px")},m(i,s){B(i,e,s),K(e,t)},p(i,s){s&16&&T(t,"stroke",i[4]),s&5&&r!==(r=ze.oblong(i[2],new Xe(i[0]-6,I.row_height)))&&T(t,"d",r),s&1&&C(e,"width",i[0]+40+"px")},d(i){i&&F(e)}}}function KI(n){let e=n[4],t,r=Hd(n);return{c(){r.c(),t=Te()},m(i,s){r.m(i,s),B(i,t,s)},p(i,s){s&16&&ce(e,e=i[4])?(r.d(1),r=Hd(i),r.c(),r.m(t.parentNode,t)):r.p(i,s)},d(i){i&&F(t),r.d(i)}}}function WI(n){let e,t,r,i,s,o;return t=new lr({props:{height:n[5],width:n[0],name:"radial-focus-border",zindex:Ee.backmost,cursor:I.cursor_default,isHit_closure:XI,mouse_state_closure:n[6],center:n[2].offsetByX(-13),$$slots:{default:[KI]},$$scope:{ctx:n}}}),s=new rm({props:{ancestry:n[1],fontSize:I.font_size+"px"}}),{c(){e=W("div"),Q(t.$$.fragment),r=J(),i=W("div"),Q(s.$$.fragment),T(i,"class","radial-focus-title"),C(i,"top","3px"),C(i,"position","absolute"),T(e,"class","radial-focus"),C(e,"height",n[5]+"px"),C(e,"position","absolute"),C(e,"width",n[0]+"px"),C(e,"top",n[3].y+"px"),C(e,"z-index",Ee.backmost),C(e,"left",n[3].x+"px")},m(a,l){B(a,e,l),X(t,e,null),K(e,r),K(e,i),X(s,i,null),o=!0},p(a,[l]){const u={};l&1&&(u.width=a[0]),l&4&&(u.center=a[2].offsetByX(-13)),l&4117&&(u.$$scope={dirty:l,ctx:a}),t.$set(u);const h={};l&2&&(h.ancestry=a[1]),s.$set(h),(!o||l&1)&&C(e,"width",a[0]+"px"),(!o||l&8)&&C(e,"top",a[3].y+"px"),(!o||l&8)&&C(e,"left",a[3].x+"px")},i(a){o||(P(t.$$.fragment,a),P(s.$$.fragment,a),o=!0)},o(a){V(t.$$.fragment,a),V(s.$$.fragment,a),o=!1},d(a){a&&F(e),Y(t),Y(s)}}}const XI=()=>!1;function YI(n,e,t){let r,i;$(n,lt,g=>t(1,r=g)),$(n,Pn,g=>t(10,i=g));var s,o,a;pt.element_state_for(r,dn.focus,te.none);const l=I.row_height+10;let u=G.zero,h=G.zero,f=I.thing_color_default,d=0;function p(g){ie.log_radial(` ${g.descriptionFor("FOCUS")}`)}return n.$$.update=()=>{if(n.$$.dirty&387){t(0,d=10+(t(8,o=t(7,s=r==null?void 0:r.thing)===null||s===void 0?void 0:s.titleWidth)!==null&&o!==void 0?o:0));const g=-d/2;t(3,h=Qe.center_ofGraphSize.offsetByXY(g,1-I.dot_size)),t(2,u=new G(d+25,l).dividedInHalf)}n.$$.dirty&1538&&t(4,f=t(9,a=r==null?void 0:r.thing)===null||a===void 0?void 0:a.color)},[d,r,u,h,f,l,p,s,o,a,i]}class QI extends Se{constructor(e){super(),Pe(this,e,YI,WI,ce,{})}}function Gd(n){let e,t;return e=new lr({props:{width:n[9],height:n[9],center:n[0],detect_longClick:!0,name:n[2].name,mouse_state_closure:n[10],$$slots:{default:[ZI]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.center=r[0]),i&4&&(s.name=r[2].name),i&67109374&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function JI(n){let e,t,r,i=n[6]&&Kd(n),s=n[5]&&Wd(n);return{c(){i&&i.c(),e=J(),s&&s.c(),t=Te()},m(o,a){i&&i.m(o,a),B(o,e,a),s&&s.m(o,a),B(o,t,a),r=!0},p(o,a){o[6]?i?(i.p(o,a),a&64&&P(i,1)):(i=Kd(o),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(de(),V(i,1,1,()=>{i=null}),_e()),o[5]?s?(s.p(o,a),a&32&&P(s,1)):(s=Wd(o),s.c(),P(s,1),s.m(t.parentNode,t)):s&&(de(),V(s,1,1,()=>{s=null}),_e())},i(o){r||(P(i),P(s),r=!0)},o(o){V(i),V(s),r=!1},d(o){o&&(F(e),F(t)),i&&i.d(o),s&&s.d(o)}}}function Kd(n){let e,t;return e=new Ln({props:{name:"drag-inside-"+n[1]+"-svg",width:n[9],height:n[9],svgPath:n[6],fill:n[2].stroke,stroke:n[2].stroke}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&2&&(s.name="drag-inside-"+r[1]+"-svg"),i&64&&(s.svgPath=r[6]),i&4&&(s.fill=r[2].stroke),i&4&&(s.stroke=r[2].stroke),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Wd(n){var r;let e,t;return e=new Ln({props:{name:"drag-related-"+n[1]+"-svg",width:n[9],height:n[9],svgPath:n[5],fill:I.color_background,stroke:(r=n[3])==null?void 0:r.color}}),{c(){Q(e.$$.fragment)},m(i,s){X(e,i,s),t=!0},p(i,s){var a;const o={};s&2&&(o.name="drag-related-"+i[1]+"-svg"),s&32&&(o.svgPath=i[5]),s&8&&(o.stroke=(a=i[3])==null?void 0:a.color),e.$set(o)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){V(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Xd(n){var a;let e,t,r,i,s;t=new Ln({props:{name:"drag-"+n[1]+"-svg",width:n[9],height:n[9],svgPath:n[7],fill:n[2].fill,stroke:(a=n[3])==null?void 0:a.color}});let o=ln.tiny_dots&&JI(n);return{c(){e=W("div"),Q(t.$$.fragment),r=J(),o&&o.c(),T(e,"id",i="drag-inner-div-for-"+n[1]),C(e,"top","0px"),C(e,"left","0px"),C(e,"width",n[9]+"px"),C(e,"height",n[9]+"px"),C(e,"color","transparent"),C(e,"position","absolute"),C(e,"z-index",Ee.dots)},m(l,u){B(l,e,u),X(t,e,null),K(e,r),o&&o.m(e,null),s=!0},p(l,u){var f;const h={};u&2&&(h.name="drag-"+l[1]+"-svg"),u&128&&(h.svgPath=l[7]),u&4&&(h.fill=l[2].fill),u&8&&(h.stroke=(f=l[3])==null?void 0:f.color),t.$set(h),ln.tiny_dots&&o.p(l,u),(!s||u&2&&i!==(i="drag-inner-div-for-"+l[1]))&&T(e,"id",i)},i(l){s||(P(t.$$.fragment,l),P(o),s=!0)},o(l){V(t.$$.fragment,l),V(o),s=!1},d(l){l&&F(e),Y(t),o&&o.d()}}}function ZI(n){let e,t=n[8],r,i,s=Xd(n);return{c(){e=W("button"),s.c(),T(e,"class","drag"),T(e,"id",r="drag-for-"+n[1]),C(e,"border","none"),C(e,"cursor","pointer"),C(e,"width",n[9]+"px"),C(e,"height",n[9]+"px"),C(e,"color","transparent"),C(e,"position","absolute"),C(e,"z-index",Ee.dots),C(e,"background-color","transparent")},m(o,a){B(o,e,a),s.m(e,null),n[17](e),i=!0},p(o,a){a&256&&ce(t,t=o[8])?(de(),V(s,1,1,ue),_e(),s=Xd(o),s.c(),P(s,1),s.m(e,null)):s.p(o,a),(!i||a&2&&r!==(r="drag-for-"+o[1]))&&T(e,"id",r)},i(o){i||(P(s),i=!0)},o(o){V(s),i=!1},d(o){o&&F(e),s.d(o),n[17](null)}}}function $I(n){let e,t,r=n[2]&&Gd(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,[s]){i[2]?r?(r.p(i,s),s&4&&P(r,1)):(r=Gd(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function eC(n){return!1}function tC(n,e,t){let r,i,s;$(n,At,w=>t(15,r=w)),$(n,Pn,w=>t(16,i=w)),$(n,_t,w=>t(19,s=w));var o;let{center:a=G.zero}=e,{name:l=I.empty}=e,{ancestry:u}=e;I.dot_size;const h=pt.element_state_forName(l);let f=I.empty,d=I.empty,p=I.empty,g=u.thing,b=!1,A=!0,S=I.dot_size,v=0,x;E(),z(!0),Zt(()=>{const w=Oe.handle_altering(D=>{const N=D&&s&&!!u&&u.canConnect_toToolsAncestry;t(2,h.isInverted=N,h),L()});return()=>{w.disconnect()}});function E(){ae.showing_radial?t(7,p=ze.circle_atOffset(S,S-1)):t(7,p=ze.oval(S,!1)),L()}function L(){if(t(5,f=t(6,d=null)),g){const w=g.parents.length;w>1&&t(6,d=ze.ellipses(6,.5,!1,w,S/2)),g.hasRelated&&t(5,f=ze.circle_atOffset(S,3,new G(-4.5,0)))}}function z(w){if(!ae.isAny_rotation_active){t(14,A=!w);const N=(!u.isGrabbed||ae.showing_radial)&&u.hasChildRelationships&&!ae.isAny_rotation_active?"pointer":"normal";h&&g&&(h.set_forHovering(g.color,N),t(2,h.isOut=w,h)),t(8,v+=1)}}function k(w){var D,N;if(!ae.isAny_rotation_active){if(w.isHover)z(w.isOut);else if(w.isLong)u==null||u.becomeFocus();else if(w.isUp){const M=(N=(D=w.event)===null||D===void 0?void 0:D.shiftKey)!==null&&N!==void 0?N:!1;u==null||u.handle_singleClick_onDragDot(M)}}}function y(w){ut[w?"unshift":"push"](()=>{x=w,t(4,x)})}return n.$$set=w=>{"center"in w&&t(0,a=w.center),"name"in w&&t(1,l=w.name),"ancestry"in w&&t(11,u=w.ancestry)},n.$$.update=()=>{if(n.$$.dirty&2048&&u&&t(3,g=u.thing),n.$$.dirty&6164&&x&&(new ar(x,eC,u.idHashed,ht.drag),h.set_forHovering(t(12,o=u.thing)===null||o===void 0?void 0:o.color,"pointer")),n.$$.dirty&65544&&g&&g.id==(i==null?void 0:i.split(I.generic_separator)[0])&&z(!0),n.$$.dirty&59392){const w=u.isGrabbed;b!=w&&(t(13,b=w),z(!A))}},[a,l,h,g,x,f,d,p,v,S,k,u,o,b,A,r,i,y]}class nC extends Se{constructor(e){super(),Pe(this,e,tC,$I,ce,{center:0,name:1,ancestry:11})}}function Yd(n){var u;let e,t,r,i,s,o,a;t=new nC({props:{ancestry:n[1],center:n[5],name:n[16].name}}),i=new rm({props:{forward:n[0],ancestry:n[1],fontSize:I.font_size+"px"}});let l=((u=n[1])==null?void 0:u.showsReveal)&&Qd(n);return{c(){e=W("div"),Q(t.$$.fragment),r=J(),Q(i.$$.fragment),s=J(),l&&l.c(),T(e,"class","widget"),T(e,"id",n[8]),T(e,"style",o=""+n[7]+"; top: "+n[14]+"px; left: "+n[13]+"px; width: "+n[12]+"px; height: "+n[11]+"px; padding: "+n[9]+"; position: absolute; z-index: "+Ee.widgets+"; border-radius: "+n[6]+"px; border: "+n[3].border+";")},m(h,f){B(h,e,f),X(t,e,null),K(e,r),X(i,e,null),K(e,s),l&&l.m(e,null),n[26](e),a=!0},p(h,f){var g;const d={};f[0]&2&&(d.ancestry=h[1]),f[0]&32&&(d.center=h[5]),t.$set(d);const p={};f[0]&1&&(p.forward=h[0]),f[0]&2&&(p.ancestry=h[1]),i.$set(p),(g=h[1])!=null&&g.showsReveal?l?(l.p(h,f),f[0]&2&&P(l,1)):(l=Qd(h),l.c(),P(l,1),l.m(e,null)):l&&(de(),V(l,1,1,()=>{l=null}),_e()),(!a||f[0]&256)&&T(e,"id",h[8]),(!a||f[0]&31432&&o!==(o=""+h[7]+"; top: "+h[14]+"px; left: "+h[13]+"px; width: "+h[12]+"px; height: "+h[11]+"px; padding: "+h[9]+"; position: absolute; z-index: "+Ee.widgets+"; border-radius: "+h[6]+"px; border: "+h[3].border+";"))&&T(e,"style",o)},i(h){a||(P(t.$$.fragment,h),P(i.$$.fragment,h),P(l),a=!0)},o(h){V(t.$$.fragment,h),V(i.$$.fragment,h),V(l),a=!1},d(h){h&&F(e),Y(t),Y(i),l&&l.d(),n[26](null)}}}function Qd(n){let e,t;return e=new Jg({props:{ancestry:n[1],center:n[4],name:n[15].name}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i[0]&2&&(s.ancestry=r[1]),i[0]&16&&(s.center=r[4]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function Jd(n){let e,t,r=n[3]&&Yd(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[3]?r?(r.p(i,s),s[0]&8&&P(r,1)):(r=Yd(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function rC(n){let e=n[10],t,r,i=Jd(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o[0]&1024&&ce(e,e=s[10])?(de(),V(i,1,1,ue),_e(),i=Jd(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function iC(n){return!1}function sC(n,e,t){let r,i,s,o;$(n,Pn,be=>t(22,r=be)),$(n,_t,be=>t(23,i=be)),$(n,At,be=>t(24,s=be)),$(n,mn,be=>t(25,o=be));let{origin:a=new G(160,5)}=e,{subtype:l=I.empty}=e,{name:u=I.empty}=e,{forward:h=!0}=e,{ancestry:f}=e;const d=!!f&&!f.isExpanded&&f.childRelationships.length>3,p=ae.showing_radial?0:d?22.5:20,g=pt.element_state_for(f,dn.reveal,l),b=pt.element_state_for(f,dn.drag,l),A=h?1:14;I.row_height;let S,v=G.zero,x=G.zero,E=I.dot_size/2,L=!1,z=a,k=I.empty,y=I.empty;I.empty,I.empty,I.empty,I.empty;let w=!1,D=!1,N=I.empty;I.empty;let M=0,O=0,H=0,j=0,Z=0,ge,le;Ve(),Zt(()=>{Ae(),t(3,S=pt.element_state_forName(u)),ie.log_mount(`WIDGET ${le==null?void 0:le.description} ${w}`),ye();const be=Oe.handle_anySignal((et,rt)=>{for(const vt of et)switch(vt){case et.relayout:rt==(le==null?void 0:le.id)&&(ie.log_layout(`WIDGET signal ${le==null?void 0:le.description}`),Ae());break;default:ye();break}});return()=>{be.disconnect()}});function ee(){ge&&t(2,ge.style.border=S.border,ge)}function fe(){const be=f!=null&&f.showsReveal?2:1.35,et=ae.showing_radial?h?16:0:-10;return I.dot_size*be+et}function Ve(){var be,et,rt;if(w=f==null?void 0:f.isGrabbed,t(21,le=f==null?void 0:f.thing),!f)console.log("bad ancestry");else if(!le)console.log(`bad thing for "${(be=f==null?void 0:f.id)!==null&&be!==void 0?be:"indeed"}"`);else{const vt=(rt=(et=le.title)!==null&&et!==void 0?et:le.id)!==null&&rt!==void 0?rt:I.unknown;t(8,y=`widget ${vt}`)}}function ye(){if(t(21,le=f==null?void 0:f.thing),le){const be=f.isEditing,et=f.isGrabbed,rt=f.toolsGrabbed&&!f.isFocus;if(D!=be||w!=et||L!=rt){const Ht=et||ae.showing_radial;t(7,k=Ht?`background-color: ${I.color_background};`:I.empty),L=rt,w=et,D=be,Ae()}}}function Ae(){var be,et;const vt=D||w,Ht=vt?0:.5,kn=Ht-5.5,$t=(be=le==null?void 0:le.titleWidth)!==null&&be!==void 0?be:0,Sn=ae.showing_radial?2.8:2.7,Dn=h?5.5-2:$t+Ht+15,On=-($t+19+((et=f==null?void 0:f.isGrabbed)!==null&&et!==void 0&&et,0));if(t(5,x=G.square(I.dot_size/2).offsetByXY(Dn,Sn)),t(13,j=a.x+Ht+(h?kn:On)),t(9,N=`0px ${p}px 0px  ${A}px`),t(12,H=$t+fe()),t(11,O=I.row_height-1.5),t(6,E=I.row_height/2),t(14,Z=a.y+(vt&&!f.isRoot?0:1)),f!=null&&f.showsReveal){const oe=I.dot_size-3.5,kt=h?I.dot_size+$t+15:0;t(4,v=new G(kt,oe))}}function Be(be){ut[be?"unshift":"push"](()=>{ge=be,t(2,ge)})}return n.$$set=be=>{"origin"in be&&t(17,a=be.origin),"subtype"in be&&t(18,l=be.subtype),"name"in be&&t(19,u=be.name),"forward"in be&&t(0,h=be.forward),"ancestry"in be&&t(1,f=be.ancestry)},n.$$.update=()=>{n.$$.dirty[0]&58720256&&ee(),n.$$.dirty[0]&6292480&&le&&le.id==(r==null?void 0:r.split(I.generic_separator)[0])&&t(10,M+=1),n.$$.dirty[0]&6&&ge&&new ar(ge,iC,f.idHashed,ht.widget),n.$$.dirty[0]&1179648&&z!=a&&(t(20,z=a),setTimeout(()=>{Ae()},1))},[h,f,ge,S,v,x,E,k,y,N,M,O,H,j,Z,g,b,a,l,u,z,le,r,i,s,o,Be]}class Wa extends Se{constructor(e){super(),Pe(this,e,sC,rC,ce,{origin:17,subtype:18,name:19,forward:0,ancestry:1},null,[-1,-1])}}function Zd(n,e,t){const r=n.slice();return r[16]=e[t],r}function $d(n){let e,t,r,i=fn(n[0].widget_maps),s=[];for(let l=0;l<i.length;l+=1)s[l]=e_(Zd(n,i,l));const o=l=>V(s[l],1,1,()=>{s[l]=null});let a=n[1]&&t_(n);return{c(){e=W("div");for(let l=0;l<s.length;l+=1)s[l].c();t=J(),a&&a.c(),T(e,"class","necklace-widgets"),C(e,"z-index",Ee.backmost)},m(l,u){B(l,e,u);for(let h=0;h<s.length;h+=1)s[h]&&s[h].m(e,null);K(e,t),a&&a.m(e,null),r=!0},p(l,u){if(u&9){i=fn(l[0].widget_maps);let h;for(h=0;h<i.length;h+=1){const f=Zd(l,i,h);s[h]?(s[h].p(f,u),P(s[h],1)):(s[h]=e_(f),s[h].c(),P(s[h],1),s[h].m(e,t))}for(de(),h=i.length;h<s.length;h+=1)o(h);_e()}l[1]?a?(a.p(l,u),u&2&&P(a,1)):(a=t_(l),a.c(),P(a,1),a.m(e,null)):a&&(de(),V(a,1,1,()=>{a=null}),_e())},i(l){if(!r){for(let u=0;u<i.length;u+=1)P(s[u]);P(a),r=!0}},o(l){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)V(s[u]);V(a),r=!1},d(l){l&&F(e),Jr(s,l),a&&a.d()}}}function e_(n){let e,t;return e=new Wa({props:{subtype:n[16].subtype,forward:n[16].points_right,name:n[16].element_state.name,ancestry:n[16].widget_ancestry,origin:n[16].childOrigin.offsetBy(n[3])}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.subtype=r[16].subtype),i&1&&(s.forward=r[16].points_right),i&1&&(s.name=r[16].element_state.name),i&1&&(s.ancestry=r[16].widget_ancestry),i&1&&(s.origin=r[16].childOrigin.offsetBy(r[3])),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function t_(n){let e,t;return e=new Wa({props:{subtype:n[1].subtype,forward:n[1].points_right,name:n[1].element_state.name,ancestry:n[1].widget_ancestry,origin:n[1].childOrigin.offsetBy(n[3])}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&2&&(s.subtype=r[1].subtype),i&2&&(s.forward=r[1].points_right),i&2&&(s.name=r[1].element_state.name),i&2&&(s.ancestry=r[1].widget_ancestry),i&2&&(s.origin=r[1].childOrigin.offsetBy(r[3])),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function n_(n){let e,t,r=!!n[0]&&$d(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[0]?r?(r.p(i,s),s&1&&P(r,1)):(r=$d(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function oC(n){let e=n[2],t,r,i=n_(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&4&&ce(e,e=s[2])?(de(),V(i,1,1,ue),_e(),i=n_(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function aC(n,e,t){let r,i,s,o,a,l;$(n,ma,S=>t(7,r=S)),$(n,Pn,S=>t(8,i=S)),$(n,Br,S=>t(0,s=S)),$(n,_t,S=>t(9,o=S)),$(n,cn,S=>t(12,a=S)),$(n,lt,S=>t(13,l=S));var u,h,f,d;const p=l;a.size.asPoint.dividedInHalf;const g=new G(I.dot_size/-2,4-I.dot_size);(h=(u=p.thing)===null||u===void 0?void 0:u.color)!==null&&h!==void 0||I.thing_color_default;let b=null,A=0;return Zt(()=>{const S=Oe.handle_anySignal(v=>{t(2,A+=1)});return()=>{S.disconnect()}}),n.$$.update=()=>{if(n.$$.dirty&513&&(t(1,b=null),setTimeout(()=>{var S;t(1,b=(S=s==null?void 0:s.tools_widget_map)!==null&&S!==void 0?S:null)},1)),n.$$.dirty&356&&p.thing&&p.thing.id==(i==null?void 0:i.split(I.generic_separator)[0])&&(t(6,d=t(5,f=p.thing)===null||f===void 0?void 0:f.color)!==null&&d!==void 0||I.thing_color_default,t(2,A+=1)),n.$$.dirty&132){const S=r;S&&p.thing&&p.thing.id==S.thing_id&&t(2,A+=1)}},[s,b,A,g,u,f,d,r,i,o]}class lC extends Se{constructor(e){super(),Pe(this,e,aC,oC,ce,{})}}function uC(n){let e,t,r;return{c(){e=W("div"),t=W("span"),r=at(n[3]),T(t,"class","text"),C(t,"font-family",n[0]),C(t,"font-size",n[2]),C(t,"color",n[4]),T(e,"class","angled-text"),C(e,"top",n[1].y+"px"),C(e,"left",n[1].x+"px"),C(e,"position","absolute"),C(e,"z-index",Ee.backmost),C(e,"transform","translate(-50%, -50%) rotate("+n[5]+"deg)")},m(i,s){B(i,e,s),K(e,t),K(t,r)},p(i,[s]){s&8&&Dt(r,i[3]),s&1&&C(t,"font-family",i[0]),s&4&&C(t,"font-size",i[2]),s&16&&C(t,"color",i[4]),s&2&&C(e,"top",i[1].y+"px"),s&2&&C(e,"left",i[1].x+"px"),s&32&&C(e,"transform","translate(-50%, -50%) rotate("+i[5]+"deg)")},i:ue,o:ue,d(i){i&&F(e)}}}function cC(n,e,t){let r,i;$(n,zn,f=>t(7,i=f));let{font_family:s=i}=e,{center:o=G.zero}=e,{font_size:a="0.7em"}=e,{text:l=I.space}=e,{color:u="red"}=e,{angle:h=0}=e;return n.$$set=f=>{"font_family"in f&&t(0,s=f.font_family),"center"in f&&t(1,o=f.center),"font_size"in f&&t(2,a=f.font_size),"text"in f&&t(3,l=f.text),"color"in f&&t(4,u=f.color),"angle"in f&&t(6,h=f.angle)},n.$$.update=()=>{n.$$.dirty&64&&t(5,r=h*180/Math.PI)},[s,o,a,l,u,r,h]}class hC extends Se{constructor(e){super(),Pe(this,e,cC,uC,ce,{font_family:0,center:1,font_size:2,text:3,color:4,angle:6})}}function r_(n){var o;let e=n[4],t,r,i,s=s_(n);return r=new hC({props:{font_size:"0.6em",text:n[0].cluster_title,center:n[0].label_center,font_family:n[5],angle:n[0].arc_map.label_text_angle,color:((o=n[6].thing)==null?void 0:o.color)??I.thing_color_default}}),{c(){s.c(),t=J(),Q(r.$$.fragment)},m(a,l){s.m(a,l),B(a,t,l),X(r,a,l),i=!0},p(a,l){var h;l&16&&ce(e,e=a[4])?(de(),V(s,1,1,ue),_e(),s=s_(a),s.c(),P(s,1),s.m(t.parentNode,t)):s.p(a,l);const u={};l&1&&(u.text=a[0].cluster_title),l&1&&(u.center=a[0].label_center),l&32&&(u.font_family=a[5]),l&1&&(u.angle=a[0].arc_map.label_text_angle),l&64&&(u.color=((h=a[6].thing)==null?void 0:h.color)??I.thing_color_default),r.$set(u)},i(a){i||(P(s),P(r.$$.fragment,a),i=!0)},o(a){V(s),V(r.$$.fragment,a),i=!1},d(a){a&&F(t),s.d(a),Y(r,a)}}}function fC(n){let e,t;return e=new lr({props:{width:n[7]*2,height:n[7]*2,zindex:Ee.backmost,name:n[0].name,cursor:I.cursor_default,center:Qe.center_ofGraphSize,isHit_closure:n[10],mouse_state_closure:n[9],$$slots:{default:[dC]},$$scope:{ctx:n}}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.name=r[0].name),i&4194333&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function i_(n){let e,t;return{c(){e=Ke("path"),T(e,"id","thumb"),T(e,"fill",n[2]),T(e,"d",t=n[0].thumb_map.svgPathFor_arc)},m(r,i){B(r,e,i)},p(r,i){i&4&&T(e,"fill",r[2]),i&1&&t!==(t=r[0].thumb_map.svgPathFor_arc)&&T(e,"d",t)},d(r){r&&F(e)}}}function dC(n){let e,t,r,i,s,o=n[0].isPaging&&n[0].widgets_shown>1&&i_(n);return{c(){e=Ke("svg"),t=Ke("path"),i=Ke("path"),o&&o.c(),T(t,"id","arc"),T(t,"stroke",n[4]),T(t,"fill","transparent"),T(t,"d",r=n[0].arc_map.svgPathFor_arc),T(i,"id","fork"),T(i,"stroke",n[3]),T(i,"fill","transparent"),T(i,"d",s=n[0].arc_map.svgPathFor_forkRadial),T(e,"id","arc"),T(e,"viewBox",n[8])},m(a,l){B(a,e,l),K(e,t),K(e,i),o&&o.m(e,null)},p(a,l){l&16&&T(t,"stroke",a[4]),l&1&&r!==(r=a[0].arc_map.svgPathFor_arc)&&T(t,"d",r),l&8&&T(i,"stroke",a[3]),l&1&&s!==(s=a[0].arc_map.svgPathFor_forkRadial)&&T(i,"d",s),a[0].isPaging&&a[0].widgets_shown>1?o?o.p(a,l):(o=i_(a),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(a){a&&F(e),o&&o.d()}}}function s_(n){let e,t,r=!ie.noRadial&&fC(n);return{c(){e=W("div"),r&&r.c(),T(e,"class","arc"),C(e,"z-index",Ee.paging)},m(i,s){B(i,e,s),r&&r.m(e,null),n[14](e),t=!0},p(i,s){ie.noRadial||r.p(i,s)},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(),n[14](null)}}}function _C(n){let e,t,r=!!n[0]&&r_(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&P(r,1)):(r=r_(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function pC(n,e,t){let r,i,s,o;$(n,Ts,L=>t(13,r=L)),$(n,yn,L=>t(16,i=L)),$(n,zn,L=>t(5,s=L)),$(n,lt,L=>t(6,o=L));let{color:a="red"}=e,{cluster_map:l}=e;const u=I.ring_widget_padding,h=i+u;`${l.name}`;const f=`${-u} ${-u} ${h*2} ${h*2}`;Qe.center_ofGraphSize.offsetBy(G.square(-h));let d=r,p=a,g=a,b=a,A;ie.log_build(` P ARC (svelte)  ${l.name}`),l.update_all(),S();function S(){t(3,g=we.opacitize(a,.3)),t(4,b=we.opacitize(a,ae.cluster_paging_state.stroke_opacity)),t(2,p=we.opacitize(a,ae.ring_rotation_state.isActive?.15:l.paging_rotation.three_level_opacity))}function v(L){l.isPaging&&L.isHover&&(t(0,l.paging_rotation.isHovering=l.thumb_isHit,l),S())}function x(L){return l.thumb_isHit}function E(L){ut[L?"unshift":"push"](()=>{A=L,t(1,A)})}return n.$$set=L=>{"color"in L&&t(11,a=L.color),"cluster_map"in L&&t(0,l=L.cluster_map)},n.$$.update=()=>{n.$$.dirty&2&&A&&new ar(A,x,-1,ht.thumb),n.$$.dirty&12289&&d!=r&&(t(12,d=r),l.paging_rotation.reset())},[l,A,p,g,b,s,o,h,f,v,x,a,d,r,E]}class gC extends Se{constructor(e){super(),Pe(this,e,pC,_C,ce,{color:11,cluster_map:0})}}function o_(n,e,t){const r=n.slice();return r[35]=e[t],r}function a_(n){let e,t;return e=new gC({props:{color:n[2],cluster_map:n[35]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i[0]&4&&(s.color=r[2]),i[0]&64&&(s.cluster_map=r[35]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function l_(n){let e,t,r=!!n[35]&&n[35].widgets_shown>0&&a_(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,s){i[35]&&i[35].widgets_shown>0?r?(r.p(i,s),s[0]&64&&P(r,1)):(r=a_(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function mC(n){let e,t,r;return t=new lr({props:{name:"radial",zindex:n[0],cursor:n[3],isHit_closure:n[12],width:n[8],height:n[8],center:Qe.center_ofGraphSize,mouse_state_closure:n[13],$$slots:{default:[bC]},$$scope:{ctx:n}}}),{c(){e=W("div"),Q(t.$$.fragment),T(e,"class","radial"),C(e,"z-index",Ee.radial)},m(i,s){B(i,e,s),X(t,e,null),r=!0},p(i,s){const o={};s[0]&1&&(o.zindex=i[0]),s[0]&8&&(o.cursor=i[3]),s[0]&6|s[1]&128&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){r||(P(t.$$.fragment,i),r=!0)},o(i){V(t.$$.fragment,i),r=!1},d(i){i&&F(e),Y(t)}}}function yC(n){let e;return{c(){e=Ke("path"),T(e,"class","reticule-path"),T(e,"stroke","green"),T(e,"fill","transparent"),T(e,"d",ze.t_cross(n[7]*2,-2))},m(t,r){B(t,e,r)},p:ue,d(t){t&&F(e)}}}function bC(n){let e,t,r,i,s,o,a,l=ie.reticule&&yC(n);return{c(){e=Ke("svg"),t=Ke("path"),l&&l.c(),s=Ke("path"),T(t,"class","resize-path"),T(t,"d",n[10]),T(t,"fill",r=we.opacitize(n[2],n[1].ring_resizing_state.fill_opacity)),T(t,"stroke",i=we.opacitize(n[2],n[1].ring_resizing_state.stroke_opacity)),T(s,"class","rotate-path"),T(s,"d",n[9]),T(s,"fill",o=we.opacitize(n[2],n[1].ring_rotation_state.fill_opacity*(n[1].ring_resizing_state.isHighlighted?.3:1))),T(s,"stroke",a=we.opacitize(n[2],n[1].ring_rotation_state.stroke_opacity*(n[1].ring_resizing_state.isHighlighted?.7:1))),T(e,"class","radial-svg"),T(e,"viewBox",n[11])},m(u,h){B(u,e,h),K(e,t),l&&l.m(e,null),K(e,s)},p(u,h){h[0]&6&&r!==(r=we.opacitize(u[2],u[1].ring_resizing_state.fill_opacity))&&T(t,"fill",r),h[0]&6&&i!==(i=we.opacitize(u[2],u[1].ring_resizing_state.stroke_opacity))&&T(t,"stroke",i),ie.reticule&&l.p(u,h),h[0]&6&&o!==(o=we.opacitize(u[2],u[1].ring_rotation_state.fill_opacity*(u[1].ring_resizing_state.isHighlighted?.3:1)))&&T(s,"fill",o),h[0]&6&&a!==(a=we.opacitize(u[2],u[1].ring_rotation_state.stroke_opacity*(u[1].ring_resizing_state.isHighlighted?.7:1)))&&T(s,"stroke",a)},d(u){u&&F(e),l&&l.d()}}}function u_(n){let e,t,r,i,s=fn(n[6].cluster_maps),o=[];for(let u=0;u<s.length;u+=1)o[u]=l_(o_(n,s,u));const a=u=>V(o[u],1,1,()=>{o[u]=null});let l=!ie.hide_radial&&mC(n);return{c(){e=W("div");for(let u=0;u<o.length;u+=1)o[u].c();t=J(),l&&l.c(),r=Te(),T(e,"class","paging-arcs"),C(e,"z-index",Ee.paging)},m(u,h){B(u,e,h);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null);n[24](e),B(u,t,h),l&&l.m(u,h),B(u,r,h),i=!0},p(u,h){if(h[0]&68){s=fn(u[6].cluster_maps);let f;for(f=0;f<s.length;f+=1){const d=o_(u,s,f);o[f]?(o[f].p(d,h),P(o[f],1)):(o[f]=l_(d),o[f].c(),P(o[f],1),o[f].m(e,null))}for(de(),f=s.length;f<o.length;f+=1)a(f);_e()}ie.hide_radial||l.p(u,h)},i(u){if(!i){for(let h=0;h<s.length;h+=1)P(o[h]);P(l),i=!0}},o(u){o=o.filter(Boolean);for(let h=0;h<o.length;h+=1)V(o[h]);V(l),i=!1},d(u){u&&(F(e),F(t),F(r)),Jr(o,u),n[24](null),l&&l.d(u)}}}function wC(n){let e=n[4],t,r,i=u_(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o[0]&16&&ce(e,e=s[4])?(de(),V(i,1,1,ue),_e(),i=u_(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}const c_="radial";function vC(n,e,t){let r,i,s,o,a,l,u,h;$(n,fl,fe=>t(17,r=fe)),$(n,Br,fe=>t(6,i=fe)),$(n,yn,fe=>t(18,s=fe)),$(n,ks,fe=>t(19,o=fe)),$(n,ya,fe=>t(20,a=fe)),$(n,Ts,fe=>t(21,l=fe)),$(n,lt,fe=>t(22,u=fe)),$(n,Pn,fe=>t(23,h=fe));var f,d,p,g;let{zindex:b=Ee.backmost}=e;const A=I.ring_rotation_thickness,S=s+I.ring_rotation_thickness,v=S+A,x=v*2,E=pt.mouse_timer_forName(c_),L=ze.annulus(G.square(s),S,A,G.square(A)),z=ze.annulus(G.square(S),v,A),k=`${-A}, ${-A}, ${x}, ${x}`;let y=(d=(f=u==null?void 0:u.thing)===null||f===void 0?void 0:f.color)!==null&&d!==void 0?d:I.thing_color_default,w=l,D=I.cursor_default,N=0,M;H(),ie.log_build(" (svelte)"),i.layoutAll_clusters();function O(){return Qe.mouse_distance_fromGraphCenter<=v}function H(){switch(Z()){case tn.paging:t(3,D=ae.cluster_paging_state.cursor);break;case tn.resize:t(3,D=ae.ring_resizing_state.cursor);break;case tn.rotate:t(3,D=ae.ring_rotation_state.cursor);break;default:t(3,D="default");break}}function j(){pt.mouse_timer_forName(c_).reset(),ae.ring_resizing_state.reset(),ae.ring_rotation_state.reset(),It(fl,r=null,r),E.reset(),pt.reset_paging(),t(4,N+=1)}function Z(){let fe=tn.miss;const Ve=Qe.mouse_vector_ofOffset_fromGraphCenter();if(Ve){const ye=Ve.magnitude,Ae=I.ring_rotation_thickness,Be=s,be=I.paging_arc_thickness,et=Be+Ae*2,rt=Be+Ae,vt=Be-be;ye&&ye<=et&&(ye>rt?fe=tn.resize:ye>Be?fe=tn.rotate:ye>vt&&(fe=tn.paging)),ie.log_hover(` ring zone ${fe} ${ye.toFixed(0)}`),ie.log_cursor(` ring zone ${fe} ${Ve.description}`)}return fe}function ge(){const fe=Z(),Ve=pt.isAny_paging_arc_active,ye=fe==tn.rotate&&!Ve&&!ae.ring_resizing_state.isActive,Ae=fe==tn.resize&&!Ve&&!ae.ring_rotation_state.isActive,Be=fe==tn.paging&&!ae.ring_rotation_state.isActive&&!ae.ring_resizing_state.isActive;ae.cluster_paging_state.isHovering!=Be&&(t(1,ae.cluster_paging_state.isHovering=Be,ae),ie.log_hover(` hover paging  ${Be}`),t(4,N+=1)),ae.ring_rotation_state.isHovering!=ye&&(t(1,ae.ring_rotation_state.isHovering=ye,ae),ie.log_hover(` hover rotate  ${ye}`),t(4,N+=1)),ae.ring_resizing_state.isHovering!=Ae&&(t(1,ae.ring_resizing_state.isHovering=Ae,ae),ie.log_hover(` hover resize  ${Ae}`),t(4,N+=1))}function le(fe){if(!fe.isHover){if(fe.isUp)j(),t(4,N+=1);else if(fe.isDown){const Ve=Qe.mouse_angle_fromGraphCenter,ye=Ve.add_angle_normalized(-o);switch(Z()){case tn.rotate:ie.log_radial(` begin rotate  ${ye.degrees_of(0)}`),t(1,ae.ring_rotation_state.active_angle=Ve,ae),t(1,ae.ring_rotation_state.basis_angle=ye,ae),t(4,N+=1);break;case tn.resize:const Ae=Qe.mouse_distance_fromGraphCenter-s;ie.log_radial(` begin resize  ${Ae.toFixed(0)}`),t(1,ae.ring_rotation_state.active_angle=Ve+$e.quarter,ae),t(1,ae.ring_rotation_state.basis_angle=ye+$e.quarter,ae),t(1,ae.ring_resizing_state.basis_radius=Ae,ae),t(4,N+=1);break;case tn.paging:const Be=Ve.angle_normalized(),be=i.cluster_mapFor_mouseLocation;be&&(ie.log_radial(` begin paging  ${Be.degrees_of(0)}`),be.paging_rotation.active_angle=Be,be.paging_rotation.basis_angle=Be,It(fl,r=be,r),t(4,N+=1));break}}}ge(),H()}function ee(fe){ut[fe?"unshift":"push"](()=>{M=fe,t(5,M)})}return n.$$set=fe=>{"zindex"in fe&&t(0,b=fe.zindex)},n.$$.update=()=>{if(n.$$.dirty[0]&12632080&&u.thing&&u.thing.id==(h==null?void 0:h.split(I.generic_separator)[0])&&(t(2,y=t(15,g=t(14,p=u==null?void 0:u.thing)===null||p===void 0?void 0:p.color)!==null&&g!==void 0?g:I.thing_color_default),t(4,N+=1)),n.$$.dirty[0]&2162688&&w!=l&&(t(16,w=l),Z()==tn.miss&&j()),n.$$.dirty[0]&1966098){const fe=Qe.mouse_vector_ofOffset_fromGraphCenter();if(fe){const Ve=fe.angle,ye=ae.ring_rotation_state,Ae=ae.ring_resizing_state;if(Ae.isActive){const Be=I.innermost_ring_radius,be=Be*3,rt=(fe.magnitude-Ae.basis_radius).force_between(Be,be),vt=rt-s,Ht=s+vt;Ae.active_angle=Ve+$e.quarter,ge(),t(3,D=ae.ring_resizing_state.cursor),Math.abs(vt)>1&&(ie.log_radial(` resize  D ${rt.toFixed(0)}  R ${Ht.toFixed(0)}  + ${vt.toFixed(1)}`),It(yn,s=Ht,s),Oe.signal_rebuildGraph_fromFocus(),t(4,N+=1))}else if(ye.isActive)!Oe.signal_isInFlight&&!Ve.isClocklyAlmost(ye.active_angle,$e.radians_from_degrees(4),$e.full)&&(It(ks,o=Ve.add_angle_normalized(-ye.basis_angle),o),ie.log_radial(` rotate ${o.degrees_of(0)}`),ye.active_angle=Ve,ge(),t(3,D=ae.ring_rotation_state.cursor),Oe.signal_relayoutWidgets_fromFocus(),t(4,N+=1));else if(r){const Be=r.paging_rotation,be=Be.basis_angle,et=Be.active_angle,rt=(et-Ve).angle_normalized_aroundZero();Be.active_angle=Ve,ge(),t(3,D=Be.cursor),be&&et&&be!=et&&r.adjust_paging_index_byAdding_angle(rt)&&(ie.log_radial(` page  ${rt.degrees_of(0)}`),Oe.signal_rebuildGraph_fromFocus(),t(4,N+=1))}else ge(),H(),t(4,N+=1)}}},[b,ae,y,D,N,M,i,S,x,L,z,k,O,le,p,g,w,r,s,o,a,l,u,h,ee]}class kC extends Se{constructor(e){super(),Pe(this,e,vC,wC,ce,{zindex:0},null,[-1,-1])}}function h_(n){let e,t,r,i,s,o,a;return t=new kC({}),i=new QI({}),o=new lC({}),{c(){e=W("div"),Q(t.$$.fragment),r=J(),Q(i.$$.fragment),s=J(),Q(o.$$.fragment),T(e,"class","radial-graph"),C(e,"z-index",Ee.backmost),C(e,"width",n[2].size.width+"px"),C(e,"height",n[2].size.height+"px"),C(e,"transform","translate("+n[0].x+"px, "+n[0].y+"px)")},m(l,u){B(l,e,u),X(t,e,null),K(e,r),X(i,e,null),K(e,s),X(o,e,null),a=!0},p(l,u){(!a||u&4)&&C(e,"width",l[2].size.width+"px"),(!a||u&4)&&C(e,"height",l[2].size.height+"px"),(!a||u&1)&&C(e,"transform","translate("+l[0].x+"px, "+l[0].y+"px)")},i(l){a||(P(t.$$.fragment,l),P(i.$$.fragment,l),P(o.$$.fragment,l),a=!0)},o(l){V(t.$$.fragment,l),V(i.$$.fragment,l),V(o.$$.fragment,l),a=!1},d(l){l&&F(e),Y(t),Y(i),Y(o)}}}function TC(n){let e=(ae.readOnce_rebuild_needed_forType(Es.clusters),n[1].hashedAncestry),t,r,i=h_(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&2&&ce(e,e=(ae.readOnce_rebuild_needed_forType(Es.clusters),s[1].hashedAncestry))?(de(),V(i,1,1,ue),_e(),i=h_(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function EC(n,e,t){let r,i,s,o,a;return $(n,Br,l=>t(4,r=l)),$(n,tr,l=>t(3,i=l)),$(n,jr,l=>t(0,s=l)),$(n,lt,l=>t(1,o=l)),$(n,cn,l=>t(2,a=l)),new G(31,-173.5).offsetBy(s.negated),It(Br,r=new uf,r),ie.log_tools(" CLUSTERS (svelte)"),Zt(()=>{const l=Oe.handle_relayoutWidgets(0,u=>{ae.require_rebuild_forType(Es.clusters)});return()=>{l.disconnect()}}),n.$$.update=()=>{n.$$.dirty&8&&(It(Br,r=new uf,r),setTimeout(()=>{ae.require_rebuild_forType(Es.clusters)},100))},[s,o,a,i]}class AC extends Se{constructor(e){super(),Pe(this,e,EC,TC,ce,{})}}function IC(n){let e;return{c(){e=W("div"),T(e,"class","circle"),T(e,"id",n[3]),C(e,"z-index",n[1]),C(e,"position","absolute"),C(e,"border-radius","50%"),C(e,"width",n[7]+"px"),C(e,"height",n[7]+"px"),C(e,"border",n[4]+"px solid "+n[6]),C(e,"background-color",n[0]),C(e,"top",n[2].y-n[5]-n[4]+"px"),C(e,"left",n[2].x-n[5]-n[4]+"px")},m(t,r){B(t,e,r)},p(t,[r]){r&8&&T(e,"id",t[3]),r&2&&C(e,"z-index",t[1]),r&128&&C(e,"width",t[7]+"px"),r&128&&C(e,"height",t[7]+"px"),r&80&&C(e,"border",t[4]+"px solid "+t[6]),r&1&&C(e,"background-color",t[0]),r&52&&C(e,"top",t[2].y-t[5]-t[4]+"px"),r&52&&C(e,"left",t[2].x-t[5]-t[4]+"px")},i:ue,o:ue,d(t){t&&F(e)}}}function CC(n,e,t){let{color_background:r=ie.lines?"transparent":I.color_background}=e,{zindex:i=Ee.dots}=e,{center:s=G.zero}=e,{name:o=I.empty}=e,{thickness:a=1}=e,{radius:l=2}=e,{color:u}=e,h=0;return n.$$set=f=>{"color_background"in f&&t(0,r=f.color_background),"zindex"in f&&t(1,i=f.zindex),"center"in f&&t(2,s=f.center),"name"in f&&t(3,o=f.name),"thickness"in f&&t(4,a=f.thickness),"radius"in f&&t(5,l=f.radius),"color"in f&&t(6,u=f.color)},n.$$.update=()=>{n.$$.dirty&32&&t(7,h=l*2)},[r,i,s,o,a,l,u,h]}class im extends Se{constructor(e){super(),Pe(this,e,CC,IC,ce,{color_background:0,zindex:1,center:2,name:3,thickness:4,radius:5,color:6})}}function RC(n){let e,t;return e=new im({props:{radius:"1",center:n[0].extent.offsetBy(n[8]),color:"black",thickness:"1"}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.center=r[0].extent.offsetBy(r[8])),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function f_(n){let e,t,r,i,s,o,a,l,u,h,f=ie.lines&&RC(n);return{c(){e=Ke("svg"),t=Ke("path"),l=J(),f&&f.c(),u=Te(),T(t,"class","tree-line-path"),T(t,"d",n[6]),T(t,"stroke",r=n[1].thing.color),T(t,"fill","none"),T(e,"id",i=n[1].title),T(e,"width",s=n[3].width+"px"),T(e,"class","tree-line-svg"),T(e,"viewBox",o=n[5].verbose),T(e,"height",a=Math.max(2,n[3].height)+"px"),C(e,"z-index",Ee.lines),C(e,"top",n[2].y-n[3].height+.5+"px"),C(e,"left",n[2].x+142+"px"),C(e,"position","absolute"),C(e,"stroke-width","1px")},m(d,p){B(d,e,p),K(e,t),n[12](e),B(d,l,p),f&&f.m(d,p),B(d,u,p),h=!0},p(d,p){(!h||p&64)&&T(t,"d",d[6]),(!h||p&2&&r!==(r=d[1].thing.color))&&T(t,"stroke",r),(!h||p&2&&i!==(i=d[1].title))&&T(e,"id",i),(!h||p&8&&s!==(s=d[3].width+"px"))&&T(e,"width",s),(!h||p&32&&o!==(o=d[5].verbose))&&T(e,"viewBox",o),(!h||p&8&&a!==(a=Math.max(2,d[3].height)+"px"))&&T(e,"height",a),(!h||p&12)&&C(e,"top",d[2].y-d[3].height+.5+"px"),(!h||p&4)&&C(e,"left",d[2].x+142+"px"),ie.lines&&f.p(d,p)},i(d){h||(P(f),h=!0)},o(d){V(f),h=!1},d(d){d&&(F(e),F(l),F(u)),n[12](null),f&&f.d(d)}}}function PC(n){let e=n[7],t,r,i=f_(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&128&&ce(e,e=s[7])?(de(),V(i,1,1,ue),_e(),i=f_(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function SC(n){return!1}function DC(n,e,t){let r;$(n,Pn,A=>t(11,r=A));let{ancestry:i}=e,{rect:s=new De}=e,{curveType:o=gn.up}=e;const a=new G(131,-.5);let l=s.origin,u=s.extent,h=new De,f=I.empty,d=Xe.zero,p=0,g;function b(A){ut[A?"unshift":"push"](()=>{g=A,t(4,g)})}return n.$$set=A=>{"ancestry"in A&&t(1,i=A.ancestry),"rect"in A&&t(0,s=A.rect),"curveType"in A&&t(9,o=A.curveType)},n.$$.update=()=>{if(n.$$.dirty&18&&g&&new ar(g,SC,i.idHashed,ht.line),n.$$.dirty&2178&&i.thing&&i.thing.id==(r==null?void 0:r.split(I.generic_separator)[0])&&t(7,p+=1),n.$$.dirty&1549&&I.dot_size>0){switch(o){case gn.up:t(2,l=s.origin),t(10,u=s.extent.offsetByY(-1.5));break;case gn.down:t(2,l=s.bottomLeft.offsetByY(-.5)),t(10,u=l.offsetBy(s.size.asPoint).offsetByY(.5));break;case gn.flat:t(0,s=s.offsetByY(-1.5)),t(2,l=s.centerLeft),t(10,u=s.centerRight),t(6,f=ze.line(l.vector_to(u)));break}const A=l.vector_to(u);if(t(3,d=A.abs.asSize),o!=gn.flat){const v=o==gn.down?0:1,x=o==gn.down?0:d.height,E=o==gn.up?0:d.height;t(6,f=`M0 ${x} A ${d.description} 0 0 ${v} ${d.width} ${E}`)}const S=new Xe(d.width,Math.max(2,d.height));t(5,h=new De(l,S))}},[s,i,l,d,g,h,f,p,a,o,u,r,b]}class OC extends Se{constructor(e){super(),Pe(this,e,DC,PC,ce,{ancestry:1,rect:0,curveType:9})}}function d_(n,e,t){const r=n.slice();return r[9]=e[t],r}function NC(n){let e,t;return e=new im({props:{radius:"1",center:n[2],color:"black",thickness:"1"}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.center=r[2]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function __(n){let e,t,r=fn(n[1]),i=[];for(let o=0;o<r.length;o+=1)i[o]=g_(d_(n,r,o));const s=o=>V(i[o],1,1,()=>{i[o]=null});return{c(){e=W("div");for(let o=0;o<i.length;o+=1)i[o].c();T(e,"class","tree-children")},m(o,a){B(o,e,a);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);t=!0},p(o,a){if(a&26){r=fn(o[1]);let l;for(l=0;l<r.length;l+=1){const u=d_(o,r,l);i[l]?(i[l].p(u,a),P(i[l],1)):(i[l]=g_(u),i[l].c(),P(i[l],1),i[l].m(e,null))}for(de(),l=r.length;l<i.length;l+=1)s(l);_e()}},i(o){if(!t){for(let a=0;a<r.length;a+=1)P(i[a]);t=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)V(i[a]);t=!1},d(o){o&&F(e),Jr(i,o)}}}function p_(n){let e,t;return e=new sm({props:{ancestry:n[9].widget_ancestry,origin:n[9].childOrigin}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&2&&(s.ancestry=r[9].widget_ancestry),i&2&&(s.origin=r[9].childOrigin),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function g_(n){let e,t,r,i,s,o;e=new Wa({props:{name:n[9].element_state.name,ancestry:n[9].widget_ancestry,origin:n[9].extent.offsetBy(n[3])}}),r=new OC({props:{ancestry:n[9].widget_ancestry,curveType:n[9].curveType,rect:n[9].offsetBy(n[4])}});let a=n[9].widget_ancestry.showsChildRelationships&&p_(n);return{c(){Q(e.$$.fragment),t=J(),Q(r.$$.fragment),i=J(),a&&a.c(),s=Te()},m(l,u){X(e,l,u),B(l,t,u),X(r,l,u),B(l,i,u),a&&a.m(l,u),B(l,s,u),o=!0},p(l,u){const h={};u&2&&(h.name=l[9].element_state.name),u&2&&(h.ancestry=l[9].widget_ancestry),u&2&&(h.origin=l[9].extent.offsetBy(l[3])),e.$set(h);const f={};u&2&&(f.ancestry=l[9].widget_ancestry),u&2&&(f.curveType=l[9].curveType),u&2&&(f.rect=l[9].offsetBy(l[4])),r.$set(f),l[9].widget_ancestry.showsChildRelationships?a?(a.p(l,u),u&2&&P(a,1)):(a=p_(l),a.c(),P(a,1),a.m(s.parentNode,s)):a&&(de(),V(a,1,1,()=>{a=null}),_e())},i(l){o||(P(e.$$.fragment,l),P(r.$$.fragment,l),P(a),o=!0)},o(l){V(e.$$.fragment,l),V(r.$$.fragment,l),V(a),o=!1},d(l){l&&(F(t),F(i),F(s)),Y(e,l),Y(r,l),a&&a.d(l)}}}function VC(n){let e,t,r,i=ie.lines&&NC(n),s=n[0].isExpanded&&__(n);return{c(){i&&i.c(),e=J(),s&&s.c(),t=Te()},m(o,a){i&&i.m(o,a),B(o,e,a),s&&s.m(o,a),B(o,t,a),r=!0},p(o,[a]){ie.lines&&i.p(o,a),o[0].isExpanded?s?(s.p(o,a),a&1&&P(s,1)):(s=__(o),s.c(),P(s,1),s.m(t.parentNode,t)):s&&(de(),V(s,1,1,()=>{s=null}),_e())},i(o){r||(P(i),P(s),r=!0)},o(o){V(i),V(s),r=!1},d(o){o&&(F(e),F(t)),i&&i.d(o),s&&s.d(o)}}}function MC(n,e,t){let r;$(n,cn,d=>t(6,r=d));let{origin:i=G.zero}=e,{ancestry:s}=e;const o=new G(17,I.dot_size/-15-7),a=new G(-122.5,2.5);let l=[],u=new Date().getTime(),h=G.zero;Bm(()=>{t(1,l=[])}),Zt(()=>{f();const d=Oe.handle_relayoutWidgets(1,p=>{const g=new Date().getTime();s.isExpanded&&g-u>100&&s.ancestry_hasEqualID(p)&&(u=g,ie.log_origins(i.x+" before timeout"),f())});return()=>{d.disconnect()}});function f(){if(t(1,l=[]),s.isExpanded||s.isRoot){ie.log_origins(i.x+" children layout");const d=s.visibleProgeny_halfHeight,p=s.childAncestries,g=i.offsetByXY(3,d+1);let b=-s.visibleProgeny_height()/2;for(const A of p){const S=new Ov(b,s,A,g);t(1,l=we.concatenateArrays(l,S.widgetMapRects)),b+=S.childHeight+1}t(2,h=g.offsetByXY(20,2))}else console.log(`not expanded, cannot layout ${s.description}`)}return n.$$set=d=>{"origin"in d&&t(5,i=d.origin),"ancestry"in d&&t(0,s=d.ancestry)},n.$$.update=()=>{n.$$.dirty&64&&r&&f()},[s,l,h,o,a,i,r]}class sm extends Se{constructor(e){super(),Pe(this,e,MC,VC,ce,{origin:5,ancestry:0})}}function m_(n){let e=n[4],t,r,i=b_(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,o){o&16&&ce(e,e=s[4])?(de(),V(i,1,1,ue),_e(),i=b_(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function y_(n){let e,t;return e=new sm({props:{ancestry:n[0],origin:n[2]}}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p(r,i){const s={};i&1&&(s.ancestry=r[0]),i&4&&(s.origin=r[2]),e.$set(s)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function b_(n){let e,t,r,i;t=new Wa({props:{name:n[6].name,ancestry:n[0],origin:n[1].offsetByXY(-21.5-n[3],-5)}});let s=n[0].isExpanded&&y_(n);return{c(){e=W("div"),Q(t.$$.fragment),r=J(),s&&s.c(),T(e,"class","tree"),C(e,"transform","translate("+n[5].x+"px, "+n[5].y+"px)")},m(o,a){B(o,e,a),X(t,e,null),K(e,r),s&&s.m(e,null),i=!0},p(o,a){const l={};a&1&&(l.ancestry=o[0]),a&10&&(l.origin=o[1].offsetByXY(-21.5-o[3],-5)),t.$set(l),o[0].isExpanded?s?(s.p(o,a),a&1&&P(s,1)):(s=y_(o),s.c(),P(s,1),s.m(e,null)):s&&(de(),V(s,1,1,()=>{s=null}),_e()),(!i||a&32)&&C(e,"transform","translate("+o[5].x+"px, "+o[5].y+"px)")},i(o){i||(P(t.$$.fragment,o),P(s),i=!0)},o(o){V(t.$$.fragment,o),V(s),i=!1},d(o){o&&F(e),Y(t),s&&s.d()}}}function xC(n){let e,t,r=n[0]&&m_(n);return{c(){r&&r.c(),e=Te()},m(i,s){r&&r.m(i,s),B(i,e,s),t=!0},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&P(r,1)):(r=m_(i),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(de(),V(r,1,1,()=>{r=null}),_e())},i(i){t||(P(r),t=!0)},o(i){V(r),t=!1},d(i){i&&F(e),r&&r.d(i)}}}function LC(n,e,t){let r,i,s,o,a,l;$(n,Ur,S=>t(8,r=S)),$(n,tr,S=>t(16,i=S)),$(n,lt,S=>t(0,s=S)),$(n,Fe,S=>t(9,o=S)),$(n,cn,S=>t(10,a=S)),$(n,jr,S=>t(5,l=S)),pt.element_state_for(s,dn.reveal,"tree");const u=pt.element_state_for(s,dn.focus,"tree");let h=G.zero,f=G.zero,d=G.zero,p=0,g,b=0;Zt(()=>{const S=Oe.handle_relayoutWidgets(0,v=>{A()});return()=>{S.disconnect()}});function A(){const S=s;if(S&&g){d=S.visibleProgeny_size;const v=15+(i?-I.width_details:0)-d.width/2-I.dot_size/2.5+p,x=-1-g.origin.y;t(1,h=g.center.offsetByXY(v,x)),r&&t(1,h.x=25,h);const E=new G(-42.2+I.line_stretch-I.dot_size/2+p,I.dot_size/2-d.height/2-4);t(2,f=h.offsetBy(E)),ie.log_origins(f.x+" updateOrigins")}}return n.$$.update=()=>{if(n.$$.dirty&272&&(A(),t(4,b+=1)),n.$$.dirty&1152&&g!=a&&(t(7,g=a),g.size.height,g.size.width,g.origin.x,g.origin.y,A()),n.$$.dirty&529){const S=s?s.thing:o.root;t(3,p=3+(S==null?void 0:S.titleWidth)/2),A(),t(4,b+=1)}},[s,h,f,p,b,l,u,g,r,o,a]}class zC extends Se{constructor(e){super(),Pe(this,e,LC,xC,ce,{})}}function FC(n){let e,t;return e=new zC({}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function BC(n){let e,t;return e=new AC({}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function w_(n){let e,t,r,i;const s=[BC,FC],o=[];function a(l,u){return l[4]==kr.radial?0:1}return t=a(n),r=o[t]=s[t](n),{c(){e=W("div"),r.c(),T(e,"class","draggable"),T(e,"style",n[0])},m(l,u){B(l,e,u),o[t].m(e,null),n[9](e),i=!0},p(l,u){let h=t;t=a(l),t!==h&&(de(),V(o[h],1,1,()=>{o[h]=null}),_e(),r=o[t],r||(r=o[t]=s[t](l),r.c()),P(r,1),r.m(e,null)),(!i||u&1)&&T(e,"style",l[0])},i(l){i||(P(r),i=!0)},o(l){V(r),i=!1},d(l){l&&F(e),o[t].d(),n[9](null)}}}function UC(n){let e=(n[3],n[1]),t,r,i=w_(n);return{c(){i.c(),t=Te()},m(s,o){i.m(s,o),B(s,t,o),r=!0},p(s,[o]){o&10&&ce(e,e=(s[3],s[1]))?(de(),V(i,1,1,ue),_e(),i=w_(s),i.c(),P(i,1),i.m(t.parentNode,t)):i.p(s,o)},i(s){r||(P(i),r=!0)},o(s){V(i),r=!1},d(s){s&&F(t),i.d(s)}}}function jC(n,e,t){let r,i,s,o,a;$(n,Ur,g=>t(6,r=g)),$(n,cn,g=>t(7,i=g)),$(n,jr,g=>t(8,s=g)),$(n,lt,g=>t(3,o=g)),$(n,vr,g=>t(4,a=g));let l=null,u=I.empty,h=0,f;Zt(()=>{d();const g=Oe.handle_rebuildGraph(1,b=>{ie.log_mount(" rebuild GRAPH"),t(1,h+=1)});return()=>{g.disconnect()}});function d(){t(0,u=`
			left: 0px;
			overflow: hidden;
			position: absolute;
			touch-action: none;
			pointer-events: auto;
			z-index: ${Ee.backmost};
			top:${l.origin.y}px;
			width: ${l.size.width}px;
			height: ${l.size.height}px;
		`.removeWhiteSpace())}function p(g){ut[g?"unshift":"push"](()=>{f=g,t(2,f)})}return n.$$.update=()=>{n.$$.dirty&258&&t(1,h+=1),n.$$.dirty&162&&(t(5,l=i.offsetByY(-9)),ie.log_action(` draggable ${l.description}`),d(),t(1,h+=1)),n.$$.dirty&64&&setTimeout(()=>{d()},1)},[u,h,f,o,a,l,r,i,s,p]}class qC extends Se{constructor(e){super(),Pe(this,e,jC,UC,ce,{})}}function HC(n){let e,t,r,i,s,o,a;e=new VI({});let l=!n[2]&&v_(n);const u=[YC,XC,WC],h=[];function f(d,p){return d[2]==Le.builds?0:d[2]==Le.open?1:d[2]?-1:2}return~(s=f(n))&&(o=h[s]=u[s](n)),{c(){Q(e.$$.fragment),t=J(),l&&l.c(),r=J(),i=W("div"),o&&o.c(),T(i,"class","right-side"),C(i,"height","100%"),C(i,"position","fixed"),C(i,"z-index",Ee.backmost),C(i,"left",(n[3]?I.width_details:0)+"px")},m(d,p){X(e,d,p),B(d,t,p),l&&l.m(d,p),B(d,r,p),B(d,i,p),~s&&h[s].m(i,null),a=!0},p(d,p){d[2]?l&&(de(),V(l,1,1,()=>{l=null}),_e()):l?(l.p(d,p),p&4&&P(l,1)):(l=v_(d),l.c(),P(l,1),l.m(r.parentNode,r));let g=s;s=f(d),s!==g&&(o&&(de(),V(h[g],1,1,()=>{h[g]=null}),_e()),~s?(o=h[s],o||(o=h[s]=u[s](d),o.c()),P(o,1),o.m(i,null)):o=null),(!a||p&8)&&C(i,"left",(d[3]?I.width_details:0)+"px")},i(d){a||(P(e.$$.fragment,d),P(l),P(o),a=!0)},o(d){V(e.$$.fragment,d),V(l),V(o),a=!1},d(d){d&&(F(t),F(r),F(i)),Y(e,d),l&&l.d(d),~s&&h[s].d()}}}function GC(n){let e;return{c(){e=W("p"),e.textContent="Nothing is available.",T(e,"class","svelte-1u0vu6u")},m(t,r){B(t,e,r)},p:ue,i:ue,o:ue,d(t){t&&F(e)}}}function KC(n){let e,t,r,i=n[0]==jn.fetch&&T_();return{c(){e=W("p"),e.textContent="Welcome to Seriously",t=J(),i&&i.c(),r=Te(),T(e,"class","svelte-1u0vu6u")},m(s,o){B(s,e,o),B(s,t,o),i&&i.m(s,o),B(s,r,o)},p(s,o){s[0]==jn.fetch?i||(i=T_(),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},i:ue,o:ue,d(s){s&&(F(e),F(t),F(r)),i&&i.d(s)}}}function v_(n){let e,t,r,i,s,o,a,l,u;t=new aI({});let h=n[3]&&k_(n);return{c(){e=W("div"),Q(t.$$.fragment),r=J(),i=W("div"),i.innerHTML="",s=J(),o=W("div"),o.innerHTML="",a=J(),h&&h.c(),l=Te(),T(i,"class","horizontal-line svelte-1u0vu6u"),C(i,"top",I.height_banner+I.height_breadcrumbs+"px"),C(i,"z-index",Ee.lines),T(e,"class","breadcrumbs"),C(e,"left","0px"),C(e,"position","absolute"),C(e,"top",I.height_banner-1+"px"),C(e,"z-index",Ee.frontmost),C(e,"width",Qe.windowSize.width+"px"),C(e,"height",I.height_breadcrumbs+"px"),T(o,"class","horizontal-line svelte-1u0vu6u"),C(o,"z-index",Ee.lines),C(o,"top",I.height_banner+"px")},m(f,d){B(f,e,d),X(t,e,null),K(e,r),K(e,i),B(f,s,d),B(f,o,d),B(f,a,d),h&&h.m(f,d),B(f,l,d),u=!0},p(f,d){f[3]?h?(h.p(f,d),d&8&&P(h,1)):(h=k_(f),h.c(),P(h,1),h.m(l.parentNode,l)):h&&(de(),V(h,1,1,()=>{h=null}),_e())},i(f){u||(P(t.$$.fragment,f),P(h),u=!0)},o(f){V(t.$$.fragment,f),V(h),u=!1},d(f){f&&(F(e),F(s),F(o),F(a),F(l)),Y(t),h&&h.d(f)}}}function k_(n){let e,t,r,i;return e=new $A({}),{c(){Q(e.$$.fragment),t=J(),r=W("div"),T(r,"class","vertical-line"),C(r,"width","1px"),C(r,"position","absolute"),C(r,"z-index",Ee.lines),C(r,"left",I.width_details+"px"),C(r,"background-color","lightgray"),C(r,"top",n[4].origin.y+"px"),C(r,"height",n[4].size.height+"px")},m(s,o){X(e,s,o),B(s,t,o),B(s,r,o),i=!0},p(s,o){(!i||o&16)&&C(r,"top",s[4].origin.y+"px"),(!i||o&16)&&C(r,"height",s[4].size.height+"px")},i(s){i||(P(e.$$.fragment,s),i=!0)},o(s){V(e.$$.fragment,s),i=!1},d(s){s&&(F(t),F(r)),Y(e,s)}}}function WC(n){let e,t;return e=new qC({}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function XC(n){let e,t;return e=new BI({}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function YC(n){let e,t;return e=new mI({}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function T_(n){let e;return{c(){e=W("p"),e.textContent=`${st.startupExplanation}`,T(e,"class","svelte-1u0vu6u")},m(t,r){B(t,e,r)},d(t){t&&F(e)}}}function E_(n){let e,t,r,i,s,o,a,l,u;e=new AI({});const h=[KC,GC,HC],f=[];function d(p,g){return g&1&&(i=null),i==null&&(i=!!([jn.start,jn.fetch].includes(p[0])&&st.db.isPersistent)),i?0:p[0]==jn.empty?1:p[0]==jn.ready?2:-1}return~(s=d(n,-1))&&(o=f[s]=h[s](n)),{c(){Q(e.$$.fragment),t=J(),r=W("div"),o&&o.c(),T(r,"style","touch-action: none; pointer-events: auto; "+I.prevent_selection_style+";")},m(p,g){X(e,p,g),B(p,t,g),B(p,r,g),~s&&f[s].m(r,null),a=!0,l||(u=ke(r,"wheel",JC),l=!0)},p(p,g){let b=s;s=d(p,g),s===b?~s&&f[s].p(p,g):(o&&(de(),V(f[b],1,1,()=>{f[b]=null}),_e()),~s?(o=f[s],o?o.p(p,g):(o=f[s]=h[s](p),o.c()),P(o,1),o.m(r,null)):o=null)},i(p){a||(P(e.$$.fragment,p),P(o),a=!0)},o(p){V(e.$$.fragment,p),V(o),a=!1},d(p){p&&(F(t),F(r)),Y(e,p),~s&&f[s].d(),l=!1,u()}}}function QC(n){let e,t=n[1],r,i,s,o,a=E_(n);return{c(){e=J(),a.c(),r=Te()},m(l,u){B(l,e,u),a.m(l,u),B(l,r,u),i=!0,s||(o=ke(document,"keydown",n[5]),s=!0)},p(l,[u]){u&2&&ce(t,t=l[1])?(de(),V(a,1,1,ue),_e(),a=E_(l),a.c(),P(a,1),a.m(r.parentNode,r)):a.p(l,u)},i(l){i||(P(a),i=!0)},o(l){V(a),i=!1},d(l){l&&(F(e),F(r)),a.d(l),s=!1,o()}}}function JC(n){n.preventDefault()}function ZC(n,e,t){let r,i,s,o,a,l,u;$(n,Fe,p=>t(7,r=p)),$(n,mn,p=>t(8,i=p)),$(n,Go,p=>t(0,s=p)),$(n,di,p=>t(6,o=p)),$(n,xn,p=>t(2,a=p)),$(n,tr,p=>t(3,l=p)),$(n,cn,p=>t(4,u=p));var h=this&&this.__awaiter||function(p,g,b,A){function S(v){return v instanceof b?v:new b(function(x){x(v)})}return new(b||(b=Promise))(function(v,x){function E(k){try{z(A.next(k))}catch(y){x(y)}}function L(k){try{z(A.throw(k))}catch(y){x(y)}}function z(k){k.done?v(k.value):S(k.value).then(E,L)}z((A=A.apply(p,g||[])).next())})};let f=0;function d(p){return h(this,void 0,void 0,function*(){if(p.type=="keydown"){const g=p.key;if(g==null)alert("No key for "+p.type);else if(!i&&!ae.isEditing_text){const b=r;switch(g){case"c":Qe.user_graph_offset_setTo(G.zero);break;case"o":b.select_file_toUpload(p.ctrlKey);break;case"s":b.save_toFile();break;case"?":ae.showHelp();break;default:yield b.handle_key_down(p);return}ie.log_key(`PANEL  ${g}`)}}})}return n.$$.update=()=>{n.$$.dirty&67&&t(1,f+=1)},[s,f,a,l,u,d,o]}class $C extends Se{constructor(e){super(),Pe(this,e,ZC,QC,ce,{})}}function eR(n){let e,t;return e=new $C({}),{c(){Q(e.$$.fragment)},m(r,i){X(e,r,i),t=!0},p:ue,i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){V(e.$$.fragment,r),t=!1},d(r){Y(e,r)}}}function tR(n){return ae.startup(),[]}class nR extends Se{constructor(e){super(),Pe(this,e,tR,eR,ce,{})}}new nR({target:document.body});